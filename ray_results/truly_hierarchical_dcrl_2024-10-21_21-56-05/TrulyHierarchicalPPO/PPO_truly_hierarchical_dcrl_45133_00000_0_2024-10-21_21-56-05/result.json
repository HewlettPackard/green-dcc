{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8553805097937583, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.703503584861755, "policy_loss": -0.00021243421360850334, "vf_loss": 9.703580152988433, "vf_explained_var": -0.00033713281154632566, "kl": 0.0006789716650700938, "entropy": 1.396655973792076, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.7122858505696058, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.760191512107848, "policy_loss": -0.0029404856264591216, "vf_loss": 9.762675189971924, "vf_explained_var": -0.00024574771523475645, "kl": 0.0022843944133228433, "entropy": 1.382828126847744, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8243968952447176, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.699362206459046, "policy_loss": -0.0007116872817277909, "vf_loss": 9.699991357326507, "vf_explained_var": -0.00021495893597602844, "kl": 0.00041299659837932266, "entropy": 1.408848947286606, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4841479912400244, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.623868000507354, "policy_loss": -0.00038073647301644086, "vf_loss": 8.623944425582886, "vf_explained_var": 0.0006886623799800873, "kl": 0.0015221057474263944, "entropy": 4.259270322322846, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192, "num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 556.1956158113308, "num_env_steps_trained_throughput_per_sec": 556.1956158113308, "timesteps_total": 2048, "num_env_steps_sampled_lifetime": 2048, "num_agent_steps_sampled_lifetime": 8192, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 8192, "timers": {"training_iteration_time_ms": 3682.17, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3682.099, "sample_time_ms": 2251.32, "learn_time_ms": 1388.207, "learn_throughput": 1475.284, "synch_weights_time_ms": 24.975}, "counters": {"num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192}, "done": false, "training_iteration": 1, "trial_id": "45133_00000", "date": "2024-10-21_21-56-17", "timestamp": 1729547777, "time_this_iter_s": 3.686222553253174, "time_total_s": 3.686222553253174, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae17ac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4670>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4790>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e560>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e620>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 3.686222553253174, "iterations_since_restore": 1, "perf": {"cpu_util_percent": 16.599999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9041969016194343, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.846287381649017, "policy_loss": -0.0005733101279474795, "vf_loss": 9.846844947338104, "vf_explained_var": -0.0008590027689933776, "kl": 0.00015828863505228664, "entropy": 1.3874210447072983, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8913436330854893, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.65352042913437, "policy_loss": -0.0014369531301781536, "vf_loss": 9.654832017421722, "vf_explained_var": -0.0013354569673538208, "kl": 0.0012534172768079686, "entropy": 1.3568561747670174, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1133658356964589, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.580057597160339, "policy_loss": -0.001335944642778486, "vf_loss": 9.581325817108155, "vf_explained_var": -0.0017186850309371948, "kl": 0.000676398665854102, "entropy": 1.4128321453928947, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6844074815511703, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.17053410410881, "policy_loss": -0.004500982933677733, "vf_loss": 8.174433588981628, "vf_explained_var": 0.0020858839154243468, "kl": 0.0060152743207027015, "entropy": 4.28362540602684, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384, "num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 574.7049992690687, "num_env_steps_trained_throughput_per_sec": 574.7049992690687, "timesteps_total": 4096, "num_env_steps_sampled_lifetime": 4096, "num_agent_steps_sampled_lifetime": 16384, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 16384, "timers": {"training_iteration_time_ms": 3622.882, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3622.753, "sample_time_ms": 2244.682, "learn_time_ms": 1320.426, "learn_throughput": 1551.014, "synch_weights_time_ms": 21.179}, "counters": {"num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384}, "done": false, "training_iteration": 2, "trial_id": "45133_00000", "date": "2024-10-21_21-56-21", "timestamp": 1729547781, "time_this_iter_s": 3.5685276985168457, "time_total_s": 7.2547502517700195, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae17910>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeae3e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeae890>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeac580>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aed5ed0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 7.2547502517700195, "iterations_since_restore": 2, "perf": {"cpu_util_percent": 15.0, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9925728127360344, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.890909206867217, "policy_loss": -0.0009265800239518285, "vf_loss": 9.89178866147995, "vf_explained_var": -0.0021206334233283995, "kl": 0.0009413910818750724, "entropy": 1.4110091090202332, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.009444908425212, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.7919682264328, "policy_loss": -0.0046971557545475665, "vf_loss": 9.796440768241883, "vf_explained_var": -0.0006558828055858612, "kl": 0.004490158739851888, "entropy": 1.3204528629779815, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.080501002818346, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.643305313587188, "policy_loss": -0.0005441405985038728, "vf_loss": 9.643826282024383, "vf_explained_var": -0.004873047769069672, "kl": 0.0004654926377668289, "entropy": 1.408673034608364, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.738740211725235, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.32907059788704, "policy_loss": -0.004819092992693186, "vf_loss": 8.333167690038682, "vf_explained_var": -0.0017339855432510376, "kl": 0.007221710180857599, "entropy": 4.189800471067429, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576, "num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 590.6347303429386, "num_env_steps_trained_throughput_per_sec": 590.6347303429386, "timesteps_total": 6144, "num_env_steps_sampled_lifetime": 6144, "num_agent_steps_sampled_lifetime": 24576, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 24576, "timers": {"training_iteration_time_ms": 3571.108, "restore_workers_time_ms": 0.063, "training_step_time_ms": 3570.928, "sample_time_ms": 2196.776, "learn_time_ms": 1316.976, "learn_throughput": 1555.078, "synch_weights_time_ms": 21.845}, "counters": {"num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576}, "done": false, "training_iteration": 3, "trial_id": "45133_00000", "date": "2024-10-21_21-56-24", "timestamp": 1729547784, "time_this_iter_s": 3.4736125469207764, "time_total_s": 10.728362798690796, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fea7af76c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4700>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada40a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4160>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4220>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 10.728362798690796, "iterations_since_restore": 3, "perf": {"cpu_util_percent": 6.38, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4416475974023342, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.74172991514206, "policy_loss": -0.004980432556476444, "vf_loss": 9.746611845493316, "vf_explained_var": -0.0021170258522033693, "kl": 0.003943109698659697, "entropy": 1.4478192254900932, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0302833914756775, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.801692032814026, "policy_loss": -0.0016162961721420289, "vf_loss": 9.803284704685211, "vf_explained_var": -0.001768551766872406, "kl": 0.0009409330704514468, "entropy": 1.3113552555441856, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3020289447158575, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.53102171421051, "policy_loss": -0.0031749902642332017, "vf_loss": 9.534083807468415, "vf_explained_var": -0.005779281258583069, "kl": 0.004515988193429633, "entropy": 1.4022559374570847, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.9175264433026316, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.103130400180817, "policy_loss": -0.0012722746992949396, "vf_loss": 8.104180192947387, "vf_explained_var": 0.004112272709608078, "kl": 0.002224851332349005, "entropy": 4.157047086954117, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768, "num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 554.4483095329689, "num_env_steps_trained_throughput_per_sec": 554.4483095329689, "timesteps_total": 8192, "num_env_steps_sampled_lifetime": 8192, "num_agent_steps_sampled_lifetime": 32768, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 32768, "timers": {"training_iteration_time_ms": 3601.778, "restore_workers_time_ms": 0.057, "training_step_time_ms": 3601.616, "sample_time_ms": 2224.751, "learn_time_ms": 1324.778, "learn_throughput": 1545.919, "synch_weights_time_ms": 20.597}, "counters": {"num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768}, "done": false, "training_iteration": 4, "trial_id": "45133_00000", "date": "2024-10-21_21-56-28", "timestamp": 1729547788, "time_this_iter_s": 3.697875738143921, "time_total_s": 14.426238536834717, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae732e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5330>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5420>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada54e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada55a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 14.426238536834717, "iterations_since_restore": 4, "perf": {"cpu_util_percent": 11.179999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7623555976897478, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.65310800075531, "policy_loss": -0.0014909059042111038, "vf_loss": 9.654559385776519, "vf_explained_var": -0.0009107120335102081, "kl": 0.0031624188765249526, "entropy": 1.4166185170412064, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2188999071717261, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.755440163612366, "policy_loss": -0.0027878415188752116, "vf_loss": 9.758185577392577, "vf_explained_var": -0.005426658689975739, "kl": 0.003400370446759382, "entropy": 1.262347197532654, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4065452616661787, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.746011686325073, "policy_loss": -0.001056448626331985, "vf_loss": 9.747059381008148, "vf_explained_var": 0.0010748773813247681, "kl": 0.0006957989004931165, "entropy": 1.383398950099945, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.879859671741724, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.55844721198082, "policy_loss": -0.008732653956394642, "vf_loss": 7.566604316234589, "vf_explained_var": 5.7022273540496823e-05, "kl": 0.011509702626108327, "entropy": 4.105489033460617, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960, "num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 569.7343652656511, "num_env_steps_trained_throughput_per_sec": 569.7343652656511, "timesteps_total": 10240, "num_env_steps_sampled_lifetime": 10240, "num_agent_steps_sampled_lifetime": 40960, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 40960, "timers": {"training_iteration_time_ms": 3600.357, "restore_workers_time_ms": 0.049, "training_step_time_ms": 3600.211, "sample_time_ms": 2211.251, "learn_time_ms": 1336.259, "learn_throughput": 1532.637, "synch_weights_time_ms": 20.99}, "counters": {"num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960}, "done": false, "training_iteration": 5, "trial_id": "45133_00000", "date": "2024-10-21_21-56-31", "timestamp": 1729547791, "time_this_iter_s": 3.5992143154144287, "time_total_s": 18.025452852249146, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae17910>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5780>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5870>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5930>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada59f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 18.025452852249146, "iterations_since_restore": 5, "perf": {"cpu_util_percent": 19.42, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.274565366655588, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.833420062065125, "policy_loss": -0.0018459367100149393, "vf_loss": 9.83525493144989, "vf_explained_var": -0.005651576817035675, "kl": 0.0017698112373068487, "entropy": 1.4188322961330413, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1530958671122788, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.861869513988495, "policy_loss": -2.724513178691268e-05, "vf_loss": 9.861892569065095, "vf_explained_var": -0.0014715231955051422, "kl": 0.0006597507908737011, "entropy": 1.2807951614260673, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3493962597101927, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.713698935508727, "policy_loss": -0.00045256775338202714, "vf_loss": 9.714145028591156, "vf_explained_var": -4.266873002052307e-05, "kl": 0.0010322442237594715, "entropy": 1.3492048233747482, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8709440499544145, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.569157612323761, "policy_loss": -0.007231760758440941, "vf_loss": 7.575829184055328, "vf_explained_var": -0.0009571455419063568, "kl": 0.01120256269409765, "entropy": 4.055700087547303, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152, "num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 553.6798002148216, "num_env_steps_trained_throughput_per_sec": 553.6798002148216, "timesteps_total": 12288, "num_env_steps_sampled_lifetime": 12288, "num_agent_steps_sampled_lifetime": 49152, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 49152, "timers": {"training_iteration_time_ms": 3616.782, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3616.644, "sample_time_ms": 2223.77, "learn_time_ms": 1340.464, "learn_throughput": 1527.829, "synch_weights_time_ms": 20.912}, "counters": {"num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152}, "done": false, "training_iteration": 6, "trial_id": "45133_00000", "date": "2024-10-21_21-56-35", "timestamp": 1729547795, "time_this_iter_s": 3.7030298709869385, "time_total_s": 21.728482723236084, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bed1b0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4b80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4c70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada48e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4730>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 21.728482723236084, "iterations_since_restore": 6, "perf": {"cpu_util_percent": 18.933333333333334, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.108753127977252, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.828445148468017, "policy_loss": -0.0002616261830553412, "vf_loss": 9.828705489635468, "vf_explained_var": -0.005733232200145722, "kl": 0.0004266234519235565, "entropy": 1.4007255464792252, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.134553848952055, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.89010285139084, "policy_loss": -0.0006306646682787687, "vf_loss": 9.890732228755951, "vf_explained_var": -0.0015662796795368195, "kl": 0.0004338400407412735, "entropy": 1.2846728697419167, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5336730256676674, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.704056477546692, "policy_loss": -0.0017826565657742322, "vf_loss": 9.70583255290985, "vf_explained_var": -3.118738532066345e-05, "kl": 0.002064764189674406, "entropy": 1.3044699788093568, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.321604372560978, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.9481562912464145, "policy_loss": -0.004531183408107609, "vf_loss": 7.952248233556747, "vf_explained_var": 0.0033349595963954926, "kl": 0.008782917703683857, "entropy": 3.9894144982099533, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344, "num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 574.5932074538752, "num_env_steps_trained_throughput_per_sec": 574.5932074538752, "timesteps_total": 14336, "num_env_steps_sampled_lifetime": 14336, "num_agent_steps_sampled_lifetime": 57344, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 57344, "timers": {"training_iteration_time_ms": 3609.282, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3609.15, "sample_time_ms": 2214.93, "learn_time_ms": 1341.58, "learn_throughput": 1526.558, "synch_weights_time_ms": 21.005}, "counters": {"num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344}, "done": false, "training_iteration": 7, "trial_id": "45133_00000", "date": "2024-10-21_21-56-39", "timestamp": 1729547799, "time_this_iter_s": 3.5691099166870117, "time_total_s": 25.297592639923096, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae73010>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeacb80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aed6830>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aed6f20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aed6f80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 25.297592639923096, "iterations_since_restore": 7, "perf": {"cpu_util_percent": 18.919999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4839086044579743, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.7056884765625, "policy_loss": -0.0017140556825324892, "vf_loss": 9.707399451732636, "vf_explained_var": 0.0006118558347225189, "kl": 0.001985737952281852, "entropy": 1.374850831925869, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.069134403206408, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.921605515480042, "policy_loss": -0.0009329435473773628, "vf_loss": 9.922537314891816, "vf_explained_var": -0.0014739774167537689, "kl": 0.0007866840326641977, "entropy": 1.2892608478665353, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2341496523469686, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.929571616649628, "policy_loss": -0.000998140830779448, "vf_loss": 9.93056777715683, "vf_explained_var": -0.0001421339809894562, "kl": 0.001273418545088134, "entropy": 1.2562555074691772, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.913794122636318, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.374785512685776, "policy_loss": -0.007224074029363692, "vf_loss": 7.381387776136398, "vf_explained_var": -0.0022366061806678773, "kl": 0.012436979737026583, "entropy": 3.9009654849767683, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536, "num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 545.1956059311386, "num_env_steps_trained_throughput_per_sec": 545.1956059311386, "timesteps_total": 16384, "num_env_steps_sampled_lifetime": 16384, "num_agent_steps_sampled_lifetime": 65536, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 65536, "timers": {"training_iteration_time_ms": 3627.681, "restore_workers_time_ms": 0.04, "training_step_time_ms": 3627.553, "sample_time_ms": 2231.556, "learn_time_ms": 1342.754, "learn_throughput": 1525.224, "synch_weights_time_ms": 21.04}, "counters": {"num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536}, "done": false, "training_iteration": 8, "trial_id": "45133_00000", "date": "2024-10-21_21-56-43", "timestamp": 1729547803, "time_this_iter_s": 3.7609386444091797, "time_total_s": 29.058531284332275, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae72b90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5900>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5870>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5750>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada56f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 29.058531284332275, "iterations_since_restore": 8, "perf": {"cpu_util_percent": 19.94, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4848339281976224, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.840555226802826, "policy_loss": -0.0027835616609081628, "vf_loss": 9.84333678483963, "vf_explained_var": 0.000982964038848877, "kl": 0.002639537423056046, "entropy": 1.363803593814373, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1461073104292154, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.87013487815857, "policy_loss": -0.0005172951961867512, "vf_loss": 9.870651817321777, "vf_explained_var": -0.000983498990535736, "kl": 0.0003092000504295811, "entropy": 1.3030786573886872, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3539564065635203, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.838203561305999, "policy_loss": -0.004500533902319148, "vf_loss": 9.842695224285126, "vf_explained_var": 1.1057406663894653e-05, "kl": 0.011362026283927662, "entropy": 1.2239285930991173, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.162783399224281, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.033327710628509, "policy_loss": -0.004442737472709268, "vf_loss": 8.037372463941574, "vf_explained_var": -0.00036367177963256834, "kl": 0.007959146946814325, "entropy": 3.821231058239937, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728, "num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 560.9829771390839, "num_env_steps_trained_throughput_per_sec": 560.9829771390839, "timesteps_total": 18432, "num_env_steps_sampled_lifetime": 18432, "num_agent_steps_sampled_lifetime": 73728, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 73728, "timers": {"training_iteration_time_ms": 3630.244, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3630.121, "sample_time_ms": 2231.801, "learn_time_ms": 1345.498, "learn_throughput": 1522.113, "synch_weights_time_ms": 20.887}, "counters": {"num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728}, "done": false, "training_iteration": 9, "trial_id": "45133_00000", "date": "2024-10-21_21-56-46", "timestamp": 1729547806, "time_this_iter_s": 3.6555328369140625, "time_total_s": 32.71406412124634, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bedcf0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4f10>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5000>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada50c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5180>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 32.71406412124634, "iterations_since_restore": 9, "perf": {"cpu_util_percent": 18.78, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1323303282260895, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.4662935256958, "policy_loss": -0.0049853116739541296, "vf_loss": 9.471276926994324, "vf_explained_var": -0.0010577201843261718, "kl": 0.005319739362194321, "entropy": 1.4534360826015473, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2038882687687873, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.88230003118515, "policy_loss": -0.0003391261852812022, "vf_loss": 9.882639002799987, "vf_explained_var": -0.00016596987843513488, "kl": 0.0005298876815956532, "entropy": 1.300069934129715, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5160580161958932, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.650562131404877, "policy_loss": -0.0028707563469652086, "vf_loss": 9.653429710865021, "vf_explained_var": -0.0001467578113079071, "kl": 0.003966597854480369, "entropy": 1.261766168475151, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.911801505088806, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.981210082769394, "policy_loss": -0.0035000694158952685, "vf_loss": 7.984309202432632, "vf_explained_var": 0.0017141737043857574, "kl": 0.008018827375917682, "entropy": 3.779756987094879, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": 602.3678501294302, "episode_reward_mean": 2497.014779857111, "episode_len_mean": 2432.0, "episode_media": {}, "episodes_timesteps_total": 7296, "policy_reward_min": {"high_level_policy": 1003.6366932741887, "DC1_ls_policy": -3679.826600716275, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 1146.5513904770853}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 2152.1562373117576, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1431.4286007806497, "DC1_ls_policy": -2485.698439365288, "DC2_ls_policy": 2107.9237209230305, "DC3_ls_policy": 1443.3608975187228}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 97171.63175065961, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 100559.57172123007, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.4805929487179487, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.37958333333333333, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.621346153846154, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 74002.26232871071, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71508.03723194441, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 84272.74209380914, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 88916.02801426886, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.010416666666666666, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.03125, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.15243055555555554, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.23333333333333334, "accumulated/bat_CO2_footprint_sum_mean": 77314137.21899557, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 83118964.71557009, "accumulated/ls_tasks_dropped_sum_mean": 52.98825988247862, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 77.20052083333333, "accumulated/ls_overdue_penalty_sum_mean": 396.5528979700855, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 528.7305689102565}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514], "episode_lengths": [2400, 2496, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5856087846121688, "mean_inference_ms": 2.1226395856864, "mean_action_processing_ms": 0.3218133515031887, "mean_env_wait_ms": 4.176837771444384, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003979603449503581, "StateBufferConnector_ms": 0.0023305416107177734, "ViewRequirementAgentConnector_ms": 0.05182425181070963}, "num_episodes": 3, "episode_return_max": 3853.597797251453, "episode_return_min": 602.3678501294302, "episode_return_mean": 2497.014779857111, "episodes_this_iter": 3}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920, "num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 549.3415137025619, "num_env_steps_trained_throughput_per_sec": 549.3415137025619, "timesteps_total": 20480, "num_env_steps_sampled_lifetime": 20480, "num_agent_steps_sampled_lifetime": 81920, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 81920, "timers": {"training_iteration_time_ms": 3640.032, "restore_workers_time_ms": 0.037, "training_step_time_ms": 3639.911, "sample_time_ms": 2248.233, "learn_time_ms": 1335.533, "learn_throughput": 1533.47, "synch_weights_time_ms": 20.384}, "counters": {"num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920}, "done": false, "training_iteration": 10, "trial_id": "45133_00000", "date": "2024-10-21_21-56-50", "timestamp": 1729547810, "time_this_iter_s": 3.733827590942383, "time_total_s": 36.44789171218872, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae73010>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6890>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6980>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6a40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6b00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 36.44789171218872, "iterations_since_restore": 10, "perf": {"cpu_util_percent": 8.9, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4817806720733642, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.665591824054719, "policy_loss": -0.005331132630817592, "vf_loss": 9.670920753479004, "vf_explained_var": -0.00028589144349098203, "kl": 0.005537604716994424, "entropy": 1.5636696949601174, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.031641562283039, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.93763438463211, "policy_loss": -0.00109909173916094, "vf_loss": 9.938733410835265, "vf_explained_var": 0.0006981194019317627, "kl": 0.0012619531708850766, "entropy": 1.2592164725065231, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.509193492308259, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.81103390455246, "policy_loss": -0.003954985737800598, "vf_loss": 9.814986789226532, "vf_explained_var": -0.0003089800477027893, "kl": 0.0056484796954379135, "entropy": 1.2675708547234534, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.401477847993374, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.708211731910706, "policy_loss": -0.0053807883756235245, "vf_loss": 7.713107073307038, "vf_explained_var": -0.000950717180967331, "kl": 0.009707994440213951, "entropy": 3.663678598403931, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": 602.3678501294302, "episode_reward_mean": 2043.5562105423783, "episode_len_mean": 2520.0, "episode_media": {}, "episodes_timesteps_total": 10080, "policy_reward_min": {"high_level_policy": 1003.6366932741887, "DC1_ls_policy": -3936.934378437615, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 708.298311374226}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 2528.7582863050466, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1419.3360214246215, "DC1_ls_policy": -2848.5074241333696, "DC2_ls_policy": 2213.1323622685345, "DC3_ls_policy": 1259.5952509825986}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 97719.81612105155, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 100559.57172123007, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.44772919429708224, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.34913793103448276, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.8326583222811674, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 73751.07972975314, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71508.03723194441, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 85154.22907291737, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 88916.02801426886, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.04454022988505747, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.32059087643678164, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.8250718390804598, "accumulated/bat_CO2_footprint_sum_mean": 80573632.85764691, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 90352119.77360095, "accumulated/ls_tasks_dropped_sum_mean": 51.75340755553713, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 77.20052083333333, "accumulated/ls_overdue_penalty_sum_mean": 460.00694179652965, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 650.3690732758621}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179], "episode_lengths": [2400, 2496, 2400, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5889624861571413, "mean_inference_ms": 2.119897858769168, "mean_action_processing_ms": 0.3216686713659928, "mean_env_wait_ms": 4.187365419986284, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003649294376373291, "StateBufferConnector_ms": 0.0023484230041503906, "ViewRequirementAgentConnector_ms": 0.05161762237548828}, "num_episodes": 1, "episode_return_max": 3853.597797251453, "episode_return_min": 602.3678501294302, "episode_return_mean": 2043.5562105423783, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112, "num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 536.3793538459098, "num_env_steps_trained_throughput_per_sec": 536.3793538459098, "timesteps_total": 22528, "num_env_steps_sampled_lifetime": 22528, "num_agent_steps_sampled_lifetime": 90112, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 90112, "timers": {"training_iteration_time_ms": 3653.636, "restore_workers_time_ms": 0.038, "training_step_time_ms": 3653.514, "sample_time_ms": 2270.524, "learn_time_ms": 1325.576, "learn_throughput": 1544.989, "synch_weights_time_ms": 20.356}, "counters": {"num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112}, "done": false, "training_iteration": 11, "trial_id": "45133_00000", "date": "2024-10-21_21-56-54", "timestamp": 1729547814, "time_this_iter_s": 3.823615074157715, "time_total_s": 40.271506786346436, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae14dc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5180>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5150>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4f70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5030>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 40.271506786346436, "iterations_since_restore": 11, "perf": {"cpu_util_percent": 6.683333333333334, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8572445262223483, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.412774193286896, "policy_loss": -0.0026554759475402533, "vf_loss": 9.415427756309509, "vf_explained_var": -8.462369441986084e-06, "kl": 0.005158645479494339, "entropy": 1.6063264071941377, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0091178242117167, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.942104256153106, "policy_loss": -0.0010344667593017221, "vf_loss": 9.943138575553894, "vf_explained_var": -0.000549190491437912, "kl": 0.0016031771764091311, "entropy": 1.224049262702465, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6113965973258018, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.631495666503906, "policy_loss": -0.0004601650987751782, "vf_loss": 9.631955242156982, "vf_explained_var": -0.00041781216859817507, "kl": 0.0012306000589205723, "entropy": 1.2727635860443116, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.027422097325325, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.835997462272644, "policy_loss": -0.002691072737798095, "vf_loss": 7.838297259807587, "vf_explained_var": -0.0006770268082618713, "kl": 0.007824577557676345, "entropy": 3.556639465689659, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": 602.3678501294302, "episode_reward_mean": 2043.5562105423783, "episode_len_mean": 2520.0, "episode_media": {}, "episodes_timesteps_total": 10080, "policy_reward_min": {"high_level_policy": 1003.6366932741887, "DC1_ls_policy": -3936.934378437615, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 708.298311374226}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 2528.7582863050466, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1419.3360214246215, "DC1_ls_policy": -2848.5074241333696, "DC2_ls_policy": 2213.1323622685345, "DC3_ls_policy": 1259.5952509825986}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 97719.81612105155, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 100559.57172123007, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.44772919429708224, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.34913793103448276, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.8326583222811674, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 73751.07972975314, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71508.03723194441, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 85154.22907291737, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 88916.02801426886, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.04454022988505747, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.32059087643678164, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.8250718390804598, "accumulated/bat_CO2_footprint_sum_mean": 80573632.85764691, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 90352119.77360095, "accumulated/ls_tasks_dropped_sum_mean": 51.75340755553713, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 77.20052083333333, "accumulated/ls_overdue_penalty_sum_mean": 460.00694179652965, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 650.3690732758621}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179], "episode_lengths": [2400, 2496, 2400, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5889624861571413, "mean_inference_ms": 2.119897858769168, "mean_action_processing_ms": 0.3216686713659928, "mean_env_wait_ms": 4.187365419986284, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003649294376373291, "StateBufferConnector_ms": 0.0023484230041503906, "ViewRequirementAgentConnector_ms": 0.05161762237548828}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": 602.3678501294302, "episode_return_mean": 2043.5562105423783, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304, "num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 568.2775899051433, "num_env_steps_trained_throughput_per_sec": 568.2775899051433, "timesteps_total": 24576, "num_env_steps_sampled_lifetime": 24576, "num_agent_steps_sampled_lifetime": 98304, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 98304, "timers": {"training_iteration_time_ms": 3657.665, "restore_workers_time_ms": 0.033, "training_step_time_ms": 3657.556, "sample_time_ms": 2272.859, "learn_time_ms": 1330.041, "learn_throughput": 1539.802, "synch_weights_time_ms": 21.084}, "counters": {"num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304}, "done": false, "training_iteration": 12, "trial_id": "45133_00000", "date": "2024-10-21_21-56-58", "timestamp": 1729547818, "time_this_iter_s": 3.608083486557007, "time_total_s": 43.87959027290344, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bee8c0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada65f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6530>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada66b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6ce0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 43.87959027290344, "iterations_since_restore": 12, "perf": {"cpu_util_percent": 18.82, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7639729790389538, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.365023982524871, "policy_loss": -0.0007596892770379782, "vf_loss": 9.365783774852753, "vf_explained_var": -0.00023454651236534118, "kl": 0.000533479823971561, "entropy": 1.5363131269812584, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1729490838944912, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.92537567615509, "policy_loss": -0.0005892733810469508, "vf_loss": 9.925964951515198, "vf_explained_var": -0.00014177039265632628, "kl": 0.00025075029904932935, "entropy": 1.2021829530596733, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4039625264704227, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.657920622825623, "policy_loss": -0.0029587880475446583, "vf_loss": 9.66087863445282, "vf_explained_var": -0.0006163880228996277, "kl": 0.0036571963049937552, "entropy": 1.2121276289224625, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.772123697400093, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.445579963922501, "policy_loss": -0.008228577417321503, "vf_loss": 8.45296146273613, "vf_explained_var": 0.00034735947847366335, "kl": 0.016942876419119797, "entropy": 3.398901975154877, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": 602.3678501294302, "episode_reward_mean": 2043.5562105423783, "episode_len_mean": 2520.0, "episode_media": {}, "episodes_timesteps_total": 10080, "policy_reward_min": {"high_level_policy": 1003.6366932741887, "DC1_ls_policy": -3936.934378437615, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 708.298311374226}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 2528.7582863050466, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1419.3360214246215, "DC1_ls_policy": -2848.5074241333696, "DC2_ls_policy": 2213.1323622685345, "DC3_ls_policy": 1259.5952509825986}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 97719.81612105155, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 100559.57172123007, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.44772919429708224, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.34913793103448276, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.8326583222811674, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 73751.07972975314, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71508.03723194441, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 85154.22907291737, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 88916.02801426886, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.04454022988505747, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.32059087643678164, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.8250718390804598, "accumulated/bat_CO2_footprint_sum_mean": 80573632.85764691, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 90352119.77360095, "accumulated/ls_tasks_dropped_sum_mean": 51.75340755553713, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 77.20052083333333, "accumulated/ls_overdue_penalty_sum_mean": 460.00694179652965, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 650.3690732758621}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179], "episode_lengths": [2400, 2496, 2400, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5889624861571413, "mean_inference_ms": 2.119897858769168, "mean_action_processing_ms": 0.3216686713659928, "mean_env_wait_ms": 4.187365419986284, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003649294376373291, "StateBufferConnector_ms": 0.0023484230041503906, "ViewRequirementAgentConnector_ms": 0.05161762237548828}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": 602.3678501294302, "episode_return_mean": 2043.5562105423783, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496, "num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 537.0637850317995, "num_env_steps_trained_throughput_per_sec": 537.0637850317995, "timesteps_total": 26624, "num_env_steps_sampled_lifetime": 26624, "num_agent_steps_sampled_lifetime": 106496, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 106496, "timers": {"training_iteration_time_ms": 3692.243, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3692.155, "sample_time_ms": 2298.02, "learn_time_ms": 1337.235, "learn_throughput": 1531.519, "synch_weights_time_ms": 21.376}, "counters": {"num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496}, "done": false, "training_iteration": 13, "trial_id": "45133_00000", "date": "2024-10-21_21-57-01", "timestamp": 1729547821, "time_this_iter_s": 3.8200371265411377, "time_total_s": 47.69962739944458, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae17be0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5bd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6fb0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7070>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada74f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 47.69962739944458, "iterations_since_restore": 13, "perf": {"cpu_util_percent": 19.466666666666665, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6829843912273645, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.36696230173111, "policy_loss": -0.002940268418751657, "vf_loss": 9.369902050495147, "vf_explained_var": -0.0002129293978214264, "kl": 0.00304588829067255, "entropy": 1.5186524271965027, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1930940564721824, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.920008623600006, "policy_loss": -0.0012204276397824287, "vf_loss": 9.92122904062271, "vf_explained_var": 0.0010445885360240935, "kl": 0.0011877518194751246, "entropy": 1.1786049246788024, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4640904814004898, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.54268581867218, "policy_loss": -0.00037453940603882074, "vf_loss": 9.543060290813447, "vf_explained_var": -0.0002737388014793396, "kl": 0.0004899071166106585, "entropy": 1.1992820635437966, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.328132589161396, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.230266451835632, "policy_loss": -0.001833275833632797, "vf_loss": 8.23166599869728, "vf_explained_var": 0.0004836156964302063, "kl": 0.008676215701927958, "entropy": 3.3015969693660736, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -626.396882882358, "episode_reward_mean": 1436.0254050527612, "episode_len_mean": 2816.0, "episode_media": {}, "episodes_timesteps_total": 16896, "policy_reward_min": {"high_level_policy": 663.638324430605, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 414.3061483365836}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 3406.365838679606, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1198.7628146268546, "DC1_ls_policy": -3360.8214620517906, "DC2_ls_policy": 2565.03118945454, "DC3_ls_policy": 1033.0528630231627}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 98936.77235643349, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 103571.30645533987, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.4434527851751271, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.34913793103448276, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.9271183347835645, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 72727.16340406988, "DC2_ls_policy/bat_CO2_footprint_sum_min": 67837.08033722173, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 90720.13214522648, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 102432.78532873327, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.029693486590038315, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4272124251201119, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.8250718390804598, "accumulated/bat_CO2_footprint_sum_mean": 91846289.84921364, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 115713984.08158334, "accumulated/ls_tasks_dropped_sum_mean": 79.69440856711735, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 137.55104166666666, "accumulated/ls_overdue_penalty_sum_mean": 714.8268070282639, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 1263.1922619047618}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5885806629400262, "mean_inference_ms": 2.127166490720079, "mean_action_processing_ms": 0.32301204735582, "mean_env_wait_ms": 4.233693664515263, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003399451573689779, "StateBufferConnector_ms": 0.002361337343851725, "ViewRequirementAgentConnector_ms": 0.05162358283996582}, "num_episodes": 2, "episode_return_max": 3853.597797251453, "episode_return_min": -626.396882882358, "episode_return_mean": 1436.0254050527612, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688, "num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 555.8776544735258, "num_env_steps_trained_throughput_per_sec": 555.8776544735258, "timesteps_total": 28672, "num_env_steps_sampled_lifetime": 28672, "num_agent_steps_sampled_lifetime": 114688, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 114688, "timers": {"training_iteration_time_ms": 3691.293, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3691.205, "sample_time_ms": 2290.17, "learn_time_ms": 1341.108, "learn_throughput": 1527.095, "synch_weights_time_ms": 21.817}, "counters": {"num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688}, "done": false, "training_iteration": 14, "trial_id": "45133_00000", "date": "2024-10-21_21-57-05", "timestamp": 1729547825, "time_this_iter_s": 3.6905999183654785, "time_total_s": 51.39022731781006, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef910>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0220>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0340>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0400>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0130>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 51.39022731781006, "iterations_since_restore": 14, "perf": {"cpu_util_percent": 19.759999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5050444222986699, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.357222902774812, "policy_loss": -0.0021935396012850105, "vf_loss": 9.359416449069977, "vf_explained_var": -4.632249474525452e-05, "kl": 0.0031512254664449535, "entropy": 1.5799773946404456, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0745276413857936, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.939805507659912, "policy_loss": -0.0039255997748114165, "vf_loss": 9.94373116493225, "vf_explained_var": 0.0010948620736598968, "kl": 0.0051402882215029425, "entropy": 1.188787442445755, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5484551057219504, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.65398200750351, "policy_loss": -0.0034494783612899482, "vf_loss": 9.657431077957153, "vf_explained_var": -0.00018835216760635377, "kl": 0.006559714039387643, "entropy": 1.1915854603052138, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.549097202718258, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.811436021327973, "policy_loss": -0.004631695873104036, "vf_loss": 8.815658497810364, "vf_explained_var": 0.0009217485785484314, "kl": 0.008186800249586668, "entropy": 3.2561420500278473, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -626.396882882358, "episode_reward_mean": 1436.0254050527612, "episode_len_mean": 2816.0, "episode_media": {}, "episodes_timesteps_total": 16896, "policy_reward_min": {"high_level_policy": 663.638324430605, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 414.3061483365836}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 3406.365838679606, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1198.7628146268546, "DC1_ls_policy": -3360.8214620517906, "DC2_ls_policy": 2565.03118945454, "DC3_ls_policy": 1033.0528630231627}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 98936.77235643349, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 103571.30645533987, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.4434527851751271, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.34913793103448276, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.9271183347835645, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 72727.16340406988, "DC2_ls_policy/bat_CO2_footprint_sum_min": 67837.08033722173, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 90720.13214522648, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 102432.78532873327, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.029693486590038315, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4272124251201119, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.8250718390804598, "accumulated/bat_CO2_footprint_sum_mean": 91846289.84921364, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 115713984.08158334, "accumulated/ls_tasks_dropped_sum_mean": 79.69440856711735, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 137.55104166666666, "accumulated/ls_overdue_penalty_sum_mean": 714.8268070282639, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 1263.1922619047618}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5885806629400262, "mean_inference_ms": 2.127166490720079, "mean_action_processing_ms": 0.32301204735582, "mean_env_wait_ms": 4.233693664515263, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003399451573689779, "StateBufferConnector_ms": 0.002361337343851725, "ViewRequirementAgentConnector_ms": 0.05162358283996582}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": -626.396882882358, "episode_return_mean": 1436.0254050527612, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880, "num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 535.9475079405377, "num_env_steps_trained_throughput_per_sec": 535.9475079405377, "timesteps_total": 30720, "num_env_steps_sampled_lifetime": 30720, "num_agent_steps_sampled_lifetime": 122880, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 122880, "timers": {"training_iteration_time_ms": 3713.954, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3713.866, "sample_time_ms": 2317.913, "learn_time_ms": 1336.284, "learn_throughput": 1532.608, "synch_weights_time_ms": 21.388}, "counters": {"num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880}, "done": false, "training_iteration": 15, "trial_id": "45133_00000", "date": "2024-10-21_21-57-09", "timestamp": 1729547829, "time_this_iter_s": 3.8282265663146973, "time_total_s": 55.218453884124756, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beedd0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0760>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0850>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0910>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada09d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 55.218453884124756, "iterations_since_restore": 15, "perf": {"cpu_util_percent": 19.54, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.533101563155651, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.548696649074554, "policy_loss": -0.0011197266518138348, "vf_loss": 9.549816477298737, "vf_explained_var": 1.1593103408813476e-06, "kl": 0.0013091528811173703, "entropy": 1.5645167171955108, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1846640072762966, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.907560312747956, "policy_loss": -0.0010972206480801105, "vf_loss": 9.90865774154663, "vf_explained_var": -0.00029530823230743407, "kl": 0.0008205038069945658, "entropy": 1.1671777814626694, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7601421996951103, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.270052933692932, "policy_loss": -0.0030011571710929275, "vf_loss": 9.273053967952729, "vf_explained_var": -0.0009632855653762817, "kl": 0.004168158495872465, "entropy": 1.1446479260921478, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.094453971087932, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.302427732944489, "policy_loss": -0.006062704004580155, "vf_loss": 8.307997977733612, "vf_explained_var": 0.0007013022899627685, "kl": 0.009847953358598716, "entropy": 3.2572853922843934, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -626.396882882358, "episode_reward_mean": 1368.3111491053858, "episode_len_mean": 2989.714285714286, "episode_media": {}, "episodes_timesteps_total": 20928, "policy_reward_min": {"high_level_policy": 609.2270527246297, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 326.77351793376624}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 4306.195320420563, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1114.543420069394, "DC1_ls_policy": -3492.157007138369, "DC2_ls_policy": 2813.768922449686, "DC3_ls_policy": 932.1558137246774}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 100519.57895075272, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 110016.41851666819, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.4124507433020364, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.22643849206349206, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.841228980834892, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 72283.94979765978, "DC2_ls_policy/bat_CO2_footprint_sum_min": 67837.08033722173, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 91732.11531831035, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 102432.78532873327, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.025451559934318555, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.45263332583991456, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.8250718390804598, "accumulated/bat_CO2_footprint_sum_mean": 97917275.73241058, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 134343191.03159225, "accumulated/ls_tasks_dropped_sum_mean": 80.55211458530694, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 137.55104166666666, "accumulated/ls_overdue_penalty_sum_mean": 827.0271264040449, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 1500.2290426587301}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5872442379779194, "mean_inference_ms": 2.1232451745174292, "mean_action_processing_ms": 0.3224516566260326, "mean_env_wait_ms": 4.2425564716236455, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003281661442347935, "StateBufferConnector_ms": 0.0023373535701206754, "ViewRequirementAgentConnector_ms": 0.05142177854265485}, "num_episodes": 1, "episode_return_max": 3853.597797251453, "episode_return_min": -626.396882882358, "episode_return_mean": 1368.3111491053858, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072, "num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 567.5819557252308, "num_env_steps_trained_throughput_per_sec": 567.5819557252308, "timesteps_total": 32768, "num_env_steps_sampled_lifetime": 32768, "num_agent_steps_sampled_lifetime": 131072, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 131072, "timers": {"training_iteration_time_ms": 3704.894, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3704.805, "sample_time_ms": 2307.425, "learn_time_ms": 1337.289, "learn_throughput": 1531.456, "synch_weights_time_ms": 21.545}, "counters": {"num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072}, "done": false, "training_iteration": 16, "trial_id": "45133_00000", "date": "2024-10-21_21-57-13", "timestamp": 1729547833, "time_this_iter_s": 3.613515853881836, "time_total_s": 58.83196973800659, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27befe20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada11b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6fe0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5bd0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4580>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 58.83196973800659, "iterations_since_restore": 16, "perf": {"cpu_util_percent": 19.200000000000003, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.223468867689371, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.699262404441834, "policy_loss": -0.0036237235646694897, "vf_loss": 9.702886128425598, "vf_explained_var": -0.00011218488216400147, "kl": 0.003679299230611832, "entropy": 1.6505353599786758, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1755106067284942, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.948059844970704, "policy_loss": -0.0019146301550790668, "vf_loss": 9.949974524974824, "vf_explained_var": -1.410841941833496e-05, "kl": 0.004116164966615088, "entropy": 1.1156886756420135, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6740279279649257, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.75686297416687, "policy_loss": -0.0041496768360957505, "vf_loss": 9.761012780666352, "vf_explained_var": -0.00039927363395690917, "kl": 0.00486316226986226, "entropy": 1.2093387871980668, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4018975526094435, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.233770287036895, "policy_loss": -0.0031205374514684083, "vf_loss": 9.236489045619965, "vf_explained_var": 0.0007050931453704834, "kl": 0.008036189568701956, "entropy": 3.239726942777634, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -626.396882882358, "episode_reward_mean": 1368.3111491053858, "episode_len_mean": 2989.714285714286, "episode_media": {}, "episodes_timesteps_total": 20928, "policy_reward_min": {"high_level_policy": 609.2270527246297, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 326.77351793376624}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 4306.195320420563, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1114.543420069394, "DC1_ls_policy": -3492.157007138369, "DC2_ls_policy": 2813.768922449686, "DC3_ls_policy": 932.1558137246774}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 100519.57895075272, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 110016.41851666819, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.4124507433020364, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.22643849206349206, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.841228980834892, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 72283.94979765978, "DC2_ls_policy/bat_CO2_footprint_sum_min": 67837.08033722173, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 91732.11531831035, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 102432.78532873327, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.025451559934318555, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.45263332583991456, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.8250718390804598, "accumulated/bat_CO2_footprint_sum_mean": 97917275.73241058, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 134343191.03159225, "accumulated/ls_tasks_dropped_sum_mean": 80.55211458530694, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 137.55104166666666, "accumulated/ls_overdue_penalty_sum_mean": 827.0271264040449, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 1500.2290426587301}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5872442379779194, "mean_inference_ms": 2.1232451745174292, "mean_action_processing_ms": 0.3224516566260326, "mean_env_wait_ms": 4.2425564716236455, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003281661442347935, "StateBufferConnector_ms": 0.0023373535701206754, "ViewRequirementAgentConnector_ms": 0.05142177854265485}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": -626.396882882358, "episode_return_mean": 1368.3111491053858, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264, "num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 550.573093397008, "num_env_steps_trained_throughput_per_sec": 550.573093397008, "timesteps_total": 34816, "num_env_steps_sampled_lifetime": 34816, "num_agent_steps_sampled_lifetime": 139264, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 139264, "timers": {"training_iteration_time_ms": 3720.445, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3720.352, "sample_time_ms": 2332.748, "learn_time_ms": 1325.683, "learn_throughput": 1544.865, "synch_weights_time_ms": 21.208}, "counters": {"num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264}, "done": false, "training_iteration": 17, "trial_id": "45133_00000", "date": "2024-10-21_21-57-16", "timestamp": 1729547836, "time_this_iter_s": 3.7274627685546875, "time_total_s": 62.55943250656128, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beeb90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5f90>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada42b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4460>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada63e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 62.55943250656128, "iterations_since_restore": 17, "perf": {"cpu_util_percent": 10.74, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9201853185892106, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.390152418613434, "policy_loss": -0.002892578043974936, "vf_loss": 9.393044936656953, "vf_explained_var": 6.739124655723572e-05, "kl": 0.008271015827745032, "entropy": 1.431065283715725, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1773269079625606, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.95241700410843, "policy_loss": -0.0015806450159288944, "vf_loss": 9.95399762392044, "vf_explained_var": 0.0005212083458900451, "kl": 0.003735271576722824, "entropy": 1.0669847771525383, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7657638214528562, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.64248492717743, "policy_loss": -0.00857578496215865, "vf_loss": 9.65106076002121, "vf_explained_var": -0.000938589870929718, "kl": 0.010606546205701829, "entropy": 1.203268326818943, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8714239314198493, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.51264083981514, "policy_loss": -0.002911068149842322, "vf_loss": 8.515127301216125, "vf_explained_var": -0.0009615659713745117, "kl": 0.00849241569672229, "entropy": 3.2007398784160612, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -626.396882882358, "episode_reward_mean": 1368.3111491053858, "episode_len_mean": 2989.714285714286, "episode_media": {}, "episodes_timesteps_total": 20928, "policy_reward_min": {"high_level_policy": 609.2270527246297, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": 326.77351793376624}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 4306.195320420563, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 1114.543420069394, "DC1_ls_policy": -3492.157007138369, "DC2_ls_policy": 2813.768922449686, "DC3_ls_policy": 932.1558137246774}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 100519.57895075272, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 110016.41851666819, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.4124507433020364, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.22643849206349206, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.841228980834892, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.8125, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 72283.94979765978, "DC2_ls_policy/bat_CO2_footprint_sum_min": 67837.08033722173, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 91732.11531831035, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 102432.78532873327, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.025451559934318555, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.45263332583991456, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 0.8250718390804598, "accumulated/bat_CO2_footprint_sum_mean": 97917275.73241058, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 134343191.03159225, "accumulated/ls_tasks_dropped_sum_mean": 80.55211458530694, "accumulated/ls_tasks_dropped_sum_min": 40.8544671474359, "accumulated/ls_tasks_dropped_sum_max": 137.55104166666666, "accumulated/ls_overdue_penalty_sum_mean": 827.0271264040449, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 1500.2290426587301}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5872442379779194, "mean_inference_ms": 2.1232451745174292, "mean_action_processing_ms": 0.3224516566260326, "mean_env_wait_ms": 4.2425564716236455, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003281661442347935, "StateBufferConnector_ms": 0.0023373535701206754, "ViewRequirementAgentConnector_ms": 0.05142177854265485}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": -626.396882882358, "episode_return_mean": 1368.3111491053858, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456, "num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 596.5777561338244, "num_env_steps_trained_throughput_per_sec": 596.5777561338244, "timesteps_total": 36864, "num_env_steps_sampled_lifetime": 36864, "num_agent_steps_sampled_lifetime": 147456, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 147456, "timers": {"training_iteration_time_ms": 3688.093, "restore_workers_time_ms": 0.026, "training_step_time_ms": 3687.998, "sample_time_ms": 2310.728, "learn_time_ms": 1313.023, "learn_throughput": 1559.76, "synch_weights_time_ms": 20.659}, "counters": {"num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456}, "done": false, "training_iteration": 18, "trial_id": "45133_00000", "date": "2024-10-21_21-57-20", "timestamp": 1729547840, "time_this_iter_s": 3.4400734901428223, "time_total_s": 65.9995059967041, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae72b00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4fd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5120>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5690>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5ab0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 65.9995059967041, "iterations_since_restore": 18, "perf": {"cpu_util_percent": 6.24, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7556943394243718, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.245922553539277, "policy_loss": -0.0005452421843074262, "vf_loss": 9.246467816829682, "vf_explained_var": 0.00023094117641448976, "kl": 0.0012722183182631852, "entropy": 1.5642645925283432, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3867111966013907, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.92586520910263, "policy_loss": 0.0001482904073782265, "vf_loss": 9.925716960430146, "vf_explained_var": -0.0002267494797706604, "kl": 0.0006109098827609668, "entropy": 1.0238908216357232, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8759793791919948, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.26210813522339, "policy_loss": -0.003622571693267673, "vf_loss": 9.2657306432724, "vf_explained_var": -0.003447602689266205, "kl": 0.004742667263229805, "entropy": 1.188674482703209, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.653657282888889, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.655250787734985, "policy_loss": -0.0037920864997431636, "vf_loss": 8.658514189720155, "vf_explained_var": 0.0003277912735939026, "kl": 0.010574505658405921, "entropy": 3.1243988633155824, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 791.1357096942157, "episode_len_mean": 2858.6666666666665, "episode_media": {}, "episodes_timesteps_total": 25728, "policy_reward_min": {"high_level_policy": -9.773771999837688, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 4306.195320420563, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 918.4299808686707, "DC1_ls_policy": -3206.375516513209, "DC2_ls_policy": 2893.120439585222, "DC3_ls_policy": 185.9608057535351}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 101640.0562741812, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 110016.41851666819, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.3549616892349172, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0875, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.597529948056769, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.2504166666666667, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 68099.8219973217, "DC2_ls_policy/bat_CO2_footprint_sum_min": 53041.46344436682, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 98269.17385601236, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.022249361430395916, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.8757981423199335, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 94528438.67241415, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 134343191.03159225, "accumulated/ls_tasks_dropped_sum_mean": 78.8927789367202, "accumulated/ls_tasks_dropped_sum_min": 27.658541666666668, "accumulated/ls_tasks_dropped_sum_max": 137.55104166666666, "accumulated/ls_overdue_penalty_sum_mean": 1030.344211740183, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2140.658125}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5879482998196234, "mean_inference_ms": 2.121339755461106, "mean_action_processing_ms": 0.32225090552424146, "mean_env_wait_ms": 4.25767933478725, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035544236501057944, "StateBufferConnector_ms": 0.0023497475518120658, "ViewRequirementAgentConnector_ms": 0.05199975437588162}, "num_episodes": 2, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 791.1357096942157, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648, "num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 541.4597836665743, "num_env_steps_trained_throughput_per_sec": 541.4597836665743, "timesteps_total": 38912, "num_env_steps_sampled_lifetime": 38912, "num_agent_steps_sampled_lifetime": 155648, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 155648, "timers": {"training_iteration_time_ms": 3701.256, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3701.162, "sample_time_ms": 2337.813, "learn_time_ms": 1299.709, "learn_throughput": 1575.737, "synch_weights_time_ms": 19.982}, "counters": {"num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648}, "done": false, "training_iteration": 19, "trial_id": "45133_00000", "date": "2024-10-21_21-57-24", "timestamp": 1729547844, "time_this_iter_s": 3.7873854637145996, "time_total_s": 69.7868914604187, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bee9e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6920>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6b30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6a10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4b50>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 69.7868914604187, "iterations_since_restore": 19, "perf": {"cpu_util_percent": 15.959999999999999, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6461751967668534, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.266840088367463, "policy_loss": -0.002843607123941183, "vf_loss": 9.269683682918549, "vf_explained_var": 0.0009763658046722413, "kl": 0.0048890741009928185, "entropy": 1.5582308873534203, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2660007648169995, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.93507777452469, "policy_loss": -0.000939226383343339, "vf_loss": 9.936017084121705, "vf_explained_var": 0.0036037445068359377, "kl": 0.002002354297593584, "entropy": 1.01852448284626, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5782825402915477, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.613828921318055, "policy_loss": -0.0012258414295502006, "vf_loss": 9.615054857730865, "vf_explained_var": -0.0029202505946159365, "kl": 0.0011241316846736418, "entropy": 1.2043640673160554, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4579524241387842, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.079794728755951, "policy_loss": -0.0017919212696142495, "vf_loss": 9.081242561340332, "vf_explained_var": 0.00015460401773452758, "kl": 0.0068795702512946645, "entropy": 3.0508924216032027, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 729.9314079149581, "episode_len_mean": 2822.4, "episode_media": {}, "episodes_timesteps_total": 28224, "policy_reward_min": {"high_level_policy": -9.773771999837688, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 4306.195320420563, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 825.8400599195772, "DC1_ls_policy": -3061.4838329591066, "DC2_ls_policy": 2923.9022429386596, "DC3_ls_policy": 41.67293801583098}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 102128.34084023033, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 110016.41851666819, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.3194655203114255, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.4564868891485276, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.187099358974359, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 67017.07552286565, "DC2_ls_policy/bat_CO2_footprint_sum_min": 53041.46344436682, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 100577.69294874763, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.020024425287356325, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.8974330716776837, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 93446817.41983894, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 134343191.03159225, "accumulated/ls_tasks_dropped_sum_mean": 71.00350104304819, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 137.55104166666666, "accumulated/ls_overdue_penalty_sum_mean": 1040.4197064315492, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2140.658125}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5875225048564061, "mean_inference_ms": 2.1246192148380745, "mean_action_processing_ms": 0.32172480115266416, "mean_env_wait_ms": 4.263339485433384, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035071372985839844, "StateBufferConnector_ms": 0.0024008750915527344, "ViewRequirementAgentConnector_ms": 0.05237698554992676}, "num_episodes": 1, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 729.9314079149581, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840, "num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 554.2571982040123, "num_env_steps_trained_throughput_per_sec": 554.2571982040123, "timesteps_total": 40960, "num_env_steps_sampled_lifetime": 40960, "num_agent_steps_sampled_lifetime": 163840, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 163840, "timers": {"training_iteration_time_ms": 3697.95, "restore_workers_time_ms": 0.026, "training_step_time_ms": 3697.858, "sample_time_ms": 2343.749, "learn_time_ms": 1296.505, "learn_throughput": 1579.632, "synch_weights_time_ms": 19.488}, "counters": {"num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840}, "done": false, "training_iteration": 20, "trial_id": "45133_00000", "date": "2024-10-21_21-57-28", "timestamp": 1729547848, "time_this_iter_s": 3.701183557510376, "time_total_s": 73.48807501792908, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beeb00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada11e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1360>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1540>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1630>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 73.48807501792908, "iterations_since_restore": 20, "perf": {"cpu_util_percent": 19.166666666666664, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9035984449088574, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.342749404907227, "policy_loss": -0.0010573028994258493, "vf_loss": 9.343806600570678, "vf_explained_var": 0.0016718931496143342, "kl": 0.0014729674532192399, "entropy": 1.6271987050771712, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2742053937166928, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.94324986934662, "policy_loss": -0.0011314355535432697, "vf_loss": 9.944381380081177, "vf_explained_var": 0.0006334155797958374, "kl": 0.0033109880923349634, "entropy": 0.9848116151988506, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.130058507621288, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.302035784721374, "policy_loss": -0.006247505475766957, "vf_loss": 9.308283340930938, "vf_explained_var": -0.0013649538159370422, "kl": 0.011317055559698091, "entropy": 1.1818142846226691, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.890032468736172, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.715448117256164, "policy_loss": -0.003618745494168252, "vf_loss": 8.718646812438966, "vf_explained_var": -0.0005148351192474365, "kl": 0.00839934896300747, "entropy": 2.987667927145958, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 768.5402248793769, "episode_len_mean": 3037.090909090909, "episode_media": {}, "episodes_timesteps_total": 33408, "policy_reward_min": {"high_level_policy": -9.773771999837688, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1554.0330457241166, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 791.3529197435101, "DC1_ls_policy": -3189.477780479281, "DC2_ls_policy": 3190.1816108958064, "DC3_ls_policy": -23.516525280655276}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 102596.30545203341, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 110016.41851666819, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.31269452463777175, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.4103233784627465, "DC1_ls_policy/ls_overdue_penalty_sum_min": 2.187099358974359, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 66911.20033699277, "DC2_ls_policy/bat_CO2_footprint_sum_min": 53041.46344436682, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 101212.92614887422, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.018274168891984986, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.9130003232984554, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101375904.19568934, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 81.06582744233337, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1174.1244884857517, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5873691576392315, "mean_inference_ms": 2.1260393021526056, "mean_action_processing_ms": 0.3218094902651138, "mean_env_wait_ms": 4.2706573844375955, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003445148468017578, "StateBufferConnector_ms": 0.0024069439281116834, "ViewRequirementAgentConnector_ms": 0.05228952928022905}, "num_episodes": 1, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 768.5402248793769, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032, "num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 611.486087802525, "num_env_steps_trained_throughput_per_sec": 611.486087802525, "timesteps_total": 43008, "num_env_steps_sampled_lifetime": 43008, "num_agent_steps_sampled_lifetime": 172032, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 172032, "timers": {"training_iteration_time_ms": 3651.051, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3650.96, "sample_time_ms": 2304.265, "learn_time_ms": 1290.381, "learn_throughput": 1587.128, "synch_weights_time_ms": 18.254}, "counters": {"num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032}, "done": false, "training_iteration": 21, "trial_id": "45133_00000", "date": "2024-10-21_21-57-31", "timestamp": 1729547851, "time_this_iter_s": 3.3540682792663574, "time_total_s": 76.84214329719543, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bee9e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada05e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2530>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2680>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0db70>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 76.84214329719543, "iterations_since_restore": 21, "perf": {"cpu_util_percent": 19.675, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3763940408825874, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.665589690208435, "policy_loss": -0.0024153877515345813, "vf_loss": 9.668005001544952, "vf_explained_var": 0.0023562856018543243, "kl": 0.0035531568654846523, "entropy": 1.431051343679428, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3276946227997541, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.94033612012863, "policy_loss": -0.004036181839182973, "vf_loss": 9.944372296333313, "vf_explained_var": 8.037462830543519e-05, "kl": 0.008957916064270186, "entropy": 0.8664809122681618, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8375675477087499, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.308038794994355, "policy_loss": -0.002486765303183347, "vf_loss": 9.310525512695312, "vf_explained_var": -0.00023917555809020995, "kl": 0.007310222745053352, "entropy": 1.1633200839161872, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.263660663366318, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.696327817440032, "policy_loss": -0.004496655060211197, "vf_loss": 8.700334417819978, "vf_explained_var": 0.00021779239177703856, "kl": 0.0097981508394696, "entropy": 2.9487205505371095, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 748.0282227395854, "episode_len_mean": 3016.0, "episode_media": {}, "episodes_timesteps_total": 36192, "policy_reward_min": {"high_level_policy": -9.773771999837688, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1442.421914904963, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 726.9965249342048, "DC1_ls_policy": -3043.889791681421, "DC2_ls_policy": 3243.491555760802, "DC3_ls_policy": -178.57006627399744}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 103498.99853023324, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 113428.62239043128, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.28888161884899194, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.267712617996981, "DC1_ls_policy/ls_overdue_penalty_sum_min": 1.6989942528735633, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 65391.20540437574, "DC2_ls_policy/bat_CO2_footprint_sum_min": 48671.26114558838, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 102991.64168813621, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01675132148431957, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.9695498653224347, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100937014.41296399, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 75.44916336188989, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1188.049421856671, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5883152631996357, "mean_inference_ms": 2.1274959591987987, "mean_action_processing_ms": 0.32170786515311584, "mean_env_wait_ms": 4.273541350087046, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033835570017496743, "StateBufferConnector_ms": 0.0024080276489257812, "ViewRequirementAgentConnector_ms": 0.05218038956324259}, "num_episodes": 1, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 748.0282227395854, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224, "num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 575.2717387402591, "num_env_steps_trained_throughput_per_sec": 575.2717387402591, "timesteps_total": 45056, "num_env_steps_sampled_lifetime": 45056, "num_agent_steps_sampled_lifetime": 180224, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 180224, "timers": {"training_iteration_time_ms": 3646.671, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3646.578, "sample_time_ms": 2308.435, "learn_time_ms": 1282.702, "learn_throughput": 1596.63, "synch_weights_time_ms": 16.939}, "counters": {"num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224}, "done": false, "training_iteration": 22, "trial_id": "45133_00000", "date": "2024-10-21_21-57-35", "timestamp": 1729547855, "time_this_iter_s": 3.5648398399353027, "time_total_s": 80.40698313713074, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bee290>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6fb0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4c70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6800>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada45e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 80.40698313713074, "iterations_since_restore": 22, "perf": {"cpu_util_percent": 19.349999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6564355056732893, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.31185302734375, "policy_loss": -0.0025235080276615916, "vf_loss": 9.314376664161681, "vf_explained_var": 0.0036551177501678465, "kl": 0.0023454234209113827, "entropy": 1.6313696205615997, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.522504348680377, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.932139837741852, "policy_loss": -0.004432119405828416, "vf_loss": 9.936571931838989, "vf_explained_var": 0.00022957101464271545, "kl": 0.008765836377870376, "entropy": 0.771991528570652, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2674318697303533, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.852921807765961, "policy_loss": -0.0008971286471933127, "vf_loss": 9.853818833827972, "vf_explained_var": -3.4189224243164064e-05, "kl": 0.0016555037629473837, "entropy": 1.3357426792383194, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4253890812397003, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.21389547586441, "policy_loss": -0.0037250650697387756, "vf_loss": 9.217255759239197, "vf_explained_var": -1.4265626668930054e-05, "kl": 0.007294118102709894, "entropy": 3.051132047176361, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 748.0282227395854, "episode_len_mean": 3016.0, "episode_media": {}, "episodes_timesteps_total": 36192, "policy_reward_min": {"high_level_policy": -9.773771999837688, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1442.421914904963, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 726.9965249342048, "DC1_ls_policy": -3043.889791681421, "DC2_ls_policy": 3243.491555760802, "DC3_ls_policy": -178.57006627399744}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 103498.99853023324, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 113428.62239043128, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.28888161884899194, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.267712617996981, "DC1_ls_policy/ls_overdue_penalty_sum_min": 1.6989942528735633, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 65391.20540437574, "DC2_ls_policy/bat_CO2_footprint_sum_min": 48671.26114558838, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 102991.64168813621, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01675132148431957, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.9695498653224347, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100937014.41296399, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 75.44916336188989, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1188.049421856671, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5883152631996357, "mean_inference_ms": 2.1274959591987987, "mean_action_processing_ms": 0.32170786515311584, "mean_env_wait_ms": 4.273541350087046, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033835570017496743, "StateBufferConnector_ms": 0.0024080276489257812, "ViewRequirementAgentConnector_ms": 0.05218038956324259}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 748.0282227395854, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416, "num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 613.6990963980019, "num_env_steps_trained_throughput_per_sec": 613.6990963980019, "timesteps_total": 47104, "num_env_steps_sampled_lifetime": 47104, "num_agent_steps_sampled_lifetime": 188416, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 188416, "timers": {"training_iteration_time_ms": 3599.052, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3598.962, "sample_time_ms": 2283.796, "learn_time_ms": 1265.166, "learn_throughput": 1618.76, "synch_weights_time_ms": 15.361}, "counters": {"num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416}, "done": false, "training_iteration": 23, "trial_id": "45133_00000", "date": "2024-10-21_21-57-38", "timestamp": 1729547858, "time_this_iter_s": 3.343086004257202, "time_total_s": 83.75006914138794, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae73130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1f00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2320>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2410>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada25f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 83.75006914138794, "iterations_since_restore": 23, "perf": {"cpu_util_percent": 20.075000000000003, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4322114497423173, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.669573080539703, "policy_loss": -0.0032555114827118813, "vf_loss": 9.672828769683838, "vf_explained_var": 0.006080277264118195, "kl": 0.007070011234119988, "entropy": 1.3647784307599067, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6552927039563656, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.93303781747818, "policy_loss": -0.0005814280826598406, "vf_loss": 9.933619225025177, "vf_explained_var": 0.0015405915677547456, "kl": 0.003900189482783734, "entropy": 0.7573208317160607, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7240677796304227, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.350049018859863, "policy_loss": -0.002390989544801414, "vf_loss": 9.352440094947815, "vf_explained_var": -0.00011234134435653687, "kl": 0.003798045011447534, "entropy": 1.2463673934340478, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.928188329935074, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.773983013629913, "policy_loss": -0.003848894662223756, "vf_loss": 8.777385449409485, "vf_explained_var": 3.1659752130508424e-05, "kl": 0.008927281550131737, "entropy": 3.0187646776437758, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 748.0282227395854, "episode_len_mean": 3016.0, "episode_media": {}, "episodes_timesteps_total": 36192, "policy_reward_min": {"high_level_policy": -9.773771999837688, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1442.421914904963, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 726.9965249342048, "DC1_ls_policy": -3043.889791681421, "DC2_ls_policy": 3243.491555760802, "DC3_ls_policy": -178.57006627399744}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 103498.99853023324, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 113428.62239043128, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.28888161884899194, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.267712617996981, "DC1_ls_policy/ls_overdue_penalty_sum_min": 1.6989942528735633, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 65391.20540437574, "DC2_ls_policy/bat_CO2_footprint_sum_min": 48671.26114558838, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 102991.64168813621, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01675132148431957, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.9695498653224347, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100937014.41296399, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 75.44916336188989, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1188.049421856671, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5883152631996357, "mean_inference_ms": 2.1274959591987987, "mean_action_processing_ms": 0.32170786515311584, "mean_env_wait_ms": 4.273541350087046, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033835570017496743, "StateBufferConnector_ms": 0.0024080276489257812, "ViewRequirementAgentConnector_ms": 0.05218038956324259}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 748.0282227395854, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608, "num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 592.6091754122028, "num_env_steps_trained_throughput_per_sec": 592.6091754122028, "timesteps_total": 49152, "num_env_steps_sampled_lifetime": 49152, "num_agent_steps_sampled_lifetime": 196608, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 196608, "timers": {"training_iteration_time_ms": 3576.215, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3576.129, "sample_time_ms": 2283.214, "learn_time_ms": 1247.155, "learn_throughput": 1642.137, "synch_weights_time_ms": 14.272}, "counters": {"num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608}, "done": false, "training_iteration": 24, "trial_id": "45133_00000", "date": "2024-10-21_21-57-41", "timestamp": 1729547861, "time_this_iter_s": 3.4604501724243164, "time_total_s": 87.21051931381226, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bee9e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada50f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5d80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6fe0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6dd0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 87.21051931381226, "iterations_since_restore": 24, "perf": {"cpu_util_percent": 19.48, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6660142730921508, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.49922126531601, "policy_loss": -0.0026455414365045725, "vf_loss": 9.50186687707901, "vf_explained_var": 0.00672837644815445, "kl": 0.0043496352137225355, "entropy": 1.4783254832029342, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6290986500680447, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.9244025349617, "policy_loss": -0.001746646239189431, "vf_loss": 9.926149129867554, "vf_explained_var": -0.00033347904682159426, "kl": 0.0026892153722542387, "entropy": 0.7715008728206157, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.52966593131423, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.61874383687973, "policy_loss": -0.0015537303872406483, "vf_loss": 9.620297586917877, "vf_explained_var": -6.353706121444702e-05, "kl": 0.0016188847178536616, "entropy": 1.2841115310788154, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.117703552544117, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.472912263870239, "policy_loss": 8.572497172281146e-05, "vf_loss": 8.472629153728485, "vf_explained_var": -0.00017622709274291992, "kl": 0.00394864900539492, "entropy": 3.060105022788048, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 748.0282227395854, "episode_len_mean": 3016.0, "episode_media": {}, "episodes_timesteps_total": 36192, "policy_reward_min": {"high_level_policy": -9.773771999837688, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1442.421914904963, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 726.9965249342048, "DC1_ls_policy": -3043.889791681421, "DC2_ls_policy": 3243.491555760802, "DC3_ls_policy": -178.57006627399744}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 103498.99853023324, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 113428.62239043128, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.28888161884899194, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.267712617996981, "DC1_ls_policy/ls_overdue_penalty_sum_min": 1.6989942528735633, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 65391.20540437574, "DC2_ls_policy/bat_CO2_footprint_sum_min": 48671.26114558838, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 102991.64168813621, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01675132148431957, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.9695498653224347, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100937014.41296399, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 75.44916336188989, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1188.049421856671, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5883152631996357, "mean_inference_ms": 2.1274959591987987, "mean_action_processing_ms": 0.32170786515311584, "mean_env_wait_ms": 4.273541350087046, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033835570017496743, "StateBufferConnector_ms": 0.0024080276489257812, "ViewRequirementAgentConnector_ms": 0.05218038956324259}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 748.0282227395854, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800, "num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 591.6383977759186, "num_env_steps_trained_throughput_per_sec": 591.6383977759186, "timesteps_total": 51200, "num_env_steps_sampled_lifetime": 51200, "num_agent_steps_sampled_lifetime": 204800, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 204800, "timers": {"training_iteration_time_ms": 3540.245, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3540.16, "sample_time_ms": 2255.12, "learn_time_ms": 1240.996, "learn_throughput": 1650.287, "synch_weights_time_ms": 13.659}, "counters": {"num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800}, "done": false, "training_iteration": 25, "trial_id": "45133_00000", "date": "2024-10-21_21-57-45", "timestamp": 1729547865, "time_this_iter_s": 3.469700813293457, "time_total_s": 90.68022012710571, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bee290>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6620>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7dc0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada43a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4cd0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 90.68022012710571, "iterations_since_restore": 25, "perf": {"cpu_util_percent": 9.2, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.763864553719759, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.34035928249359, "policy_loss": -0.0022146027418784796, "vf_loss": 9.34257389307022, "vf_explained_var": 0.010513919591903686, "kl": 0.0022996519028312067, "entropy": 1.4893806383013726, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5989448715001344, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.940689671039582, "policy_loss": -0.0014924333430826665, "vf_loss": 9.942182111740113, "vf_explained_var": 0.0014799796044826508, "kl": 0.0026792121122756426, "entropy": 0.7429546684026718, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.644583198428154, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.624548399448395, "policy_loss": -0.0007354549481533468, "vf_loss": 9.625283730030059, "vf_explained_var": -4.072785377502441e-05, "kl": 0.00425146302964099, "entropy": 1.296340648829937, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5596638202667235, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.01551033258438, "policy_loss": -0.0023849424440413715, "vf_loss": 9.017680478096008, "vf_explained_var": 0.0001816876232624054, "kl": 0.008590250447424199, "entropy": 3.0075549364089964, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 748.0282227395854, "episode_len_mean": 3016.0, "episode_media": {}, "episodes_timesteps_total": 36192, "policy_reward_min": {"high_level_policy": -9.773771999837688, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1442.421914904963, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 726.9965249342048, "DC1_ls_policy": -3043.889791681421, "DC2_ls_policy": 3243.491555760802, "DC3_ls_policy": -178.57006627399744}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 103498.99853023324, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 113428.62239043128, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.28888161884899194, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.267712617996981, "DC1_ls_policy/ls_overdue_penalty_sum_min": 1.6989942528735633, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 65391.20540437574, "DC2_ls_policy/bat_CO2_footprint_sum_min": 48671.26114558838, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 102991.64168813621, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01675132148431957, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.9695498653224347, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100937014.41296399, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 75.44916336188989, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1188.049421856671, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5883152631996357, "mean_inference_ms": 2.1274959591987987, "mean_action_processing_ms": 0.32170786515311584, "mean_env_wait_ms": 4.273541350087046, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033835570017496743, "StateBufferConnector_ms": 0.0024080276489257812, "ViewRequirementAgentConnector_ms": 0.05218038956324259}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 748.0282227395854, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992, "num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 555.709318986306, "num_env_steps_trained_throughput_per_sec": 555.709318986306, "timesteps_total": 53248, "num_env_steps_sampled_lifetime": 53248, "num_agent_steps_sampled_lifetime": 212992, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 212992, "timers": {"training_iteration_time_ms": 3547.954, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3547.867, "sample_time_ms": 2279.961, "learn_time_ms": 1226.77, "learn_throughput": 1669.425, "synch_weights_time_ms": 12.457}, "counters": {"num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992}, "done": false, "training_iteration": 26, "trial_id": "45133_00000", "date": "2024-10-21_21-57-49", "timestamp": 1729547869, "time_this_iter_s": 3.690235137939453, "time_total_s": 94.37045526504517, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beea70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a5c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b820>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b5b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61ae30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 94.37045526504517, "iterations_since_restore": 26, "perf": {"cpu_util_percent": 6.3500000000000005, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2876783579587936, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.697097206115723, "policy_loss": -0.0025854000239633025, "vf_loss": 9.699682509899139, "vf_explained_var": 0.004547381401062011, "kl": 0.005038677713355355, "entropy": 1.2313359081745148, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7033300317823887, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.923068833351135, "policy_loss": -0.004010102967731655, "vf_loss": 9.927079045772553, "vf_explained_var": -0.00022143200039863585, "kl": 0.00726147570055422, "entropy": 0.6895015984773636, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7795195195823907, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.377335715293885, "policy_loss": -0.005047828660462983, "vf_loss": 9.38238354921341, "vf_explained_var": -3.861859440803528e-05, "kl": 0.008704959161025377, "entropy": 1.1890566244721412, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.564006152749061, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.235025644302368, "policy_loss": -0.004676068254048005, "vf_loss": 8.239491415023803, "vf_explained_var": -0.00022959858179092408, "kl": 0.008413135315777512, "entropy": 3.038291272521019, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 865.1298181735152, "episode_len_mean": 3072.0, "episode_media": {}, "episodes_timesteps_total": 43008, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1027.5105632671498, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 568.7883323910715, "DC1_ls_policy": -2848.913883575738, "DC2_ls_policy": 3467.1732930529474, "DC3_ls_policy": -321.9179236947628}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 106010.85843380932, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 122174.0363726423, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.24761281615627878, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.957410489462265, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.8706597222222222, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 63140.9842579015, "DC2_ls_policy/bat_CO2_footprint_sum_min": 48671.26114558838, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 105411.86080575603, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.015309003071215715, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.9360556149097815, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103812567.51328297, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 65.33758479960932, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1138.8468847809163, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5888463897156955, "mean_inference_ms": 2.1320160167642843, "mean_action_processing_ms": 0.3221303412959534, "mean_env_wait_ms": 4.284804792403479, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032974140984671457, "StateBufferConnector_ms": 0.002417394093104771, "ViewRequirementAgentConnector_ms": 0.05250317709786551}, "num_episodes": 2, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 865.1298181735152, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184, "num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 595.9964409236059, "num_env_steps_trained_throughput_per_sec": 595.9964409236059, "timesteps_total": 55296, "num_env_steps_sampled_lifetime": 55296, "num_agent_steps_sampled_lifetime": 221184, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 221184, "timers": {"training_iteration_time_ms": 3519.603, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3519.523, "sample_time_ms": 2258.117, "learn_time_ms": 1224.357, "learn_throughput": 1672.714, "synch_weights_time_ms": 11.915}, "counters": {"num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184}, "done": false, "training_iteration": 27, "trial_id": "45133_00000", "date": "2024-10-21_21-57-52", "timestamp": 1729547872, "time_this_iter_s": 3.4419798851013184, "time_total_s": 97.81243515014648, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bedc60>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada04f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada00a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0280>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0760>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 97.81243515014648, "iterations_since_restore": 27, "perf": {"cpu_util_percent": 19.72, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6966039679944516, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.26120330095291, "policy_loss": -0.0025069179304409773, "vf_loss": 9.263710224628449, "vf_explained_var": 0.009259185940027236, "kl": 0.0034163252023122017, "entropy": 1.4764127299189567, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8175652116537093, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.922249352931976, "policy_loss": -0.0016256866976618767, "vf_loss": 9.92387501001358, "vf_explained_var": -0.00020591467618942262, "kl": 0.003193619900898511, "entropy": 0.6447463527321815, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6273118712008, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.637299060821533, "policy_loss": -0.002135337970685214, "vf_loss": 9.639434385299683, "vf_explained_var": -6.715878844261169e-05, "kl": 0.0036167627772556443, "entropy": 1.2166033446788789, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4812564074993135, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.309286367893218, "policy_loss": -0.0064853796386159955, "vf_loss": 9.315499758720398, "vf_explained_var": -0.00011393949389457703, "kl": 0.010880431124678977, "entropy": 3.0690575748682023, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376}, "env_runners": {"episode_reward_max": 3853.597797251453, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 865.1298181735152, "episode_len_mean": 3072.0, "episode_media": {}, "episodes_timesteps_total": 43008, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -1027.5105632671498, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 568.7883323910715, "DC1_ls_policy": -2848.913883575738, "DC2_ls_policy": 3467.1732930529474, "DC3_ls_policy": -321.9179236947628}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 106010.85843380932, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 122174.0363726423, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.24761281615627878, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.957410489462265, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.8706597222222222, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 63140.9842579015, "DC2_ls_policy/bat_CO2_footprint_sum_min": 48671.26114558838, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 105411.86080575603, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.015309003071215715, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.9360556149097815, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103812567.51328297, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 65.33758479960932, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1138.8468847809163, "accumulated/ls_overdue_penalty_sum_min": 288.4596875, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5888463897156955, "mean_inference_ms": 2.1320160167642843, "mean_action_processing_ms": 0.3221303412959534, "mean_env_wait_ms": 4.284804792403479, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032974140984671457, "StateBufferConnector_ms": 0.002417394093104771, "ViewRequirementAgentConnector_ms": 0.05250317709786551}, "num_episodes": 0, "episode_return_max": 3853.597797251453, "episode_return_min": -2216.1845545339484, "episode_return_mean": 865.1298181735152, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376, "num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 580.4768793757833, "num_env_steps_trained_throughput_per_sec": 580.4768793757833, "timesteps_total": 57344, "num_env_steps_sampled_lifetime": 57344, "num_agent_steps_sampled_lifetime": 229376, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 229376, "timers": {"training_iteration_time_ms": 3529.123, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3529.049, "sample_time_ms": 2274.719, "learn_time_ms": 1222.868, "learn_throughput": 1674.751, "synch_weights_time_ms": 11.36}, "counters": {"num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376}, "done": false, "training_iteration": 28, "trial_id": "45133_00000", "date": "2024-10-21_21-57-56", "timestamp": 1729547876, "time_this_iter_s": 3.5330586433410645, "time_total_s": 101.34549379348755, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef5b0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada70a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7520>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7610>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7bb0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 101.34549379348755, "iterations_since_restore": 28, "perf": {"cpu_util_percent": 19.419999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.325723397359252, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.262134683132171, "policy_loss": -0.0023248579120263456, "vf_loss": 9.264459455013276, "vf_explained_var": 0.006415415555238724, "kl": 0.003250494090752909, "entropy": 1.2678298339247704, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9203589849174023, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.911682486534119, "policy_loss": -0.0009540004888549447, "vf_loss": 9.912636506557465, "vf_explained_var": 0.0002766050398349762, "kl": 0.002167479791603455, "entropy": 0.647833839058876, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.912071280181408, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.320173120498657, "policy_loss": -0.0012759486213326453, "vf_loss": 9.321449017524719, "vf_explained_var": 3.211796283721924e-05, "kl": 0.0009096840398229368, "entropy": 1.2091874748468399, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6732460379600527, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.678506302833558, "policy_loss": 0.0003368078207131475, "vf_loss": 8.678050184249878, "vf_explained_var": -4.7478824853897095e-05, "kl": 0.004771808209443407, "entropy": 3.0766599833965302, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1151.4716551127644, "episode_len_mean": 2988.0, "episode_media": {}, "episodes_timesteps_total": 47808, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 504.47165393815493, "DC1_ls_policy": -2535.96127680703, "DC2_ls_policy": 3455.635772516147, "DC3_ls_policy": -272.6744945345066}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 107877.55440656436, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 126039.7542083882, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.21666121413674394, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.6234893866128153, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 61526.041856695156, "DC2_ls_policy/bat_CO2_footprint_sum_min": 47853.45370480695, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106323.35548252464, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013395377687313751, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.8363142880460589, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101468881.08980583, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 57.17038669965815, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 1013.7128536103852, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5893906997303808, "mean_inference_ms": 2.129899168619013, "mean_action_processing_ms": 0.322023378456127, "mean_env_wait_ms": 4.2893598794650085, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003448501229286194, "StateBufferConnector_ms": 0.002417340874671936, "ViewRequirementAgentConnector_ms": 0.05269646644592285}, "num_episodes": 2, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1151.4716551127644, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568, "num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 587.5189768364605, "num_env_steps_trained_throughput_per_sec": 587.5189768364605, "timesteps_total": 59392, "num_env_steps_sampled_lifetime": 59392, "num_agent_steps_sampled_lifetime": 237568, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 237568, "timers": {"training_iteration_time_ms": 3499.47, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3499.398, "sample_time_ms": 2245.146, "learn_time_ms": 1224.588, "learn_throughput": 1672.399, "synch_weights_time_ms": 11.133}, "counters": {"num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568}, "done": false, "training_iteration": 29, "trial_id": "45133_00000", "date": "2024-10-21_21-57-59", "timestamp": 1729547879, "time_this_iter_s": 3.4918174743652344, "time_total_s": 104.83731126785278, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beea70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0100>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada19f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0040>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada03d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 104.83731126785278, "iterations_since_restore": 29, "perf": {"cpu_util_percent": 18.82, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7593647971749307, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.363342726230622, "policy_loss": -0.006427929585333914, "vf_loss": 9.369770658016204, "vf_explained_var": 0.00961502194404602, "kl": 0.00782860717586142, "entropy": 1.288164184987545, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7833146635442971, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.929013800621032, "policy_loss": -0.0029863683157600462, "vf_loss": 9.932000136375427, "vf_explained_var": 1.4349073171615601e-05, "kl": 0.0056897767674858775, "entropy": 0.6229628950357438, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0206102930009364, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.223112094402314, "policy_loss": -0.0033867134246975184, "vf_loss": 9.226498711109162, "vf_explained_var": 1.6864389181137085e-05, "kl": 0.00505512959070997, "entropy": 1.1365897253155708, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.804393522441387, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.317423033714295, "policy_loss": -0.0023026171256788075, "vf_loss": 8.319642555713653, "vf_explained_var": 0.00010645389556884766, "kl": 0.006651509036441894, "entropy": 3.1087225556373594, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1131.4732746016666, "episode_len_mean": 2959.0588235294117, "episode_media": {}, "episodes_timesteps_total": 50304, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 441.04032056035334, "DC1_ls_policy": -2496.3440356973338, "DC2_ls_policy": 3462.9280929910224, "DC3_ls_policy": -276.1511032523741}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 108997.71331123805, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 126920.25578601706, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.20391643683458252, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.539938540341473, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60688.21192114969, "DC2_ls_policy/bat_CO2_footprint_sum_min": 47282.932952422154, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107262.71248428506, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.012607414293942354, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.8094373917658232, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101052945.4185753, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 53.80742277614885, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 984.7567701683716, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.589307336336348, "mean_inference_ms": 2.130811212773033, "mean_action_processing_ms": 0.3217568471709307, "mean_env_wait_ms": 4.291549608687113, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003399217829984777, "StateBufferConnector_ms": 0.002412235035615809, "ViewRequirementAgentConnector_ms": 0.05257480284746956}, "num_episodes": 1, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1131.4732746016666, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760, "num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 604.5316850910654, "num_env_steps_trained_throughput_per_sec": 604.5316850910654, "timesteps_total": 61440, "num_env_steps_sampled_lifetime": 61440, "num_agent_steps_sampled_lifetime": 245760, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 245760, "timers": {"training_iteration_time_ms": 3468.74, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3468.671, "sample_time_ms": 2214.117, "learn_time_ms": 1225.068, "learn_throughput": 1671.743, "synch_weights_time_ms": 11.04}, "counters": {"num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760}, "done": false, "training_iteration": 30, "trial_id": "45133_00000", "date": "2024-10-21_21-58-03", "timestamp": 1729547883, "time_this_iter_s": 3.393432855606079, "time_total_s": 108.23074412345886, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bedc60>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2b00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2fb0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2e30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3490>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 108.23074412345886, "iterations_since_restore": 30, "perf": {"cpu_util_percent": 18.919999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.569767838716507, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.406304490566253, "policy_loss": -0.0015805689268745481, "vf_loss": 9.407885134220123, "vf_explained_var": 0.007386809587478638, "kl": 0.006808510761311481, "entropy": 1.52313794195652, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7280075952410698, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.932587325572968, "policy_loss": -0.002536063181469217, "vf_loss": 9.935123419761657, "vf_explained_var": 0.000324210524559021, "kl": 0.0040549467203447875, "entropy": 0.6347111515700817, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8060717768967152, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.308344304561615, "policy_loss": -0.0015370727516710759, "vf_loss": 9.309881353378296, "vf_explained_var": -1.420825719833374e-05, "kl": 0.0021398126927011513, "entropy": 1.1351842120289803, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.509409840404987, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.92954317331314, "policy_loss": -0.0017643237370066345, "vf_loss": 8.93124086856842, "vf_explained_var": -9.972751140594483e-05, "kl": 0.005330850423070516, "entropy": 3.109177586436272, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1131.4732746016666, "episode_len_mean": 2959.0588235294117, "episode_media": {}, "episodes_timesteps_total": 50304, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5852.975290467279, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 441.04032056035334, "DC1_ls_policy": -2496.3440356973338, "DC2_ls_policy": 3462.9280929910224, "DC3_ls_policy": -276.1511032523741}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 108997.71331123805, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 126920.25578601706, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.20391643683458252, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.539938540341473, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60688.21192114969, "DC2_ls_policy/bat_CO2_footprint_sum_min": 47282.932952422154, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107262.71248428506, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.012607414293942354, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.8094373917658232, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101052945.4185753, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 53.80742277614885, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 984.7567701683716, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.589307336336348, "mean_inference_ms": 2.130811212773033, "mean_action_processing_ms": 0.3217568471709307, "mean_env_wait_ms": 4.291549608687113, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003399217829984777, "StateBufferConnector_ms": 0.002412235035615809, "ViewRequirementAgentConnector_ms": 0.05257480284746956}, "num_episodes": 0, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1131.4732746016666, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952, "num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 563.5379504696886, "num_env_steps_trained_throughput_per_sec": 563.5379504696886, "timesteps_total": 63488, "num_env_steps_sampled_lifetime": 63488, "num_agent_steps_sampled_lifetime": 253952, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 253952, "timers": {"training_iteration_time_ms": 3497.238, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3497.165, "sample_time_ms": 2245.455, "learn_time_ms": 1223.844, "learn_throughput": 1673.416, "synch_weights_time_ms": 10.958}, "counters": {"num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952}, "done": false, "training_iteration": 31, "trial_id": "45133_00000", "date": "2024-10-21_21-58-07", "timestamp": 1729547887, "time_this_iter_s": 3.6390998363494873, "time_total_s": 111.86984395980835, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a998c10>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada30a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61ae30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a619150>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a260>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 111.86984395980835, "iterations_since_restore": 31, "perf": {"cpu_util_percent": 19.04, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0017880886793136, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.4656551361084, "policy_loss": -0.002310714276973158, "vf_loss": 9.467965888977051, "vf_explained_var": 0.007597914338111878, "kl": 0.002231900863523606, "entropy": 1.3651844441890717, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7553963996469975, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.925514733791351, "policy_loss": -0.0006907855859026313, "vf_loss": 9.926205515861511, "vf_explained_var": 7.783696055412293e-05, "kl": 0.002262015653355369, "entropy": 0.6776582926511765, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7673294488340616, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.443943822383881, "policy_loss": -0.0025322948931716383, "vf_loss": 9.446476221084595, "vf_explained_var": -0.00016720741987228394, "kl": 0.005266840591235865, "entropy": 1.004379814863205, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.951569490134716, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.421915066242217, "policy_loss": -0.0032398712704889477, "vf_loss": 8.425073307752609, "vf_explained_var": -0.0002982452511787415, "kl": 0.006544387957364961, "entropy": 3.138952872157097, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1174.1584995927806, "episode_len_mean": 3018.6666666666665, "episode_media": {}, "episodes_timesteps_total": 54336, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 391.72467966989217, "DC1_ls_policy": -2506.6735224641197, "DC2_ls_policy": 3596.998642427852, "DC3_ls_policy": -307.8913000408426}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110140.04733668735, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 129559.72576932532, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.19258774589932795, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4461605394230315, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60015.59059405848, "DC2_ls_policy/bat_CO2_footprint_sum_min": 47282.932952422154, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107548.00355438725, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.011907002388723335, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.8004998426641945, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103484189.70535165, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 50.818121510807245, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 981.4755642970247, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5892118831737069, "mean_inference_ms": 2.1298808202110147, "mean_action_processing_ms": 0.3216593230320923, "mean_env_wait_ms": 4.294676962537041, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033527612686157227, "StateBufferConnector_ms": 0.0024040540059407554, "ViewRequirementAgentConnector_ms": 0.05253056685129801}, "num_episodes": 1, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1174.1584995927806, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144, "num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 613.9485887401544, "num_env_steps_trained_throughput_per_sec": 613.9485887401544, "timesteps_total": 65536, "num_env_steps_sampled_lifetime": 65536, "num_agent_steps_sampled_lifetime": 262144, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 262144, "timers": {"training_iteration_time_ms": 3474.809, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3474.738, "sample_time_ms": 2221.794, "learn_time_ms": 1224.536, "learn_throughput": 1672.471, "synch_weights_time_ms": 11.005}, "counters": {"num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144}, "done": false, "training_iteration": 32, "trial_id": "45133_00000", "date": "2024-10-21_21-58-10", "timestamp": 1729547890, "time_this_iter_s": 3.341594934463501, "time_total_s": 115.21143889427185, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fea7af76c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e380>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0db70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0df30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e1a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 115.21143889427185, "iterations_since_restore": 32, "perf": {"cpu_util_percent": 19.380000000000003, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4430585846304893, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.598623776435852, "policy_loss": -0.0019602470099925997, "vf_loss": 9.600584018230439, "vf_explained_var": 0.004389526695013047, "kl": 0.0021631792433595364, "entropy": 1.5432044073939324, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.810389133170247, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.925667905807495, "policy_loss": -0.0010306214215233922, "vf_loss": 9.926698446273804, "vf_explained_var": -3.580823540687561e-05, "kl": 0.004195786367069361, "entropy": 0.6747035421431065, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7825468853116035, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.50100735425949, "policy_loss": -0.0034700737392995506, "vf_loss": 9.50447746515274, "vf_explained_var": -4.306957125663757e-05, "kl": 0.006816314212210473, "entropy": 1.0366918556392193, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.2365691885352135, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.736738061904907, "policy_loss": -0.0017656442825682462, "vf_loss": 8.738437962532043, "vf_explained_var": 0.0001330047845840454, "kl": 0.005259615502961878, "entropy": 3.178698644042015, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1180.3461532139036, "episode_len_mean": 3006.315789473684, "episode_media": {}, "episodes_timesteps_total": 57120, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 366.82080360435486, "DC1_ls_policy": -2525.905411196855, "DC2_ls_policy": 3616.027147782471, "DC3_ls_policy": -276.5963869760667}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110978.65116458433, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 129559.72576932532, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.18360475503832277, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4085185449101436, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59302.077018610114, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107883.9218920807, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.011280318052474737, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7583871770188315, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103165706.42356676, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 48.57350660068007, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 961.9874419247675, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5897802317348855, "mean_inference_ms": 2.1304007170708084, "mean_action_processing_ms": 0.32162879146318507, "mean_env_wait_ms": 4.297155182560867, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033246843438399466, "StateBufferConnector_ms": 0.0024042631450452304, "ViewRequirementAgentConnector_ms": 0.05260204014025236}, "num_episodes": 1, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1180.3461532139036, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336, "num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 567.0597183124254, "num_env_steps_trained_throughput_per_sec": 567.0597183124254, "timesteps_total": 67584, "num_env_steps_sampled_lifetime": 67584, "num_agent_steps_sampled_lifetime": 270336, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 270336, "timers": {"training_iteration_time_ms": 3502.258, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3502.181, "sample_time_ms": 2245.209, "learn_time_ms": 1226.733, "learn_throughput": 1669.475, "synch_weights_time_ms": 11.214}, "counters": {"num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336}, "done": false, "training_iteration": 33, "trial_id": "45133_00000", "date": "2024-10-21_21-58-14", "timestamp": 1729547894, "time_this_iter_s": 3.6171016693115234, "time_total_s": 118.82854056358337, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef640>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e8f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e560>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b520>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a7a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 118.82854056358337, "iterations_since_restore": 33, "perf": {"cpu_util_percent": 7.340000000000001, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8263844832777978, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.424105334281922, "policy_loss": -0.0033380502834916117, "vf_loss": 9.427443325519562, "vf_explained_var": 0.0076632387936115265, "kl": 0.005902460584136211, "entropy": 1.8126878589391708, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.815442566201091, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.933728456497192, "policy_loss": -0.0018161740503273905, "vf_loss": 9.935544574260712, "vf_explained_var": -9.053349494934083e-05, "kl": 0.0044440730194040155, "entropy": 0.6787672147154808, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.335665460675955, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.298657286167145, "policy_loss": -0.003075158124556765, "vf_loss": 9.301732397079467, "vf_explained_var": -2.496764063835144e-05, "kl": 0.003704055713365051, "entropy": 1.201806864142418, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.10967859774828, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.102950394153595, "policy_loss": -0.00045146141201257706, "vf_loss": 9.103306794166565, "vf_explained_var": -9.752064943313599e-05, "kl": 0.0075960519671298245, "entropy": 3.081467741727829, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1180.3461532139036, "episode_len_mean": 3006.315789473684, "episode_media": {}, "episodes_timesteps_total": 57120, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 366.82080360435486, "DC1_ls_policy": -2525.905411196855, "DC2_ls_policy": 3616.027147782471, "DC3_ls_policy": -276.5963869760667}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110978.65116458433, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 129559.72576932532, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.18360475503832277, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4085185449101436, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59302.077018610114, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107883.9218920807, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.011280318052474737, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7583871770188315, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103165706.42356676, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 48.57350660068007, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 961.9874419247675, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5897802317348855, "mean_inference_ms": 2.1304007170708084, "mean_action_processing_ms": 0.32162879146318507, "mean_env_wait_ms": 4.297155182560867, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033246843438399466, "StateBufferConnector_ms": 0.0024042631450452304, "ViewRequirementAgentConnector_ms": 0.05260204014025236}, "num_episodes": 0, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1180.3461532139036, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528, "num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 607.5131484102978, "num_env_steps_trained_throughput_per_sec": 607.5131484102978, "timesteps_total": 69632, "num_env_steps_sampled_lifetime": 69632, "num_agent_steps_sampled_lifetime": 278528, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 278528, "timers": {"training_iteration_time_ms": 3493.781, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3493.702, "sample_time_ms": 2234.653, "learn_time_ms": 1227.55, "learn_throughput": 1668.363, "synch_weights_time_ms": 11.383}, "counters": {"num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528}, "done": false, "training_iteration": 34, "trial_id": "45133_00000", "date": "2024-10-21_21-58-17", "timestamp": 1729547897, "time_this_iter_s": 3.3774476051330566, "time_total_s": 122.20598816871643, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99ac20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2590>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada18a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0190>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada06a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 122.20598816871643, "iterations_since_restore": 34, "perf": {"cpu_util_percent": 6.3, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6442306697368623, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.324518871307372, "policy_loss": -0.0030002159415744244, "vf_loss": 9.32751910686493, "vf_explained_var": 0.00509117990732193, "kl": 0.004489191737366492, "entropy": 1.2860842615365982, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5528621800243854, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.937514126300812, "policy_loss": -0.0019115870236419141, "vf_loss": 9.939425802230835, "vf_explained_var": 0.00048241764307022095, "kl": 0.0038481547961798077, "entropy": 0.6392743289470673, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4533214405179025, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.087137985229493, "policy_loss": -0.007911582192173227, "vf_loss": 9.095049583911896, "vf_explained_var": 0.0001254141330718994, "kl": 0.011912428761206831, "entropy": 1.0265329986810685, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7857933714985847, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.179797434806824, "policy_loss": -0.003975141112459823, "vf_loss": 8.183673346042633, "vf_explained_var": 0.0003139577805995941, "kl": 0.007946861485288536, "entropy": 3.1305039554834364, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1180.3461532139036, "episode_len_mean": 3006.315789473684, "episode_media": {}, "episodes_timesteps_total": 57120, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 366.82080360435486, "DC1_ls_policy": -2525.905411196855, "DC2_ls_policy": 3616.027147782471, "DC3_ls_policy": -276.5963869760667}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110978.65116458433, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 129559.72576932532, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.18360475503832277, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4085185449101436, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59302.077018610114, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107883.9218920807, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.011280318052474737, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7583871770188315, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103165706.42356676, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 48.57350660068007, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 961.9874419247675, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5897802317348855, "mean_inference_ms": 2.1304007170708084, "mean_action_processing_ms": 0.32162879146318507, "mean_env_wait_ms": 4.297155182560867, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033246843438399466, "StateBufferConnector_ms": 0.0024042631450452304, "ViewRequirementAgentConnector_ms": 0.05260204014025236}, "num_episodes": 0, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1180.3461532139036, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720, "num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 589.7640480943542, "num_env_steps_trained_throughput_per_sec": 589.7640480943542, "timesteps_total": 71680, "num_env_steps_sampled_lifetime": 71680, "num_agent_steps_sampled_lifetime": 286720, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 286720, "timers": {"training_iteration_time_ms": 3494.881, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3494.803, "sample_time_ms": 2241.813, "learn_time_ms": 1222.551, "learn_throughput": 1675.186, "synch_weights_time_ms": 11.215}, "counters": {"num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720}, "done": false, "training_iteration": 35, "trial_id": "45133_00000", "date": "2024-10-21_21-58-21", "timestamp": 1729547901, "time_this_iter_s": 3.4781651496887207, "time_total_s": 125.68415331840515, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fea7af76c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1f90>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2770>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada10c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada20e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 125.68415331840515, "iterations_since_restore": 35, "perf": {"cpu_util_percent": 18.04, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5692881479859353, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.612324559688568, "policy_loss": -0.00029553123749792576, "vf_loss": 9.612620091438293, "vf_explained_var": 0.01044110432267189, "kl": 0.0009959655196894346, "entropy": 1.9757489994168282, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8628300819545984, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.922895073890686, "policy_loss": -0.002587416872847825, "vf_loss": 9.925482392311096, "vf_explained_var": -8.059218525886535e-05, "kl": 0.006429735555685061, "entropy": 0.590703060477972, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8971521377563476, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.465391314029693, "policy_loss": -0.0019060824415646493, "vf_loss": 9.467297446727752, "vf_explained_var": 0.000143500417470932, "kl": 0.005818965478465543, "entropy": 1.1072047382593155, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.675758643448353, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.729868400096894, "policy_loss": -0.0035816471558064223, "vf_loss": 8.733348941802978, "vf_explained_var": 0.00012018904089927673, "kl": 0.008083838520832753, "entropy": 3.1125498086214067, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1180.3461532139036, "episode_len_mean": 3006.315789473684, "episode_media": {}, "episodes_timesteps_total": 57120, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 366.82080360435486, "DC1_ls_policy": -2525.905411196855, "DC2_ls_policy": 3616.027147782471, "DC3_ls_policy": -276.5963869760667}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110978.65116458433, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 129559.72576932532, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.18360475503832277, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4085185449101436, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59302.077018610114, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107883.9218920807, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.011280318052474737, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7583871770188315, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103165706.42356676, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 48.57350660068007, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 961.9874419247675, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5897802317348855, "mean_inference_ms": 2.1304007170708084, "mean_action_processing_ms": 0.32162879146318507, "mean_env_wait_ms": 4.297155182560867, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033246843438399466, "StateBufferConnector_ms": 0.0024042631450452304, "ViewRequirementAgentConnector_ms": 0.05260204014025236}, "num_episodes": 0, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1180.3461532139036, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912, "num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 602.4834283882674, "num_env_steps_trained_throughput_per_sec": 602.4834283882674, "timesteps_total": 73728, "num_env_steps_sampled_lifetime": 73728, "num_agent_steps_sampled_lifetime": 294912, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 294912, "timers": {"training_iteration_time_ms": 3466.269, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3466.192, "sample_time_ms": 2212.6, "learn_time_ms": 1222.409, "learn_throughput": 1675.381, "synch_weights_time_ms": 11.448}, "counters": {"num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912}, "done": false, "training_iteration": 36, "trial_id": "45133_00000", "date": "2024-10-21_21-58-24", "timestamp": 1729547904, "time_this_iter_s": 3.4051098823547363, "time_total_s": 129.0892632007599, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99a0e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1f30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2710>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3520>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1e40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 129.0892632007599, "iterations_since_restore": 36, "perf": {"cpu_util_percent": 19.54, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5962466757744551, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.266001749038697, "policy_loss": -0.0018727104878053069, "vf_loss": 9.26787452697754, "vf_explained_var": 0.014383042603731156, "kl": 0.0030433950833412384, "entropy": 1.7293561384081841, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.859093414247036, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.930235385894775, "policy_loss": -0.0012567266123369337, "vf_loss": 9.931492078304291, "vf_explained_var": 0.0006949298083782196, "kl": 0.0031940084365203346, "entropy": 0.5992961816489697, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2389188699424265, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.179752039909364, "policy_loss": -0.0018569349544122816, "vf_loss": 9.181608951091766, "vf_explained_var": 0.00017822086811065675, "kl": 0.004282287658026246, "entropy": 0.9932714134454728, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7305787548422815, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.535540598630906, "policy_loss": -0.0025123913190327586, "vf_loss": 8.537963843345642, "vf_explained_var": -5.263090133666992e-06, "kl": 0.007131339113402646, "entropy": 3.1159126818180085, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1180.3461532139036, "episode_len_mean": 3006.315789473684, "episode_media": {}, "episodes_timesteps_total": 57120, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 366.82080360435486, "DC1_ls_policy": -2525.905411196855, "DC2_ls_policy": 3616.027147782471, "DC3_ls_policy": -276.5963869760667}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110978.65116458433, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 129559.72576932532, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.18360475503832277, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4085185449101436, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59302.077018610114, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107883.9218920807, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.011280318052474737, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7583871770188315, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103165706.42356676, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 48.57350660068007, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 961.9874419247675, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5897802317348855, "mean_inference_ms": 2.1304007170708084, "mean_action_processing_ms": 0.32162879146318507, "mean_env_wait_ms": 4.297155182560867, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033246843438399466, "StateBufferConnector_ms": 0.0024042631450452304, "ViewRequirementAgentConnector_ms": 0.05260204014025236}, "num_episodes": 0, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1180.3461532139036, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104, "num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 590.9121553206885, "num_env_steps_trained_throughput_per_sec": 590.9121553206885, "timesteps_total": 75776, "num_env_steps_sampled_lifetime": 75776, "num_agent_steps_sampled_lifetime": 303104, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 303104, "timers": {"training_iteration_time_ms": 3469.227, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3469.149, "sample_time_ms": 2214.85, "learn_time_ms": 1223.839, "learn_throughput": 1673.422, "synch_weights_time_ms": 11.162}, "counters": {"num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104}, "done": false, "training_iteration": 37, "trial_id": "45133_00000", "date": "2024-10-21_21-58-28", "timestamp": 1729547908, "time_this_iter_s": 3.4713680744171143, "time_total_s": 132.560631275177, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a999750>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7c40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6470>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada70d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4460>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 132.560631275177, "iterations_since_restore": 37, "perf": {"cpu_util_percent": 19.16, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7962847121059895, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.260505294799804, "policy_loss": -0.0013440257869660854, "vf_loss": 9.261849224567413, "vf_explained_var": 0.00936935842037201, "kl": 0.0067328298768188685, "entropy": 1.3960181787610053, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2244619362056257, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.898204922676086, "policy_loss": -0.0019610100076533853, "vf_loss": 9.90016586780548, "vf_explained_var": 0.0001070261001586914, "kl": 0.004301420528509571, "entropy": 0.531350826099515, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4620613880455493, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 8.931611430644988, "policy_loss": -0.0004004767048172653, "vf_loss": 8.932011783123016, "vf_explained_var": -0.00013475865125656128, "kl": 0.0021212572145543618, "entropy": 0.901445134729147, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.2927191480994225, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.874723619222641, "policy_loss": -0.0033561102114617824, "vf_loss": 7.8779598593711855, "vf_explained_var": 7.189661264419555e-05, "kl": 0.009592460752174015, "entropy": 3.027867263555527, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1283.1292273282857, "episode_len_mean": 2948.5714285714284, "episode_media": {}, "episodes_timesteps_total": 61920, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 322.87977487739056, "DC1_ls_policy": -2415.3013427465244, "DC2_ls_policy": 3595.8852859192266, "DC3_ls_policy": -220.33449072180593}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 113021.47578418978, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 134189.24307543703, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.16611858789181586, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.2533024930139396, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.17625, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 58274.468883059235, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107707.31015885067, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.010206002047477144, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.700425699842435, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101593656.10928127, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 43.94745835299625, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 908.191187535107, "accumulated/ls_overdue_penalty_sum_min": 41.55125, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5902432968058056, "mean_inference_ms": 2.1288450573045155, "mean_action_processing_ms": 0.3215655232426973, "mean_env_wait_ms": 4.299611041691799, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003478356770106724, "StateBufferConnector_ms": 0.0024071761540004183, "ViewRequirementAgentConnector_ms": 0.05270469756353469}, "num_episodes": 2, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1283.1292273282857, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296, "num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 614.1068635579278, "num_env_steps_trained_throughput_per_sec": 614.1068635579278, "timesteps_total": 77824, "num_env_steps_sampled_lifetime": 77824, "num_agent_steps_sampled_lifetime": 311296, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 311296, "timers": {"training_iteration_time_ms": 3449.905, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3449.828, "sample_time_ms": 2193.698, "learn_time_ms": 1225.58, "learn_throughput": 1671.045, "synch_weights_time_ms": 11.237}, "counters": {"num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296}, "done": false, "training_iteration": 38, "trial_id": "45133_00000", "date": "2024-10-21_21-58-31", "timestamp": 1729547911, "time_this_iter_s": 3.3414738178253174, "time_total_s": 135.90210509300232, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fea7af76c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0c670>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0dba0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e680>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e560>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 135.90210509300232, "iterations_since_restore": 38, "perf": {"cpu_util_percent": 19.439999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9358414456248283, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.421425426006317, "policy_loss": -0.000990856281714514, "vf_loss": 9.422416174411774, "vf_explained_var": 0.007804974168539047, "kl": 0.0013524130486992233, "entropy": 2.0893026694655417, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3344138137996198, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.913676345348359, "policy_loss": -0.0010023443843238055, "vf_loss": 9.914678823947906, "vf_explained_var": 0.0001374073326587677, "kl": 0.0015761322577311208, "entropy": 0.5836943909525871, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8274563543498517, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.610919189453124, "policy_loss": -0.003696279786527157, "vf_loss": 9.614615535736084, "vf_explained_var": 0.000405023992061615, "kl": 0.010563247402660781, "entropy": 1.0935836300253867, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.837180842459202, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.522443330287933, "policy_loss": -0.0033292865613475443, "vf_loss": 9.525681483745576, "vf_explained_var": -0.0014523640275001526, "kl": 0.007281610307837132, "entropy": 3.016771048307419, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1392.415212724023, "episode_len_mean": 2928.0, "episode_media": {}, "episodes_timesteps_total": 64416, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 311.2561633911377, "DC1_ls_policy": -2321.0669700407966, "DC2_ls_policy": 3593.6526671464508, "DC3_ls_policy": -191.42664777276724}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 113632.6361607039, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 134189.24307543703, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.1585677429876424, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.1514806139608584, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.013221153846153846, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57822.37144751947, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107759.67386132515, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.00974209286350091, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6685881680314152, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100860545.09242745, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 41.94984660967824, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 867.1419550524507, "accumulated/ls_overdue_penalty_sum_min": 5.108072916666667, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5901966861631514, "mean_inference_ms": 2.1292823128301275, "mean_action_processing_ms": 0.3213831559299119, "mean_env_wait_ms": 4.300776859627735, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034405426545576615, "StateBufferConnector_ms": 0.002405860207297585, "ViewRequirementAgentConnector_ms": 0.05262331529097124}, "num_episodes": 1, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1392.415212724023, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488, "num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 593.1471572705411, "num_env_steps_trained_throughput_per_sec": 593.1471572705411, "timesteps_total": 79872, "num_env_steps_sampled_lifetime": 79872, "num_agent_steps_sampled_lifetime": 319488, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 319488, "timers": {"training_iteration_time_ms": 3446.598, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3446.521, "sample_time_ms": 2193.818, "learn_time_ms": 1222.157, "learn_throughput": 1675.726, "synch_weights_time_ms": 11.251}, "counters": {"num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488}, "done": false, "training_iteration": 39, "trial_id": "45133_00000", "date": "2024-10-21_21-58-35", "timestamp": 1729547915, "time_this_iter_s": 3.4583349227905273, "time_total_s": 139.36044001579285, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae73010>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7040>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada74c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7280>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada71c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 139.36044001579285, "iterations_since_restore": 39, "perf": {"cpu_util_percent": 19.439999999999998, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5520924627780914, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.528332793712616, "policy_loss": -0.0068104881211183965, "vf_loss": 9.535143435001373, "vf_explained_var": 0.012866173684597016, "kl": 0.00785880450102953, "entropy": 1.4417661070823669, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1324420154094694, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.911333215236663, "policy_loss": -0.0027173567563295365, "vf_loss": 9.914050614833831, "vf_explained_var": 0.00014953091740608216, "kl": 0.006123547719244016, "entropy": 0.5006977930665016, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.100590719282627, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.505755877494812, "policy_loss": -0.0011584123654756694, "vf_loss": 9.506914114952087, "vf_explained_var": 0.0004352189600467682, "kl": 0.004297356679455788, "entropy": 0.9020487613976002, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.046957950294018, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.051993536949158, "policy_loss": -0.0035657929023727775, "vf_loss": 8.055441910028458, "vf_explained_var": -0.00012363046407699586, "kl": 0.009393186293937563, "entropy": 3.0423840075731277, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680}, "env_runners": {"episode_reward_max": 3901.783393867865, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1500.8020519189972, "episode_len_mean": 2946.782608695652, "episode_media": {}, "episodes_timesteps_total": 67776, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 5876.197982853948, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 283.4063348303083, "DC1_ls_policy": -2265.613767085644, "DC2_ls_policy": 3643.1237594565155, "DC3_ls_policy": -160.114275282181}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 114284.25613982759, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 134189.24307543703, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.15167349329252752, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.066180732194444, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.013221153846153846, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57431.73284441427, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107963.27795292716, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009318523608566087, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6395191172474406, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101730888.08156644, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 180666771.95419312, "accumulated/ls_tasks_dropped_sum_mean": 40.1259402353444, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 834.3206109921992, "accumulated/ls_overdue_penalty_sum_min": 5.108072916666667, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.590507616189552, "mean_inference_ms": 2.1304991108627127, "mean_action_processing_ms": 0.32162125321314816, "mean_env_wait_ms": 4.304789767157311, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003410681434299635, "StateBufferConnector_ms": 0.0024095825527025304, "ViewRequirementAgentConnector_ms": 0.05259747090546981}, "num_episodes": 1, "episode_return_max": 3901.783393867865, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1500.8020519189972, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680, "num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 579.9038359546896, "num_env_steps_trained_throughput_per_sec": 579.9038359546896, "timesteps_total": 81920, "num_env_steps_sampled_lifetime": 81920, "num_agent_steps_sampled_lifetime": 327680, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 327680, "timers": {"training_iteration_time_ms": 3460.985, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3460.908, "sample_time_ms": 2207.103, "learn_time_ms": 1223.256, "learn_throughput": 1674.22, "synch_weights_time_ms": 11.255}, "counters": {"num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680}, "done": false, "training_iteration": 40, "trial_id": "45133_00000", "date": "2024-10-21_21-58-38", "timestamp": 1729547918, "time_this_iter_s": 3.5385074615478516, "time_total_s": 142.8989474773407, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99b400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a619870>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61bbb0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a619ab0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a619bd0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 142.8989474773407, "iterations_since_restore": 40, "perf": {"cpu_util_percent": 19.32, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.800140092521906, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.224702441692353, "policy_loss": -0.0037363963085226713, "vf_loss": 9.228438794612885, "vf_explained_var": 0.01480495259165764, "kl": 0.010092960813926766, "entropy": 1.9032978922128678, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1614014826714993, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.903579080104828, "policy_loss": -0.0013626533444039523, "vf_loss": 9.904941618442535, "vf_explained_var": 0.0006158672273159027, "kl": 0.0012993633854080145, "entropy": 0.4945781290531158, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0309798292815686, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.318536734580993, "policy_loss": -0.003145715675782412, "vf_loss": 9.32168231010437, "vf_explained_var": 0.0008440017700195312, "kl": 0.00801155519866407, "entropy": 0.7909024365246295, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.653480203449726, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.778701364994049, "policy_loss": -0.0033953644218854607, "vf_loss": 8.782014507055283, "vf_explained_var": -0.0006674125790596009, "kl": 0.006577723262222816, "entropy": 3.0776221215724946, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1725.669037210597, "episode_len_mean": 3056.64, "episode_media": {}, "episodes_timesteps_total": 76416, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 234.90890138735386, "DC1_ls_policy": -2224.0720126769756, "DC2_ls_policy": 3845.046120966469, "DC3_ls_policy": -130.21397246624883}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115732.39891503929, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.1395396138291253, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.9217813353472835, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.013221153846153846, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56789.02792271726, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 7.71604938271605e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107894.58800165297, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0085730417198808, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5968028039170281, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105887910.90231296, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 36.91586501651685, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 789.3115930927617, "accumulated/ls_overdue_penalty_sum_min": 5.108072916666667, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5906548501867608, "mean_inference_ms": 2.1317420354707473, "mean_action_processing_ms": 0.3217393430944478, "mean_env_wait_ms": 4.308150508226632, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003388643264770508, "StateBufferConnector_ms": 0.0024261474609375, "ViewRequirementAgentConnector_ms": 0.052823781967163086}, "num_episodes": 2, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1725.669037210597, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872, "num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 569.2195524362882, "num_env_steps_trained_throughput_per_sec": 569.2195524362882, "timesteps_total": 83968, "num_env_steps_sampled_lifetime": 83968, "num_agent_steps_sampled_lifetime": 335872, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 335872, "timers": {"training_iteration_time_ms": 3457.358, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3457.281, "sample_time_ms": 2203.951, "learn_time_ms": 1222.975, "learn_throughput": 1674.604, "synch_weights_time_ms": 11.112}, "counters": {"num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872}, "done": false, "training_iteration": 41, "trial_id": "45133_00000", "date": "2024-10-21_21-58-42", "timestamp": 1729547922, "time_this_iter_s": 3.6045780181884766, "time_total_s": 146.50352549552917, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae73010>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a3e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a650>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a890>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b5e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 146.50352549552917, "iterations_since_restore": 41, "perf": {"cpu_util_percent": 7.839999999999999, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6280179090797902, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.657417666912078, "policy_loss": -0.0028137822868302465, "vf_loss": 9.660231471061707, "vf_explained_var": 0.011386774480342865, "kl": 0.004968041469192622, "entropy": 1.7874849081039428, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1048814479261635, "cur_kl_coeff": 1.164153218269348e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.909398138523102, "policy_loss": -0.0036727363825775684, "vf_loss": 9.913070821762085, "vf_explained_var": 0.000567588210105896, "kl": 0.008158083839078572, "entropy": 0.4457733932882547, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.317679601162672, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.515878093242645, "policy_loss": -0.0015356410411186516, "vf_loss": 9.517413568496703, "vf_explained_var": 0.0015410751104354859, "kl": 0.006456121682822898, "entropy": 0.6825837209820748, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.375353334844112, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.703241676092148, "policy_loss": -0.0035326056415215133, "vf_loss": 8.706685638427734, "vf_explained_var": 0.002315923571586609, "kl": 0.00707804370138092, "entropy": 3.102186518907547, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1725.669037210597, "episode_len_mean": 3056.64, "episode_media": {}, "episodes_timesteps_total": 76416, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 234.90890138735386, "DC1_ls_policy": -2224.0720126769756, "DC2_ls_policy": 3845.046120966469, "DC3_ls_policy": -130.21397246624883}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115732.39891503929, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.1395396138291253, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.9217813353472835, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.013221153846153846, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56789.02792271726, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 7.71604938271605e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107894.58800165297, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0085730417198808, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5968028039170281, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105887910.90231296, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 36.91586501651685, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 789.3115930927617, "accumulated/ls_overdue_penalty_sum_min": 5.108072916666667, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5906548501867608, "mean_inference_ms": 2.1317420354707473, "mean_action_processing_ms": 0.3217393430944478, "mean_env_wait_ms": 4.308150508226632, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003388643264770508, "StateBufferConnector_ms": 0.0024261474609375, "ViewRequirementAgentConnector_ms": 0.052823781967163086}, "num_episodes": 0, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1725.669037210597, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064, "num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 568.9095134912388, "num_env_steps_trained_throughput_per_sec": 568.9095134912388, "timesteps_total": 86016, "num_env_steps_sampled_lifetime": 86016, "num_agent_steps_sampled_lifetime": 344064, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 344064, "timers": {"training_iteration_time_ms": 3483.766, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3483.69, "sample_time_ms": 2229.905, "learn_time_ms": 1224.077, "learn_throughput": 1673.097, "synch_weights_time_ms": 11.039}, "counters": {"num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064}, "done": false, "training_iteration": 42, "trial_id": "45133_00000", "date": "2024-10-21_21-58-46", "timestamp": 1729547926, "time_this_iter_s": 3.6055474281311035, "time_total_s": 150.10907292366028, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bedc60>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61ba60>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61bcd0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61bee0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61ac80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 150.10907292366028, "iterations_since_restore": 42, "perf": {"cpu_util_percent": 8.299999999999999, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7057373456656932, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.450855362415314, "policy_loss": -0.004695592290954664, "vf_loss": 9.455550980567931, "vf_explained_var": 0.013607601821422576, "kl": 0.009826988110945595, "entropy": 1.8395863637328147, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0684864334762096, "cur_kl_coeff": 1.164153218269348e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.91858845949173, "policy_loss": -0.0027778583986219018, "vf_loss": 9.921366322040559, "vf_explained_var": -0.00030811578035354613, "kl": 0.0032418302795998166, "entropy": 0.3688319757580757, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.630539322644472, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.374717915058136, "policy_loss": -0.002374530641827732, "vf_loss": 9.377092432975768, "vf_explained_var": 0.0006984487175941467, "kl": 0.008569846520367718, "entropy": 0.683275631070137, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9138776108622553, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.542908203601836, "policy_loss": -0.005078346107620746, "vf_loss": 8.547848373651505, "vf_explained_var": -0.000858868658542633, "kl": 0.01105848443207833, "entropy": 3.0576439768075945, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1725.669037210597, "episode_len_mean": 3056.64, "episode_media": {}, "episodes_timesteps_total": 76416, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -266.365693521594, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 234.90890138735386, "DC1_ls_policy": -2224.0720126769756, "DC2_ls_policy": 3845.046120966469, "DC3_ls_policy": -130.21397246624883}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115732.39891503929, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.1395396138291253, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.9217813353472835, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.013221153846153846, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56789.02792271726, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 7.71604938271605e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107894.58800165297, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0085730417198808, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5968028039170281, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105887910.90231296, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 36.91586501651685, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 789.3115930927617, "accumulated/ls_overdue_penalty_sum_min": 5.108072916666667, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5906548501867608, "mean_inference_ms": 2.1317420354707473, "mean_action_processing_ms": 0.3217393430944478, "mean_env_wait_ms": 4.308150508226632, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003388643264770508, "StateBufferConnector_ms": 0.0024261474609375, "ViewRequirementAgentConnector_ms": 0.052823781967163086}, "num_episodes": 0, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1725.669037210597, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256, "num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 614.3544467370665, "num_env_steps_trained_throughput_per_sec": 614.3544467370665, "timesteps_total": 88064, "num_env_steps_sampled_lifetime": 88064, "num_agent_steps_sampled_lifetime": 352256, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 352256, "timers": {"training_iteration_time_ms": 3455.961, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3455.889, "sample_time_ms": 2204.082, "learn_time_ms": 1223.029, "learn_throughput": 1674.53, "synch_weights_time_ms": 10.996}, "counters": {"num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256}, "done": false, "training_iteration": 43, "trial_id": "45133_00000", "date": "2024-10-21_21-58-49", "timestamp": 1729547929, "time_this_iter_s": 3.3397154808044434, "time_total_s": 153.44878840446472, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99aa70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6b00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada70d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6470>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7880>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 153.44878840446472, "iterations_since_restore": 43, "perf": {"cpu_util_percent": 19.325, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.715456985682249, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.381796169281007, "policy_loss": -0.0006032792036421597, "vf_loss": 9.38239951133728, "vf_explained_var": 0.008778679370880126, "kl": 0.001199243297457997, "entropy": 2.179268018901348, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8424715593457224, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.900485944747924, "policy_loss": -0.0022472851444035767, "vf_loss": 9.902733278274535, "vf_explained_var": -7.448345422744751e-05, "kl": 0.006496927700254673, "entropy": 0.32045695930719376, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6792395815253256, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.143706345558167, "policy_loss": -0.003454223147127777, "vf_loss": 9.147160637378693, "vf_explained_var": 0.0004135213792324066, "kl": 0.011836810494764904, "entropy": 0.49645627215504645, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.3970570668578146, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.875627446174622, "policy_loss": -0.0019348703906871378, "vf_loss": 8.877477884292603, "vf_explained_var": -3.9903074502944945e-05, "kl": 0.006741440147198562, "entropy": 3.0205288261175154, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1822.5462072464736, "episode_len_mean": 3046.153846153846, "episode_media": {}, "episodes_timesteps_total": 79200, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -244.3110529122674, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 233.52051193935773, "DC1_ls_policy": -2147.927360378333, "DC2_ls_policy": 3848.7180071581874, "DC3_ls_policy": -111.76495147273727}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115885.5362230499, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.1341727056049282, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.847866668603157, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56544.04201197876, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 7.4192782526115855e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108025.41311714762, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.008243309346039231, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5738488499202193, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105684452.5102037, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 35.496024054343124, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 758.9534548968861, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5909625913560442, "mean_inference_ms": 2.131669484427234, "mean_action_processing_ms": 0.3216998134313478, "mean_env_wait_ms": 4.309422118246033, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003358263235825759, "StateBufferConnector_ms": 0.002422928810119629, "ViewRequirementAgentConnector_ms": 0.052729019751915567}, "num_episodes": 1, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1822.5462072464736, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448, "num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 582.8470137073226, "num_env_steps_trained_throughput_per_sec": 582.8470137073226, "timesteps_total": 90112, "num_env_steps_sampled_lifetime": 90112, "num_agent_steps_sampled_lifetime": 360448, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 360448, "timers": {"training_iteration_time_ms": 3470.227, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3470.158, "sample_time_ms": 2218.677, "learn_time_ms": 1223.845, "learn_throughput": 1673.415, "synch_weights_time_ms": 10.919}, "counters": {"num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448}, "done": false, "training_iteration": 44, "trial_id": "45133_00000", "date": "2024-10-21_21-58-53", "timestamp": 1729547933, "time_this_iter_s": 3.519806385040283, "time_total_s": 156.968594789505, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a999c60>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0df30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0eaa0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e170>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fec27a0e4d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 156.968594789505, "iterations_since_restore": 44, "perf": {"cpu_util_percent": 20.160000000000004, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7075066447257996, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.430396676063538, "policy_loss": -0.0028593924304004758, "vf_loss": 9.433256006240844, "vf_explained_var": 0.01782066226005554, "kl": 0.009191634228410805, "entropy": 2.063757500052452, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.648383108526468, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.922654783725738, "policy_loss": -0.003201284445822239, "vf_loss": 9.925856018066407, "vf_explained_var": 1.2584030628204346e-05, "kl": 0.006032837123643731, "entropy": 0.31615181993693114, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.904584226757288, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.528514969348908, "policy_loss": -0.0023347312468104064, "vf_loss": 9.53084968328476, "vf_explained_var": 2.2124499082565308e-05, "kl": 0.009152134269970701, "entropy": 0.29616505932062864, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7991265445947646, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.007748937606811, "policy_loss": -0.0064398752117995174, "vf_loss": 8.014061659574509, "vf_explained_var": 0.0010087698698043822, "kl": 0.010177329607540742, "entropy": 3.108119335770607, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1822.5462072464736, "episode_len_mean": 3046.153846153846, "episode_media": {}, "episodes_timesteps_total": 79200, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -244.3110529122674, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 233.52051193935773, "DC1_ls_policy": -2147.927360378333, "DC2_ls_policy": 3848.7180071581874, "DC3_ls_policy": -111.76495147273727}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115885.5362230499, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.1341727056049282, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.847866668603157, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56544.04201197876, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 7.4192782526115855e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108025.41311714762, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.008243309346039231, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5738488499202193, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105684452.5102037, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 35.496024054343124, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 758.9534548968861, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5909625913560442, "mean_inference_ms": 2.131669484427234, "mean_action_processing_ms": 0.3216998134313478, "mean_env_wait_ms": 4.309422118246033, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003358263235825759, "StateBufferConnector_ms": 0.002422928810119629, "ViewRequirementAgentConnector_ms": 0.052729019751915567}, "num_episodes": 0, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1822.5462072464736, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640, "num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 615.9933302975651, "num_env_steps_trained_throughput_per_sec": 615.9933302975651, "timesteps_total": 92160, "num_env_steps_sampled_lifetime": 92160, "num_agent_steps_sampled_lifetime": 368640, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 368640, "timers": {"training_iteration_time_ms": 3455.441, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3455.371, "sample_time_ms": 2204.837, "learn_time_ms": 1222.93, "learn_throughput": 1674.666, "synch_weights_time_ms": 10.882}, "counters": {"num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640}, "done": false, "training_iteration": 45, "trial_id": "45133_00000", "date": "2024-10-21_21-58-56", "timestamp": 1729547936, "time_this_iter_s": 3.3332443237304688, "time_total_s": 160.30183911323547, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a999e10>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5d80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4820>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7400>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7a30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 160.30183911323547, "iterations_since_restore": 45, "perf": {"cpu_util_percent": 19.64, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7202652763575315, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.447859251499176, "policy_loss": -0.002851239440497011, "vf_loss": 9.450710475444794, "vf_explained_var": 0.014499715715646743, "kl": 0.005616761937929478, "entropy": 2.375705561041832, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7168877743184567, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.91736775636673, "policy_loss": -0.0028471257071942093, "vf_loss": 9.920214891433716, "vf_explained_var": -0.00021277815103530883, "kl": 0.0068154823504310656, "entropy": 0.31873477920889853, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.168365629017353, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.147446441650391, "policy_loss": -0.0014358848915435375, "vf_loss": 9.148882293701172, "vf_explained_var": 0.00021291449666023255, "kl": 0.0059259268160541684, "entropy": 0.41976020485162735, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6378189235925675, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.65465214252472, "policy_loss": -0.0035448439768515526, "vf_loss": 8.658110094070434, "vf_explained_var": -0.0007618740200996399, "kl": 0.006953908457763142, "entropy": 3.159174883365631, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1822.5462072464736, "episode_len_mean": 3046.153846153846, "episode_media": {}, "episodes_timesteps_total": 79200, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": -244.3110529122674, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 233.52051193935773, "DC1_ls_policy": -2147.927360378333, "DC2_ls_policy": 3848.7180071581874, "DC3_ls_policy": -111.76495147273727}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115885.5362230499, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.1341727056049282, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.847866668603157, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56544.04201197876, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 7.4192782526115855e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108025.41311714762, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.008243309346039231, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5738488499202193, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105684452.5102037, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 35.496024054343124, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 758.9534548968861, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5909625913560442, "mean_inference_ms": 2.131669484427234, "mean_action_processing_ms": 0.3216998134313478, "mean_env_wait_ms": 4.309422118246033, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003358263235825759, "StateBufferConnector_ms": 0.002422928810119629, "ViewRequirementAgentConnector_ms": 0.052729019751915567}, "num_episodes": 0, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1822.5462072464736, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832, "num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 587.0315068154262, "num_env_steps_trained_throughput_per_sec": 587.0315068154262, "timesteps_total": 94208, "num_env_steps_sampled_lifetime": 94208, "num_agent_steps_sampled_lifetime": 376832, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 376832, "timers": {"training_iteration_time_ms": 3464.389, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3464.319, "sample_time_ms": 2213.773, "learn_time_ms": 1222.757, "learn_throughput": 1674.904, "synch_weights_time_ms": 10.708}, "counters": {"num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832}, "done": false, "training_iteration": 46, "trial_id": "45133_00000", "date": "2024-10-21_21-59-00", "timestamp": 1729547940, "time_this_iter_s": 3.4941418170928955, "time_total_s": 163.79598093032837, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a999c60>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6fe0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7f40>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada70a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4a90>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 163.79598093032837, "iterations_since_restore": 46, "perf": {"cpu_util_percent": 19.380000000000003, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.019148810207844, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.321925854682922, "policy_loss": -0.0015441037598066033, "vf_loss": 9.32347000837326, "vf_explained_var": 0.024073154479265214, "kl": 0.007469053081194943, "entropy": 2.330048958957195, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.5026602409780025, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.853676426410676, "policy_loss": -0.0020461216336116195, "vf_loss": 9.855722534656525, "vf_explained_var": -5.5640935897827145e-06, "kl": 0.006299520145058815, "entropy": 0.3616945955902338, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.1352132253348826, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.291902482509613, "policy_loss": 2.9575976077467204e-05, "vf_loss": 9.29187297821045, "vf_explained_var": 0.00010638386011123657, "kl": 0.004719667330210507, "entropy": 0.3732791479676962, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.520634813606739, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.560674357414246, "policy_loss": -0.005137837829533964, "vf_loss": 8.565676516294479, "vf_explained_var": 0.0004154622554779053, "kl": 0.010855454399211716, "entropy": 3.0675585865974426, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 1939.0096477128097, "episode_len_mean": 3000.0, "episode_media": {}, "episodes_timesteps_total": 84000, "policy_reward_min": {"high_level_policy": -728.1722477217634, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 124.89368682527306, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 225.62147120814765, "DC1_ls_policy": -1988.6674227704093, "DC2_ls_policy": 3802.802396388771, "DC3_ls_policy": -100.74679711369903}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115662.80929809938, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.12458894091886188, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.7191500017981698, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56184.49008443398, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 6.889329805996472e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108749.39803123982, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007654501535607858, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5436632177830608, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 104214129.200314, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 32.96059376474718, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 710.62581972568, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5912987511045078, "mean_inference_ms": 2.1313494419997014, "mean_action_processing_ms": 0.32164569096725854, "mean_env_wait_ms": 4.310311432607424, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003447915826525007, "StateBufferConnector_ms": 0.002424206052507673, "ViewRequirementAgentConnector_ms": 0.05271775381905692}, "num_episodes": 2, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 1939.0096477128097, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024, "num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 611.7631041509333, "num_env_steps_trained_throughput_per_sec": 611.7631041509333, "timesteps_total": 96256, "num_env_steps_sampled_lifetime": 96256, "num_agent_steps_sampled_lifetime": 385024, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 385024, "timers": {"training_iteration_time_ms": 3452.575, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3452.506, "sample_time_ms": 2200.368, "learn_time_ms": 1223.439, "learn_throughput": 1673.969, "synch_weights_time_ms": 10.928}, "counters": {"num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024}, "done": false, "training_iteration": 47, "trial_id": "45133_00000", "date": "2024-10-21_21-59-03", "timestamp": 1729547943, "time_this_iter_s": 3.35585618019104, "time_total_s": 167.1518371105194, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae72b00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4f10>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada51b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5b70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada62f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 167.1518371105194, "iterations_since_restore": 47, "perf": {"cpu_util_percent": 19.64, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5775607965886593, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.521013820171357, "policy_loss": -0.0043185990420170125, "vf_loss": 9.525332355499268, "vf_explained_var": 0.019041184335947037, "kl": 0.011415218227921287, "entropy": 2.0922895208001138, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4423427201807497, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.886520838737487, "policy_loss": -0.0016792901849839836, "vf_loss": 9.888200223445892, "vf_explained_var": 2.7295202016830444e-05, "kl": 0.003923436582590511, "entropy": 0.38546949736773967, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.887340506911278, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.46492303609848, "policy_loss": -0.0010535824461840094, "vf_loss": 9.465976595878601, "vf_explained_var": 0.00013783127069473268, "kl": 0.005609669120201488, "entropy": 0.378519020229578, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.3614303201436995, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.426576453447343, "policy_loss": -0.005527659761719405, "vf_loss": 8.43198384642601, "vf_explained_var": 4.946887493133545e-05, "kl": 0.009620626034757565, "entropy": 3.0134599983692167, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2008.4694322036548, "episode_len_mean": 3035.5862068965516, "episode_media": {}, "episodes_timesteps_total": 88032, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 124.89368682527306, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 187.20176045876786, "DC1_ls_policy": -1952.4601012508454, "DC2_ls_policy": 3868.5253228380157, "DC3_ls_policy": -94.79754984228309}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 116081.99496223158, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.12029277054234941, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.66466679155554, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56029.33702366043, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 6.651766709237973e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109017.15954951038, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007390553206793793, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5251385693318661, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105725010.44088046, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 31.8240215659628, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 688.6052018656811, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5912810676748548, "mean_inference_ms": 2.130833327016576, "mean_action_processing_ms": 0.32159719671680953, "mean_env_wait_ms": 4.311742044819944, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003420484477076037, "StateBufferConnector_ms": 0.0024199485778808594, "ViewRequirementAgentConnector_ms": 0.05267077478869208}, "num_episodes": 1, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2008.4694322036548, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216, "num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 589.776560315892, "num_env_steps_trained_throughput_per_sec": 589.776560315892, "timesteps_total": 98304, "num_env_steps_sampled_lifetime": 98304, "num_agent_steps_sampled_lifetime": 393216, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 393216, "timers": {"training_iteration_time_ms": 3466.334, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3466.263, "sample_time_ms": 2213.975, "learn_time_ms": 1222.553, "learn_throughput": 1675.183, "synch_weights_time_ms": 11.004}, "counters": {"num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216}, "done": false, "training_iteration": 48, "trial_id": "45133_00000", "date": "2024-10-21_21-59-07", "timestamp": 1729547947, "time_this_iter_s": 3.4782559871673584, "time_total_s": 170.63009309768677, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a999ea0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada42e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada48e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5c60>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6080>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 170.63009309768677, "iterations_since_restore": 48, "perf": {"cpu_util_percent": 18.6, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.898819137364626, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.389544343948364, "policy_loss": -0.0021808585617691277, "vf_loss": 9.391725301742554, "vf_explained_var": 0.018578477203845978, "kl": 0.00640360308462056, "entropy": 2.3216754376888273, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6119819335639476, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.854655945301056, "policy_loss": -0.00523655082215555, "vf_loss": 9.859892511367798, "vf_explained_var": 0.00021159127354621887, "kl": 0.008700491806412042, "entropy": 0.32613085210323334, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.972381566464901, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.2372505068779, "policy_loss": -0.000537625839933753, "vf_loss": 9.237788152694701, "vf_explained_var": 4.165619611740112e-05, "kl": 0.004470702579625068, "entropy": 0.4301876720041037, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7256161898374556, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.811368012428284, "policy_loss": -0.004578604293055832, "vf_loss": 8.815833330154419, "vf_explained_var": 0.0005692817270755768, "kl": 0.009069083534279798, "entropy": 2.962354937195778, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2067.9567376181935, "episode_len_mean": 3017.6, "episode_media": {}, "episodes_timesteps_total": 90528, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 440.37012070112377, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 186.84317900135395, "DC1_ls_policy": -1872.6990938524464, "DC2_ls_policy": 3849.7175623994567, "DC3_ls_policy": -95.90490993017076}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115692.96761608947, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.11628301152427109, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.6091912532045434, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 55901.35424069625, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 6.430041152263374e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109545.40190739362, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007144201433234001, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5076473050549919, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105126821.3237788, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 30.763220847097372, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 665.6683551261414, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5912741197985562, "mean_inference_ms": 2.131164151620173, "mean_action_processing_ms": 0.32149064002243954, "mean_env_wait_ms": 4.312440028510513, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033932924270629883, "StateBufferConnector_ms": 0.002418359120686849, "ViewRequirementAgentConnector_ms": 0.0526114304860433}, "num_episodes": 1, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2067.9567376181935, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408, "num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 611.8709562162752, "num_env_steps_trained_throughput_per_sec": 611.8709562162752, "timesteps_total": 100352, "num_env_steps_sampled_lifetime": 100352, "num_agent_steps_sampled_lifetime": 401408, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 401408, "timers": {"training_iteration_time_ms": 3455.768, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3455.698, "sample_time_ms": 2203.955, "learn_time_ms": 1222.139, "learn_throughput": 1675.751, "synch_weights_time_ms": 10.949}, "counters": {"num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408}, "done": false, "training_iteration": 49, "trial_id": "45133_00000", "date": "2024-10-21_21-59-10", "timestamp": 1729547950, "time_this_iter_s": 3.3549644947052, "time_total_s": 173.98505759239197, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef6d0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6bf0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7e50>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6dd0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7a30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 173.98505759239197, "iterations_since_restore": 49, "perf": {"cpu_util_percent": 6.319999999999999, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.049332346767187, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.185308229923248, "policy_loss": -0.00025398696889169516, "vf_loss": 9.185562229156494, "vf_explained_var": 0.027395784854888916, "kl": 0.003726095322601117, "entropy": 1.9600638553500176, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4965010464191435, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.899861872196198, "policy_loss": -0.0012772069429047405, "vf_loss": 9.901139187812806, "vf_explained_var": 1.6491115093231202e-05, "kl": 0.003098175360719324, "entropy": 0.35941033624112606, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.2619174510240554, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.640255606174469, "policy_loss": -0.0051237394218333066, "vf_loss": 9.645379400253296, "vf_explained_var": 6.863996386528016e-05, "kl": 0.01500022789423383, "entropy": 0.1665519735775888, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.070393550395965, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.986590451002121, "policy_loss": -0.00575174258556217, "vf_loss": 7.992215806245804, "vf_explained_var": -8.693858981132508e-05, "kl": 0.010111196417972975, "entropy": 2.88055602312088, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2067.9567376181935, "episode_len_mean": 3017.6, "episode_media": {}, "episodes_timesteps_total": 90528, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 440.37012070112377, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 186.84317900135395, "DC1_ls_policy": -1872.6990938524464, "DC2_ls_policy": 3849.7175623994567, "DC3_ls_policy": -95.90490993017076}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115692.96761608947, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.11628301152427109, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.6091912532045434, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 55901.35424069625, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 6.430041152263374e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109545.40190739362, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007144201433234001, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5076473050549919, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105126821.3237788, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 30.763220847097372, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 665.6683551261414, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5912741197985562, "mean_inference_ms": 2.131164151620173, "mean_action_processing_ms": 0.32149064002243954, "mean_env_wait_ms": 4.312440028510513, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033932924270629883, "StateBufferConnector_ms": 0.002418359120686849, "ViewRequirementAgentConnector_ms": 0.0526114304860433}, "num_episodes": 0, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2067.9567376181935, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600, "num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 593.6995756363468, "num_env_steps_trained_throughput_per_sec": 593.6995756363468, "timesteps_total": 102400, "num_env_steps_sampled_lifetime": 102400, "num_agent_steps_sampled_lifetime": 409600, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 409600, "timers": {"training_iteration_time_ms": 3447.562, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3447.49, "sample_time_ms": 2196.542, "learn_time_ms": 1221.188, "learn_throughput": 1677.055, "synch_weights_time_ms": 11.051}, "counters": {"num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600}, "done": false, "training_iteration": 50, "trial_id": "45133_00000", "date": "2024-10-21_21-59-14", "timestamp": 1729547954, "time_this_iter_s": 3.455728054046631, "time_total_s": 177.4407856464386, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beea70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5210>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6380>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4640>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4b80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 177.4407856464386, "iterations_since_restore": 50, "perf": {"cpu_util_percent": 7.3, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3493238519877195, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 8.813571107387542, "policy_loss": -0.0014232280082069337, "vf_loss": 8.814994299411774, "vf_explained_var": 0.02033012956380844, "kl": 0.0043645069163081775, "entropy": 2.069055162370205, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.304588981717825, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.848564839363098, "policy_loss": -0.0016881488729268313, "vf_loss": 9.850252938270568, "vf_explained_var": 0.0002442166209220886, "kl": 0.0019248968016199798, "entropy": 0.36706278324127195, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.58680277839303, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.192346847057342, "policy_loss": -0.00029872312443330885, "vf_loss": 9.192645466327667, "vf_explained_var": 8.000880479812622e-05, "kl": 0.009912955490017339, "entropy": 0.25729006063193083, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.257460129261017, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.32025283575058, "policy_loss": -0.005515541729982943, "vf_loss": 8.325659322738648, "vf_explained_var": 0.0002798542380332947, "kl": 0.00871835184707379, "entropy": 2.9056250274181368, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2067.9567376181935, "episode_len_mean": 3017.6, "episode_media": {}, "episodes_timesteps_total": 90528, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 440.37012070112377, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 186.84317900135395, "DC1_ls_policy": -1872.6990938524464, "DC2_ls_policy": 3849.7175623994567, "DC3_ls_policy": -95.90490993017076}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115692.96761608947, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.11628301152427109, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.6091912532045434, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 55901.35424069625, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 6.430041152263374e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109545.40190739362, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007144201433234001, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5076473050549919, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105126821.3237788, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 30.763220847097372, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 665.6683551261414, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5912741197985562, "mean_inference_ms": 2.131164151620173, "mean_action_processing_ms": 0.32149064002243954, "mean_env_wait_ms": 4.312440028510513, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033932924270629883, "StateBufferConnector_ms": 0.002418359120686849, "ViewRequirementAgentConnector_ms": 0.0526114304860433}, "num_episodes": 0, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2067.9567376181935, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792, "num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 593.4416660708025, "num_env_steps_trained_throughput_per_sec": 593.4416660708025, "timesteps_total": 104448, "num_env_steps_sampled_lifetime": 104448, "num_agent_steps_sampled_lifetime": 417792, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 417792, "timers": {"training_iteration_time_ms": 3432.876, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3432.807, "sample_time_ms": 2179.95, "learn_time_ms": 1222.221, "learn_throughput": 1675.638, "synch_weights_time_ms": 11.18}, "counters": {"num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792}, "done": false, "training_iteration": 51, "trial_id": "45133_00000", "date": "2024-10-21_21-59-17", "timestamp": 1729547957, "time_this_iter_s": 3.4568731784820557, "time_total_s": 180.89765882492065, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a999bd0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeac880>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeacaf0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeafb20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada04f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 180.89765882492065, "iterations_since_restore": 51, "perf": {"cpu_util_percent": 19.380000000000003, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0519984856247904, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.235034370422364, "policy_loss": 0.00014308636309579015, "vf_loss": 9.234891307353973, "vf_explained_var": 0.03249760717153549, "kl": 0.0011917497357008464, "entropy": 1.9809118658304214, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3235356755554677, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.877733838558196, "policy_loss": -0.0027101109037175773, "vf_loss": 9.880443954467774, "vf_explained_var": -0.0004516668617725372, "kl": 0.0032591446360299868, "entropy": 0.3849527880549431, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.778089439868927, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.1656662940979, "policy_loss": -0.0015599409700371325, "vf_loss": 9.167226195335388, "vf_explained_var": -4.833713173866272e-05, "kl": 0.008265795270791614, "entropy": 0.19589503509923817, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.529311352968216, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.45471385717392, "policy_loss": -0.0023964113905094566, "vf_loss": 8.457036918401718, "vf_explained_var": 0.00013955682516098022, "kl": 0.005866706263077987, "entropy": 2.9302115768194197, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2067.9567376181935, "episode_len_mean": 3017.6, "episode_media": {}, "episodes_timesteps_total": 90528, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 440.37012070112377, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 186.84317900135395, "DC1_ls_policy": -1872.6990938524464, "DC2_ls_policy": 3849.7175623994567, "DC3_ls_policy": -95.90490993017076}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115692.96761608947, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.11628301152427109, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.6091912532045434, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 55901.35424069625, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 6.430041152263374e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109545.40190739362, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007144201433234001, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5076473050549919, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105126821.3237788, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 30.763220847097372, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 665.6683551261414, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5912741197985562, "mean_inference_ms": 2.131164151620173, "mean_action_processing_ms": 0.32149064002243954, "mean_env_wait_ms": 4.312440028510513, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033932924270629883, "StateBufferConnector_ms": 0.002418359120686849, "ViewRequirementAgentConnector_ms": 0.0526114304860433}, "num_episodes": 0, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2067.9567376181935, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984, "num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 600.8228322248569, "num_env_steps_trained_throughput_per_sec": 600.8228322248569, "timesteps_total": 106496, "num_env_steps_sampled_lifetime": 106496, "num_agent_steps_sampled_lifetime": 425984, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 425984, "timers": {"training_iteration_time_ms": 3413.755, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3413.684, "sample_time_ms": 2163.436, "learn_time_ms": 1220.549, "learn_throughput": 1677.933, "synch_weights_time_ms": 11.194}, "counters": {"num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984}, "done": false, "training_iteration": 52, "trial_id": "45133_00000", "date": "2024-10-21_21-59-21", "timestamp": 1729547961, "time_this_iter_s": 3.414616346359253, "time_total_s": 184.3122751712799, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bee5f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada21d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0be0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2b90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2410>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 184.3122751712799, "iterations_since_restore": 52, "perf": {"cpu_util_percent": 19.18, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9945704214274884, "cur_kl_coeff": 1.164153218269348e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.224355137348175, "policy_loss": -0.0013501199544407427, "vf_loss": 9.22570526599884, "vf_explained_var": 0.014275124669075013, "kl": 0.0015941999731307812, "entropy": 1.703888188302517, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.530813417583704, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.9006298661232, "policy_loss": -0.002654422668274492, "vf_loss": 9.903284299373627, "vf_explained_var": 0.0010446980595588684, "kl": 0.0061373485248168436, "entropy": 0.39094823859632016, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9699034333229064, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.466543579101563, "policy_loss": -0.0032739969552494585, "vf_loss": 9.469817650318145, "vf_explained_var": 2.5413930416107178e-05, "kl": 0.011045871949602316, "entropy": -0.02546631115837954, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.425861848890781, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.104344922304153, "policy_loss": -0.004706358729163185, "vf_loss": 7.108937638998031, "vf_explained_var": -0.0002664603292942047, "kl": 0.00909286081473865, "entropy": 2.891643759608269, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176}, "env_runners": {"episode_reward_max": 5219.277891733597, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2126.893121238601, "episode_len_mean": 3028.6451612903224, "episode_media": {}, "episodes_timesteps_total": 93888, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 440.37012070112377, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 187.8316336673216, "DC1_ls_policy": -1829.0522308325894, "DC2_ls_policy": 3865.3016158542573, "DC3_ls_policy": -97.18789745038808}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115463.56827389398, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.11253194663639138, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.5733532865113091, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 55936.11194291564, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 6.222620469932298e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109760.16897430943, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0069137433224845165, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.49880806787195836, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105644072.72881325, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 29.77085888428778, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 660.9310334746069, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5914345942748179, "mean_inference_ms": 2.131544008474575, "mean_action_processing_ms": 0.32161688610086253, "mean_env_wait_ms": 4.314365853461821, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003370354252476846, "StateBufferConnector_ms": 0.0024232172196911226, "ViewRequirementAgentConnector_ms": 0.052689352343159336}, "num_episodes": 1, "episode_return_max": 5219.277891733597, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2126.893121238601, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176, "num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 597.1386615886554, "num_env_steps_trained_throughput_per_sec": 597.1386615886554, "timesteps_total": 108544, "num_env_steps_sampled_lifetime": 108544, "num_agent_steps_sampled_lifetime": 434176, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 434176, "timers": {"training_iteration_time_ms": 3423.366, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3423.295, "sample_time_ms": 2173.633, "learn_time_ms": 1219.726, "learn_throughput": 1679.065, "synch_weights_time_ms": 11.131}, "counters": {"num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176}, "done": false, "training_iteration": 53, "trial_id": "45133_00000", "date": "2024-10-21_21-59-24", "timestamp": 1729547964, "time_this_iter_s": 3.4383704662323, "time_total_s": 187.7506456375122, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beea70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada30d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1f00>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2a40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2f80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 187.7506456375122, "iterations_since_restore": 53, "perf": {"cpu_util_percent": 19.46, "ram_util_percent": 3.96}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0201068207621575, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.15431776046753, "policy_loss": -0.00029171250062063334, "vf_loss": 9.154609429836274, "vf_explained_var": 0.03358462974429131, "kl": 0.001824125382972852, "entropy": 2.2400135561823844, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6288844026625156, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.910381281375885, "policy_loss": -0.0017974553164094686, "vf_loss": 9.912178790569305, "vf_explained_var": -0.00017315968871116637, "kl": 0.003743692669786469, "entropy": 0.38828046396374705, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.357016821950674, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.117088913917542, "policy_loss": -0.0008932407712563872, "vf_loss": 9.11798220872879, "vf_explained_var": 0.00012853369116783142, "kl": 0.0037951604934288686, "entropy": 0.20854266062378884, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.878779335319996, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.840812277793884, "policy_loss": -0.005737802345538512, "vf_loss": 8.846409440040588, "vf_explained_var": -5.1894783973693846e-05, "kl": 0.011260799565661728, "entropy": 2.790915477275848, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368}, "env_runners": {"episode_reward_max": 6739.1525253298305, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2271.026227616452, "episode_len_mean": 3042.0, "episode_media": {}, "episodes_timesteps_total": 97344, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 629.0082814214958, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 222.407613002312, "DC1_ls_policy": -1752.2378398246494, "DC2_ls_policy": 3885.298624861629, "DC3_ls_policy": -84.44217042283873}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 115157.89219592567, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10901532330400415, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.5241950385532013, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 55912.61497503855, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 6.028163580246913e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109624.19456442696, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0066976888436568755, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.48322935799632993, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105985482.14112689, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 28.840519544153786, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 640.2925591574026, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5914853154033022, "mean_inference_ms": 2.1318639190361326, "mean_action_processing_ms": 0.3216434818107418, "mean_env_wait_ms": 4.314825774406586, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033563002943992615, "StateBufferConnector_ms": 0.0024216249585151672, "ViewRequirementAgentConnector_ms": 0.052661262452602386}, "num_episodes": 1, "episode_return_max": 6739.1525253298305, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2271.026227616452, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368, "num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 616.2842178095585, "num_env_steps_trained_throughput_per_sec": 616.2842178095585, "timesteps_total": 110592, "num_env_steps_sampled_lifetime": 110592, "num_agent_steps_sampled_lifetime": 442368, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 442368, "timers": {"training_iteration_time_ms": 3404.301, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3404.23, "sample_time_ms": 2155.017, "learn_time_ms": 1219.378, "learn_throughput": 1679.545, "synch_weights_time_ms": 11.032}, "counters": {"num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368}, "done": false, "training_iteration": 54, "trial_id": "45133_00000", "date": "2024-10-21_21-59-28", "timestamp": 1729547968, "time_this_iter_s": 3.330812931060791, "time_total_s": 191.081458568573, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c0af0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a6193c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a6e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61ba30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a500>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 191.081458568573, "iterations_since_restore": 54, "perf": {"cpu_util_percent": 19.000000000000004, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.656792043894529, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.115016841888428, "policy_loss": -0.00596242540050298, "vf_loss": 9.120979249477386, "vf_explained_var": 0.016699420660734175, "kl": 0.012343134139952385, "entropy": 1.805386696755886, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4330225352197887, "cur_kl_coeff": 1.8189894035458563e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.852279698848724, "policy_loss": -0.0013327023421879857, "vf_loss": 9.853612446784973, "vf_explained_var": -3.9159506559371946e-05, "kl": 0.0024551427137623704, "entropy": 0.4281507257372141, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.010621419548988, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 8.972627913951873, "policy_loss": -0.002997015346772969, "vf_loss": 8.975625038146973, "vf_explained_var": -3.4456700086593627e-05, "kl": 0.005467086911085062, "entropy": 0.1090817489195615, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6113316386938097, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.06567787528038, "policy_loss": -0.004569104115944356, "vf_loss": 8.070137590169907, "vf_explained_var": -0.000306856632232666, "kl": 0.008754275357387088, "entropy": 2.7926270812749863, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560}, "env_runners": {"episode_reward_max": 6739.1525253298305, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2368.3894402355236, "episode_len_mean": 3034.181818181818, "episode_media": {}, "episodes_timesteps_total": 100128, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 834.6582428826653, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 244.7607757771701, "DC1_ls_policy": -1673.8470494395792, "DC2_ls_policy": 3874.7273199289907, "DC3_ls_policy": -77.25160603105832}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 114627.21031274254, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10571182865842826, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.478007310112195, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 55958.906062059454, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 5.845491956603067e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109716.54917045552, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.006494728575667273, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4693588584680538, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105669015.93087651, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 27.966564406452157, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 621.3956456832841, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5916775736543947, "mean_inference_ms": 2.1317026907906005, "mean_action_processing_ms": 0.3216038239827381, "mean_env_wait_ms": 4.31554008809209, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003343820571899414, "StateBufferConnector_ms": 0.0024239222208658853, "ViewRequirementAgentConnector_ms": 0.0527862346533573}, "num_episodes": 1, "episode_return_max": 6739.1525253298305, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2368.3894402355236, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560, "num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 587.829562892357, "num_env_steps_trained_throughput_per_sec": 587.829562892357, "timesteps_total": 112640, "num_env_steps_sampled_lifetime": 112640, "num_agent_steps_sampled_lifetime": 450560, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 450560, "timers": {"training_iteration_time_ms": 3420.23, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3420.159, "sample_time_ms": 2170.337, "learn_time_ms": 1220.066, "learn_throughput": 1678.597, "synch_weights_time_ms": 10.99}, "counters": {"num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560}, "done": false, "training_iteration": 55, "trial_id": "45133_00000", "date": "2024-10-21_21-59-31", "timestamp": 1729547971, "time_this_iter_s": 3.4905972480773926, "time_total_s": 194.5720558166504, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99bd90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1e70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada25f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2ef0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0940>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 194.5720558166504, "iterations_since_restore": 55, "perf": {"cpu_util_percent": 18.6, "ram_util_percent": 3.96}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8360303804278373, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.603504252433776, "policy_loss": -0.00168195670703426, "vf_loss": 9.605186235904693, "vf_explained_var": 0.006288185715675354, "kl": 0.005991987103766405, "entropy": 2.0367256075143816, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1720828671008348, "cur_kl_coeff": 9.094947017729282e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.874173295497894, "policy_loss": -0.0015772407117765398, "vf_loss": 9.87575044631958, "vf_explained_var": 0.0004717521369457245, "kl": 0.0029571758753413604, "entropy": 0.44381467774510386, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.622032763063908, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.563324987888336, "policy_loss": 0.0017227988864760846, "vf_loss": 9.561602139472962, "vf_explained_var": -1.5328824520111085e-05, "kl": 0.012260410867565952, "entropy": 0.058017935015959664, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.932697767019272, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.515168774127961, "policy_loss": -0.0017902809602674096, "vf_loss": 8.516886878013612, "vf_explained_var": -0.00034972876310348513, "kl": 0.00577820734051831, "entropy": 2.8030316680669785, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752}, "env_runners": {"episode_reward_max": 6739.1525253298305, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2368.3894402355236, "episode_len_mean": 3034.181818181818, "episode_media": {}, "episodes_timesteps_total": 100128, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1764.3847327178512, "DC1_ls_policy": 834.6582428826653, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 244.7607757771701, "DC1_ls_policy": -1673.8470494395792, "DC2_ls_policy": 3874.7273199289907, "DC3_ls_policy": -77.25160603105832}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 114627.21031274254, "DC1_ls_policy/bat_CO2_footprint_sum_min": 93509.36687217852, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10571182865842826, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.478007310112195, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 55958.906062059454, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 5.845491956603067e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109716.54917045552, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.006494728575667273, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4693588584680538, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105669015.93087651, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 27.966564406452157, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 621.3956456832841, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5916775736543947, "mean_inference_ms": 2.1317026907906005, "mean_action_processing_ms": 0.3216038239827381, "mean_env_wait_ms": 4.31554008809209, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003343820571899414, "StateBufferConnector_ms": 0.0024239222208658853, "ViewRequirementAgentConnector_ms": 0.0527862346533573}, "num_episodes": 0, "episode_return_max": 6739.1525253298305, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2368.3894402355236, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752, "num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 627.2096872872245, "num_env_steps_trained_throughput_per_sec": 627.2096872872245, "timesteps_total": 114688, "num_env_steps_sampled_lifetime": 114688, "num_agent_steps_sampled_lifetime": 458752, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 458752, "timers": {"training_iteration_time_ms": 3397.881, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3397.812, "sample_time_ms": 2154.014, "learn_time_ms": 1214.921, "learn_throughput": 1685.706, "synch_weights_time_ms": 11.185}, "counters": {"num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752}, "done": false, "training_iteration": 56, "trial_id": "45133_00000", "date": "2024-10-21_21-59-35", "timestamp": 1729547975, "time_this_iter_s": 3.271857261657715, "time_total_s": 197.8439130783081, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae732e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada04c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada21d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2fb0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1e10>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 197.8439130783081, "iterations_since_restore": 56, "perf": {"cpu_util_percent": 18.92, "ram_util_percent": 3.9799999999999995}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3426047280430793, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.538957941532136, "policy_loss": -0.002671792672481388, "vf_loss": 9.541629683971404, "vf_explained_var": 0.0055913753807544705, "kl": 0.009762808946745138, "entropy": 1.8305743783712387, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.478315141797066, "cur_kl_coeff": 4.547473508864641e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.75245487689972, "policy_loss": -0.003397222561761737, "vf_loss": 9.755852115154266, "vf_explained_var": 7.281601428985596e-05, "kl": 0.006104869436331448, "entropy": 0.4587760157883167, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.781475744396448, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.456739950180054, "policy_loss": 0.0003141580149531364, "vf_loss": 9.456425726413727, "vf_explained_var": -1.300126314163208e-05, "kl": 0.009499599703305462, "entropy": -0.025582979450700805, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.096490648388863, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.448629879951477, "policy_loss": -0.0015268205432221293, "vf_loss": 8.450092375278473, "vf_explained_var": -0.00019939318299293517, "kl": 0.005157978957687, "entropy": 2.8021309435367585, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944}, "env_runners": {"episode_reward_max": 6739.1525253298305, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2576.4268790408423, "episode_len_mean": 2997.942857142857, "episode_media": {}, "episodes_timesteps_total": 104928, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1879.5181875029257, "DC1_ls_policy": 1072.902494755591, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 312.0810016005692, "DC1_ls_policy": -1518.0631395275227, "DC2_ls_policy": 3816.846575639529, "DC3_ls_policy": -34.43755867173336}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 113489.84780295356, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09967115273508952, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.3935497495343554, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56183.54077451309, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 5.511463844797178e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109203.80949891108, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0061236012284862865, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.44339549512702214, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 104052571.33683607, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 26.368475011797745, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 586.1731712870965, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5919104516094243, "mean_inference_ms": 2.1313093741186386, "mean_action_processing_ms": 0.32155866417082235, "mean_env_wait_ms": 4.315834968797217, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034126213618687223, "StateBufferConnector_ms": 0.002419437680925642, "ViewRequirementAgentConnector_ms": 0.05269220897129604}, "num_episodes": 2, "episode_return_max": 6739.1525253298305, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2576.4268790408423, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944, "num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 605.2811920367501, "num_env_steps_trained_throughput_per_sec": 605.2811920367501, "timesteps_total": 116736, "num_env_steps_sampled_lifetime": 116736, "num_agent_steps_sampled_lifetime": 466944, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 466944, "timers": {"training_iteration_time_ms": 3401.466, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3401.397, "sample_time_ms": 2163.215, "learn_time_ms": 1210.182, "learn_throughput": 1692.307, "synch_weights_time_ms": 10.967}, "counters": {"num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944}, "done": false, "training_iteration": 57, "trial_id": "45133_00000", "date": "2024-10-21_21-59-38", "timestamp": 1729547978, "time_this_iter_s": 3.389315605163574, "time_total_s": 201.23322868347168, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c1990>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0a90>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3040>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0550>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada32e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 201.23322868347168, "iterations_since_restore": 57, "perf": {"cpu_util_percent": 6.459999999999999, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3038829267024994, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.219122755527497, "policy_loss": -0.003286540776025504, "vf_loss": 9.222409319877624, "vf_explained_var": 0.004724828153848648, "kl": 0.00921731369153495, "entropy": 1.8020005106925965, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2766250163316726, "cur_kl_coeff": 4.547473508864641e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.800222396850586, "policy_loss": -0.0010607944801449775, "vf_loss": 9.801283156871795, "vf_explained_var": 0.00010261759161949158, "kl": 0.0029662043319376606, "entropy": 0.41718292497098447, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.729084837436676, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.404595506191253, "policy_loss": -0.0005736781633459032, "vf_loss": 9.40516916513443, "vf_explained_var": 4.9971044063568115e-05, "kl": 0.00748460630902793, "entropy": -0.08090957629610784, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.421035827696324, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.930596131086349, "policy_loss": -0.0037320236559025945, "vf_loss": 7.934211081266403, "vf_explained_var": 0.000498645007610321, "kl": 0.009361581364374951, "entropy": 2.800772789120674, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136}, "env_runners": {"episode_reward_max": 6739.1525253298305, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2576.4268790408423, "episode_len_mean": 2997.942857142857, "episode_media": {}, "episodes_timesteps_total": 104928, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1879.5181875029257, "DC1_ls_policy": 1072.902494755591, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 312.0810016005692, "DC1_ls_policy": -1518.0631395275227, "DC2_ls_policy": 3816.846575639529, "DC3_ls_policy": -34.43755867173336}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 113489.84780295356, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09967115273508952, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.3935497495343554, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56183.54077451309, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 5.511463844797178e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109203.80949891108, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0061236012284862865, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.44339549512702214, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 104052571.33683607, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 26.368475011797745, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 586.1731712870965, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5919104516094243, "mean_inference_ms": 2.1313093741186386, "mean_action_processing_ms": 0.32155866417082235, "mean_env_wait_ms": 4.315834968797217, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034126213618687223, "StateBufferConnector_ms": 0.002419437680925642, "ViewRequirementAgentConnector_ms": 0.05269220897129604}, "num_episodes": 0, "episode_return_max": 6739.1525253298305, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2576.4268790408423, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136, "num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 625.1659516746679, "num_env_steps_trained_throughput_per_sec": 625.1659516746679, "timesteps_total": 118784, "num_env_steps_sampled_lifetime": 118784, "num_agent_steps_sampled_lifetime": 475136, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 475136, "timers": {"training_iteration_time_ms": 3381.809, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3381.739, "sample_time_ms": 2147.159, "learn_time_ms": 1207.026, "learn_throughput": 1696.732, "synch_weights_time_ms": 10.931}, "counters": {"num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136}, "done": false, "training_iteration": 58, "trial_id": "45133_00000", "date": "2024-10-21_21-59-42", "timestamp": 1729547982, "time_this_iter_s": 3.2820935249328613, "time_total_s": 204.51532220840454, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99bd90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2530>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3160>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3430>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2bf0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 204.51532220840454, "iterations_since_restore": 58, "perf": {"cpu_util_percent": 7.359999999999999, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.072270247340202, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.284404468536376, "policy_loss": -0.0016294163768179714, "vf_loss": 9.286033821105956, "vf_explained_var": 0.0028798580169677734, "kl": 0.004491242100115166, "entropy": 2.101478135585785, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8825140573084354, "cur_kl_coeff": 2.2737367544323204e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.827850914001464, "policy_loss": -0.0005899419425986707, "vf_loss": 9.828440892696381, "vf_explained_var": 0.0007365845143795013, "kl": 0.0030124794179905968, "entropy": 0.39683404564857483, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.486068557202816, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.330784094333648, "policy_loss": -0.002620331465732306, "vf_loss": 9.333404517173767, "vf_explained_var": -6.904676556587219e-05, "kl": 0.012206893002805003, "entropy": -0.041616178170079364, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.02423891723156, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.475552767515182, "policy_loss": -0.0033521381788887083, "vf_loss": 8.478834944963456, "vf_explained_var": 0.00028565302491188047, "kl": 0.005602384869939669, "entropy": 2.796296724677086, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328}, "env_runners": {"episode_reward_max": 6739.1525253298305, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2676.385305794848, "episode_len_mean": 2984.0, "episode_media": {}, "episodes_timesteps_total": 107424, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1879.5181875029257, "DC1_ls_policy": 1094.5456346944834, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 336.6472795023717, "DC1_ls_policy": -1445.4906735769114, "DC2_ls_policy": 3792.345429801505, "DC3_ls_policy": -7.116729932118179}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 113016.5080950647, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09690250960355924, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.3548400342695122, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56346.26763902284, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 5.358367626886145e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109018.73105064679, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005953501194361667, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.43107895359571596, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103460776.42363332, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 25.636017372581144, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 569.8905831957883, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5918695190434256, "mean_inference_ms": 2.131454558205663, "mean_action_processing_ms": 0.3214613899677252, "mean_env_wait_ms": 4.316076685766944, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033954779307047525, "StateBufferConnector_ms": 0.002418955167134603, "ViewRequirementAgentConnector_ms": 0.052676763799455434}, "num_episodes": 1, "episode_return_max": 6739.1525253298305, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2676.385305794848, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328, "num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 583.9777311755316, "num_env_steps_trained_throughput_per_sec": 583.9777311755316, "timesteps_total": 120832, "num_env_steps_sampled_lifetime": 120832, "num_agent_steps_sampled_lifetime": 483328, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 483328, "timers": {"training_iteration_time_ms": 3397.796, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3397.725, "sample_time_ms": 2164.334, "learn_time_ms": 1205.456, "learn_throughput": 1698.942, "synch_weights_time_ms": 11.068}, "counters": {"num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328}, "done": false, "training_iteration": 59, "trial_id": "45133_00000", "date": "2024-10-21_21-59-45", "timestamp": 1729547985, "time_this_iter_s": 3.514434814453125, "time_total_s": 208.02975702285767, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae732e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2770>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1f30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0e80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada29e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 208.02975702285767, "iterations_since_restore": 59, "perf": {"cpu_util_percent": 19.4, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0512678630650045, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.34440940618515, "policy_loss": -0.004041113296989351, "vf_loss": 9.348450601100922, "vf_explained_var": 0.006270758807659149, "kl": 0.006276301401330968, "entropy": 1.6389912709593772, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.5370363228023054, "cur_kl_coeff": 1.1368683772161602e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.83826574087143, "policy_loss": -0.0006056291982531548, "vf_loss": 9.838871312141418, "vf_explained_var": -3.6492198705673215e-05, "kl": 0.0009839050462687737, "entropy": 0.4031966272741556, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.0583316937088965, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.392079710960388, "policy_loss": -0.0009548121714033186, "vf_loss": 9.39303457736969, "vf_explained_var": -2.275332808494568e-05, "kl": 0.007679471346911992, "entropy": -0.1449371444992721, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.127467563748359, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.090221714973449, "policy_loss": -0.004434903216315433, "vf_loss": 8.09453849196434, "vf_explained_var": 0.0005539670586585998, "kl": 0.009448389701072344, "entropy": 2.7607171803712847, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520}, "env_runners": {"episode_reward_max": 6739.1525253298305, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2676.385305794848, "episode_len_mean": 2984.0, "episode_media": {}, "episodes_timesteps_total": 107424, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 1879.5181875029257, "DC1_ls_policy": 1094.5456346944834, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 336.6472795023717, "DC1_ls_policy": -1445.4906735769114, "DC2_ls_policy": 3792.345429801505, "DC3_ls_policy": -7.116729932118179}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 113016.5080950647, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09690250960355924, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.3548400342695122, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56346.26763902284, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 5.358367626886145e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109018.73105064679, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005953501194361667, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.43107895359571596, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103460776.42363332, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 25.636017372581144, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 569.8905831957883, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5918695190434256, "mean_inference_ms": 2.131454558205663, "mean_action_processing_ms": 0.3214613899677252, "mean_env_wait_ms": 4.316076685766944, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033954779307047525, "StateBufferConnector_ms": 0.002418955167134603, "ViewRequirementAgentConnector_ms": 0.052676763799455434}, "num_episodes": 0, "episode_return_max": 6739.1525253298305, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2676.385305794848, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520, "num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 575.1554901520444, "num_env_steps_trained_throughput_per_sec": 575.1554901520444, "timesteps_total": 122880, "num_env_steps_sampled_lifetime": 122880, "num_agent_steps_sampled_lifetime": 491520, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 491520, "timers": {"training_iteration_time_ms": 3408.919, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3408.847, "sample_time_ms": 2173.786, "learn_time_ms": 1207.038, "learn_throughput": 1696.716, "synch_weights_time_ms": 11.021}, "counters": {"num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520}, "done": false, "training_iteration": 60, "trial_id": "45133_00000", "date": "2024-10-21_21-59-49", "timestamp": 1729547989, "time_this_iter_s": 3.5663418769836426, "time_total_s": 211.5960988998413, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c0dc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61be50>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b040>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61bf70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7940>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 211.5960988998413, "iterations_since_restore": 60, "perf": {"cpu_util_percent": 19.2, "ram_util_percent": 3.9799999999999995}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.170882411301136, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.399453628063203, "policy_loss": 0.0007108468969818204, "vf_loss": 9.398742830753326, "vf_explained_var": 0.007708589732646942, "kl": 0.0024716311379961555, "entropy": 1.7297382444143294, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.873664158582687, "cur_kl_coeff": 5.684341886080801e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.671746873855591, "policy_loss": -0.0006868898286484182, "vf_loss": 9.672433769702911, "vf_explained_var": 1.985132694244385e-05, "kl": 0.0031327250723961696, "entropy": 0.3994000192731619, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.0110304147005085, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.244945311546326, "policy_loss": -0.0023556263302452864, "vf_loss": 9.247300958633422, "vf_explained_var": 1.325160264968872e-05, "kl": 0.008981139534080284, "entropy": -0.1365108332131058, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8501127019524573, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.142215210199357, "policy_loss": -0.004079294146504253, "vf_loss": 8.146165019273758, "vf_explained_var": 0.0007786862552165985, "kl": 0.010368485178652017, "entropy": 2.657095041871071, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2917.7644178551636, "episode_len_mean": 3043.4594594594596, "episode_media": {}, "episodes_timesteps_total": 112608, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2425.8185564448218, "DC1_ls_policy": 1487.8991972834506, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 393.11136806838385, "DC1_ls_policy": -1366.209866256361, "DC2_ls_policy": 3867.4867520189955, "DC3_ls_policy": 23.376164024144426}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 112851.46061626062, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09428352285751711, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.318222736046012, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56272.26187000891, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 5.213546880213546e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108804.30655512611, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005792595756676217, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.42071070359863455, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105280983.51760116, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 24.94315203818706, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 555.150332354911, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.591897472216988, "mean_inference_ms": 2.131726872701151, "mean_action_processing_ms": 0.32150560898989244, "mean_env_wait_ms": 4.3168085547990565, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033831274187242663, "StateBufferConnector_ms": 0.0024244591996476455, "ViewRequirementAgentConnector_ms": 0.052722402521081874}, "num_episodes": 1, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2917.7644178551636, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712, "num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 589.6913338466455, "num_env_steps_trained_throughput_per_sec": 589.6913338466455, "timesteps_total": 124928, "num_env_steps_sampled_lifetime": 124928, "num_agent_steps_sampled_lifetime": 499712, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 499712, "timers": {"training_iteration_time_ms": 3411.114, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3411.04, "sample_time_ms": 2179.379, "learn_time_ms": 1203.578, "learn_throughput": 1701.593, "synch_weights_time_ms": 10.886}, "counters": {"num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712}, "done": false, "training_iteration": 61, "trial_id": "45133_00000", "date": "2024-10-21_21-59-52", "timestamp": 1729547992, "time_this_iter_s": 3.4791061878204346, "time_total_s": 215.07520508766174, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef5b0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2050>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0eb0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0f40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada20e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 215.07520508766174, "iterations_since_restore": 61, "perf": {"cpu_util_percent": 19.22, "ram_util_percent": 3.96}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5288089528679847, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.661603212356567, "policy_loss": -0.002476823178585619, "vf_loss": 9.664080011844636, "vf_explained_var": 0.0041132688522338865, "kl": 0.00349256560749609, "entropy": 1.784704801440239, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.630756160616875, "cur_kl_coeff": 2.8421709430404005e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.820247673988343, "policy_loss": -0.003532602242194116, "vf_loss": 9.823780286312104, "vf_explained_var": -4.2463093996047975e-05, "kl": 0.006981627796591283, "entropy": 0.3907437019050121, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.759689432382584, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.302453720569611, "policy_loss": -0.0017943332204595208, "vf_loss": 9.30424805879593, "vf_explained_var": 1.6939640045166015e-05, "kl": 0.00969474154990332, "entropy": 0.03038327457034029, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.78600410670042, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.646110969781876, "policy_loss": -0.003117598919197917, "vf_loss": 8.649144649505615, "vf_explained_var": -5.561932921409607e-05, "kl": 0.006700858665226406, "entropy": 2.693560743331909, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 2917.7644178551636, "episode_len_mean": 3043.4594594594596, "episode_media": {}, "episodes_timesteps_total": 112608, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2425.8185564448218, "DC1_ls_policy": 1487.8991972834506, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 393.11136806838385, "DC1_ls_policy": -1366.209866256361, "DC2_ls_policy": 3867.4867520189955, "DC3_ls_policy": 23.376164024144426}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 112851.46061626062, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09428352285751711, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.318222736046012, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56272.26187000891, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 5.213546880213546e-06, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.00019290123456790122, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108804.30655512611, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005792595756676217, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.42071070359863455, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105280983.51760116, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 24.94315203818706, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 555.150332354911, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.591897472216988, "mean_inference_ms": 2.131726872701151, "mean_action_processing_ms": 0.32150560898989244, "mean_env_wait_ms": 4.3168085547990565, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033831274187242663, "StateBufferConnector_ms": 0.0024244591996476455, "ViewRequirementAgentConnector_ms": 0.052722402521081874}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 2917.7644178551636, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904, "num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 570.4126745997353, "num_env_steps_trained_throughput_per_sec": 570.4126745997353, "timesteps_total": 126976, "num_env_steps_sampled_lifetime": 126976, "num_agent_steps_sampled_lifetime": 507904, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 507904, "timers": {"training_iteration_time_ms": 3429.286, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3429.214, "sample_time_ms": 2201.175, "learn_time_ms": 1200.161, "learn_throughput": 1706.437, "synch_weights_time_ms": 10.714}, "counters": {"num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904}, "done": false, "training_iteration": 62, "trial_id": "45133_00000", "date": "2024-10-21_21-59-56", "timestamp": 1729547996, "time_this_iter_s": 3.59755539894104, "time_total_s": 218.67276048660278, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2b60>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada30d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2200>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1210>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 218.67276048660278, "iterations_since_restore": 62, "perf": {"cpu_util_percent": 19.32, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.120039400458336, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.690879142284393, "policy_loss": -0.00020624452736228704, "vf_loss": 9.691085362434388, "vf_explained_var": 0.002024151384830475, "kl": 0.004144136733248161, "entropy": 1.279426107555628, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6419252403080464, "cur_kl_coeff": 2.8421709430404005e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.816761648654937, "policy_loss": -0.0010145518463104963, "vf_loss": 9.817776322364807, "vf_explained_var": 6.544440984725952e-05, "kl": 0.002623373067752665, "entropy": 0.4151645313948393, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.484874669462442, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.371929812431336, "policy_loss": -0.001359154167585075, "vf_loss": 9.373288893699646, "vf_explained_var": -0.00010121837258338928, "kl": 0.010536439659495045, "entropy": -0.1790397794917226, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.864316937327385, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.637749171257019, "policy_loss": -0.004989033157471567, "vf_loss": 7.642642599344254, "vf_explained_var": 0.000487421452999115, "kl": 0.007650664888240044, "entropy": 2.8058978468179703, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3087.8771257187595, "episode_len_mean": 3069.4736842105262, "episode_media": {}, "episodes_timesteps_total": 116640, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2425.8185564448218, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 422.6992422125387, "DC1_ls_policy": -1280.2043873668986, "DC2_ls_policy": 3885.545321292937, "DC3_ls_policy": 59.836949580181084}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 112471.49983672755, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09180237751916138, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.283532664044801, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56441.762587923935, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1603081778520374e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108705.67133705912, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005640159026237369, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4096589494939086, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105997329.1820505, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 24.28675330034003, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 540.5674223451537, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5918880650034227, "mean_inference_ms": 2.131395294166917, "mean_action_processing_ms": 0.3214734081195743, "mean_env_wait_ms": 4.317670120188349, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033645253432424446, "StateBufferConnector_ms": 0.0024204191408659283, "ViewRequirementAgentConnector_ms": 0.05269552531995272}, "num_episodes": 1, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3087.8771257187595, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096, "num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 594.5953015815179, "num_env_steps_trained_throughput_per_sec": 594.5953015815179, "timesteps_total": 129024, "num_env_steps_sampled_lifetime": 129024, "num_agent_steps_sampled_lifetime": 516096, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 516096, "timers": {"training_iteration_time_ms": 3430.753, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3430.681, "sample_time_ms": 2204.632, "learn_time_ms": 1198.913, "learn_throughput": 1708.214, "synch_weights_time_ms": 10.782}, "counters": {"num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096}, "done": false, "training_iteration": 63, "trial_id": "45133_00000", "date": "2024-10-21_22-00-00", "timestamp": 1729548000, "time_this_iter_s": 3.4515388011932373, "time_total_s": 222.12429928779602, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c1bd0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5450>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7310>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7130>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4610>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 222.12429928779602, "iterations_since_restore": 63, "perf": {"cpu_util_percent": 18.98, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3610523723065855, "cur_kl_coeff": 1.8189894035458563e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.278252828121186, "policy_loss": -0.0021910533192567526, "vf_loss": 9.28044377565384, "vf_explained_var": 0.0020120419561862946, "kl": 0.00348655677953662, "entropy": 1.5207783639431, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6077361635863783, "cur_kl_coeff": 1.4210854715202003e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.770589697360993, "policy_loss": -0.0010056453640572727, "vf_loss": 9.771595478057861, "vf_explained_var": -1.1145323514938355e-05, "kl": 0.004680174618057241, "entropy": 0.37792337238788604, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.344681033492089, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.14808430671692, "policy_loss": -0.0012307005177717655, "vf_loss": 9.149314999580383, "vf_explained_var": -2.8786808252334593e-05, "kl": 0.005178683005535118, "entropy": 0.10093896880862303, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.429545249044895, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.802529096603394, "policy_loss": -0.006152756221126765, "vf_loss": 8.808567202091217, "vf_explained_var": -6.083101034164429e-05, "kl": 0.009181873071111804, "entropy": 2.8204213619232177, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3087.8771257187595, "episode_len_mean": 3069.4736842105262, "episode_media": {}, "episodes_timesteps_total": 116640, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2425.8185564448218, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 422.6992422125387, "DC1_ls_policy": -1280.2043873668986, "DC2_ls_policy": 3885.545321292937, "DC3_ls_policy": 59.836949580181084}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 112471.49983672755, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09180237751916138, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.283532664044801, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56441.762587923935, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1603081778520374e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108705.67133705912, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005640159026237369, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4096589494939086, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105997329.1820505, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 24.28675330034003, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 540.5674223451537, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5918880650034227, "mean_inference_ms": 2.131395294166917, "mean_action_processing_ms": 0.3214734081195743, "mean_env_wait_ms": 4.317670120188349, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033645253432424446, "StateBufferConnector_ms": 0.0024204191408659283, "ViewRequirementAgentConnector_ms": 0.05269552531995272}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3087.8771257187595, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288, "num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 593.027871624712, "num_env_steps_trained_throughput_per_sec": 593.027871624712, "timesteps_total": 131072, "num_env_steps_sampled_lifetime": 131072, "num_agent_steps_sampled_lifetime": 524288, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 524288, "timers": {"training_iteration_time_ms": 3443.786, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3443.713, "sample_time_ms": 2219.484, "learn_time_ms": 1197.153, "learn_throughput": 1710.726, "synch_weights_time_ms": 10.777}, "counters": {"num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288}, "done": false, "training_iteration": 64, "trial_id": "45133_00000", "date": "2024-10-21_22-00-03", "timestamp": 1729548003, "time_this_iter_s": 3.4600298404693604, "time_total_s": 225.58432912826538, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef5b0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4760>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6470>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4910>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4df0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 225.58432912826538, "iterations_since_restore": 64, "perf": {"cpu_util_percent": 18.48, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9714923292398452, "cur_kl_coeff": 9.094947017729282e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.885576844215393, "policy_loss": -0.00017250670352950693, "vf_loss": 9.885749220848083, "vf_explained_var": 0.0012751109898090363, "kl": 0.004030660372520267, "entropy": 1.0907297387719155, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.809765496104956, "cur_kl_coeff": 7.105427357601001e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.809823787212371, "policy_loss": -0.0006960704165976494, "vf_loss": 9.810519742965699, "vf_explained_var": -2.38761305809021e-05, "kl": 0.0032139199677097214, "entropy": 0.37743730619549754, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.209718035161496, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.343812501430511, "policy_loss": -0.0007757502957247197, "vf_loss": 9.344588160514832, "vf_explained_var": -1.8630921840667724e-05, "kl": 0.010681529547719037, "entropy": -0.1888376172631979, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6317147821187974, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.729859906435013, "policy_loss": -0.001022401312366128, "vf_loss": 7.7308200120925905, "vf_explained_var": -0.0006463795900344849, "kl": 0.004986174338694127, "entropy": 2.894561207294464, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3087.8771257187595, "episode_len_mean": 3069.4736842105262, "episode_media": {}, "episodes_timesteps_total": 116640, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2425.8185564448218, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1729.2102293138898}, "policy_reward_mean": {"high_level_policy": 422.6992422125387, "DC1_ls_policy": -1280.2043873668986, "DC2_ls_policy": 3885.545321292937, "DC3_ls_policy": 59.836949580181084}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 112471.49983672755, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09180237751916138, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.283532664044801, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 56441.762587923935, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1603081778520374e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108705.67133705912, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005640159026237369, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4096589494939086, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 105997329.1820505, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 24.28675330034003, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 540.5674223451537, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5918880650034227, "mean_inference_ms": 2.131395294166917, "mean_action_processing_ms": 0.3214734081195743, "mean_env_wait_ms": 4.317670120188349, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033645253432424446, "StateBufferConnector_ms": 0.0024204191408659283, "ViewRequirementAgentConnector_ms": 0.05269552531995272}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3087.8771257187595, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480, "num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 626.6473485648463, "num_env_steps_trained_throughput_per_sec": 626.6473485648463, "timesteps_total": 133120, "num_env_steps_sampled_lifetime": 133120, "num_agent_steps_sampled_lifetime": 532480, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 532480, "timers": {"training_iteration_time_ms": 3422.204, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3422.132, "sample_time_ms": 2201.115, "learn_time_ms": 1193.857, "learn_throughput": 1715.448, "synch_weights_time_ms": 10.86}, "counters": {"num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480}, "done": false, "training_iteration": 65, "trial_id": "45133_00000", "date": "2024-10-21_22-00-06", "timestamp": 1729548006, "time_this_iter_s": 3.2750651836395264, "time_total_s": 228.8593943119049, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef640>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5840>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada65c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5690>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6290>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 228.8593943119049, "iterations_since_restore": 65, "perf": {"cpu_util_percent": 6.74, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8112732604146005, "cur_kl_coeff": 4.547473508864641e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.252972686290741, "policy_loss": -0.003454018826596439, "vf_loss": 9.256426763534545, "vf_explained_var": 0.004671259969472885, "kl": 0.01270655358894146, "entropy": 1.2999498173594475, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5001216560602186, "cur_kl_coeff": 3.5527136788005006e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.57592009305954, "policy_loss": -0.0014311154372990131, "vf_loss": 9.57735116481781, "vf_explained_var": 5.35130500793457e-05, "kl": 0.003728341059900231, "entropy": 0.2770321315154433, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.442658345401287, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.159269702434539, "policy_loss": -0.005480931571219117, "vf_loss": 9.164750683307648, "vf_explained_var": 1.356452703475952e-05, "kl": 0.011203804022809006, "entropy": -0.12607666137628257, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.850484623014927, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.8271946728229524, "policy_loss": -0.0034525917726568878, "vf_loss": 7.830609834194183, "vf_explained_var": 0.0002112843096256256, "kl": 0.0059859984165944015, "entropy": 2.901304742693901, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3514.595938896858, "episode_len_mean": 3037.714285714286, "episode_media": {}, "episodes_timesteps_total": 127584, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2425.8185564448218, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 560.0476784669728, "DC1_ls_policy": -1042.5840042984103, "DC2_ls_policy": 3797.972382610829, "DC3_ls_policy": 199.15988211746458}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110932.4136126021, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.08305929394590793, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1612985441130967, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57113.814096574584, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0498026371042243e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107016.77982910824, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005103001023738572, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.3706438114468697, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 104132001.1346358, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 21.97372917649812, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 489.09076130264486, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5923368158300952, "mean_inference_ms": 2.1312820748297243, "mean_action_processing_ms": 0.3215026938137196, "mean_env_wait_ms": 4.318736958310184, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034609011241367887, "StateBufferConnector_ms": 0.0024190970829554965, "ViewRequirementAgentConnector_ms": 0.05260507265726725}, "num_episodes": 4, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3514.595938896858, "episodes_this_iter": 4}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672, "num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 586.8178791038027, "num_env_steps_trained_throughput_per_sec": 586.8178791038027, "timesteps_total": 135168, "num_env_steps_sampled_lifetime": 135168, "num_agent_steps_sampled_lifetime": 540672, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 540672, "timers": {"training_iteration_time_ms": 3444.679, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3444.609, "sample_time_ms": 2219.33, "learn_time_ms": 1197.832, "learn_throughput": 1709.756, "synch_weights_time_ms": 10.756}, "counters": {"num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672}, "done": false, "training_iteration": 66, "trial_id": "45133_00000", "date": "2024-10-21_22-00-10", "timestamp": 1729548010, "time_this_iter_s": 3.5033960342407227, "time_total_s": 232.36279034614563, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c3490>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6a40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7070>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7520>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada76d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 232.36279034614563, "iterations_since_restore": 66, "perf": {"cpu_util_percent": 6.8, "ram_util_percent": 3.94}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.605377722531557, "cur_kl_coeff": 4.547473508864641e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.460970687866212, "policy_loss": -0.00019989025895483792, "vf_loss": 9.461170542240144, "vf_explained_var": 0.0024978160858154298, "kl": 0.002443180935131295, "entropy": 1.420719450712204, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.086467224359512, "cur_kl_coeff": 1.7763568394002503e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.771298158168793, "policy_loss": -0.00019471687264740467, "vf_loss": 9.771492803096772, "vf_explained_var": -2.5159865617752076e-05, "kl": 0.0013786453087062, "entropy": 0.3122118838131428, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.169835844635964, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.205691516399384, "policy_loss": -0.00323318827431649, "vf_loss": 9.208924698829652, "vf_explained_var": 3.788694739341736e-05, "kl": 0.005852060453004787, "entropy": 0.016165455750888215, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.778894081711769, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.302515333890915, "policy_loss": -0.0026906652783509344, "vf_loss": 8.305160939693451, "vf_explained_var": -0.0002519778907299042, "kl": 0.00719363808673279, "entropy": 2.8311728864908217, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3514.595938896858, "episode_len_mean": 3037.714285714286, "episode_media": {}, "episodes_timesteps_total": 127584, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2425.8185564448218, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 560.0476784669728, "DC1_ls_policy": -1042.5840042984103, "DC2_ls_policy": 3797.972382610829, "DC3_ls_policy": 199.15988211746458}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110932.4136126021, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90563.63951426346, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.08305929394590793, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1612985441130967, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57113.814096574584, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0498026371042243e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107016.77982910824, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.005103001023738572, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.3706438114468697, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 104132001.1346358, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 21.97372917649812, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 489.09076130264486, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5923368158300952, "mean_inference_ms": 2.1312820748297243, "mean_action_processing_ms": 0.3215026938137196, "mean_env_wait_ms": 4.318736958310184, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034609011241367887, "StateBufferConnector_ms": 0.0024190970829554965, "ViewRequirementAgentConnector_ms": 0.05260507265726725}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3514.595938896858, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864, "num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 596.5337163215437, "num_env_steps_trained_throughput_per_sec": 596.5337163215437, "timesteps_total": 137216, "num_env_steps_sampled_lifetime": 137216, "num_agent_steps_sampled_lifetime": 548864, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 548864, "timers": {"training_iteration_time_ms": 3449.64, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3449.572, "sample_time_ms": 2220.122, "learn_time_ms": 1201.959, "learn_throughput": 1703.885, "synch_weights_time_ms": 10.797}, "counters": {"num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864}, "done": false, "training_iteration": 67, "trial_id": "45133_00000", "date": "2024-10-21_22-00-14", "timestamp": 1729548014, "time_this_iter_s": 3.4406275749206543, "time_total_s": 235.80341792106628, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99bd90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6080>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5cc0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7f40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4cd0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 235.80341792106628, "iterations_since_restore": 67, "perf": {"cpu_util_percent": 19.500000000000004, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.452026105672121, "cur_kl_coeff": 2.2737367544323204e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.681386065483093, "policy_loss": 0.00017974242800846695, "vf_loss": 9.681206238269805, "vf_explained_var": 0.0033969521522521974, "kl": 0.003275230926465156, "entropy": 1.1122613169252873, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.930285705626011, "cur_kl_coeff": 8.881784197001252e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.401164126396178, "policy_loss": -0.0028042515856213867, "vf_loss": 9.403968465328216, "vf_explained_var": -1.798272132873535e-05, "kl": 0.0054316751348324034, "entropy": 0.31749756149947644, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.165629356354475, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.28207449913025, "policy_loss": -0.005159874842502177, "vf_loss": 9.287234461307525, "vf_explained_var": 0.000125054270029068, "kl": 0.008565147729314049, "entropy": 0.0830340622458607, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8837484389543535, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.7982635498046875, "policy_loss": -0.0018472946481779217, "vf_loss": 7.800075602531433, "vf_explained_var": -0.00020308196544647217, "kl": 0.005621247577408894, "entropy": 2.811612617969513, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3659.8323745172524, "episode_len_mean": 3047.4418604651164, "episode_media": {}, "episodes_timesteps_total": 131040, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 606.4770385407986, "DC1_ls_policy": -976.2354729107033, "DC2_ls_policy": 3795.3591014498684, "DC3_ls_policy": 234.23170743728622}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110457.63718195415, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.08112768245879379, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1342916012267457, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57234.63032777862, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.025388622287847e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106741.68060958151, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004984326581326047, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.36202418792484947, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 104225419.99862793, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 21.462712218905143, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 477.7165575514205, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5923671949076804, "mean_inference_ms": 2.1314580639790646, "mean_action_processing_ms": 0.32151707277274216, "mean_env_wait_ms": 4.318798357088418, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003454435703366302, "StateBufferConnector_ms": 0.002428958582323651, "ViewRequirementAgentConnector_ms": 0.0526860702869504}, "num_episodes": 1, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3659.8323745172524, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056, "num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 595.3380993086956, "num_env_steps_trained_throughput_per_sec": 595.3380993086956, "timesteps_total": 139264, "num_env_steps_sampled_lifetime": 139264, "num_agent_steps_sampled_lifetime": 557056, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 557056, "timers": {"training_iteration_time_ms": 3466.053, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3465.986, "sample_time_ms": 2234.952, "learn_time_ms": 1204.252, "learn_throughput": 1700.641, "synch_weights_time_ms": 10.648}, "counters": {"num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056}, "done": false, "training_iteration": 68, "trial_id": "45133_00000", "date": "2024-10-21_22-00-17", "timestamp": 1729548017, "time_this_iter_s": 3.44608998298645, "time_total_s": 239.24950790405273, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c3400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7b50>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6f80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4520>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada65c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 239.24950790405273, "iterations_since_restore": 68, "perf": {"cpu_util_percent": 19.4, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8411783933639527, "cur_kl_coeff": 1.1368683772161602e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.428293943405151, "policy_loss": -0.001635222788900137, "vf_loss": 9.429929196834564, "vf_explained_var": 0.0029664061963558196, "kl": 0.0025206909559766177, "entropy": 1.1702643923461438, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4982762947678565, "cur_kl_coeff": 8.881784197001252e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.766250276565552, "policy_loss": -0.0018078700464684515, "vf_loss": 9.768058133125304, "vf_explained_var": -6.078854203224182e-05, "kl": 0.0032810538323941054, "entropy": 0.2862402806058526, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.384640599042177, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.260231828689575, "policy_loss": -0.0032018386526033284, "vf_loss": 9.263433575630188, "vf_explained_var": 0.0002122536301612854, "kl": 0.00504127632712074, "entropy": 0.5095043338835239, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.474905887246132, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.615113109350204, "policy_loss": -0.003322531748563051, "vf_loss": 8.618393397331237, "vf_explained_var": -0.00045247524976730345, "kl": 0.006781241263547996, "entropy": 2.8833811402320864, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3737.917411524139, "episode_len_mean": 3034.909090909091, "episode_media": {}, "episodes_timesteps_total": 133536, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 630.8726388092446, "DC1_ls_policy": -929.9245615436757, "DC2_ls_policy": 3769.3927718895266, "DC3_ls_policy": 267.57656236904097}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110228.44774034452, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0792838714938212, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1085122466534105, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57484.78791359067, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0020843354176686e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106196.04293027357, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004871046431750455, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.353796365472012, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103644527.0856265, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.974923304839116, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 466.8593630616155, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.592312873471071, "mean_inference_ms": 2.1314495803525877, "mean_action_processing_ms": 0.3216292023918751, "mean_env_wait_ms": 4.31857562847148, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034394589337435636, "StateBufferConnector_ms": 0.002430108460513028, "ViewRequirementAgentConnector_ms": 0.05269890481775457}, "num_episodes": 1, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3737.917411524139, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248, "num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 596.9280688555864, "num_env_steps_trained_throughput_per_sec": 596.9280688555864, "timesteps_total": 141312, "num_env_steps_sampled_lifetime": 141312, "num_agent_steps_sampled_lifetime": 565248, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 565248, "timers": {"training_iteration_time_ms": 3458.444, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3458.38, "sample_time_ms": 2226.107, "learn_time_ms": 1205.903, "learn_throughput": 1698.312, "synch_weights_time_ms": 10.438}, "counters": {"num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248}, "done": false, "training_iteration": 69, "trial_id": "45133_00000", "date": "2024-10-21_22-00-21", "timestamp": 1729548021, "time_this_iter_s": 3.4372665882110596, "time_total_s": 242.6867744922638, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae732e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4df0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5840>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6050>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6dd0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 242.6867744922638, "iterations_since_restore": 69, "perf": {"cpu_util_percent": 19.359999999999996, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.480348242074251, "cur_kl_coeff": 5.684341886080801e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.899879646301269, "policy_loss": 0.0005796701239887625, "vf_loss": 9.899300050735473, "vf_explained_var": 0.0010022364556789398, "kl": 0.003765149277751334, "entropy": 0.835258873552084, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6856296606361867, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.739704871177674, "policy_loss": -0.0016866668942384423, "vf_loss": 9.741391491889953, "vf_explained_var": -1.687481999397278e-05, "kl": 0.0050677208970284935, "entropy": 0.26663596332073214, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5053625017404557, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.261256051063537, "policy_loss": -0.0013838685117661953, "vf_loss": 9.262639915943145, "vf_explained_var": 0.00016515031456947326, "kl": 0.005240132638210738, "entropy": 0.34041386377066374, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.965106275677681, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.295249944925308, "policy_loss": -0.004455774597590789, "vf_loss": 7.299648463726044, "vf_explained_var": 0.00015666261315345765, "kl": 0.00915377390492722, "entropy": 2.906490820646286, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3737.917411524139, "episode_len_mean": 3034.909090909091, "episode_media": {}, "episodes_timesteps_total": 133536, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 630.8726388092446, "DC1_ls_policy": -929.9245615436757, "DC2_ls_policy": 3769.3927718895266, "DC3_ls_policy": 267.57656236904097}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110228.44774034452, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0792838714938212, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1085122466534105, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57484.78791359067, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0020843354176686e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106196.04293027357, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004871046431750455, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.353796365472012, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103644527.0856265, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.974923304839116, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 466.8593630616155, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.592312873471071, "mean_inference_ms": 2.1314495803525877, "mean_action_processing_ms": 0.3216292023918751, "mean_env_wait_ms": 4.31857562847148, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034394589337435636, "StateBufferConnector_ms": 0.002430108460513028, "ViewRequirementAgentConnector_ms": 0.05269890481775457}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3737.917411524139, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440, "num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 576.3597306534392, "num_env_steps_trained_throughput_per_sec": 576.3597306534392, "timesteps_total": 143360, "num_env_steps_sampled_lifetime": 143360, "num_agent_steps_sampled_lifetime": 573440, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 573440, "timers": {"training_iteration_time_ms": 3457.7, "restore_workers_time_ms": 0.02, "training_step_time_ms": 3457.634, "sample_time_ms": 2226.402, "learn_time_ms": 1203.986, "learn_throughput": 1701.016, "synch_weights_time_ms": 10.642}, "counters": {"num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440}, "done": false, "training_iteration": 70, "trial_id": "45133_00000", "date": "2024-10-21_22-00-24", "timestamp": 1729548024, "time_this_iter_s": 3.56186842918396, "time_total_s": 246.24864292144775, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99bd90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0220>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2dd0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1bd0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1900>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 246.24864292144775, "iterations_since_restore": 70, "perf": {"cpu_util_percent": 18.84, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8279989153146743, "cur_kl_coeff": 2.8421709430404005e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.649156427383422, "policy_loss": -0.006247705570422113, "vf_loss": 9.655404090881348, "vf_explained_var": 0.002276831865310669, "kl": 0.009911422131381187, "entropy": 0.9071932710707188, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.441486155986786, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.510497629642487, "policy_loss": -0.0032611894188448788, "vf_loss": 9.513758718967438, "vf_explained_var": -2.5256723165512086e-05, "kl": 0.007227827139196128, "entropy": 0.254441555403173, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.586110001802444, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.46877326965332, "policy_loss": -0.0014092809986323118, "vf_loss": 9.470182538032532, "vf_explained_var": 0.0002400115132331848, "kl": 0.004139207721620397, "entropy": 0.579639545455575, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.797351299226284, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.841204440593719, "policy_loss": -0.0041119282133877276, "vf_loss": 7.845258891582489, "vf_explained_var": -0.00038668662309646604, "kl": 0.009203808977066288, "entropy": 2.8935083746910095, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3737.917411524139, "episode_len_mean": 3034.909090909091, "episode_media": {}, "episodes_timesteps_total": 133536, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 630.8726388092446, "DC1_ls_policy": -929.9245615436757, "DC2_ls_policy": 3769.3927718895266, "DC3_ls_policy": 267.57656236904097}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110228.44774034452, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0792838714938212, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1085122466534105, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57484.78791359067, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0020843354176686e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106196.04293027357, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004871046431750455, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.353796365472012, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103644527.0856265, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.974923304839116, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 466.8593630616155, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.592312873471071, "mean_inference_ms": 2.1314495803525877, "mean_action_processing_ms": 0.3216292023918751, "mean_env_wait_ms": 4.31857562847148, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034394589337435636, "StateBufferConnector_ms": 0.002430108460513028, "ViewRequirementAgentConnector_ms": 0.05269890481775457}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3737.917411524139, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632, "num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 581.3219491717723, "num_env_steps_trained_throughput_per_sec": 581.3219491717723, "timesteps_total": 145408, "num_env_steps_sampled_lifetime": 145408, "num_agent_steps_sampled_lifetime": 581632, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 581632, "timers": {"training_iteration_time_ms": 3462.701, "restore_workers_time_ms": 0.02, "training_step_time_ms": 3462.636, "sample_time_ms": 2214.821, "learn_time_ms": 1221.453, "learn_throughput": 1676.691, "synch_weights_time_ms": 10.643}, "counters": {"num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632}, "done": false, "training_iteration": 71, "trial_id": "45133_00000", "date": "2024-10-21_22-00-28", "timestamp": 1729548028, "time_this_iter_s": 3.5294077396392822, "time_total_s": 249.77805066108704, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c3130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada42e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada64a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7280>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7a90>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 249.77805066108704, "iterations_since_restore": 71, "perf": {"cpu_util_percent": 19.160000000000004, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.486766201257706, "cur_kl_coeff": 2.8421709430404005e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.805567193031312, "policy_loss": -0.0005963950301520526, "vf_loss": 9.806163644790649, "vf_explained_var": 0.0012181460857391357, "kl": 0.0018478340958608896, "entropy": 0.8558128423988819, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.621189770102501, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.470126903057098, "policy_loss": -0.0013717791065573693, "vf_loss": 9.471498668193817, "vf_explained_var": 1.1124461889266967e-05, "kl": 0.007246933545367257, "entropy": 0.1749792587943375, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.675015784800053, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 8.865722000598907, "policy_loss": -0.001007261866470799, "vf_loss": 8.86672922372818, "vf_explained_var": 0.00017794892191886903, "kl": 0.003696786753789638, "entropy": 0.40831015072762966, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.037578520178795, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.115251684188843, "policy_loss": -0.003880392439896241, "vf_loss": 8.11908741593361, "vf_explained_var": 5.9497356414794925e-05, "kl": 0.007153521831867934, "entropy": 2.9290056437253953, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3737.917411524139, "episode_len_mean": 3034.909090909091, "episode_media": {}, "episodes_timesteps_total": 133536, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 630.8726388092446, "DC1_ls_policy": -929.9245615436757, "DC2_ls_policy": 3769.3927718895266, "DC3_ls_policy": 267.57656236904097}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110228.44774034452, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0792838714938212, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1085122466534105, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57484.78791359067, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0020843354176686e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106196.04293027357, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004871046431750455, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.353796365472012, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103644527.0856265, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.974923304839116, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 466.8593630616155, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.592312873471071, "mean_inference_ms": 2.1314495803525877, "mean_action_processing_ms": 0.3216292023918751, "mean_env_wait_ms": 4.31857562847148, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034394589337435636, "StateBufferConnector_ms": 0.002430108460513028, "ViewRequirementAgentConnector_ms": 0.05269890481775457}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3737.917411524139, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824, "num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 625.6688000265711, "num_env_steps_trained_throughput_per_sec": 625.6688000265711, "timesteps_total": 147456, "num_env_steps_sampled_lifetime": 147456, "num_agent_steps_sampled_lifetime": 589824, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 589824, "timers": {"training_iteration_time_ms": 3430.993, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3430.926, "sample_time_ms": 2182.481, "learn_time_ms": 1221.802, "learn_throughput": 1676.213, "synch_weights_time_ms": 10.744}, "counters": {"num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824}, "done": false, "training_iteration": 72, "trial_id": "45133_00000", "date": "2024-10-21_22-00-31", "timestamp": 1729548031, "time_this_iter_s": 3.2796075344085693, "time_total_s": 253.0576581954956, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae73010>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0460>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0700>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada09a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3520>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 253.0576581954956, "iterations_since_restore": 72, "perf": {"cpu_util_percent": 19.02, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.297826947271824, "cur_kl_coeff": 1.4210854715202003e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.812768793106079, "policy_loss": 4.174178466200829e-05, "vf_loss": 9.812726974487305, "vf_explained_var": 0.000434219092130661, "kl": 0.0030389774238769813, "entropy": 0.6736778628081084, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.980491629242897, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.592498219013214, "policy_loss": -0.0031114270270336418, "vf_loss": 9.595609617233276, "vf_explained_var": -5.281418561935425e-05, "kl": 0.007971459358124287, "entropy": 0.10992073067463934, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.9000630840659145, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 8.975188207626342, "policy_loss": -0.0056608343613334, "vf_loss": 8.980849051475525, "vf_explained_var": 0.00023706331849098204, "kl": 0.01192618508985106, "entropy": -0.01823697310173884, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.818081034719944, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.561864739656448, "policy_loss": -0.006313006748678162, "vf_loss": 7.568121486902237, "vf_explained_var": 0.00031748414039611816, "kl": 0.009002394896788866, "entropy": 2.9223166346549987, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3737.917411524139, "episode_len_mean": 3034.909090909091, "episode_media": {}, "episodes_timesteps_total": 133536, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 630.8726388092446, "DC1_ls_policy": -929.9245615436757, "DC2_ls_policy": 3769.3927718895266, "DC3_ls_policy": 267.57656236904097}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110228.44774034452, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0792838714938212, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1085122466534105, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57484.78791359067, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0020843354176686e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106196.04293027357, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004871046431750455, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.353796365472012, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103644527.0856265, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.974923304839116, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 466.8593630616155, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.592312873471071, "mean_inference_ms": 2.1314495803525877, "mean_action_processing_ms": 0.3216292023918751, "mean_env_wait_ms": 4.31857562847148, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034394589337435636, "StateBufferConnector_ms": 0.002430108460513028, "ViewRequirementAgentConnector_ms": 0.05269890481775457}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3737.917411524139, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016, "num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 607.614478339546, "num_env_steps_trained_throughput_per_sec": 607.614478339546, "timesteps_total": 149504, "num_env_steps_sampled_lifetime": 149504, "num_agent_steps_sampled_lifetime": 598016, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 598016, "timers": {"training_iteration_time_ms": 3423.612, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3423.547, "sample_time_ms": 2176.178, "learn_time_ms": 1221.061, "learn_throughput": 1677.23, "synch_weights_time_ms": 10.586}, "counters": {"num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016}, "done": false, "training_iteration": 73, "trial_id": "45133_00000", "date": "2024-10-21_22-00-35", "timestamp": 1729548035, "time_this_iter_s": 3.3781216144561768, "time_total_s": 256.4357798099518, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bef880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0880>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0760>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0670>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada14e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 256.4357798099518, "iterations_since_restore": 73, "perf": {"cpu_util_percent": 6.76, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.745333732664585, "cur_kl_coeff": 7.105427357601001e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.501596212387085, "policy_loss": -9.839549893513322e-05, "vf_loss": 9.501694750785827, "vf_explained_var": 0.00048391744494438174, "kl": 0.002792663093873671, "entropy": 0.8898914732038975, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.177528333663941, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.609582149982453, "policy_loss": -0.0017079190351068974, "vf_loss": 9.61129002571106, "vf_explained_var": 2.5462359189987183e-05, "kl": 0.006377345323563951, "entropy": 0.1068184713833034, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.903055933117867, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.679709911346436, "policy_loss": -0.00010791722452268005, "vf_loss": 9.679817724227906, "vf_explained_var": 0.0001304604113101959, "kl": 0.003992312198897707, "entropy": 0.3423417339101434, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.78539909273386, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.6820423066616055, "policy_loss": -0.003488007403211668, "vf_loss": 7.68547819852829, "vf_explained_var": -0.0004234388470649719, "kl": 0.008342379170426933, "entropy": 2.9265340864658356, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3737.917411524139, "episode_len_mean": 3034.909090909091, "episode_media": {}, "episodes_timesteps_total": 133536, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 1808.8192260542407}, "policy_reward_mean": {"high_level_policy": 630.8726388092446, "DC1_ls_policy": -929.9245615436757, "DC2_ls_policy": 3769.3927718895266, "DC3_ls_policy": 267.57656236904097}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110228.44774034452, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0792838714938212, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.1085122466534105, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57484.78791359067, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0020843354176686e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.000248015873015873, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106196.04293027357, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79653.36666496264, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004871046431750455, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.353796365472012, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103644527.0856265, "accumulated/bat_CO2_footprint_sum_min": 73447409.18210293, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.974923304839116, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 466.8593630616155, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.592312873471071, "mean_inference_ms": 2.1314495803525877, "mean_action_processing_ms": 0.3216292023918751, "mean_env_wait_ms": 4.31857562847148, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034394589337435636, "StateBufferConnector_ms": 0.002430108460513028, "ViewRequirementAgentConnector_ms": 0.05269890481775457}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3737.917411524139, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208, "num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 616.5102406791052, "num_env_steps_trained_throughput_per_sec": 616.5102406791052, "timesteps_total": 151552, "num_env_steps_sampled_lifetime": 151552, "num_agent_steps_sampled_lifetime": 606208, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 606208, "timers": {"training_iteration_time_ms": 3410.457, "restore_workers_time_ms": 0.02, "training_step_time_ms": 3410.395, "sample_time_ms": 2163.953, "learn_time_ms": 1220.09, "learn_throughput": 1678.564, "synch_weights_time_ms": 10.57}, "counters": {"num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208}, "done": false, "training_iteration": 74, "trial_id": "45133_00000", "date": "2024-10-21_22-00-38", "timestamp": 1729548038, "time_this_iter_s": 3.3286495208740234, "time_total_s": 259.7644293308258, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c3c70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7af0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6bc0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada67d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6590>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 259.7644293308258, "iterations_since_restore": 74, "perf": {"cpu_util_percent": 6.36, "ram_util_percent": 3.9}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.397536887973547, "cur_kl_coeff": 3.5527136788005006e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.867474675178528, "policy_loss": -0.0035766478220466526, "vf_loss": 9.871051394939423, "vf_explained_var": 0.0008450850844383239, "kl": 0.006256070618111216, "entropy": 0.9351363696157933, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4622141808271407, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.725277030467987, "policy_loss": -0.0008783704251982272, "vf_loss": 9.726155471801757, "vf_explained_var": 2.1379441022872925e-05, "kl": 0.00507538461752261, "entropy": 0.07418994891922921, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.958024629950524, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.738760769367218, "policy_loss": -0.008719245385145768, "vf_loss": 9.74748009443283, "vf_explained_var": 6.863921880722046e-05, "kl": 0.008885200988333963, "entropy": 0.06947587293107063, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.353926174342632, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.322943288087845, "policy_loss": -0.006020381103735417, "vf_loss": 7.328882086277008, "vf_explained_var": 0.00012710392475128173, "kl": 0.013071785223474425, "entropy": 2.7901702493429186, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3866.5457378832875, "episode_len_mean": 3007.304347826087, "episode_media": {}, "episodes_timesteps_total": 138336, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 2342.607934412276}, "policy_reward_mean": {"high_level_policy": 676.1524865398986, "DC1_ls_policy": -868.9814783321311, "DC2_ls_policy": 3712.023979207082, "DC3_ls_policy": 347.350750468435}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110181.16371255476, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.07583674664626376, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.0603160620163057, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57913.23065751661, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 2.7701096541676256e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0008333333333333334, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 104782.31672441249, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004659261804283043, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.33842297277033034, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 102418247.6882855, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.062970117672197, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 446.5774274393714, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5925315324520092, "mean_inference_ms": 2.1312310778331947, "mean_action_processing_ms": 0.32159675059867343, "mean_env_wait_ms": 4.318509164737383, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003493220909782078, "StateBufferConnector_ms": 0.0024322582327801247, "ViewRequirementAgentConnector_ms": 0.052748426147129227}, "num_episodes": 2, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3866.5457378832875, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400, "num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 600.0997047752442, "num_env_steps_trained_throughput_per_sec": 600.0997047752442, "timesteps_total": 153600, "num_env_steps_sampled_lifetime": 153600, "num_agent_steps_sampled_lifetime": 614400, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 614400, "timers": {"training_iteration_time_ms": 3424.915, "restore_workers_time_ms": 0.02, "training_step_time_ms": 3424.852, "sample_time_ms": 2176.985, "learn_time_ms": 1220.19, "learn_throughput": 1678.427, "synch_weights_time_ms": 10.798}, "counters": {"num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400}, "done": false, "training_iteration": 75, "trial_id": "45133_00000", "date": "2024-10-21_22-00-41", "timestamp": 1729548041, "time_this_iter_s": 3.419119358062744, "time_total_s": 263.18354868888855, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae73010>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4b50>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7670>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5d80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada77f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 263.18354868888855, "iterations_since_restore": 75, "perf": {"cpu_util_percent": 18.660000000000004, "ram_util_percent": 3.9799999999999995}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.875706632435322, "cur_kl_coeff": 3.5527136788005006e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.716927194595337, "policy_loss": -0.001194966709590517, "vf_loss": 9.71812230348587, "vf_explained_var": 0.0012475624680519104, "kl": 0.0050523527461336926, "entropy": 0.8388234198093414, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.681580673158169, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.606290185451508, "policy_loss": -0.00027797765214927496, "vf_loss": 9.60656816959381, "vf_explained_var": -3.933161497116089e-06, "kl": 0.006753957397927479, "entropy": 0.0011238950828555971, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.763611309230328, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.661970615386963, "policy_loss": 0.0007706390460953116, "vf_loss": 9.661199927330017, "vf_explained_var": 3.954172134399414e-05, "kl": 0.012811018862251545, "entropy": -0.37771251872181894, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.763789537549019, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.221287357807159, "policy_loss": -0.002183365751989186, "vf_loss": 7.223432260751724, "vf_explained_var": -0.0002461552619934082, "kl": 0.006163268346426776, "entropy": 2.805372327566147, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3866.5457378832875, "episode_len_mean": 3007.304347826087, "episode_media": {}, "episodes_timesteps_total": 138336, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 2342.607934412276}, "policy_reward_mean": {"high_level_policy": 676.1524865398986, "DC1_ls_policy": -868.9814783321311, "DC2_ls_policy": 3712.023979207082, "DC3_ls_policy": 347.350750468435}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110181.16371255476, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.07583674664626376, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.0603160620163057, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 57913.23065751661, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 2.7701096541676256e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0008333333333333334, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 104782.31672441249, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004659261804283043, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.33842297277033034, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 102418247.6882855, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.062970117672197, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 446.5774274393714, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5925315324520092, "mean_inference_ms": 2.1312310778331947, "mean_action_processing_ms": 0.32159675059867343, "mean_env_wait_ms": 4.318509164737383, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003493220909782078, "StateBufferConnector_ms": 0.0024322582327801247, "ViewRequirementAgentConnector_ms": 0.052748426147129227}, "num_episodes": 0, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3866.5457378832875, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592, "num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 600.6468849788818, "num_env_steps_trained_throughput_per_sec": 600.6468849788818, "timesteps_total": 155648, "num_env_steps_sampled_lifetime": 155648, "num_agent_steps_sampled_lifetime": 622592, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 622592, "timers": {"training_iteration_time_ms": 3416.881, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3416.813, "sample_time_ms": 2170.232, "learn_time_ms": 1218.646, "learn_throughput": 1680.553, "synch_weights_time_ms": 10.788}, "counters": {"num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592}, "done": false, "training_iteration": 76, "trial_id": "45133_00000", "date": "2024-10-21_22-00-45", "timestamp": 1729548045, "time_this_iter_s": 3.4155988693237305, "time_total_s": 266.5991475582123, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c25f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4f70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada62f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4e50>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7550>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 266.5991475582123, "iterations_since_restore": 76, "perf": {"cpu_util_percent": 18.9, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.855816623568535, "cur_kl_coeff": 3.5527136788005006e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.75698118209839, "policy_loss": -0.0012401730171404779, "vf_loss": 9.758221375942231, "vf_explained_var": 0.00021898820996284484, "kl": 0.004059123784306859, "entropy": 0.9637681499123574, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.432736712694168, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.50930359363556, "policy_loss": -0.0031844693352468313, "vf_loss": 9.512487983703613, "vf_explained_var": 1.6145408153533935e-06, "kl": 0.005546283640796901, "entropy": -0.03213688385440037, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.7097621947526935, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.311016821861267, "policy_loss": -0.005299994326196611, "vf_loss": 9.316316890716553, "vf_explained_var": 9.78417694568634e-05, "kl": 0.012242589174809382, "entropy": 0.14203461683355273, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9888866096735, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.590098398923874, "policy_loss": -0.0036272016499424354, "vf_loss": 7.593681514263153, "vf_explained_var": -0.00014702677726745604, "kl": 0.00704328237034133, "entropy": 2.763914147019386, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 3942.6043854963746, "episode_len_mean": 3002.553191489362, "episode_media": {}, "episodes_timesteps_total": 141120, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 2039.6085583628937, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 2488.4261305146074}, "policy_reward_mean": {"high_level_policy": 694.604076027261, "DC1_ls_policy": -837.4405602335238, "DC2_ls_policy": 3692.535323914068, "DC3_ls_policy": 392.9055457885663}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 110131.0172469343, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.07422319884527942, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.0377561458031928, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 58217.138762109855, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 2.7111711508874633e-05, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0008333333333333334, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 104196.7378371108, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004560128574404681, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.3312224839879829, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 102172302.32060367, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 19.636098413040877, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 437.0757800470443, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5926609785220787, "mean_inference_ms": 2.131093776921908, "mean_action_processing_ms": 0.32156983297014374, "mean_env_wait_ms": 4.318816445191047, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003478248068626891, "StateBufferConnector_ms": 0.0024341522379124417, "ViewRequirementAgentConnector_ms": 0.05281022254456865}, "num_episodes": 1, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 3942.6043854963746, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784, "num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 571.8609764091237, "num_env_steps_trained_throughput_per_sec": 571.8609764091237, "timesteps_total": 157696, "num_env_steps_sampled_lifetime": 157696, "num_agent_steps_sampled_lifetime": 630784, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 630784, "timers": {"training_iteration_time_ms": 3431.695, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3431.623, "sample_time_ms": 2184.237, "learn_time_ms": 1217.784, "learn_throughput": 1681.743, "synch_weights_time_ms": 10.828}, "counters": {"num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784}, "done": false, "training_iteration": 77, "trial_id": "45133_00000", "date": "2024-10-21_22-00-49", "timestamp": 1729548049, "time_this_iter_s": 3.5894007682800293, "time_total_s": 270.1885483264923, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c3e20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada63e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6500>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7130>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada75e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 270.1885483264923, "iterations_since_restore": 77, "perf": {"cpu_util_percent": 18.62, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.008536295592785, "cur_kl_coeff": 1.7763568394002503e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.783944940567016, "policy_loss": -0.0009402535215485841, "vf_loss": 9.784885144233703, "vf_explained_var": 0.00010847896337509155, "kl": 0.006297652397439557, "entropy": 0.5227272193878889, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.381290017068386, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.387588679790497, "policy_loss": -0.003008133708499372, "vf_loss": 9.390596723556518, "vf_explained_var": 1.697242259979248e-05, "kl": 0.0045660678833314705, "entropy": 0.04629723395919427, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.224712389707565, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.859671700000764, "policy_loss": 0.0009559823549352587, "vf_loss": 9.858715617656708, "vf_explained_var": 0.0001199290156364441, "kl": 0.0052063235051718944, "entropy": -0.3472084845416248, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.558950553834438, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 6.52030023932457, "policy_loss": -0.010699486103840172, "vf_loss": 6.5309005916118625, "vf_explained_var": 9.190291166305542e-05, "kl": 0.015854993595121415, "entropy": 2.643661293387413, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976}, "env_runners": {"episode_reward_max": 11607.412452026525, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4014.7909591595417, "episode_len_mean": 2992.0, "episode_media": {}, "episodes_timesteps_total": 143616, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 1310.6675224243206, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 2556.5101616414827, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 2488.4261305146074}, "policy_reward_mean": {"high_level_policy": 732.9265242517813, "DC1_ls_policy": -794.5224417938839, "DC2_ls_policy": 3642.913078049698, "DC3_ls_policy": 433.47379865194324}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 109823.57339008483, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.07267688220266943, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.0161529194750278, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 58463.37704553754, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.020859880217519108, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103459.86536415659, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.00446512589577125, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.32432201557156654, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101586565.87937273, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 19.227013029435856, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 428.6060856443548, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5926148106052261, "mean_inference_ms": 2.1310605900311903, "mean_action_processing_ms": 0.32164375023076897, "mean_env_wait_ms": 4.318584275780723, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003458559513092041, "StateBufferConnector_ms": 0.002432366212209066, "ViewRequirementAgentConnector_ms": 0.052750855684280396}, "num_episodes": 1, "episode_return_max": 11607.412452026525, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4014.7909591595417, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976, "num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 607.6795140337896, "num_env_steps_trained_throughput_per_sec": 607.6795140337896, "timesteps_total": 159744, "num_env_steps_sampled_lifetime": 159744, "num_agent_steps_sampled_lifetime": 638976, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 638976, "timers": {"training_iteration_time_ms": 3424.708, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3424.637, "sample_time_ms": 2178.561, "learn_time_ms": 1216.446, "learn_throughput": 1683.593, "synch_weights_time_ms": 10.866}, "counters": {"num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976}, "done": false, "training_iteration": 78, "trial_id": "45133_00000", "date": "2024-10-21_22-00-52", "timestamp": 1729548052, "time_this_iter_s": 3.37796688079834, "time_total_s": 273.56651520729065, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a999c60>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7d30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5d20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5180>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada61a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 273.56651520729065, "iterations_since_restore": 78, "perf": {"cpu_util_percent": 18.98, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.107687474787235, "cur_kl_coeff": 1.7763568394002503e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.457689321041107, "policy_loss": 0.0008781489916145802, "vf_loss": 9.456811177730561, "vf_explained_var": 0.0008872225880622864, "kl": 0.0025448499822702565, "entropy": 0.9080391108989716, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.264075514674187, "cur_kl_coeff": 2.220446049250313e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.231706941127777, "policy_loss": -0.002011970238527283, "vf_loss": 9.233718860149384, "vf_explained_var": 2.530217170715332e-06, "kl": 0.006586658517244359, "entropy": -0.09114567749202251, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.375589405000209, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.41898763179779, "policy_loss": -0.00026309387758374216, "vf_loss": 9.419250774383546, "vf_explained_var": 0.00013415515422821045, "kl": 0.010344558541012978, "entropy": -0.43084540255367754, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.585697987675667, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.025643730163575, "policy_loss": -0.004880667704856023, "vf_loss": 8.030469697713851, "vf_explained_var": -0.0002087727189064026, "kl": 0.008751717495806588, "entropy": 2.606186866760254, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168}, "env_runners": {"episode_reward_max": 12086.651605070909, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4291.709925599979, "episode_len_mean": 3020.16, "episode_media": {}, "episodes_timesteps_total": 151008, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 1310.6675224243206, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 3389.023720116725, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 3148.0800202115247}, "policy_reward_mean": {"high_level_policy": 826.7392246358223, "DC1_ls_policy": -703.5526309809776, "DC2_ls_policy": 3626.9761609270554, "DC3_ls_policy": 541.5471710180748}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 109266.1581079461, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06976980691456265, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.9755068026960267, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 58899.249373023056, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.031169334215167554, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 102447.35390675328, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0042865208599404, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.31134913494870387, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 102054373.77866113, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.457932508258423, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 412.84555576024724, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5926951663720528, "mean_inference_ms": 2.1310712937083873, "mean_action_processing_ms": 0.3216773827573807, "mean_env_wait_ms": 4.319726432455759, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003427743911743164, "StateBufferConnector_ms": 0.0024309158325195312, "ViewRequirementAgentConnector_ms": 0.052777767181396484}, "num_episodes": 2, "episode_return_max": 12086.651605070909, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4291.709925599979, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168, "num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 574.7047685671698, "num_env_steps_trained_throughput_per_sec": 574.7047685671698, "timesteps_total": 161792, "num_env_steps_sampled_lifetime": 161792, "num_agent_steps_sampled_lifetime": 647168, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 647168, "timers": {"training_iteration_time_ms": 3437.975, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3437.904, "sample_time_ms": 2193.71, "learn_time_ms": 1214.506, "learn_throughput": 1686.282, "synch_weights_time_ms": 10.898}, "counters": {"num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168}, "done": false, "training_iteration": 79, "trial_id": "45133_00000", "date": "2024-10-21_22-00-56", "timestamp": 1729548056, "time_this_iter_s": 3.572885513305664, "time_total_s": 277.1394007205963, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99bd90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5de0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6380>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4b20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada43d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 277.1394007205963, "iterations_since_restore": 79, "perf": {"cpu_util_percent": 19.939999999999998, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.619697900861502, "cur_kl_coeff": 8.881784197001252e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.384308218955994, "policy_loss": -0.0013539229286834598, "vf_loss": 9.385662233829498, "vf_explained_var": 0.0012108340859413147, "kl": 0.002442613288803841, "entropy": 1.353685013204813, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4536361694335938, "cur_kl_coeff": 2.220446049250313e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.649201834201813, "policy_loss": -0.0004652863368391991, "vf_loss": 9.649667072296143, "vf_explained_var": 2.659112215042114e-06, "kl": 0.0047334968452219075, "entropy": -0.05684435671428219, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.54262634217739, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.41661740541458, "policy_loss": -0.001093319256324321, "vf_loss": 9.41771067380905, "vf_explained_var": 3.850460052490234e-06, "kl": 0.006106701854150742, "entropy": -0.23151148268952965, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9236612185835837, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.476222908496856, "policy_loss": -0.005061775527428836, "vf_loss": 8.481207019090652, "vf_explained_var": 2.574324607849121e-05, "kl": 0.01242133979208222, "entropy": 2.6270817875862122, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360}, "env_runners": {"episode_reward_max": 12086.651605070909, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4291.709925599979, "episode_len_mean": 3020.16, "episode_media": {}, "episodes_timesteps_total": 151008, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 1310.6675224243206, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 3389.023720116725, "DC1_ls_policy": 1901.99833154321, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 3148.0800202115247}, "policy_reward_mean": {"high_level_policy": 826.7392246358223, "DC1_ls_policy": -703.5526309809776, "DC2_ls_policy": 3626.9761609270554, "DC3_ls_policy": 541.5471710180748}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 109266.1581079461, "DC1_ls_policy/bat_CO2_footprint_sum_min": 90517.02709474042, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06976980691456265, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.9755068026960267, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 58899.249373023056, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.031169334215167554, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 102447.35390675328, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0042865208599404, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.31134913494870387, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 102054373.77866113, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.457932508258423, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 412.84555576024724, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5926951663720528, "mean_inference_ms": 2.1310712937083873, "mean_action_processing_ms": 0.3216773827573807, "mean_env_wait_ms": 4.319726432455759, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003427743911743164, "StateBufferConnector_ms": 0.0024309158325195312, "ViewRequirementAgentConnector_ms": 0.052777767181396484}, "num_episodes": 0, "episode_return_max": 12086.651605070909, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4291.709925599979, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360, "num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 600.7817350330946, "num_env_steps_trained_throughput_per_sec": 600.7817350330946, "timesteps_total": 163840, "num_env_steps_sampled_lifetime": 163840, "num_agent_steps_sampled_lifetime": 655360, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 655360, "timers": {"training_iteration_time_ms": 3423.53, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3423.461, "sample_time_ms": 2183.372, "learn_time_ms": 1211.478, "learn_throughput": 1690.498, "synch_weights_time_ms": 10.632}, "counters": {"num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360}, "done": false, "training_iteration": 80, "trial_id": "45133_00000", "date": "2024-10-21_22-00-59", "timestamp": 1729548059, "time_this_iter_s": 3.4167537689208984, "time_total_s": 280.5561544895172, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c1ab0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5d50>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6ec0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5b40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6200>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 280.5561544895172, "iterations_since_restore": 80, "perf": {"cpu_util_percent": 19.14, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.9198959179222586, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.775400674343109, "policy_loss": -0.0010491657885722816, "vf_loss": 9.776449751853942, "vf_explained_var": 0.00016910359263420106, "kl": 0.003898124167064451, "entropy": 0.5024988856166601, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.195704598724842, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.47550152540207, "policy_loss": -0.000365357002010569, "vf_loss": 9.475866854190826, "vf_explained_var": -7.316470146179199e-07, "kl": 0.0029144490569268924, "entropy": 0.01105610178783536, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.173691545426845, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.508932244777679, "policy_loss": 0.0011279754806309938, "vf_loss": 9.507804274559021, "vf_explained_var": 4.9085170030593875e-05, "kl": 0.008445868065132344, "entropy": -0.39819191973656415, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.9075322791934015, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.339798527956009, "policy_loss": -0.0008230436622397974, "vf_loss": 7.340571498870849, "vf_explained_var": -9.980201721191407e-05, "kl": 0.008006522864162249, "entropy": 2.5441187739372255, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4674.570543283352, "episode_len_mean": 3070.153846153846, "episode_media": {}, "episodes_timesteps_total": 159648, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 1310.6675224243206, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 956.1507383590296, "DC1_ls_policy": -596.3226117807551, "DC2_ls_policy": 3637.1359642336984, "DC3_ls_policy": 677.606452471374}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 108611.34178930131, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0670863528024641, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.9379873102846411, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59280.47939872091, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03723398707773708, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 101324.43116467042, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0041216546730196155, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2993741682199076, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103069107.5489631, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 17.748012027171562, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 398.3264716251784, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5927481394646329, "mean_inference_ms": 2.131381796549428, "mean_action_processing_ms": 0.3217165539282725, "mean_env_wait_ms": 4.319916566416813, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034060615759629468, "StateBufferConnector_ms": 0.002433474247272198, "ViewRequirementAgentConnector_ms": 0.052758248952718884}, "num_episodes": 2, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4674.570543283352, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552, "num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 583.8440484258487, "num_env_steps_trained_throughput_per_sec": 583.8440484258487, "timesteps_total": 165888, "num_env_steps_sampled_lifetime": 165888, "num_agent_steps_sampled_lifetime": 663552, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 663552, "timers": {"training_iteration_time_ms": 3422.006, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3421.942, "sample_time_ms": 2197.278, "learn_time_ms": 1195.857, "learn_throughput": 1712.58, "synch_weights_time_ms": 10.747}, "counters": {"num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552}, "done": false, "training_iteration": 81, "trial_id": "45133_00000", "date": "2024-10-21_22-01-03", "timestamp": 1729548063, "time_this_iter_s": 3.5157504081726074, "time_total_s": 284.0719048976898, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99bd90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7ac0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada70a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7700>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada74c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 284.0719048976898, "iterations_since_restore": 81, "perf": {"cpu_util_percent": 7.220000000000001, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.3961026579141618, "cur_kl_coeff": 2.220446049250313e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.883064711093903, "policy_loss": -0.0032492320984601974, "vf_loss": 9.886313891410827, "vf_explained_var": -4.917159676551819e-05, "kl": 0.0061788336647509825, "entropy": 0.42833936829119923, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.242382116615772, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 8.96075792312622, "policy_loss": -0.0021886341273784637, "vf_loss": 8.962946665287017, "vf_explained_var": 8.596479892730713e-06, "kl": 0.0018552380884102604, "entropy": 0.018338793842121958, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.721150967478752, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.563467109203339, "policy_loss": -0.0028173756087198853, "vf_loss": 9.566284430027007, "vf_explained_var": 0.0001085631549358368, "kl": 0.008055896662976306, "entropy": -0.3636371781118214, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.301328244805336, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.481306588649749, "policy_loss": -0.004677182156592607, "vf_loss": 7.485929244756699, "vf_explained_var": 1.2224912643432617e-05, "kl": 0.008723609841217695, "entropy": 2.5446620315313337, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4674.570543283352, "episode_len_mean": 3070.153846153846, "episode_media": {}, "episodes_timesteps_total": 159648, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 1310.6675224243206, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 956.1507383590296, "DC1_ls_policy": -596.3226117807551, "DC2_ls_policy": 3637.1359642336984, "DC3_ls_policy": 677.606452471374}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 108611.34178930131, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0670863528024641, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.9379873102846411, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59280.47939872091, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03723398707773708, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 101324.43116467042, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0041216546730196155, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2993741682199076, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103069107.5489631, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 17.748012027171562, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 398.3264716251784, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5927481394646329, "mean_inference_ms": 2.131381796549428, "mean_action_processing_ms": 0.3217165539282725, "mean_env_wait_ms": 4.319916566416813, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034060615759629468, "StateBufferConnector_ms": 0.002433474247272198, "ViewRequirementAgentConnector_ms": 0.052758248952718884}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4674.570543283352, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744, "num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 602.0356242400031, "num_env_steps_trained_throughput_per_sec": 602.0356242400031, "timesteps_total": 167936, "num_env_steps_sampled_lifetime": 167936, "num_agent_steps_sampled_lifetime": 671744, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 671744, "timers": {"training_iteration_time_ms": 3434.856, "restore_workers_time_ms": 0.02, "training_step_time_ms": 3434.791, "sample_time_ms": 2204.247, "learn_time_ms": 1200.218, "learn_throughput": 1706.356, "synch_weights_time_ms": 11.108}, "counters": {"num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744}, "done": false, "training_iteration": 82, "trial_id": "45133_00000", "date": "2024-10-21_22-01-07", "timestamp": 1729548067, "time_this_iter_s": 3.4099373817443848, "time_total_s": 287.4818422794342, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae17be0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeac130>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeac940>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeafbb0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1aeafa30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 287.4818422794342, "iterations_since_restore": 82, "perf": {"cpu_util_percent": 6.42, "ram_util_percent": 3.94}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5479923650622367, "cur_kl_coeff": 2.220446049250313e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.813037061691285, "policy_loss": 0.0007486352464184165, "vf_loss": 9.81228847503662, "vf_explained_var": 0.0003444865345954895, "kl": 0.003669048622124834, "entropy": 0.3603047883138061, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5670334175229073, "cur_kl_coeff": 2.775557561562891e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.418869614601135, "policy_loss": -0.001219776610378176, "vf_loss": 9.420089399814605, "vf_explained_var": 1.370161771774292e-06, "kl": 0.002987776646570379, "entropy": 0.0207458027289249, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.440567755699158, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.185694670677185, "policy_loss": -0.00023173494264483452, "vf_loss": 9.185926365852357, "vf_explained_var": 0.00015609040856361388, "kl": 0.007126643795348791, "entropy": -0.010262413183227181, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.088420687615871, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.038034051656723, "policy_loss": -0.002685554570052773, "vf_loss": 8.040665608644485, "vf_explained_var": 0.00020023882389068602, "kl": 0.00861636043555336, "entropy": 2.513910946249962, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4674.570543283352, "episode_len_mean": 3070.153846153846, "episode_media": {}, "episodes_timesteps_total": 159648, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 1310.6675224243206, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 956.1507383590296, "DC1_ls_policy": -596.3226117807551, "DC2_ls_policy": 3637.1359642336984, "DC3_ls_policy": 677.606452471374}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 108611.34178930131, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0670863528024641, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.9379873102846411, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59280.47939872091, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03723398707773708, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 101324.43116467042, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0041216546730196155, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2993741682199076, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103069107.5489631, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 17.748012027171562, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 398.3264716251784, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5927481394646329, "mean_inference_ms": 2.131381796549428, "mean_action_processing_ms": 0.3217165539282725, "mean_env_wait_ms": 4.319916566416813, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034060615759629468, "StateBufferConnector_ms": 0.002433474247272198, "ViewRequirementAgentConnector_ms": 0.052758248952718884}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4674.570543283352, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936, "num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 544.0884493133095, "num_env_steps_trained_throughput_per_sec": 544.0884493133095, "timesteps_total": 169984, "num_env_steps_sampled_lifetime": 169984, "num_agent_steps_sampled_lifetime": 679936, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 679936, "timers": {"training_iteration_time_ms": 3474.21, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3474.144, "sample_time_ms": 2242.024, "learn_time_ms": 1201.813, "learn_throughput": 1704.092, "synch_weights_time_ms": 11.067}, "counters": {"num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936}, "done": false, "training_iteration": 83, "trial_id": "45133_00000", "date": "2024-10-21_22-01-10", "timestamp": 1729548070, "time_this_iter_s": 3.7706809043884277, "time_total_s": 291.25252318382263, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c0d30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b700>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61bfd0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a440>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a9e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 291.25252318382263, "iterations_since_restore": 83, "perf": {"cpu_util_percent": 18.816666666666666, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.347739611566067, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.859941279888153, "policy_loss": -0.0005376958521082998, "vf_loss": 9.860478901863098, "vf_explained_var": 0.00040020719170570375, "kl": 0.008776167138285019, "entropy": 0.389170840382576, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.200101669132709, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.272802925109863, "policy_loss": -0.0038101576501503587, "vf_loss": 9.276613068580627, "vf_explained_var": -5.081295967102051e-06, "kl": 0.009299898429209516, "entropy": -0.00429177179466933, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.395109033584594, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.372598218917847, "policy_loss": 0.002550402039196342, "vf_loss": 9.370047724246978, "vf_explained_var": 0.00022750124335289002, "kl": 0.008805751553975555, "entropy": -0.0022419572342187166, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.468444018065929, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.190318667888642, "policy_loss": -0.003059078787919134, "vf_loss": 7.193329399824142, "vf_explained_var": -0.0002996206283569336, "kl": 0.007724997622609575, "entropy": 2.5185446053743363, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4674.570543283352, "episode_len_mean": 3070.153846153846, "episode_media": {}, "episodes_timesteps_total": 159648, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": 1310.6675224243206, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 956.1507383590296, "DC1_ls_policy": -596.3226117807551, "DC2_ls_policy": 3637.1359642336984, "DC3_ls_policy": 677.606452471374}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 108611.34178930131, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0670863528024641, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.9379873102846411, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 59280.47939872091, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 75419.4985562842, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03723398707773708, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.0, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 101324.43116467042, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0041216546730196155, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2993741682199076, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 103069107.5489631, "accumulated/bat_CO2_footprint_sum_min": 72348219.81907004, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 17.748012027171562, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 398.3264716251784, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5927481394646329, "mean_inference_ms": 2.131381796549428, "mean_action_processing_ms": 0.3217165539282725, "mean_env_wait_ms": 4.319916566416813, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034060615759629468, "StateBufferConnector_ms": 0.002433474247272198, "ViewRequirementAgentConnector_ms": 0.052758248952718884}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4674.570543283352, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128, "num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 582.0453032550267, "num_env_steps_trained_throughput_per_sec": 582.0453032550267, "timesteps_total": 172032, "num_env_steps_sampled_lifetime": 172032, "num_agent_steps_sampled_lifetime": 688128, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 688128, "timers": {"training_iteration_time_ms": 3493.881, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3493.814, "sample_time_ms": 2259.907, "learn_time_ms": 1203.641, "learn_throughput": 1701.504, "synch_weights_time_ms": 11.041}, "counters": {"num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128}, "done": false, "training_iteration": 84, "trial_id": "45133_00000", "date": "2024-10-21_22-01-14", "timestamp": 1729548074, "time_this_iter_s": 3.527709484100342, "time_total_s": 294.780232667923, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c3400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61bdf0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61bc10>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a950>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a6196f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 294.780232667923, "iterations_since_restore": 84, "perf": {"cpu_util_percent": 18.919999999999998, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.601924441754818, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.86446225643158, "policy_loss": 0.0003071807557716966, "vf_loss": 9.864154994487762, "vf_explained_var": 4.4455379247665404e-05, "kl": 0.01356028817317565, "entropy": 0.18050663840258493, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.7093031913042065, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 8.207748103141785, "policy_loss": -0.0022633308777585625, "vf_loss": 8.210011470317841, "vf_explained_var": -3.462284803390503e-06, "kl": 0.006714439317647702, "entropy": -0.08981413913425058, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.314247381687164, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.352944600582124, "policy_loss": -0.0018040858092717826, "vf_loss": 9.35474865436554, "vf_explained_var": 0.00030802339315414427, "kl": 0.01989989719431833, "entropy": -0.2272282403893769, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.127554121613502, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.7239022016525265, "policy_loss": -0.004956352600129321, "vf_loss": 7.7287957787513735, "vf_explained_var": 5.133971571922302e-05, "kl": 0.010059646512548684, "entropy": 2.4887223690748215, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4663.671225581846, "episode_len_mean": 3045.3333333333335, "episode_media": {}, "episodes_timesteps_total": 164448, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -2213.1862638954735, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 999.4578043271908, "DC1_ls_policy": -517.5493114442477, "DC2_ls_policy": 3445.786863996295, "DC3_ls_policy": 735.9758687026034}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 107866.3481439008, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0646016730690395, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.9032470395333582, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60033.815882498, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 80304.93335398115, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0029320987654320985, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.09875, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.172984580148932, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.406666666666666, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 100260.67040003717, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0039690007962411115, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.28830938421176283, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101908812.86542399, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.230853788510885, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 423.45091364831984, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5929366024989351, "mean_inference_ms": 2.1311399248165968, "mean_action_processing_ms": 0.3216820052631339, "mean_env_wait_ms": 4.320679752833457, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034448173311021593, "StateBufferConnector_ms": 0.0024287788956253616, "ViewRequirementAgentConnector_ms": 0.052658385700649686}, "num_episodes": 2, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4663.671225581846, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320, "num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 580.1197062829536, "num_env_steps_trained_throughput_per_sec": 580.1197062829536, "timesteps_total": 174080, "num_env_steps_sampled_lifetime": 174080, "num_agent_steps_sampled_lifetime": 696320, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 696320, "timers": {"training_iteration_time_ms": 3505.635, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3505.568, "sample_time_ms": 2268.395, "learn_time_ms": 1207.989, "learn_throughput": 1695.38, "synch_weights_time_ms": 10.838}, "counters": {"num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320}, "done": false, "training_iteration": 85, "trial_id": "45133_00000", "date": "2024-10-21_22-01-18", "timestamp": 1729548078, "time_this_iter_s": 3.538421630859375, "time_total_s": 298.31865429878235, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae73130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0c40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2800>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2b90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3340>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 298.31865429878235, "iterations_since_restore": 85, "perf": {"cpu_util_percent": 19.28, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.5676044672727585, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.815813434123992, "policy_loss": 0.0036737023561727255, "vf_loss": 9.812139689922333, "vf_explained_var": 4.132464528083801e-05, "kl": 0.012970562969803723, "entropy": 0.0852801778819412, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.54949917793274, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.378174662590027, "policy_loss": -0.005591355572687462, "vf_loss": 9.383766055107117, "vf_explained_var": 9.350478649139404e-07, "kl": 0.012267850900615197, "entropy": -0.02582182834739797, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.617715045809746, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.442213380336762, "policy_loss": 0.0010443769569974393, "vf_loss": 9.441168868541718, "vf_explained_var": 2.3972243070602417e-05, "kl": 0.007767403986508725, "entropy": -0.5334685057401657, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.296474914252758, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.857159274816513, "policy_loss": -0.008132197603117675, "vf_loss": 7.865207451581955, "vf_explained_var": -9.543523192405701e-05, "kl": 0.0134436082926423, "entropy": 2.4624807357788088, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4663.671225581846, "episode_len_mean": 3045.3333333333335, "episode_media": {}, "episodes_timesteps_total": 164448, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -2213.1862638954735, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 999.4578043271908, "DC1_ls_policy": -517.5493114442477, "DC2_ls_policy": 3445.786863996295, "DC3_ls_policy": 735.9758687026034}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 107866.3481439008, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0646016730690395, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.9032470395333582, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60033.815882498, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 80304.93335398115, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0029320987654320985, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.09875, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.172984580148932, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.406666666666666, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 100260.67040003717, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0039690007962411115, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.28830938421176283, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101908812.86542399, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.230853788510885, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 423.45091364831984, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5929366024989351, "mean_inference_ms": 2.1311399248165968, "mean_action_processing_ms": 0.3216820052631339, "mean_env_wait_ms": 4.320679752833457, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034448173311021593, "StateBufferConnector_ms": 0.0024287788956253616, "ViewRequirementAgentConnector_ms": 0.052658385700649686}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4663.671225581846, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512, "num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 578.6064458730766, "num_env_steps_trained_throughput_per_sec": 578.6064458730766, "timesteps_total": 176128, "num_env_steps_sampled_lifetime": 176128, "num_agent_steps_sampled_lifetime": 704512, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 704512, "timers": {"training_iteration_time_ms": 3518.623, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3518.558, "sample_time_ms": 2279.946, "learn_time_ms": 1210.005, "learn_throughput": 1692.555, "synch_weights_time_ms": 10.746}, "counters": {"num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512}, "done": false, "training_iteration": 86, "trial_id": "45133_00000", "date": "2024-10-21_22-01-21", "timestamp": 1729548081, "time_this_iter_s": 3.547952175140381, "time_total_s": 301.86660647392273, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae72e60>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3430>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada30a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada08e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0550>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 301.86660647392273, "iterations_since_restore": 86, "perf": {"cpu_util_percent": 19.160000000000004, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.443669880926609, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.796980023384094, "policy_loss": -0.0013048353837803006, "vf_loss": 9.798284947872162, "vf_explained_var": 0.00024769529700279235, "kl": 0.0056536332573177165, "entropy": 0.44141055140644314, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.7216818034648895, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.246815073490144, "policy_loss": -0.0016522262012585998, "vf_loss": 9.248467350006104, "vf_explained_var": -5.523860454559326e-06, "kl": 0.005568292488534665, "entropy": -0.06373769178171643, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 12.955643166601657, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.217527794837952, "policy_loss": -0.0003114478837233037, "vf_loss": 9.217839086055756, "vf_explained_var": 4.788562655448914e-05, "kl": 0.020579942173576067, "entropy": -0.46431289380416274, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.45896517932415, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.104659897089005, "policy_loss": -0.0026916144182905556, "vf_loss": 7.107313871383667, "vf_explained_var": -0.0037714622914791105, "kl": 0.006030046237368543, "entropy": 2.488312175869942, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 178176, "num_env_steps_trained": 178176, "num_agent_steps_sampled": 712704, "num_agent_steps_trained": 712704}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4659.698783907623, "episode_len_mean": 3040.581818181818, "episode_media": {}, "episodes_timesteps_total": 167232, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -2213.1862638954735, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1017.7330470194357, "DC1_ls_policy": -480.7818677029624, "DC2_ls_policy": 3351.637299094529, "DC3_ls_policy": 771.1103054966158}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 107630.3074321656, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06342709719505696, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.8868243660872971, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60448.995284310084, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 82868.6829821625, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004335161964472309, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.09875, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.23597054494037253, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.406666666666666, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 99733.11497365391, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68197.18786257619, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003896837145400364, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2830673954079126, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101625216.8953879, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.54932004408028, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 440.03029195554996, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.593030283877094, "mean_inference_ms": 2.1309772012155332, "mean_action_processing_ms": 0.3216531764230224, "mean_env_wait_ms": 4.321274945976259, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034297596324573865, "StateBufferConnector_ms": 0.0024259090423583984, "ViewRequirementAgentConnector_ms": 0.05261421203613281}, "num_episodes": 1, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4659.698783907623, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 712704, "num_agent_steps_trained": 712704, "num_env_steps_sampled": 178176, "num_env_steps_trained": 178176, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 576.3315400943957, "num_env_steps_trained_throughput_per_sec": 576.3315400943957, "timesteps_total": 178176, "num_env_steps_sampled_lifetime": 178176, "num_agent_steps_sampled_lifetime": 712704, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 712704, "timers": {"training_iteration_time_ms": 3515.844, "restore_workers_time_ms": 0.02, "training_step_time_ms": 3515.779, "sample_time_ms": 2276.844, "learn_time_ms": 1211.012, "learn_throughput": 1691.148, "synch_weights_time_ms": 10.974}, "counters": {"num_env_steps_sampled": 178176, "num_env_steps_trained": 178176, "num_agent_steps_sampled": 712704, "num_agent_steps_trained": 712704}, "done": false, "training_iteration": 87, "trial_id": "45133_00000", "date": "2024-10-21_22-01-25", "timestamp": 1729548085, "time_this_iter_s": 3.561528444290161, "time_total_s": 305.4281349182129, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beea70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada0910>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1450>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2c80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada21a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 305.4281349182129, "iterations_since_restore": 87, "perf": {"cpu_util_percent": 19.159999999999997, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.980206035077572, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.780860459804535, "policy_loss": 0.00046542863128706813, "vf_loss": 9.780395066738128, "vf_explained_var": 7.923692464828491e-05, "kl": 0.0028032809561428554, "entropy": 0.16599328527227045, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.314950031042098, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 8.050706875324249, "policy_loss": -0.0036932102229911834, "vf_loss": 8.054399996995926, "vf_explained_var": -4.753470420837402e-07, "kl": 0.006735344285063452, "entropy": -0.15849512424319984, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 14.271097058057785, "cur_kl_coeff": 3.492459654808044e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.682787430286407, "policy_loss": -0.0007600630633533001, "vf_loss": 9.683547389507293, "vf_explained_var": 0.0002552345395088196, "kl": 0.023268719547927856, "entropy": -0.3756867599673569, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9727449372410772, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.75808761715889, "policy_loss": -0.005575106188189238, "vf_loss": 7.763585096597671, "vf_explained_var": 0.009561895579099654, "kl": 0.012420170767882679, "entropy": 2.440271931886673, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 180224, "num_env_steps_trained": 180224, "num_agent_steps_sampled": 720896, "num_agent_steps_trained": 720896}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4682.055928624476, "episode_len_mean": 3030.8571428571427, "episode_media": {}, "episodes_timesteps_total": 169728, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -2213.1862638954735, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1049.296293082023, "DC1_ls_policy": -442.6773947059328, "DC2_ls_policy": 3267.495200641998, "DC3_ls_policy": 807.9418296063842}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 107298.20282146022, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06229447045943094, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.8709882166928811, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60761.614412587405, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 82868.6829821625, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.008206924182139698, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.22115384615384615, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.29400638456826883, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.406666666666666, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 99063.18642305215, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003827250767803929, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2780126204899142, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101077543.24597158, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.941682804282145, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 449.7992286204921, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5929767867601131, "mean_inference_ms": 2.1309228237842026, "mean_action_processing_ms": 0.32169637567843384, "mean_env_wait_ms": 4.321295324692429, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034146010875701904, "StateBufferConnector_ms": 0.002424206052507673, "ViewRequirementAgentConnector_ms": 0.05258066313607352}, "num_episodes": 1, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4682.055928624476, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 720896, "num_agent_steps_trained": 720896, "num_env_steps_sampled": 180224, "num_env_steps_trained": 180224, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 573.2402469503087, "num_env_steps_trained_throughput_per_sec": 573.2402469503087, "timesteps_total": 180224, "num_env_steps_sampled_lifetime": 180224, "num_agent_steps_sampled_lifetime": 720896, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 720896, "timers": {"training_iteration_time_ms": 3536.092, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3536.026, "sample_time_ms": 2291.593, "learn_time_ms": 1215.115, "learn_throughput": 1685.437, "synch_weights_time_ms": 11.179}, "counters": {"num_env_steps_sampled": 180224, "num_env_steps_trained": 180224, "num_agent_steps_sampled": 720896, "num_agent_steps_trained": 720896}, "done": false, "training_iteration": 88, "trial_id": "45133_00000", "date": "2024-10-21_22-01-29", "timestamp": 1729548089, "time_this_iter_s": 3.5795392990112305, "time_total_s": 309.0076742172241, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1ae72b00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b490>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b790>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada28c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1480>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 309.0076742172241, "iterations_since_restore": 88, "perf": {"cpu_util_percent": 15.34, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0977410070598124, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.431526613235473, "policy_loss": -0.0014320700371172278, "vf_loss": 9.43295876979828, "vf_explained_var": 0.0005998507142066956, "kl": 0.006497520612813052, "entropy": 0.5371566332876683, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.50920914709568, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 8.427144050598145, "policy_loss": -0.0016940026136580855, "vf_loss": 8.428837954998016, "vf_explained_var": 3.8743019104003906e-07, "kl": 0.005681576936058264, "entropy": -0.07687317322706803, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 12.508321148157119, "cur_kl_coeff": 5.2386894822120674e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.39141275882721, "policy_loss": -0.0006145471823401749, "vf_loss": 9.3920272231102, "vf_explained_var": 0.00019126683473587037, "kl": 0.01065563718985128, "entropy": -0.4279177522286773, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.044865933060646, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.103757935762405, "policy_loss": -0.006442982511362061, "vf_loss": 7.1101440489292145, "vf_explained_var": -0.0142949178814888, "kl": 0.009101475288481193, "entropy": 2.4447854191064833, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 182272, "num_env_steps_trained": 182272, "num_agent_steps_sampled": 729088, "num_agent_steps_trained": 729088}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4682.055928624476, "episode_len_mean": 3030.8571428571427, "episode_media": {}, "episodes_timesteps_total": 169728, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -2213.1862638954735, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1049.296293082023, "DC1_ls_policy": -442.6773947059328, "DC2_ls_policy": 3267.495200641998, "DC3_ls_policy": 807.9418296063842}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 107298.20282146022, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06229447045943094, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.8709882166928811, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60761.614412587405, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 82868.6829821625, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.008206924182139698, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.22115384615384615, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.29400638456826883, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.406666666666666, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 99063.18642305215, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003827250767803929, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2780126204899142, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101077543.24597158, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.941682804282145, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 449.7992286204921, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5929767867601131, "mean_inference_ms": 2.1309228237842026, "mean_action_processing_ms": 0.32169637567843384, "mean_env_wait_ms": 4.321295324692429, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034146010875701904, "StateBufferConnector_ms": 0.002424206052507673, "ViewRequirementAgentConnector_ms": 0.05258066313607352}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4682.055928624476, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 729088, "num_agent_steps_trained": 729088, "num_env_steps_sampled": 182272, "num_env_steps_trained": 182272, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 595.6410663179608, "num_env_steps_trained_throughput_per_sec": 595.6410663179608, "timesteps_total": 182272, "num_env_steps_sampled_lifetime": 182272, "num_agent_steps_sampled_lifetime": 729088, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 729088, "timers": {"training_iteration_time_ms": 3523.567, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3523.5, "sample_time_ms": 2275.623, "learn_time_ms": 1218.379, "learn_throughput": 1680.922, "synch_weights_time_ms": 11.226}, "counters": {"num_env_steps_sampled": 182272, "num_env_steps_trained": 182272, "num_agent_steps_sampled": 729088, "num_agent_steps_trained": 729088}, "done": false, "training_iteration": 89, "trial_id": "45133_00000", "date": "2024-10-21_22-01-32", "timestamp": 1729548092, "time_this_iter_s": 3.445582151412964, "time_total_s": 312.4532563686371, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a99b640>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6ce0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada79d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada72e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7160>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 312.4532563686371, "iterations_since_restore": 89, "perf": {"cpu_util_percent": 6.42, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.509434192627668, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.889475905895234, "policy_loss": 0.0014135524106677622, "vf_loss": 9.888062226772309, "vf_explained_var": -4.2216479778289794e-05, "kl": 0.005471048922392313, "entropy": 0.13872106845956295, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.600200337171555, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 8.305130064487457, "policy_loss": -0.005213723634369671, "vf_loss": 8.310343754291534, "vf_explained_var": 4.4107437133789065e-07, "kl": 0.009423759138692136, "entropy": -0.07203010615194216, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.515571308135986, "cur_kl_coeff": 5.2386894822120674e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.273419404029847, "policy_loss": -0.003977856214623899, "vf_loss": 9.277397453784943, "vf_explained_var": -5.338937044143677e-05, "kl": 0.010605021883566223, "entropy": -0.8373176611959934, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.765629617869854, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 6.953209686279297, "policy_loss": -0.0055800530593842265, "vf_loss": 6.958715218305588, "vf_explained_var": 0.0011084601283073425, "kl": 0.011917416874519958, "entropy": 2.3701723545789717, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 184320, "num_env_steps_trained": 184320, "num_agent_steps_sampled": 737280, "num_agent_steps_trained": 737280}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4682.055928624476, "episode_len_mean": 3030.8571428571427, "episode_media": {}, "episodes_timesteps_total": 169728, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -2213.1862638954735, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1049.296293082023, "DC1_ls_policy": -442.6773947059328, "DC2_ls_policy": 3267.495200641998, "DC3_ls_policy": 807.9418296063842}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 107298.20282146022, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06229447045943094, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.8709882166928811, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60761.614412587405, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 82868.6829821625, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.008206924182139698, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.22115384615384615, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.29400638456826883, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.406666666666666, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 99063.18642305215, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003827250767803929, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2780126204899142, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101077543.24597158, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.941682804282145, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 449.7992286204921, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5929767867601131, "mean_inference_ms": 2.1309228237842026, "mean_action_processing_ms": 0.32169637567843384, "mean_env_wait_ms": 4.321295324692429, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034146010875701904, "StateBufferConnector_ms": 0.002424206052507673, "ViewRequirementAgentConnector_ms": 0.05258066313607352}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4682.055928624476, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 737280, "num_agent_steps_trained": 737280, "num_env_steps_sampled": 184320, "num_env_steps_trained": 184320, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 575.3859145393358, "num_env_steps_trained_throughput_per_sec": 575.3859145393358, "timesteps_total": 184320, "num_env_steps_sampled_lifetime": 184320, "num_agent_steps_sampled_lifetime": 737280, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 737280, "timers": {"training_iteration_time_ms": 3538.613, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3538.544, "sample_time_ms": 2287.039, "learn_time_ms": 1221.876, "learn_throughput": 1676.112, "synch_weights_time_ms": 11.199}, "counters": {"num_env_steps_sampled": 184320, "num_env_steps_trained": 184320, "num_agent_steps_sampled": 737280, "num_agent_steps_trained": 737280}, "done": false, "training_iteration": 90, "trial_id": "45133_00000", "date": "2024-10-21_22-01-36", "timestamp": 1729548096, "time_this_iter_s": 3.569042682647705, "time_total_s": 316.0222990512848, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fea7af76c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada49d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada46a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6ec0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6e60>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 316.0222990512848, "iterations_since_restore": 90, "perf": {"cpu_util_percent": 10.58, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.929206997156143, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.90120438337326, "policy_loss": 0.00039435200160369276, "vf_loss": 9.900810098648071, "vf_explained_var": 6.674230098724365e-05, "kl": 0.005632150436531447, "entropy": 0.3149993008002639, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.684650574624539, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 8.88859510421753, "policy_loss": -0.004454969812650233, "vf_loss": 8.893050026893615, "vf_explained_var": 4.224479198455811e-07, "kl": 0.00866381038668049, "entropy": 0.06662121242843569, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 16.528405559062957, "cur_kl_coeff": 5.2386894822120674e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.325484085083009, "policy_loss": 0.00041656543035060165, "vf_loss": 9.325067567825318, "vf_explained_var": -2.5335699319839478e-05, "kl": 0.013169808450038544, "entropy": -0.9365761667490006, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.746054702997208, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.033588767051697, "policy_loss": -0.003903743124101311, "vf_loss": 8.03743531703949, "vf_explained_var": 0.005522378534078598, "kl": 0.009148474502445995, "entropy": 2.2938261449337007, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 186368, "num_env_steps_trained": 186368, "num_agent_steps_sampled": 745472, "num_agent_steps_trained": 745472}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4682.055928624476, "episode_len_mean": 3030.8571428571427, "episode_media": {}, "episodes_timesteps_total": 169728, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -2213.1862638954735, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2207.591718068608, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1049.296293082023, "DC1_ls_policy": -442.6773947059328, "DC2_ls_policy": 3267.495200641998, "DC3_ls_policy": 807.9418296063842}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 107298.20282146022, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06229447045943094, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.8709882166928811, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 60761.614412587405, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 82868.6829821625, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.008206924182139698, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.22115384615384615, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.29400638456826883, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.406666666666666, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 99063.18642305215, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003827250767803929, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2780126204899142, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101077543.24597158, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 18.941682804282145, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 449.7992286204921, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5929767867601131, "mean_inference_ms": 2.1309228237842026, "mean_action_processing_ms": 0.32169637567843384, "mean_env_wait_ms": 4.321295324692429, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0034146010875701904, "StateBufferConnector_ms": 0.002424206052507673, "ViewRequirementAgentConnector_ms": 0.05258066313607352}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4682.055928624476, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 745472, "num_agent_steps_trained": 745472, "num_env_steps_sampled": 186368, "num_env_steps_trained": 186368, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 594.8329598691053, "num_env_steps_trained_throughput_per_sec": 594.8329598691053, "timesteps_total": 186368, "num_env_steps_sampled_lifetime": 186368, "num_agent_steps_sampled_lifetime": 745472, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 745472, "timers": {"training_iteration_time_ms": 3532.133, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3532.06, "sample_time_ms": 2278.683, "learn_time_ms": 1223.733, "learn_throughput": 1673.568, "synch_weights_time_ms": 11.157}, "counters": {"num_env_steps_sampled": 186368, "num_env_steps_trained": 186368, "num_agent_steps_sampled": 745472, "num_agent_steps_trained": 745472}, "done": false, "training_iteration": 91, "trial_id": "45133_00000", "date": "2024-10-21_22-01-40", "timestamp": 1729548100, "time_this_iter_s": 3.4499154090881348, "time_total_s": 319.4722144603729, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a43d090>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada61a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7f10>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7040>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada51e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 319.4722144603729, "iterations_since_restore": 91, "perf": {"cpu_util_percent": 19.05, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.494284831732512, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.832785749435425, "policy_loss": -0.0007342547760345042, "vf_loss": 9.833519983291627, "vf_explained_var": 6.24045729637146e-05, "kl": 0.007329053110152017, "entropy": 0.33195878928527234, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.209012345969677, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 8.83171501159668, "policy_loss": -0.0004960675374604762, "vf_loss": 8.83221102952957, "vf_explained_var": 1.0222196578979491e-06, "kl": 0.0018731099162563763, "entropy": 0.2305700541473925, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 22.78803823441267, "cur_kl_coeff": 5.2386894822120674e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.624570214748383, "policy_loss": 0.006071156897814944, "vf_loss": 9.618499100208282, "vf_explained_var": 0.0001239970326423645, "kl": 0.015128568703225726, "entropy": -0.9586654782295227, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.201345226168632, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.615434777736664, "policy_loss": -0.0024914121779147534, "vf_loss": 7.617872667312622, "vf_explained_var": -0.008778202533721923, "kl": 0.008570766583399453, "entropy": 2.2832027047872545, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 188416, "num_env_steps_trained": 188416, "num_agent_steps_sampled": 753664, "num_agent_steps_trained": 753664}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4701.849460198918, "episode_len_mean": 3036.6315789473683, "episode_media": {}, "episodes_timesteps_total": 173088, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2517.38167661672, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1089.5589070489166, "DC1_ls_policy": -390.7465338055353, "DC2_ls_policy": 3144.6378857400337, "DC3_ls_policy": 858.3992012154997}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 106907.72204783531, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.061201585012774264, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.8557077216631814, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 61216.57451076304, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 86694.3400085986, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.011556050825560805, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.22115384615384615, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.36887657331017887, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.5616071428571425, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 98439.25348139823, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0037601060174915794, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2731352060953543, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101018148.72094208, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 19.103110831525317, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 468.9865450461142, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5930266331387912, "mean_inference_ms": 2.1311706340396817, "mean_action_processing_ms": 0.32175032495668776, "mean_env_wait_ms": 4.322294508979308, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033981967390629285, "StateBufferConnector_ms": 0.0024223536775823226, "ViewRequirementAgentConnector_ms": 0.052535220196372585}, "num_episodes": 1, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4701.849460198918, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 753664, "num_agent_steps_trained": 753664, "num_env_steps_sampled": 188416, "num_env_steps_trained": 188416, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 577.9867975775238, "num_env_steps_trained_throughput_per_sec": 577.9867975775238, "timesteps_total": 188416, "num_env_steps_sampled_lifetime": 188416, "num_agent_steps_sampled_lifetime": 753664, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 753664, "timers": {"training_iteration_time_ms": 3546.287, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3546.216, "sample_time_ms": 2295.536, "learn_time_ms": 1222.605, "learn_throughput": 1675.112, "synch_weights_time_ms": 10.753}, "counters": {"num_env_steps_sampled": 188416, "num_env_steps_trained": 188416, "num_agent_steps_sampled": 753664, "num_agent_steps_trained": 753664}, "done": false, "training_iteration": 92, "trial_id": "45133_00000", "date": "2024-10-21_22-01-43", "timestamp": 1729548103, "time_this_iter_s": 3.5499117374420166, "time_total_s": 323.02212619781494, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27bee9e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada6080>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7070>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5690>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada79a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 323.02212619781494, "iterations_since_restore": 92, "perf": {"cpu_util_percent": 19.380000000000003, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.486030257493257, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.770308721065522, "policy_loss": -8.152243681252003e-05, "vf_loss": 9.770390212535858, "vf_explained_var": 0.00020534396171569824, "kl": 0.007855641920446032, "entropy": 0.1962486598873511, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.6258403837680815, "cur_kl_coeff": 6.938893903907228e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 8.416446566581726, "policy_loss": -0.0024945780751295388, "vf_loss": 8.418941235542297, "vf_explained_var": 1.1086463928222657e-06, "kl": 0.0065708933044362535, "entropy": -0.25534771364182235, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 16.76622581779957, "cur_kl_coeff": 5.2386894822120674e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.524485075473786, "policy_loss": 0.0011763966642320157, "vf_loss": 9.523308658599854, "vf_explained_var": 7.796138525009155e-05, "kl": 0.008700181650789235, "entropy": -0.885599534958601, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.594416896998882, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.4141670823097225, "policy_loss": -0.004740022559417412, "vf_loss": 7.418852055072785, "vf_explained_var": 0.02193910554051399, "kl": 0.008795901555618001, "entropy": 2.29344884455204, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 190464, "num_env_steps_trained": 190464, "num_agent_steps_sampled": 761856, "num_agent_steps_trained": 761856}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4701.849460198918, "episode_len_mean": 3036.6315789473683, "episode_media": {}, "episodes_timesteps_total": 173088, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2517.38167661672, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1089.5589070489166, "DC1_ls_policy": -390.7465338055353, "DC2_ls_policy": 3144.6378857400337, "DC3_ls_policy": 858.3992012154997}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 106907.72204783531, "DC1_ls_policy/bat_CO2_footprint_sum_min": 84423.71254556894, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.061201585012774264, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.8557077216631814, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 61216.57451076304, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 86694.3400085986, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.011556050825560805, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.22115384615384615, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.36887657331017887, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 4.5616071428571425, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 98439.25348139823, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0037601060174915794, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.2731352060953543, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 101018148.72094208, "accumulated/bat_CO2_footprint_sum_min": 69704317.51961578, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 19.103110831525317, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 468.9865450461142, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5930266331387912, "mean_inference_ms": 2.1311706340396817, "mean_action_processing_ms": 0.32175032495668776, "mean_env_wait_ms": 4.322294508979308, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033981967390629285, "StateBufferConnector_ms": 0.0024223536775823226, "ViewRequirementAgentConnector_ms": 0.052535220196372585}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4701.849460198918, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 761856, "num_agent_steps_trained": 761856, "num_env_steps_sampled": 190464, "num_env_steps_trained": 190464, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 583.0454120492716, "num_env_steps_trained_throughput_per_sec": 583.0454120492716, "timesteps_total": 190464, "num_env_steps_sampled_lifetime": 190464, "num_agent_steps_sampled_lifetime": 761856, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 761856, "timers": {"training_iteration_time_ms": 3521.137, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3521.065, "sample_time_ms": 2266.878, "learn_time_ms": 1225.597, "learn_throughput": 1671.023, "synch_weights_time_ms": 10.738}, "counters": {"num_env_steps_sampled": 190464, "num_env_steps_trained": 190464, "num_agent_steps_sampled": 761856, "num_agent_steps_trained": 761856}, "done": false, "training_iteration": 93, "trial_id": "45133_00000", "date": "2024-10-21_22-01-47", "timestamp": 1729548107, "time_this_iter_s": 3.520352840423584, "time_total_s": 326.5424790382385, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fec27beea70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4790>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada73a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5060>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5db0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 326.5424790382385, "iterations_since_restore": 93, "perf": {"cpu_util_percent": 18.939999999999998, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.633205685019493, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.486209344863891, "policy_loss": -0.003046626766445115, "vf_loss": 9.489255833625794, "vf_explained_var": 0.0009808242321014404, "kl": 0.00833665443897517, "entropy": 0.616473101824522, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.802364772558212, "cur_kl_coeff": 6.938893903907228e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 7.707779902219772, "policy_loss": -0.003918825718574226, "vf_loss": 7.711698687076568, "vf_explained_var": -2.1494925022125244e-06, "kl": 0.007572302216433481, "entropy": -0.2570295795798302, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 14.853892448544503, "cur_kl_coeff": 5.2386894822120674e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.287932729721069, "policy_loss": 0.0014096005819737912, "vf_loss": 9.28652333021164, "vf_explained_var": 0.00010121986269950867, "kl": 0.012389799827730181, "entropy": -0.6498714298009872, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.616612373292446, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.001786440610886, "policy_loss": -0.0039680641959421335, "vf_loss": 8.005692636966705, "vf_explained_var": 0.007595247030258179, "kl": 0.00992092878004924, "entropy": 2.275283345580101, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 192512, "num_env_steps_trained": 192512, "num_agent_steps_sampled": 770048, "num_agent_steps_trained": 770048}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4706.073248108416, "episode_len_mean": 3015.0508474576272, "episode_media": {}, "episodes_timesteps_total": 177888, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4259.087173723706, "DC1_ls_policy": 2517.38167661672, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1141.0809278998756, "DC1_ls_policy": -319.5277697738838, "DC2_ls_policy": 2963.946778530833, "DC3_ls_policy": 920.5733114515878}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 106066.51058213005, "DC1_ls_policy/bat_CO2_footprint_sum_min": 76441.90096593059, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.059126955012341234, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.8267713017197966, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 61927.4677047959, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 87701.43234658879, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.017414320289101115, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.3383333333333333, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.49789770641830844, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 5.54875, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 97351.69821912146, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003632644796559661, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.26387638554974907, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 99943278.56940992, "accumulated/bat_CO2_footprint_sum_min": 65218879.11051964, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 20.359516679044233, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 495.3266957083928, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669, 6838.047537766614, 2814.854869291579], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360, 2400, 2400], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497, 3109.2302091788397, 2109.6868351255844], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672, 1843.107757492905, 1577.3062527634665], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962, -749.4411249209986, -3622.0584289417575], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966, 2635.1506960158868, 2749.920210344299]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5931904842861695, "mean_inference_ms": 2.130887681956264, "mean_action_processing_ms": 0.3217147743238508, "mean_env_wait_ms": 4.323508536188906, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003434237787279032, "StateBufferConnector_ms": 0.002423383421817068, "ViewRequirementAgentConnector_ms": 0.05259129960658187}, "num_episodes": 2, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4706.073248108416, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 770048, "num_agent_steps_trained": 770048, "num_env_steps_sampled": 192512, "num_env_steps_trained": 192512, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 578.1420132202365, "num_env_steps_trained_throughput_per_sec": 578.1420132202365, "timesteps_total": 192512, "num_env_steps_sampled_lifetime": 192512, "num_agent_steps_sampled_lifetime": 770048, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 770048, "timers": {"training_iteration_time_ms": 3523.512, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3523.439, "sample_time_ms": 2266.264, "learn_time_ms": 1228.094, "learn_throughput": 1667.624, "synch_weights_time_ms": 11.057}, "counters": {"num_env_steps_sampled": 192512, "num_env_steps_trained": 192512, "num_agent_steps_sampled": 770048, "num_agent_steps_trained": 770048}, "done": false, "training_iteration": 94, "trial_id": "45133_00000", "date": "2024-10-21_22-01-50", "timestamp": 1729548110, "time_this_iter_s": 3.550938367843628, "time_total_s": 330.09341740608215, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a43dfc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2a40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1180>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada3310>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada07f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 330.09341740608215, "iterations_since_restore": 94, "perf": {"cpu_util_percent": 19.08, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.813201816380024, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.8550008893013, "policy_loss": 0.0012547652004286647, "vf_loss": 9.85374618768692, "vf_explained_var": 0.00034683644771575927, "kl": 0.007344985390230775, "entropy": 0.2974793878849596, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.940731705725193, "cur_kl_coeff": 6.938893903907228e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 8.17207345366478, "policy_loss": -0.0035753850126639007, "vf_loss": 8.175648951530457, "vf_explained_var": -2.384185791015625e-07, "kl": 0.015667806025339813, "entropy": -0.2544830098748207, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 26.189561313390733, "cur_kl_coeff": 5.2386894822120674e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.631179392337799, "policy_loss": 0.009788524644682184, "vf_loss": 9.621391034126281, "vf_explained_var": -0.00013682320713996886, "kl": 0.020450481189623605, "entropy": -0.8101260311901569, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.460014110803604, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.3266521990299225, "policy_loss": -0.0011813352815806867, "vf_loss": 7.327798634767532, "vf_explained_var": -0.001101764291524887, "kl": 0.005584397584971157, "entropy": 2.2420256465673445, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 194560, "num_env_steps_trained": 194560, "num_agent_steps_sampled": 778240, "num_agent_steps_trained": 778240}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4843.39000327984, "episode_len_mean": 3038.9508196721313, "episode_media": {}, "episodes_timesteps_total": 185376, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4421.096870595288, "DC1_ls_policy": 2834.7515694101385, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1239.7064602458115, "DC1_ls_policy": -227.84537397541052, "DC2_ls_policy": 2808.0626510048305, "DC3_ls_policy": 1023.4662660046035}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 105317.934425518, "DC1_ls_policy/bat_CO2_footprint_sum_min": 76441.90096593059, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05718836632341202, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.7996687893986862, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 62521.91248953408, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 87701.43234658879, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.019446170356819024, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.3383333333333333, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5863158512681548, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 5.54875, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 96331.88634620604, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003513541688475738, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.25522470077762616, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100151948.10498703, "accumulated/bat_CO2_footprint_sum_min": 65218879.11051964, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 21.04650211048419, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 523.9410794125607, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669, 6838.047537766614, 2814.854869291579, 8013.990853101006, 9774.477708572684], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360, 2400, 2400, 3456, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497, 3109.2302091788397, 2109.6868351255844, 3877.222458306555, 4421.096870595288], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672, 1843.107757492905, 1577.3062527634665, 2118.8190347489667, 2834.7515694101385], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962, -749.4411249209986, -3622.0584289417575, -1700.6510807562279, -1880.3871412682547], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966, 2635.1506960158868, 2749.920210344299, 3718.6004408016447, 4399.016409835495]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5932015425064635, "mean_inference_ms": 2.1308360052099684, "mean_action_processing_ms": 0.3216915136915856, "mean_env_wait_ms": 4.324698271360848, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003413489607513928, "StateBufferConnector_ms": 0.0024195577277511845, "ViewRequirementAgentConnector_ms": 0.05256269798904169}, "num_episodes": 2, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4843.39000327984, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 778240, "num_agent_steps_trained": 778240, "num_env_steps_sampled": 194560, "num_env_steps_trained": 194560, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 570.0232504897658, "num_env_steps_trained_throughput_per_sec": 570.0232504897658, "timesteps_total": 194560, "num_env_steps_sampled_lifetime": 194560, "num_agent_steps_sampled_lifetime": 778240, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 778240, "timers": {"training_iteration_time_ms": 3529.765, "restore_workers_time_ms": 0.025, "training_step_time_ms": 3529.692, "sample_time_ms": 2275.019, "learn_time_ms": 1225.833, "learn_throughput": 1670.7, "synch_weights_time_ms": 10.951}, "counters": {"num_env_steps_sampled": 194560, "num_env_steps_trained": 194560, "num_agent_steps_sampled": 778240, "num_agent_steps_trained": 778240}, "done": false, "training_iteration": 95, "trial_id": "45133_00000", "date": "2024-10-21_22-01-54", "timestamp": 1729548114, "time_this_iter_s": 3.600027561187744, "time_total_s": 333.6934449672699, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c1870>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a6199f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a500>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b1f0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61bbb0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 333.6934449672699, "iterations_since_restore": 95, "perf": {"cpu_util_percent": 19.82, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.79475556910038, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.771611714363098, "policy_loss": 0.005543161451350897, "vf_loss": 9.766068518161774, "vf_explained_var": 0.0001806505024433136, "kl": 0.024063974784806298, "entropy": 0.03801237253355794, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.330719946324825, "cur_kl_coeff": 6.938893903907228e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 8.811695885658263, "policy_loss": 0.0004991923691704869, "vf_loss": 8.811196553707124, "vf_explained_var": 1.333653926849365e-07, "kl": 0.004765653047799931, "entropy": -0.07921051427256316, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 24.34489176720381, "cur_kl_coeff": 7.858034223318099e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.254662466049194, "policy_loss": 0.0024553800467401743, "vf_loss": 9.252207136154174, "vf_explained_var": 8.705630898475647e-05, "kl": 0.02620464232577433, "entropy": -0.7432843774557114, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.50907936245203, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.4113028168678285, "policy_loss": -0.003654355648905039, "vf_loss": 7.414885842800141, "vf_explained_var": -0.00022687017917633057, "kl": 0.011401347071205237, "entropy": 2.154037779569626, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 196608, "num_env_steps_trained": 196608, "num_agent_steps_sampled": 786432, "num_agent_steps_trained": 786432}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4843.39000327984, "episode_len_mean": 3038.9508196721313, "episode_media": {}, "episodes_timesteps_total": 185376, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4421.096870595288, "DC1_ls_policy": 2834.7515694101385, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1239.7064602458115, "DC1_ls_policy": -227.84537397541052, "DC2_ls_policy": 2808.0626510048305, "DC3_ls_policy": 1023.4662660046035}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 105317.934425518, "DC1_ls_policy/bat_CO2_footprint_sum_min": 76441.90096593059, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05718836632341202, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.7996687893986862, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 62521.91248953408, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 87701.43234658879, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.019446170356819024, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.3383333333333333, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5863158512681548, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 5.54875, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 96331.88634620604, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003513541688475738, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.25522470077762616, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100151948.10498703, "accumulated/bat_CO2_footprint_sum_min": 65218879.11051964, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 21.04650211048419, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 523.9410794125607, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669, 6838.047537766614, 2814.854869291579, 8013.990853101006, 9774.477708572684], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360, 2400, 2400, 3456, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497, 3109.2302091788397, 2109.6868351255844, 3877.222458306555, 4421.096870595288], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672, 1843.107757492905, 1577.3062527634665, 2118.8190347489667, 2834.7515694101385], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962, -749.4411249209986, -3622.0584289417575, -1700.6510807562279, -1880.3871412682547], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966, 2635.1506960158868, 2749.920210344299, 3718.6004408016447, 4399.016409835495]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5932015425064635, "mean_inference_ms": 2.1308360052099684, "mean_action_processing_ms": 0.3216915136915856, "mean_env_wait_ms": 4.324698271360848, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003413489607513928, "StateBufferConnector_ms": 0.0024195577277511845, "ViewRequirementAgentConnector_ms": 0.05256269798904169}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4843.39000327984, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 786432, "num_agent_steps_trained": 786432, "num_env_steps_sampled": 196608, "num_env_steps_trained": 196608, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 604.59784976903, "num_env_steps_trained_throughput_per_sec": 604.59784976903, "timesteps_total": 196608, "num_env_steps_sampled_lifetime": 196608, "num_agent_steps_sampled_lifetime": 786432, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 786432, "timers": {"training_iteration_time_ms": 3514.548, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3514.478, "sample_time_ms": 2258.746, "learn_time_ms": 1226.873, "learn_throughput": 1669.285, "synch_weights_time_ms": 10.938}, "counters": {"num_env_steps_sampled": 196608, "num_env_steps_trained": 196608, "num_agent_steps_sampled": 786432, "num_agent_steps_trained": 786432}, "done": false, "training_iteration": 96, "trial_id": "45133_00000", "date": "2024-10-21_22-01-58", "timestamp": 1729548118, "time_this_iter_s": 3.3955962657928467, "time_total_s": 337.08904123306274, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fea7af76c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a1a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a619b10>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a619b40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a7d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 337.08904123306274, "iterations_since_restore": 96, "perf": {"cpu_util_percent": 11.78, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.926742781698704, "cur_kl_coeff": 8.326672684688674e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.910740768909454, "policy_loss": 0.0022712044941727073, "vf_loss": 9.908469676971436, "vf_explained_var": 9.018480777740478e-05, "kl": 0.01224638059357223, "entropy": 0.018990265630418435, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.22490897923708, "cur_kl_coeff": 3.469446951953614e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 8.569307917356491, "policy_loss": -0.0015613452065736055, "vf_loss": 8.570869195461274, "vf_explained_var": -8.024275302886963e-07, "kl": 0.0041371832916425435, "entropy": 0.09608397786505521, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 21.240928009152412, "cur_kl_coeff": 1.178705133497715e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.513196432590485, "policy_loss": 0.004508983466075733, "vf_loss": 9.508687400817871, "vf_explained_var": 0.0002860508859157562, "kl": 0.018740565585176228, "entropy": -0.46930736899375913, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.292372104525566, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.826597172021866, "policy_loss": -0.0009365974692627788, "vf_loss": 7.827504229545593, "vf_explained_var": -0.012737154960632324, "kl": 0.004745516656386916, "entropy": 2.2176619857549666, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 198656, "num_env_steps_trained": 198656, "num_agent_steps_sampled": 794624, "num_agent_steps_trained": 794624}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4843.39000327984, "episode_len_mean": 3038.9508196721313, "episode_media": {}, "episodes_timesteps_total": 185376, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4421.096870595288, "DC1_ls_policy": 2834.7515694101385, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1239.7064602458115, "DC1_ls_policy": -227.84537397541052, "DC2_ls_policy": 2808.0626510048305, "DC3_ls_policy": 1023.4662660046035}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 105317.934425518, "DC1_ls_policy/bat_CO2_footprint_sum_min": 76441.90096593059, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05718836632341202, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.7996687893986862, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 62521.91248953408, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 87701.43234658879, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.019446170356819024, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.3383333333333333, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5863158512681548, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 5.54875, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 96331.88634620604, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.003513541688475738, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.25522470077762616, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 100151948.10498703, "accumulated/bat_CO2_footprint_sum_min": 65218879.11051964, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 21.04650211048419, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 523.9410794125607, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669, 6838.047537766614, 2814.854869291579, 8013.990853101006, 9774.477708572684], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360, 2400, 2400, 3456, 4032], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497, 3109.2302091788397, 2109.6868351255844, 3877.222458306555, 4421.096870595288], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672, 1843.107757492905, 1577.3062527634665, 2118.8190347489667, 2834.7515694101385], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962, -749.4411249209986, -3622.0584289417575, -1700.6510807562279, -1880.3871412682547], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966, 2635.1506960158868, 2749.920210344299, 3718.6004408016447, 4399.016409835495]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5932015425064635, "mean_inference_ms": 2.1308360052099684, "mean_action_processing_ms": 0.3216915136915856, "mean_env_wait_ms": 4.324698271360848, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003413489607513928, "StateBufferConnector_ms": 0.0024195577277511845, "ViewRequirementAgentConnector_ms": 0.05256269798904169}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4843.39000327984, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 794624, "num_agent_steps_trained": 794624, "num_env_steps_sampled": 198656, "num_env_steps_trained": 198656, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 564.2192539874316, "num_env_steps_trained_throughput_per_sec": 564.2192539874316, "timesteps_total": 198656, "num_env_steps_sampled_lifetime": 198656, "num_agent_steps_sampled_lifetime": 794624, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 794624, "timers": {"training_iteration_time_ms": 3522.177, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3522.108, "sample_time_ms": 2267.554, "learn_time_ms": 1226.561, "learn_throughput": 1669.708, "synch_weights_time_ms": 10.687}, "counters": {"num_env_steps_sampled": 198656, "num_env_steps_trained": 198656, "num_agent_steps_sampled": 794624, "num_agent_steps_trained": 794624}, "done": false, "training_iteration": 97, "trial_id": "45133_00000", "date": "2024-10-21_22-02-01", "timestamp": 1729548121, "time_this_iter_s": 3.637115240097046, "time_total_s": 340.7261564731598, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a43c940>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a7a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a3e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a619d20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a350>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 340.7261564731598, "iterations_since_restore": 97, "perf": {"cpu_util_percent": 6.1000000000000005, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.229768136143685, "cur_kl_coeff": 8.326672684688674e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.838902401924134, "policy_loss": -0.0016718296566978097, "vf_loss": 9.840574300289154, "vf_explained_var": 8.391290903091431e-05, "kl": 0.008774224923581642, "entropy": -0.18998466890770943, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.302632524073124, "cur_kl_coeff": 1.734723475976807e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 8.188472026586533, "policy_loss": -0.0007874996634200215, "vf_loss": 8.18925945162773, "vf_explained_var": 2.7716159820556643e-07, "kl": 0.005200050593523316, "entropy": -0.21308320248499513, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 27.73717077076435, "cur_kl_coeff": 1.178705133497715e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.395068264007568, "policy_loss": 0.006892972160130739, "vf_loss": 9.388175356388093, "vf_explained_var": 0.0006851308047771454, "kl": 0.014209922792002894, "entropy": -0.6519344702363015, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.7601221859455105, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 6.459604495763779, "policy_loss": -0.0009367770166136324, "vf_loss": 6.460519629716873, "vf_explained_var": 0.007735888659954071, "kl": 0.006906596249702158, "entropy": 2.1492682129144667, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 200704, "num_env_steps_trained": 200704, "num_agent_steps_sampled": 802816, "num_agent_steps_trained": 802816}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4837.147815125566, "episode_len_mean": 3026.285714285714, "episode_media": {}, "episodes_timesteps_total": 190656, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4421.096870595288, "DC1_ls_policy": 2834.7515694101385, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1286.1829295649857, "DC1_ls_policy": -160.16556319216932, "DC2_ls_policy": 2629.4542320217975, "DC3_ls_policy": 1081.6762167309466}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 104555.98307642082, "DC1_ls_policy/bat_CO2_footprint_sum_min": 76441.90096593059, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.055372862630605285, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.7742824786241247, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 63264.519523543866, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 88318.69765813055, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.022129131251839237, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.3383333333333333, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7122551158525433, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 5.54875, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95374.85442978516, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0034020006824923813, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.24771375179079064, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 99387489.96782638, "accumulated/bat_CO2_footprint_sum_min": 65218879.11051964, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 22.03105434698419, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 558.2305112644657, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669, 6838.047537766614, 2814.854869291579, 8013.990853101006, 9774.477708572684, 4736.95298937589, 4556.569163464476], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360, 2400, 2400, 3456, 4032, 2784, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497, 3109.2302091788397, 2109.6868351255844, 3877.222458306555, 4421.096870595288, 2486.964052473511, 2920.466435126085], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672, 1843.107757492905, 1577.3062527634665, 2118.8190347489667, 2834.7515694101385, 1946.2148394043302, 1861.9224919890441], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962, -749.4411249209986, -3622.0584289417575, -1700.6510807562279, -1880.3871412682547, -2723.9668480896885, -2912.238245831757], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966, 2635.1506960158868, 2749.920210344299, 3718.6004408016447, 4399.016409835495, 3027.7409455877273, 2686.4184821810936]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5932280394691123, "mean_inference_ms": 2.1306458789904146, "mean_action_processing_ms": 0.32169670717693627, "mean_env_wait_ms": 4.325861296416952, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033904635716998388, "StateBufferConnector_ms": 0.00242335455758231, "ViewRequirementAgentConnector_ms": 0.05258738048492916}, "num_episodes": 2, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4837.147815125566, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 802816, "num_agent_steps_trained": 802816, "num_env_steps_sampled": 200704, "num_env_steps_trained": 200704, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 575.1940803976115, "num_env_steps_trained_throughput_per_sec": 575.1940803976115, "timesteps_total": 200704, "num_env_steps_sampled_lifetime": 200704, "num_agent_steps_sampled_lifetime": 802816, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 802816, "timers": {"training_iteration_time_ms": 3520.962, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3520.895, "sample_time_ms": 2268.472, "learn_time_ms": 1225.701, "learn_throughput": 1670.881, "synch_weights_time_ms": 10.468}, "counters": {"num_env_steps_sampled": 200704, "num_env_steps_trained": 200704, "num_agent_steps_sampled": 802816, "num_agent_steps_trained": 802816}, "done": false, "training_iteration": 98, "trial_id": "45133_00000", "date": "2024-10-21_22-02-05", "timestamp": 1729548125, "time_this_iter_s": 3.5685503482818604, "time_total_s": 344.29470682144165, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a8c1870>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada5c30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7d30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada4610>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada7310>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 344.29470682144165, "iterations_since_restore": 98, "perf": {"cpu_util_percent": 17.46, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.883945015072822, "cur_kl_coeff": 8.326672684688674e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.891646909713746, "policy_loss": 0.007940927962772548, "vf_loss": 9.883706057071686, "vf_explained_var": 9.117275476455688e-05, "kl": 0.026875833232770673, "entropy": -0.13866472709923983, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.257208377122879, "cur_kl_coeff": 1.734723475976807e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 9.431141972541809, "policy_loss": -0.00528712070081383, "vf_loss": 9.436429154872894, "vf_explained_var": 6.48200511932373e-08, "kl": 0.009509311485999206, "entropy": -0.02523024521651678, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.911565127968789, "cur_kl_coeff": 1.178705133497715e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.540401148796082, "policy_loss": 0.0009104835451580584, "vf_loss": 9.539490699768066, "vf_explained_var": 0.0024122513830661775, "kl": 0.007597761850777288, "entropy": 0.3378557804506272, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.411290554702282, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.390107023715974, "policy_loss": -0.003005722560919821, "vf_loss": 8.393088352680206, "vf_explained_var": -0.009935128688812255, "kl": 0.007783465101603526, "entropy": 2.090271198749542, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 202752, "num_env_steps_trained": 202752, "num_agent_steps_sampled": 811008, "num_agent_steps_trained": 811008}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4837.147815125566, "episode_len_mean": 3026.285714285714, "episode_media": {}, "episodes_timesteps_total": 190656, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4421.096870595288, "DC1_ls_policy": 2834.7515694101385, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1286.1829295649857, "DC1_ls_policy": -160.16556319216932, "DC2_ls_policy": 2629.4542320217975, "DC3_ls_policy": 1081.6762167309466}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 104555.98307642082, "DC1_ls_policy/bat_CO2_footprint_sum_min": 76441.90096593059, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.055372862630605285, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.7742824786241247, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 63264.519523543866, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 88318.69765813055, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.022129131251839237, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.3383333333333333, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7122551158525433, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 5.54875, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95374.85442978516, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0034020006824923813, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.24771375179079064, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 99387489.96782638, "accumulated/bat_CO2_footprint_sum_min": 65218879.11051964, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 22.03105434698419, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 558.2305112644657, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669, 6838.047537766614, 2814.854869291579, 8013.990853101006, 9774.477708572684, 4736.95298937589, 4556.569163464476], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360, 2400, 2400, 3456, 4032, 2784, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497, 3109.2302091788397, 2109.6868351255844, 3877.222458306555, 4421.096870595288, 2486.964052473511, 2920.466435126085], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672, 1843.107757492905, 1577.3062527634665, 2118.8190347489667, 2834.7515694101385, 1946.2148394043302, 1861.9224919890441], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962, -749.4411249209986, -3622.0584289417575, -1700.6510807562279, -1880.3871412682547, -2723.9668480896885, -2912.238245831757], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966, 2635.1506960158868, 2749.920210344299, 3718.6004408016447, 4399.016409835495, 3027.7409455877273, 2686.4184821810936]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5932280394691123, "mean_inference_ms": 2.1306458789904146, "mean_action_processing_ms": 0.32169670717693627, "mean_env_wait_ms": 4.325861296416952, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033904635716998388, "StateBufferConnector_ms": 0.00242335455758231, "ViewRequirementAgentConnector_ms": 0.05258738048492916}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4837.147815125566, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 811008, "num_agent_steps_trained": 811008, "num_env_steps_sampled": 202752, "num_env_steps_trained": 202752, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 574.7753335328223, "num_env_steps_trained_throughput_per_sec": 574.7753335328223, "timesteps_total": 202752, "num_env_steps_sampled_lifetime": 202752, "num_agent_steps_sampled_lifetime": 811008, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 811008, "timers": {"training_iteration_time_ms": 3533.444, "restore_workers_time_ms": 0.023, "training_step_time_ms": 3533.377, "sample_time_ms": 2279.849, "learn_time_ms": 1225.871, "learn_throughput": 1670.649, "synch_weights_time_ms": 10.48}, "counters": {"num_env_steps_sampled": 202752, "num_env_steps_trained": 202752, "num_agent_steps_sampled": 811008, "num_agent_steps_trained": 811008}, "done": false, "training_iteration": 99, "trial_id": "45133_00000", "date": "2024-10-21_22-02-08", "timestamp": 1729548128, "time_this_iter_s": 3.570465326309204, "time_total_s": 347.86517214775085, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a43d3f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61a2c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b700>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a619a20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1a61b5e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 347.86517214775085, "iterations_since_restore": 99, "perf": {"cpu_util_percent": 19.159999999999997, "ram_util_percent": 4.0}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.970678149163723, "cur_kl_coeff": 1.2490009027033013e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.894539594650269, "policy_loss": 0.004990177863510326, "vf_loss": 9.88954941034317, "vf_explained_var": -7.160007953643799e-06, "kl": 0.009411999565057196, "entropy": -0.44844823963940145, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.2180201157927515, "cur_kl_coeff": 1.734723475976807e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 6.778213322162628, "policy_loss": -0.0029080682783387602, "vf_loss": 6.781121385097504, "vf_explained_var": -4.172325134277344e-07, "kl": 0.01221747623931151, "entropy": -0.39103855937719345, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 21.9046067237854, "cur_kl_coeff": 1.178705133497715e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.791230976581573, "policy_loss": 0.0019987034727819266, "vf_loss": 9.789232277870179, "vf_explained_var": 0.001799306273460388, "kl": 0.019273420349418303, "entropy": -0.5501329587772489, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.250224491953849, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.096660101413727, "policy_loss": -0.009715009317733347, "vf_loss": 7.106323975324631, "vf_explained_var": -0.03626286834478378, "kl": 0.016345697203541933, "entropy": 1.9969897136092185, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 204800, "num_env_steps_trained": 204800, "num_agent_steps_sampled": 819200, "num_agent_steps_trained": 819200}, "env_runners": {"episode_reward_max": 15094.633327856347, "episode_reward_min": -2216.1845545339484, "episode_reward_mean": 4837.147815125566, "episode_len_mean": 3026.285714285714, "episode_media": {}, "episodes_timesteps_total": 190656, "policy_reward_min": {"high_level_policy": -888.5501405238665, "DC1_ls_policy": -4835.633204623035, "DC2_ls_policy": -3735.371748769962, "DC3_ls_policy": -2997.283131504963}, "policy_reward_max": {"high_level_policy": 4421.096870595288, "DC1_ls_policy": 2834.7515694101385, "DC2_ls_policy": 7501.375402124674, "DC3_ls_policy": 4595.0364078}, "policy_reward_mean": {"high_level_policy": 1286.1829295649857, "DC1_ls_policy": -160.16556319216932, "DC2_ls_policy": 2629.4542320217975, "DC3_ls_policy": 1081.6762167309466}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 104555.98307642082, "DC1_ls_policy/bat_CO2_footprint_sum_min": 76441.90096593059, "DC1_ls_policy/bat_CO2_footprint_sum_max": 135171.52462979656, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.055372862630605285, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.59625, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.7742824786241247, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 4.513621794871795, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 63264.519523543866, "DC2_ls_policy/bat_CO2_footprint_sum_min": 46458.832660539585, "DC2_ls_policy/bat_CO2_footprint_sum_max": 88318.69765813055, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.022129131251839237, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.3383333333333333, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7122551158525433, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 5.54875, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95374.85442978516, "DC3_ls_policy/bat_CO2_footprint_sum_min": 62217.11613995466, "DC3_ls_policy/bat_CO2_footprint_sum_max": 127198.32871850352, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0034020006824923813, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.1469109195402299, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.24771375179079064, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 2.99875, "accumulated/bat_CO2_footprint_sum_mean": 99387489.96782638, "accumulated/bat_CO2_footprint_sum_min": 65218879.11051964, "accumulated/bat_CO2_footprint_sum_max": 181658460.06074452, "accumulated/ls_tasks_dropped_sum_mean": 22.03105434698419, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 181.6890914351852, "accumulated/ls_overdue_penalty_sum_mean": 558.2305112644657, "accumulated/ls_overdue_penalty_sum_min": 0.0, "accumulated/ls_overdue_penalty_sum_max": 2511.172309027778}, "hist_stats": {"episode_reward": [3853.597797251453, 602.3678501294302, 3035.0786921904514, 683.180502598179, -626.396882882358, 1068.3244710294125, 962.0256134211317, -241.77210195580886, -2216.1845545339484, 179.0926919016395, 1154.6283945235637, 522.3961992018799, 713.1220392934542, 2422.356742260735, 2409.945633507153, 3901.783393867865, 811.4991864241035, 1899.8073244417155, 1291.7239183941178, 1971.398402655678, 2547.738460174155, 3687.420906034506, 3885.3125142084277, 5219.277891733597, 3404.000844394387, 4244.475458143392, 2830.2289484832418, 4075.839799067118, 3953.3433979473175, 3793.088594639816, 3894.98462985083, 6739.1525253298305, 5484.012244045803, 6597.634657516247, 5420.454581140967, 6174.930242185038, 11607.412452026525, 9382.047316671822, 7135.635643795007, 9287.290004193257, 7402.589697163545, 6448.183311203339, 9759.762670573817, 7095.57400282027, 5925.168575053327, 7467.569260515775, 7441.302175698382, 7407.559921328422, 9788.87863527004, 12086.651605070909, 15094.633327856347, 13397.538642878984, 5447.057759524441, 3313.520171160906, 4445.1869334995845, 5911.698888051427, 5810.287228367669, 6838.047537766614, 2814.854869291579, 8013.990853101006, 9774.477708572684, 4736.95298937589, 4556.569163464476], "episode_lengths": [2400, 2496, 2400, 2784, 3360, 3456, 4032, 2400, 2400, 2496, 5184, 2784, 3360, 3456, 2400, 2400, 2496, 4032, 2784, 2400, 2400, 2496, 3360, 5184, 3456, 2784, 2400, 2400, 4032, 2496, 3360, 3456, 2784, 2400, 2400, 2496, 5184, 4032, 2400, 3360, 2784, 2400, 3456, 2496, 2400, 2400, 2784, 2496, 3360, 4032, 5184, 3456, 2400, 2400, 2784, 2496, 3360, 2400, 2400, 3456, 4032, 2784, 2496], "policy_high_level_policy_reward": [1526.26437634991, 1003.6366932741887, 1764.3847327178512, 1383.058283356537, 663.638324430605, 851.5944776320357, 609.2270527246297, -9.773771999837688, 473.8396593321167, -7.469228622262568, 446.4815179828382, 19.076182031845505, -728.1722477217634, -32.74939801369254, -630.3775798344819, 738.8873893699594, -573.8610134844721, -446.6412154679471, -81.44896557531685, 53.26976715146859, -242.38976320901043, 67.1603221798273, -329.2898935079372, -324.1827898423323, -321.44037657091184, 198.8107757394546, -203.75914729226645, 449.6270306970997, -888.5501405238665, 176.4443167363505, 217.48527364635112, 1294.2629723870136, 960.0619845726297, 1879.5181875029257, 966.2112678703822, 1196.46700606546, 2425.8185564448218, 1517.4505855462662, 1809.301910339588, 2167.7625009490866, 1958.6497978123646, 1523.7170824353484, 2556.5101616414827, 1679.8834503524204, 1253.1388917548302, 2091.479381473748, 1543.377192445934, 2534.0815908042264, 2767.4643475888847, 3389.023720116725, 4123.789989154723, 4259.087173723706, 2345.737504092044, 1905.1455349067148, 2004.596152400664, 2785.2748265243276, 3344.2652891949497, 3109.2302091788397, 2109.6868351255844, 3877.222458306555, 4421.096870595288, 2486.964052473511, 2920.466435126085], "policy_DC1_ls_policy_reward": [-1554.0330457241166, -3679.826600716275, -2223.235671655472, -3936.934378437615, -4835.633204623035, -3935.2658711542317, -4280.170277657839, -1592.8778760572093, -2819.402722593086, -1757.4586809721857, -4469.4172556810245, -1442.421914904963, -2330.6063066161396, -1027.5105632671498, -266.365693521594, -424.22036533054603, -1862.4681779421983, -2682.274797499476, -2872.0794083860924, -1868.4347713979696, -860.6906135388033, -342.1451432205089, -1045.6433020722977, -2284.4865248776973, -1208.197149076873, -244.3110529122674, 124.89368682527306, 38.529845439929225, -938.6550987030578, 440.37012070112377, -519.6463402368797, 629.0082814214958, 834.6582428826653, 1072.902494755591, 1031.8402532872317, 1094.5456346944834, 1487.8991972834506, 1901.99833154321, 1129.3862696674407, 1583.442255635678, 1224.2847196294438, 922.1252944763551, 1810.4028453729898, 1061.444627238512, 349.3758699962746, 594.1568346474246, 613.4416723024137, 1222.6291248691941, 1131.3563676984043, 1828.0892893591417, 1961.2640183810104, 2207.591718068608, 1675.973229771709, 1385.1397648381785, 1504.6600943264423, 1653.0686201306985, 2517.38167661672, 1843.107757492905, 1577.3062527634665, 2118.8190347489667, 2834.7515694101385, 1946.2148394043302, 1861.9224919890441], "policy_DC2_ls_policy_reward": [2152.1562373117576, 2132.0063670944396, 2039.6085583628937, 2528.7582863050466, 3131.2918489734975, 3406.365838679606, 4306.195320420563, 3215.0398588872085, 3126.661640231981, 3200.9384731195964, 5852.975290467279, 3829.900949275752, 4679.627272322358, 4938.90016128928, 3323.4611941042026, 3426.2850634128945, 3579.6052205890314, 5876.197982853948, 3958.5402441656142, 3458.307184039056, 3350.768012397752, 3546.7676729181503, 4731.487790277938, 7501.375402124674, 4832.931154537201, 3940.5151619511516, 3150.1343004610885, 3261.6646123116243, 5708.767263416871, 3304.292509681259, 4332.823219498272, 4505.205904090123, 3536.445562084573, 2900.5116706736076, 2823.1169190532264, 2934.8053254706565, 6572.574351848665, 4553.712384428778, 2566.267430050524, 3727.266021554279, 3053.9724004553436, 2516.612008463046, 3685.6012926895332, 2652.8406007948165, 2460.49597040429, 2439.3251099822996, 2796.05718043544, 1310.6675224243206, 2767.5217245837543, 3721.458575383507, 4414.542912520604, 3367.7191812789656, -845.3932204569224, -2213.1862638954735, -1732.4392056008246, -1360.3202142472483, -3735.371748769962, -749.4411249209986, -3622.0584289417575, -1700.6510807562279, -1880.3871412682547, -2723.9668480896885, -2912.238245831757], "policy_DC3_ls_policy_reward": [1729.2102293138898, 1146.5513904770853, 1454.321072765194, 708.298311374226, 414.3061483365836, 745.6300258719978, 326.77351793376624, -1854.160312785964, -2997.283131504963, -1256.9178716235062, -675.4111582455179, -1884.1590172007611, -907.7266786910069, -1456.2834577477029, -16.772287240982614, 160.83130641555655, -331.77684273825446, -847.4746454448065, 286.7120481898997, 328.2562228631283, 300.05082452421334, 415.6380541570455, 528.7579195107162, 326.5718043289761, 100.70721550496643, 349.46057336505214, -241.03989151085827, 326.01831061845417, 71.78137375736351, -128.01835247891333, -135.67752305690772, 310.6753674311914, 152.84645450591512, 744.7023045841277, 599.2861409301287, 949.1122759544133, 1121.1203464495982, 1408.8860151535375, 1630.680033737444, 1808.8192260542407, 1165.68277926636, 1485.7289258285869, 1707.248370869794, 1701.4053244344952, 1862.1578428979324, 2342.607934412276, 2488.4261305146074, 2340.1816832306577, 3122.5361953989423, 3148.0800202115247, 4595.0364078, 3563.1405698077056, 2270.740246117648, 2236.4211353114865, 2668.36989237328, 2833.675655643658, 3684.012011325966, 2635.1506960158868, 2749.920210344299, 3718.6004408016447, 4399.016409835495, 3027.7409455877273, 2686.4184821810936]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5932280394691123, "mean_inference_ms": 2.1306458789904146, "mean_action_processing_ms": 0.32169670717693627, "mean_env_wait_ms": 4.325861296416952, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033904635716998388, "StateBufferConnector_ms": 0.00242335455758231, "ViewRequirementAgentConnector_ms": 0.05258738048492916}, "num_episodes": 0, "episode_return_max": 15094.633327856347, "episode_return_min": -2216.1845545339484, "episode_return_mean": 4837.147815125566, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 819200, "num_agent_steps_trained": 819200, "num_env_steps_sampled": 204800, "num_env_steps_trained": 204800, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 592.0392780732483, "num_env_steps_trained_throughput_per_sec": 592.0392780732483, "timesteps_total": 204800, "num_env_steps_sampled_lifetime": 204800, "num_agent_steps_sampled_lifetime": 819200, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 819200, "timers": {"training_iteration_time_ms": 3523.432, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3523.365, "sample_time_ms": 2268.428, "learn_time_ms": 1226.464, "learn_throughput": 1669.841, "synch_weights_time_ms": 10.719}, "counters": {"num_env_steps_sampled": 204800, "num_env_steps_trained": 204800, "num_agent_steps_sampled": 819200, "num_agent_steps_trained": 819200}, "done": false, "training_iteration": 100, "trial_id": "45133_00000", "date": "2024-10-21_22-02-12", "timestamp": 1729548132, "time_this_iter_s": 3.46705961227417, "time_total_s": 351.332231760025, "pid": 3121921, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7feb1a999a20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2e60>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada20b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada2aa0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7feb1ada1c60>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 351.332231760025, "iterations_since_restore": 100, "perf": {"cpu_util_percent": 19.12, "ram_util_percent": 4.0}}

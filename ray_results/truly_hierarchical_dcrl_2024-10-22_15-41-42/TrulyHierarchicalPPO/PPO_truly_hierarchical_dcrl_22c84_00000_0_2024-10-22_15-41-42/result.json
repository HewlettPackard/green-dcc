{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0089390255510806, "cur_kl_coeff": 0.2, "cur_lr": 5e-05, "total_loss": 9.521021199226379, "policy_loss": -0.0027226760750636457, "vf_loss": 9.52350492477417, "vf_explained_var": -0.00020586401224136351, "kl": 0.0011935582207115657, "entropy": 1.4369122743606568, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 20.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.7181392513215542, "cur_kl_coeff": 0.2, "cur_lr": 5e-05, "total_loss": 9.66428620815277, "policy_loss": -0.001073476253077388, "vf_loss": 9.665239500999451, "vf_explained_var": 5.0014257431030275e-05, "kl": 0.0006002782626637782, "entropy": 1.4001756012439728, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 20.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9155681908130646, "cur_kl_coeff": 0.2, "cur_lr": 5e-05, "total_loss": 9.490484285354615, "policy_loss": -0.002726995083503425, "vf_loss": 9.492902326583863, "vf_explained_var": 6.183087825775146e-05, "kl": 0.0015456796088074043, "entropy": 1.3864883691072465, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 20.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0716388285160066, "cur_kl_coeff": 0.2, "cur_lr": 5e-05, "total_loss": 8.902559924125672, "policy_loss": -0.006300867290701717, "vf_loss": 8.908103752136231, "vf_explained_var": 0.0002621456980705261, "kl": 0.0037851569293707145, "entropy": 4.252489197254181, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 20.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 1024, "num_env_steps_trained": 1024, "num_agent_steps_sampled": 4096, "num_agent_steps_trained": 4096}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 4096, "num_agent_steps_trained": 4096, "num_env_steps_sampled": 1024, "num_env_steps_trained": 1024, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 543.4622944380924, "num_env_steps_trained_throughput_per_sec": 543.4622944380924, "timesteps_total": 1024, "num_env_steps_sampled_lifetime": 1024, "num_agent_steps_sampled_lifetime": 4096, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 4096, "timers": {"training_iteration_time_ms": 1884.236, "restore_workers_time_ms": 0.025, "training_step_time_ms": 1884.161, "sample_time_ms": 1179.849, "learn_time_ms": 685.574, "learn_throughput": 1493.639, "synch_weights_time_ms": 11.137}, "counters": {"num_env_steps_sampled": 1024, "num_env_steps_trained": 1024, "num_agent_steps_sampled": 4096, "num_agent_steps_trained": 4096}, "done": false, "training_iteration": 1, "trial_id": "22c84_00000", "date": "2024-10-22_15-41-52", "timestamp": 1729611712, "time_this_iter_s": 1.892061710357666, "time_total_s": 1.892061710357666, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210640>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe115416770>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe115416680>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe115416740>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 1.892061710357666, "iterations_since_restore": 1, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.108378629386425, "cur_kl_coeff": 0.1, "cur_lr": 5e-05, "total_loss": 9.530086016654968, "policy_loss": -0.0001942600356414914, "vf_loss": 9.530258083343506, "vf_explained_var": -0.0011415153741836548, "kl": 0.00022044501758955448, "entropy": 1.448596340417862, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 60.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9219081498682499, "cur_kl_coeff": 0.1, "cur_lr": 5e-05, "total_loss": 9.510957384109497, "policy_loss": -0.00031266920268535614, "vf_loss": 9.511242341995239, "vf_explained_var": -0.0006160438060760498, "kl": 0.00027654460199073584, "entropy": 1.3829432278871536, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 60.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.133066862821579, "cur_kl_coeff": 0.1, "cur_lr": 5e-05, "total_loss": 9.107583498954773, "policy_loss": -0.0029796986491419375, "vf_loss": 9.110362005233764, "vf_explained_var": -0.0005598396062850952, "kl": 0.002013607178696475, "entropy": 1.3235866367816924, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 60.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3797078132629395, "cur_kl_coeff": 0.1, "cur_lr": 5e-05, "total_loss": 8.644377398490906, "policy_loss": -0.0038842875277623535, "vf_loss": 8.64796748161316, "vf_explained_var": 0.0014598816633224487, "kl": 0.0029426951721688967, "entropy": 4.2216291427612305, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 60.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192, "num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 610.1717608938154, "num_env_steps_trained_throughput_per_sec": 610.1717608938154, "timesteps_total": 2048, "num_env_steps_sampled_lifetime": 2048, "num_agent_steps_sampled_lifetime": 8192, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 8192, "timers": {"training_iteration_time_ms": 1781.236, "restore_workers_time_ms": 0.032, "training_step_time_ms": 1781.15, "sample_time_ms": 1105.729, "learn_time_ms": 657.47, "learn_throughput": 1557.485, "synch_weights_time_ms": 10.795}, "counters": {"num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192}, "done": false, "training_iteration": 2, "trial_id": "22c84_00000", "date": "2024-10-22_15-41-54", "timestamp": 1729611714, "time_this_iter_s": 1.6836614608764648, "time_total_s": 3.575723171234131, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fa30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3ab0190>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3ab0130>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3ab0370>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3ad6500>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 3.575723171234131, "iterations_since_restore": 2, "perf": {"cpu_util_percent": 3.066666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6387587293982506, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 8.862405633926391, "policy_loss": -0.004220352228730917, "vf_loss": 8.866520738601684, "vf_explained_var": -0.0014996960759162902, "kl": 0.0021075610690139968, "entropy": 1.439795297384262, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3885322146117687, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 9.352344512939453, "policy_loss": -0.0017607991117984056, "vf_loss": 9.35404691696167, "vf_explained_var": -0.0014474213123321534, "kl": 0.0011730745017701299, "entropy": 1.3826207280158997, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1219998061656953, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 9.665599513053895, "policy_loss": -0.00782396150752902, "vf_loss": 9.673131418228149, "vf_explained_var": -0.0006754308938980103, "kl": 0.0058450866999066875, "entropy": 1.2449605196714402, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2256617128849028, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 8.634312319755555, "policy_loss": -0.005456984369084239, "vf_loss": 8.639449119567871, "vf_explained_var": 0.002591957151889801, "kl": 0.006400002231566759, "entropy": 4.062941509485245, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 3072, "num_env_steps_trained": 3072, "num_agent_steps_sampled": 12288, "num_agent_steps_trained": 12288}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 12288, "num_agent_steps_trained": 12288, "num_env_steps_sampled": 3072, "num_env_steps_trained": 3072, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 600.9932059964326, "num_env_steps_trained_throughput_per_sec": 600.9932059964326, "timesteps_total": 3072, "num_env_steps_sampled_lifetime": 3072, "num_agent_steps_sampled_lifetime": 12288, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 12288, "timers": {"training_iteration_time_ms": 1755.45, "restore_workers_time_ms": 0.036, "training_step_time_ms": 1755.352, "sample_time_ms": 1085.472, "learn_time_ms": 650.142, "learn_throughput": 1575.041, "synch_weights_time_ms": 10.827}, "counters": {"num_env_steps_sampled": 3072, "num_env_steps_trained": 3072, "num_agent_steps_sampled": 12288, "num_agent_steps_trained": 12288}, "done": false, "training_iteration": 3, "trial_id": "22c84_00000", "date": "2024-10-22_15-41-56", "timestamp": 1729611716, "time_this_iter_s": 1.7092349529266357, "time_total_s": 5.284958124160767, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fdff3c8a320>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2106a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2100a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210160>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210220>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 5.284958124160767, "iterations_since_restore": 3, "perf": {"cpu_util_percent": 3.9, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6586419254541398, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 9.295892834663391, "policy_loss": -0.007073958148248493, "vf_loss": 9.302802062034607, "vf_explained_var": -0.0005467057228088379, "kl": 0.006590384013543371, "entropy": 1.3879806846380234, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2983961403369904, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 9.50220491886139, "policy_loss": -0.008539812837261707, "vf_loss": 9.510522508621216, "vf_explained_var": 0.0012384504079818726, "kl": 0.008880397559096309, "entropy": 1.3181640207767487, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.421048952639103, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 9.750034260749818, "policy_loss": -0.001999621884897351, "vf_loss": 9.751819562911987, "vf_explained_var": -0.000804351270198822, "kl": 0.004283718669262418, "entropy": 1.1678229719400406, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6054394602775575, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 7.847682702541351, "policy_loss": -0.006359602464362979, "vf_loss": 7.85372279882431, "vf_explained_var": 0.0011713027954101563, "kl": 0.00639225021941478, "entropy": 3.9448556005954742, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384, "num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 608.2757998710644, "num_env_steps_trained_throughput_per_sec": 608.2757998710644, "timesteps_total": 4096, "num_env_steps_sampled_lifetime": 4096, "num_agent_steps_sampled_lifetime": 16384, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 16384, "timers": {"training_iteration_time_ms": 1737.454, "restore_workers_time_ms": 0.038, "training_step_time_ms": 1737.355, "sample_time_ms": 1072.726, "learn_time_ms": 645.486, "learn_throughput": 1586.401, "synch_weights_time_ms": 10.779}, "counters": {"num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384}, "done": false, "training_iteration": 4, "trial_id": "22c84_00000", "date": "2024-10-22_15-41-58", "timestamp": 1729611718, "time_this_iter_s": 1.6890783309936523, "time_total_s": 6.974036455154419, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210400>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2104f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210760>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210850>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 6.974036455154419, "iterations_since_restore": 4, "perf": {"cpu_util_percent": 3.1666666666666665, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4492678210139274, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 9.427218794822693, "policy_loss": -0.008007630985230208, "vf_loss": 9.434994101524353, "vf_explained_var": 0.0011357679963111878, "kl": 0.009290742215907245, "entropy": 1.289735409617424, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7249604925513267, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 9.654871344566345, "policy_loss": -0.0015969456173479557, "vf_loss": 9.656459188461303, "vf_explained_var": 0.0007599711418151856, "kl": 0.0003597485228340247, "entropy": 1.2884795576334, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5430285155773162, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 9.829947113990784, "policy_loss": -0.007246058317832649, "vf_loss": 9.836955499649047, "vf_explained_var": -0.0006557777523994446, "kl": 0.009506991411331, "entropy": 1.131585383415222, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.253305435180664, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 8.061660993099213, "policy_loss": -0.008592897653579712, "vf_loss": 8.069792687892914, "vf_explained_var": -0.005068030953407287, "kl": 0.009225314285322634, "entropy": 3.90015994310379, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 5120, "num_env_steps_trained": 5120, "num_agent_steps_sampled": 20480, "num_agent_steps_trained": 20480}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 20480, "num_agent_steps_trained": 20480, "num_env_steps_sampled": 5120, "num_env_steps_trained": 5120, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 548.2826617149366, "num_env_steps_trained_throughput_per_sec": 548.2826617149366, "timesteps_total": 5120, "num_env_steps_sampled_lifetime": 5120, "num_agent_steps_sampled_lifetime": 20480, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 20480, "timers": {"training_iteration_time_ms": 1763.498, "restore_workers_time_ms": 0.04, "training_step_time_ms": 1763.394, "sample_time_ms": 1099.926, "learn_time_ms": 643.442, "learn_throughput": 1591.44, "synch_weights_time_ms": 10.986}, "counters": {"num_env_steps_sampled": 5120, "num_env_steps_trained": 5120, "num_agent_steps_sampled": 20480, "num_agent_steps_trained": 20480}, "done": false, "training_iteration": 5, "trial_id": "22c84_00000", "date": "2024-10-22_15-41-59", "timestamp": 1729611719, "time_this_iter_s": 1.874173641204834, "time_total_s": 8.848210096359253, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fa30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210a30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210b20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210be0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210ca0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 8.848210096359253, "iterations_since_restore": 5, "perf": {"cpu_util_percent": 3.95, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8582609698176384, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 9.650366854667663, "policy_loss": -0.0015104613732546568, "vf_loss": 9.651825428009033, "vf_explained_var": 0.0019065693020820617, "kl": 0.002078423997809864, "entropy": 1.2156408876180649, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4915426269173622, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 9.591104006767273, "policy_loss": -0.0064527010545134544, "vf_loss": 9.597467494010925, "vf_explained_var": 0.0008427679538726806, "kl": 0.007148792777684321, "entropy": 1.2891238063573838, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7958255290985108, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 9.672733855247497, "policy_loss": -0.004914530459791422, "vf_loss": 9.677556943893432, "vf_explained_var": -0.00013868659734725953, "kl": 0.0036638958159528555, "entropy": 1.0528738707304002, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.053333479166031, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 8.361785292625427, "policy_loss": -0.004718395275995135, "vf_loss": 8.366231405735016, "vf_explained_var": -0.0021412640810012816, "kl": 0.005441272905500227, "entropy": 3.7767116248607637, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576, "num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 589.8550066299109, "num_env_steps_trained_throughput_per_sec": 589.8550066299109, "timesteps_total": 6144, "num_env_steps_sampled_lifetime": 6144, "num_agent_steps_sampled_lifetime": 24576, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 24576, "timers": {"training_iteration_time_ms": 1758.927, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1758.814, "sample_time_ms": 1098.121, "learn_time_ms": 640.994, "learn_throughput": 1597.518, "synch_weights_time_ms": 10.89}, "counters": {"num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576}, "done": false, "training_iteration": 6, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-01", "timestamp": 1729611721, "time_this_iter_s": 1.742659330368042, "time_total_s": 10.590869426727295, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2112a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2113c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211480>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3ad6770>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 10.590869426727295, "iterations_since_restore": 6, "perf": {"cpu_util_percent": 3.366666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.214213804900646, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 9.585170435905457, "policy_loss": -0.004741780715994537, "vf_loss": 9.589855670928955, "vf_explained_var": 0.0001164257526397705, "kl": 0.004532700437266612, "entropy": 1.1579957991838454, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3737192407250405, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 9.853586769104004, "policy_loss": -0.0007128470577299594, "vf_loss": 9.854274678230286, "vf_explained_var": -0.002337028086185455, "kl": 0.0020050418763732066, "entropy": 1.2398004919290542, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8875655382871628, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 9.832349157333374, "policy_loss": -0.0009451616206206381, "vf_loss": 9.833284759521485, "vf_explained_var": -0.003629869222640991, "kl": 0.0007678185487296097, "entropy": 1.0604023218154908, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.173583507537842, "cur_kl_coeff": 0.05, "cur_lr": 5e-05, "total_loss": 8.607091557979583, "policy_loss": -0.002055623033083975, "vf_loss": 8.608954548835754, "vf_explained_var": 0.0012762665748596192, "kl": 0.0038554058866566267, "entropy": 3.692421394586563, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 7168, "num_env_steps_trained": 7168, "num_agent_steps_sampled": 28672, "num_agent_steps_trained": 28672}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 28672, "num_agent_steps_trained": 28672, "num_env_steps_sampled": 7168, "num_env_steps_trained": 7168, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 578.8923455562093, "num_env_steps_trained_throughput_per_sec": 578.8923455562093, "timesteps_total": 7168, "num_env_steps_sampled_lifetime": 7168, "num_agent_steps_sampled_lifetime": 28672, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 28672, "timers": {"training_iteration_time_ms": 1760.355, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1760.242, "sample_time_ms": 1101.883, "learn_time_ms": 638.973, "learn_throughput": 1602.571, "synch_weights_time_ms": 10.831}, "counters": {"num_env_steps_sampled": 7168, "num_env_steps_trained": 7168, "num_agent_steps_sampled": 28672, "num_agent_steps_trained": 28672}, "done": false, "training_iteration": 7, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-03", "timestamp": 1729611723, "time_this_iter_s": 1.7759790420532227, "time_total_s": 12.366848468780518, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a32e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210310>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210d60>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2114b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211570>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 12.366848468780518, "iterations_since_restore": 7, "perf": {"cpu_util_percent": 4.05, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.592600767314434, "cur_kl_coeff": 0.00625, "cur_lr": 5e-05, "total_loss": 9.676291251182557, "policy_loss": -0.002883162349462509, "vf_loss": 9.679158186912536, "vf_explained_var": -0.0001363009214401245, "kl": 0.002599868397555838, "entropy": 1.179545909166336, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.004288323223591, "cur_kl_coeff": 0.00625, "cur_lr": 5e-05, "total_loss": 9.697708010673523, "policy_loss": -0.00268592752981931, "vf_loss": 9.700371050834656, "vf_explained_var": -0.0002160295844078064, "kl": 0.003623756376353526, "entropy": 1.2439989417791366, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.843067115545273, "cur_kl_coeff": 0.00625, "cur_lr": 5e-05, "total_loss": 9.868274807929993, "policy_loss": -0.003803448146209121, "vf_loss": 9.872055268287658, "vf_explained_var": 9.63062047958374e-05, "kl": 0.0036930442112182117, "entropy": 1.0200464680790902, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9615573942661286, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 8.349412953853607, "policy_loss": -0.006390630989335478, "vf_loss": 8.355563676357269, "vf_explained_var": 0.0035496532917022707, "kl": 0.009597512820983388, "entropy": 3.5762640655040743, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768, "num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 523.3461430435923, "num_env_steps_trained_throughput_per_sec": 523.3461430435923, "timesteps_total": 8192, "num_env_steps_sampled_lifetime": 8192, "num_agent_steps_sampled_lifetime": 32768, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 32768, "timers": {"training_iteration_time_ms": 1784.893, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1784.782, "sample_time_ms": 1128.302, "learn_time_ms": 637.276, "learn_throughput": 1606.84, "synch_weights_time_ms": 10.786}, "counters": {"num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768}, "done": false, "training_iteration": 8, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-05", "timestamp": 1729611725, "time_this_iter_s": 1.9626905918121338, "time_total_s": 14.329539060592651, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fa30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211750>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211840>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211900>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2119c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 14.329539060592651, "iterations_since_restore": 8, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9882713630795479, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 9.729947113990784, "policy_loss": -0.004089505679439753, "vf_loss": 9.734027290344239, "vf_explained_var": -0.001171410083770752, "kl": 0.003063021309390024, "entropy": 1.2108705341815948, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.215155726671219, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 9.874687838554383, "policy_loss": -0.0033337537897750735, "vf_loss": 9.878006291389465, "vf_explained_var": -0.00013621598482131957, "kl": 0.004931878702882387, "entropy": 1.2817965775728226, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9160484492778778, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 9.725853061676025, "policy_loss": -0.0031726064975373448, "vf_loss": 9.729016065597534, "vf_explained_var": 5.7110190391540526e-05, "kl": 0.0030475518463394025, "entropy": 1.0041936218738556, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.269905763864517, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 7.675887608528138, "policy_loss": -0.007028969167731702, "vf_loss": 7.682698547840118, "vf_explained_var": 0.0034046441316604613, "kl": 0.008719007485706243, "entropy": 3.5677832782268526, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 9216, "num_env_steps_trained": 9216, "num_agent_steps_sampled": 36864, "num_agent_steps_trained": 36864}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 36864, "num_agent_steps_trained": 36864, "num_env_steps_sampled": 9216, "num_env_steps_trained": 9216, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 555.0121788302916, "num_env_steps_trained_throughput_per_sec": 555.0121788302916, "timesteps_total": 9216, "num_env_steps_sampled_lifetime": 9216, "num_agent_steps_sampled_lifetime": 36864, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 36864, "timers": {"training_iteration_time_ms": 1791.575, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1791.463, "sample_time_ms": 1135.316, "learn_time_ms": 636.822, "learn_throughput": 1607.984, "synch_weights_time_ms": 10.808}, "counters": {"num_env_steps_sampled": 9216, "num_env_steps_trained": 9216, "num_agent_steps_sampled": 36864, "num_agent_steps_trained": 36864}, "done": false, "training_iteration": 9, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-07", "timestamp": 1729611727, "time_this_iter_s": 1.851022481918335, "time_total_s": 16.180561542510986, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211ba0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211c90>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211d50>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211e10>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 16.180561542510986, "iterations_since_restore": 9, "perf": {"cpu_util_percent": 3.3333333333333335, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6904778137803078, "cur_kl_coeff": 0.0015625, "cur_lr": 5e-05, "total_loss": 9.828337359428406, "policy_loss": -0.0011011652648448944, "vf_loss": 9.829437375068665, "vf_explained_var": -0.005093145370483399, "kl": 0.0006960203364316478, "entropy": 1.2069898784160613, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6080769091844558, "cur_kl_coeff": 0.0015625, "cur_lr": 5e-05, "total_loss": 9.804242897033692, "policy_loss": -0.0027676859986968338, "vf_loss": 9.80700523853302, "vf_explained_var": -0.000280153751373291, "kl": 0.0033969727027113096, "entropy": 1.2698870480060578, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9177559226751328, "cur_kl_coeff": 0.0015625, "cur_lr": 5e-05, "total_loss": 9.760516142845153, "policy_loss": -0.0037376351770944892, "vf_loss": 9.764246773719787, "vf_explained_var": -0.0013744562864303588, "kl": 0.004489267183180346, "entropy": 1.0163282558321953, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.3919708877801895, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 7.782530498504639, "policy_loss": -0.005104391905479133, "vf_loss": 7.787478148937225, "vf_explained_var": -0.0029384702444076537, "kl": 0.0062716721614378915, "entropy": 3.597904455661774, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960, "num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 573.1425231487289, "num_env_steps_trained_throughput_per_sec": 573.1425231487289, "timesteps_total": 10240, "num_env_steps_sampled_lifetime": 10240, "num_agent_steps_sampled_lifetime": 40960, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 40960, "timers": {"training_iteration_time_ms": 1791.084, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1790.973, "sample_time_ms": 1135.496, "learn_time_ms": 636.238, "learn_throughput": 1609.46, "synch_weights_time_ms": 10.846}, "counters": {"num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960}, "done": false, "training_iteration": 10, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-09", "timestamp": 1729611729, "time_this_iter_s": 1.7931013107299805, "time_total_s": 17.973662853240967, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3eb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211ff0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2120e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2121a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212260>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 17.973662853240967, "iterations_since_restore": 10, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8091753005981446, "cur_kl_coeff": 0.00078125, "cur_lr": 5e-05, "total_loss": 9.755357885360718, "policy_loss": -0.005687926034443081, "vf_loss": 9.761040925979614, "vf_explained_var": -0.006367218494415283, "kl": 0.006264029076965017, "entropy": 1.1625678688287735, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4487283848226071, "cur_kl_coeff": 0.00078125, "cur_lr": 5e-05, "total_loss": 9.73508698940277, "policy_loss": -0.0031351113691926004, "vf_loss": 9.738218760490417, "vf_explained_var": -0.00013156086206436157, "kl": 0.003992441748960239, "entropy": 1.2762783110141753, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.5515478059649466, "cur_kl_coeff": 0.00078125, "cur_lr": 5e-05, "total_loss": 9.743804931640625, "policy_loss": 0.0007452244870364666, "vf_loss": 9.743059587478637, "vf_explained_var": -0.003413626551628113, "kl": 0.00022947123506043, "entropy": 0.9848958566784859, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.800220265984535, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 7.66672819852829, "policy_loss": -0.004679377796128393, "vf_loss": 7.671265888214111, "vf_explained_var": -0.003548005223274231, "kl": 0.005668007713211696, "entropy": 3.6359501659870146, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 11264, "num_env_steps_trained": 11264, "num_agent_steps_sampled": 45056, "num_agent_steps_trained": 45056}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 45056, "num_agent_steps_trained": 45056, "num_env_steps_sampled": 11264, "num_env_steps_trained": 11264, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 567.8929142820272, "num_env_steps_trained_throughput_per_sec": 567.8929142820272, "timesteps_total": 11264, "num_env_steps_sampled_lifetime": 11264, "num_agent_steps_sampled_lifetime": 45056, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 45056, "timers": {"training_iteration_time_ms": 1782.979, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1782.863, "sample_time_ms": 1130.908, "learn_time_ms": 632.739, "learn_throughput": 1618.36, "synch_weights_time_ms": 10.821}, "counters": {"num_env_steps_sampled": 11264, "num_env_steps_trained": 11264, "num_agent_steps_sampled": 45056, "num_agent_steps_trained": 45056}, "done": false, "training_iteration": 11, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-11", "timestamp": 1729611731, "time_this_iter_s": 1.808687686920166, "time_total_s": 19.782350540161133, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212890>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212980>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212a40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212b00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 19.782350540161133, "iterations_since_restore": 11, "perf": {"cpu_util_percent": 3.233333333333334, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9332342594861984, "cur_kl_coeff": 0.00078125, "cur_lr": 5e-05, "total_loss": 9.762290453910827, "policy_loss": -0.002340626553632319, "vf_loss": 9.764629673957824, "vf_explained_var": -0.001469777524471283, "kl": 0.0019436083271189952, "entropy": 1.0944055914878845, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.854530829191208, "cur_kl_coeff": 0.000390625, "cur_lr": 5e-05, "total_loss": 9.401275944709777, "policy_loss": -0.002107990742661059, "vf_loss": 9.403383421897889, "vf_explained_var": -0.00034214258193969725, "kl": 0.001752310538336231, "entropy": 1.306947159767151, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.963858897984028, "cur_kl_coeff": 0.000390625, "cur_lr": 5e-05, "total_loss": 9.800426721572876, "policy_loss": -0.0007990151178091764, "vf_loss": 9.801225543022156, "vf_explained_var": -0.004124778509140015, "kl": 0.00045519558682405314, "entropy": 0.9913866713643074, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.410521858930588, "cur_kl_coeff": 0.025, "cur_lr": 5e-05, "total_loss": 8.010678935050965, "policy_loss": -0.0035413476871326566, "vf_loss": 8.014125311374665, "vf_explained_var": 4.191696643829346e-05, "kl": 0.0038032176397795477, "entropy": 3.6596840500831602, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152, "num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 573.2397496411385, "num_env_steps_trained_throughput_per_sec": 573.2397496411385, "timesteps_total": 12288, "num_env_steps_sampled_lifetime": 12288, "num_agent_steps_sampled_lifetime": 49152, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 49152, "timers": {"training_iteration_time_ms": 1793.791, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1793.674, "sample_time_ms": 1137.929, "learn_time_ms": 635.838, "learn_throughput": 1610.472, "synch_weights_time_ms": 10.882}, "counters": {"num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152}, "done": false, "training_iteration": 12, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-12", "timestamp": 1729611732, "time_this_iter_s": 1.7919855117797852, "time_total_s": 21.574336051940918, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3a30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211b40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211f30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211ff0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2120b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 21.574336051940918, "iterations_since_restore": 12, "perf": {"cpu_util_percent": 3.266666666666666, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4884875982999803, "cur_kl_coeff": 0.000390625, "cur_lr": 5e-05, "total_loss": 9.709098410606384, "policy_loss": -0.0028045579325407743, "vf_loss": 9.711901068687439, "vf_explained_var": -0.007528170943260193, "kl": 0.004796485700842538, "entropy": 1.0467445835471154, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6895618706941604, "cur_kl_coeff": 0.0001953125, "cur_lr": 5e-05, "total_loss": 9.77138123512268, "policy_loss": -0.0009124157018959522, "vf_loss": 9.772293281555175, "vf_explained_var": -0.000545954704284668, "kl": 0.0008334216840808039, "entropy": 1.300582504272461, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.944268611073494, "cur_kl_coeff": 0.0001953125, "cur_lr": 5e-05, "total_loss": 9.841159057617187, "policy_loss": -0.0013045055558905006, "vf_loss": 9.8424635887146, "vf_explained_var": -0.004455441236495971, "kl": 0.0006529051827672702, "entropy": 0.9909753173589706, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.351847851276398, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 8.099895668029784, "policy_loss": -0.004531963542103767, "vf_loss": 8.104336380958557, "vf_explained_var": 0.002311842143535614, "kl": 0.007301995389525473, "entropy": 3.674595308303833, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 13312, "num_env_steps_trained": 13312, "num_agent_steps_sampled": 53248, "num_agent_steps_trained": 53248}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 53248, "num_agent_steps_trained": 53248, "num_env_steps_sampled": 13312, "num_env_steps_trained": 13312, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 526.574343116493, "num_env_steps_trained_throughput_per_sec": 526.574343116493, "timesteps_total": 13312, "num_env_steps_sampled_lifetime": 13312, "num_agent_steps_sampled_lifetime": 53248, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 53248, "timers": {"training_iteration_time_ms": 1817.87, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1817.754, "sample_time_ms": 1160.874, "learn_time_ms": 637.519, "learn_throughput": 1606.227, "synch_weights_time_ms": 10.818}, "counters": {"num_env_steps_sampled": 13312, "num_env_steps_trained": 13312, "num_agent_steps_sampled": 53248, "num_agent_steps_trained": 53248}, "done": false, "training_iteration": 13, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-14", "timestamp": 1729611734, "time_this_iter_s": 1.9505140781402588, "time_total_s": 23.524850130081177, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3eb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2109d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212110>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210a30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210b50>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 23.524850130081177, "iterations_since_restore": 13, "perf": {"cpu_util_percent": 3.95, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.893376035988331, "cur_kl_coeff": 0.0001953125, "cur_lr": 5e-05, "total_loss": 9.757255816459656, "policy_loss": 0.0008888270240277052, "vf_loss": 9.75636682510376, "vf_explained_var": 0.001552438735961914, "kl": 0.0010674265512765845, "entropy": 0.9511507362127304, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1722477227449417, "cur_kl_coeff": 9.765625e-05, "cur_lr": 5e-05, "total_loss": 9.366776871681214, "policy_loss": -0.003600054979324341, "vf_loss": 9.370376563072204, "vf_explained_var": -3.794431686401367e-05, "kl": 0.004557105807134576, "entropy": 1.2113040447235108, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.219521088898182, "cur_kl_coeff": 9.765625e-05, "cur_lr": 5e-05, "total_loss": 9.741427040100097, "policy_loss": -0.0021795702166855337, "vf_loss": 9.743606615066529, "vf_explained_var": -0.0022538334131240846, "kl": 0.0019870453101475507, "entropy": 0.9863028421998024, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.9940331250429155, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 7.298321270942688, "policy_loss": -0.0030291481874883176, "vf_loss": 7.301273787021637, "vf_explained_var": 0.001969204843044281, "kl": 0.006140264029454556, "entropy": 3.627888911962509, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344, "num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 565.6996000295562, "num_env_steps_trained_throughput_per_sec": 565.6996000295562, "timesteps_total": 14336, "num_env_steps_sampled_lifetime": 14336, "num_agent_steps_sampled_lifetime": 57344, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 57344, "timers": {"training_iteration_time_ms": 1830.54, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1830.424, "sample_time_ms": 1170.696, "learn_time_ms": 639.859, "learn_throughput": 1600.353, "synch_weights_time_ms": 10.802}, "counters": {"num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344}, "done": false, "training_iteration": 14, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-16", "timestamp": 1729611736, "time_this_iter_s": 1.8156886100769043, "time_total_s": 25.34053874015808, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211e40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211db0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211cf0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2102b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 25.34053874015808, "iterations_since_restore": 14, "perf": {"cpu_util_percent": 3.3666666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7823834016919136, "cur_kl_coeff": 9.765625e-05, "cur_lr": 5e-05, "total_loss": 9.719160676002502, "policy_loss": -0.0022895090631209316, "vf_loss": 9.721450304985046, "vf_explained_var": -0.0034436792135238647, "kl": 0.0030069203648963594, "entropy": 0.9111735999584198, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.688220065832138, "cur_kl_coeff": 4.8828125e-05, "cur_lr": 5e-05, "total_loss": 9.727815055847168, "policy_loss": -0.004726136871613562, "vf_loss": 9.732541227340699, "vf_explained_var": -0.000482410192489624, "kl": 0.004279944204120057, "entropy": 1.2388163536787034, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1140417620539664, "cur_kl_coeff": 4.8828125e-05, "cur_lr": 5e-05, "total_loss": 9.615142798423767, "policy_loss": -0.003108622250147164, "vf_loss": 9.618251466751099, "vf_explained_var": -0.0029065728187561033, "kl": 0.002186687347773715, "entropy": 1.028382483124733, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.53757826089859, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 7.165564608573914, "policy_loss": -0.002833773323800415, "vf_loss": 7.1683220863342285, "vf_explained_var": -0.0015478163957595825, "kl": 0.006097391773073469, "entropy": 3.5783244490623476, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 15360, "num_env_steps_trained": 15360, "num_agent_steps_sampled": 61440, "num_agent_steps_trained": 61440}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 61440, "num_agent_steps_trained": 61440, "num_env_steps_sampled": 15360, "num_env_steps_trained": 15360, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 570.4259322517427, "num_env_steps_trained_throughput_per_sec": 570.4259322517427, "timesteps_total": 15360, "num_env_steps_sampled_lifetime": 15360, "num_agent_steps_sampled_lifetime": 61440, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 61440, "timers": {"training_iteration_time_ms": 1823.291, "restore_workers_time_ms": 0.048, "training_step_time_ms": 1823.171, "sample_time_ms": 1161.52, "learn_time_ms": 642.076, "learn_throughput": 1594.827, "synch_weights_time_ms": 10.911}, "counters": {"num_env_steps_sampled": 15360, "num_env_steps_trained": 15360, "num_agent_steps_sampled": 61440, "num_agent_steps_trained": 61440}, "done": false, "training_iteration": 15, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-18", "timestamp": 1729611738, "time_this_iter_s": 1.8014020919799805, "time_total_s": 27.14194083213806, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3a30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210130>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2100a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210670>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210610>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 27.14194083213806, "iterations_since_restore": 15, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0796153992414474, "cur_kl_coeff": 4.8828125e-05, "cur_lr": 5e-05, "total_loss": 9.811213994026184, "policy_loss": -0.0027722194558009506, "vf_loss": 9.813986253738403, "vf_explained_var": -0.0018578723073005676, "kl": 0.0031035274491159727, "entropy": 0.9790730118751526, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1107175171375276, "cur_kl_coeff": 2.44140625e-05, "cur_lr": 5e-05, "total_loss": 9.757537698745727, "policy_loss": -0.004399908822961152, "vf_loss": 9.761937737464905, "vf_explained_var": -0.0006977617740631104, "kl": 0.00431487069549803, "entropy": 1.303593498468399, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8336988210678102, "cur_kl_coeff": 2.44140625e-05, "cur_lr": 5e-05, "total_loss": 9.658835196495057, "policy_loss": -0.004537373734638095, "vf_loss": 9.663372611999511, "vf_explained_var": -0.005817568302154541, "kl": 0.004618371651065445, "entropy": 0.9781648471951485, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.379677823185921, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 8.510753309726715, "policy_loss": -0.004842722928151489, "vf_loss": 8.515501832962036, "vf_explained_var": -0.002358284592628479, "kl": 0.007517544103030141, "entropy": 3.526765650510788, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536, "num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 525.4044202567638, "num_env_steps_trained_throughput_per_sec": 525.4044202567638, "timesteps_total": 16384, "num_env_steps_sampled_lifetime": 16384, "num_agent_steps_sampled_lifetime": 65536, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 65536, "timers": {"training_iteration_time_ms": 1844.585, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1844.469, "sample_time_ms": 1180.347, "learn_time_ms": 644.349, "learn_throughput": 1589.201, "synch_weights_time_ms": 10.879}, "counters": {"num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536}, "done": false, "training_iteration": 16, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-20", "timestamp": 1729611740, "time_this_iter_s": 1.9558005332946777, "time_total_s": 29.09774136543274, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212ef0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212fe0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2130a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213160>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 29.09774136543274, "iterations_since_restore": 16, "perf": {"cpu_util_percent": 3.9, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9599809914827346, "cur_kl_coeff": 2.44140625e-05, "cur_lr": 5e-05, "total_loss": 9.833375191688537, "policy_loss": -0.0011490491684526204, "vf_loss": 9.834524369239807, "vf_explained_var": -0.00594409853219986, "kl": 0.0019691106992418385, "entropy": 1.0128954216837882, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1128397211432457, "cur_kl_coeff": 1.220703125e-05, "cur_lr": 5e-05, "total_loss": 9.025272655487061, "policy_loss": -0.0029039029963314534, "vf_loss": 9.028176403045654, "vf_explained_var": -0.0010589897632598878, "kl": 0.0023349116314420825, "entropy": 1.355047869682312, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7886432513594628, "cur_kl_coeff": 1.220703125e-05, "cur_lr": 5e-05, "total_loss": 9.827776074409485, "policy_loss": -0.0016991785378195345, "vf_loss": 9.829475378990173, "vf_explained_var": -0.003446871042251587, "kl": 0.00100463126818795, "entropy": 0.9675532266497612, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.957726627588272, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 7.505968952178955, "policy_loss": -0.007097880612127483, "vf_loss": 7.512944686412811, "vf_explained_var": -0.0007479727268218994, "kl": 0.009779506351242162, "entropy": 3.4454030871391295, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 17408, "num_env_steps_trained": 17408, "num_agent_steps_sampled": 69632, "num_agent_steps_trained": 69632}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 69632, "num_agent_steps_trained": 69632, "num_env_steps_sampled": 17408, "num_env_steps_trained": 17408, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 580.5331749188836, "num_env_steps_trained_throughput_per_sec": 580.5331749188836, "timesteps_total": 17408, "num_env_steps_sampled_lifetime": 17408, "num_agent_steps_sampled_lifetime": 69632, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 69632, "timers": {"training_iteration_time_ms": 1844.085, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1843.969, "sample_time_ms": 1177.366, "learn_time_ms": 646.781, "learn_throughput": 1583.226, "synch_weights_time_ms": 10.895}, "counters": {"num_env_steps_sampled": 17408, "num_env_steps_trained": 17408, "num_agent_steps_sampled": 69632, "num_agent_steps_trained": 69632}, "done": false, "training_iteration": 17, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-22", "timestamp": 1729611742, "time_this_iter_s": 1.7692995071411133, "time_total_s": 30.867040872573853, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3be0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3ab3b80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3ab0790>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3ab0b20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210b20>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 30.867040872573853, "iterations_since_restore": 17, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7679258748888969, "cur_kl_coeff": 1.220703125e-05, "cur_lr": 5e-05, "total_loss": 9.729999113082886, "policy_loss": -0.003496267506852746, "vf_loss": 9.733495235443115, "vf_explained_var": -0.0040737509727478026, "kl": 0.002637374689606986, "entropy": 1.0918144136667252, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3416190303862097, "cur_kl_coeff": 6.103515625e-06, "cur_lr": 5e-05, "total_loss": 9.499048614501953, "policy_loss": -0.002433962095528841, "vf_loss": 9.50148274898529, "vf_explained_var": -0.0012599676847457886, "kl": 0.0018144951761769335, "entropy": 1.380713027715683, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.927160780131817, "cur_kl_coeff": 6.103515625e-06, "cur_lr": 5e-05, "total_loss": 9.761301517486572, "policy_loss": -0.003117165993899107, "vf_loss": 9.764418816566467, "vf_explained_var": -0.0038217753171920776, "kl": 0.003071434165355408, "entropy": 0.9458944603800774, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4957749634981155, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 8.517155647277832, "policy_loss": -0.005068412446416914, "vf_loss": 8.522110521793365, "vf_explained_var": 0.0015794426202774049, "kl": 0.009078664842218132, "entropy": 3.347387659549713, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728, "num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 571.8224133725716, "num_env_steps_trained_throughput_per_sec": 571.8224133725716, "timesteps_total": 18432, "num_env_steps_sampled_lifetime": 18432, "num_agent_steps_sampled_lifetime": 73728, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 73728, "timers": {"training_iteration_time_ms": 1827.498, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1827.381, "sample_time_ms": 1158.016, "learn_time_ms": 649.243, "learn_throughput": 1577.22, "synch_weights_time_ms": 11.04}, "counters": {"num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728}, "done": false, "training_iteration": 18, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-24", "timestamp": 1729611744, "time_this_iter_s": 1.7966632843017578, "time_total_s": 32.66370415687561, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1543a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2112d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211480>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211660>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2117b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 32.66370415687561, "iterations_since_restore": 18, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.21021958142519, "cur_kl_coeff": 6.103515625e-06, "cur_lr": 5e-05, "total_loss": 9.718401026725768, "policy_loss": -0.0008108580019325018, "vf_loss": 9.719211745262147, "vf_explained_var": -0.00162850022315979, "kl": 0.0015256317446869616, "entropy": 1.152237981557846, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6172663614153862, "cur_kl_coeff": 3.0517578125e-06, "cur_lr": 5e-05, "total_loss": 9.20868980884552, "policy_loss": -4.883743822574616e-05, "vf_loss": 9.208738780021667, "vf_explained_var": -0.004042574763298034, "kl": 0.0007275997646047471, "entropy": 1.3716352194547654, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9614850163459778, "cur_kl_coeff": 3.0517578125e-06, "cur_lr": 5e-05, "total_loss": 9.587971591949463, "policy_loss": -0.0014515048591420055, "vf_loss": 9.589423155784607, "vf_explained_var": -0.004623749852180481, "kl": 0.001452808144596454, "entropy": 0.8760992258787155, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.729780209064484, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 8.039861059188842, "policy_loss": -0.0035450990544632077, "vf_loss": 8.043305122852326, "vf_explained_var": 0.001725912094116211, "kl": 0.008083806741160516, "entropy": 3.2678533256053925, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 19456, "num_env_steps_trained": 19456, "num_agent_steps_sampled": 77824, "num_agent_steps_trained": 77824}, "env_runners": {"episode_reward_max": 4566.322711289452, "episode_reward_min": 4248.648906342018, "episode_reward_mean": 4407.485808815734, "episode_len_mean": 2400.0, "episode_media": {}, "episodes_timesteps_total": 4800, "policy_reward_min": {"high_level_policy": 1999.4675817606794, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 2054.3276835436923, "DC3_ls_policy": 1791.5711525315492}, "policy_reward_max": {"high_level_policy": 2400.00109806875, "DC1_ls_policy": -1680.2320649328985, "DC2_ls_policy": 2137.8422369826835, "DC3_ls_policy": 2008.3013673458254}, "policy_reward_mean": {"high_level_policy": 2199.734339914715, "DC1_ls_policy": -1788.2697513008634, "DC2_ls_policy": 2096.084960263188, "DC3_ls_policy": 1899.9362599386873}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 92039.38619281995, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.21999999999999997, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.15958333333333333, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.036458333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 2.94, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 71810.92548700084, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 73248.38773762801, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 75321.88957195586, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 76031.18307205845, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.12125000000000001, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.2325, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 70711055.49443987, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 72231511.61544786, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 55.0371875, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 46.36708333333333, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 63.70729166666667, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 716.21609375, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 752.8836458333334}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018], "episode_lengths": [2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6086873851388852, "mean_inference_ms": 2.228799593384943, "mean_action_processing_ms": 0.32441517084751215, "mean_env_wait_ms": 4.255943958817125, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.004851818084716797, "StateBufferConnector_ms": 0.0024437904357910156, "ViewRequirementAgentConnector_ms": 0.05384087562561035}, "num_episodes": 2, "episode_return_max": 4566.322711289452, "episode_return_min": 4248.648906342018, "episode_return_mean": 4407.485808815734, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 77824, "num_agent_steps_trained": 77824, "num_env_steps_sampled": 19456, "num_env_steps_trained": 19456, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 584.6679558954173, "num_env_steps_trained_throughput_per_sec": 584.6679558954173, "timesteps_total": 19456, "num_env_steps_sampled_lifetime": 19456, "num_agent_steps_sampled_lifetime": 77824, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 77824, "timers": {"training_iteration_time_ms": 1818.14, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1818.022, "sample_time_ms": 1147.312, "learn_time_ms": 650.786, "learn_throughput": 1573.482, "synch_weights_time_ms": 11.028}, "counters": {"num_env_steps_sampled": 19456, "num_env_steps_trained": 19456, "num_agent_steps_sampled": 77824, "num_agent_steps_trained": 77824}, "done": false, "training_iteration": 19, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-26", "timestamp": 1729611746, "time_this_iter_s": 1.7587041854858398, "time_total_s": 34.42240834236145, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2132b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2133a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213460>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213520>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 34.42240834236145, "iterations_since_restore": 19, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1852241829037666, "cur_kl_coeff": 3.0517578125e-06, "cur_lr": 5e-05, "total_loss": 9.785584545135498, "policy_loss": -0.0029985178844071925, "vf_loss": 9.788583159446716, "vf_explained_var": -0.001202128827571869, "kl": 0.002396747397915533, "entropy": 1.1152465105056764, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.250185604393482, "cur_kl_coeff": 1.52587890625e-06, "cur_lr": 5e-05, "total_loss": 8.571557664871216, "policy_loss": -0.001996633969247341, "vf_loss": 8.573554301261902, "vf_explained_var": -0.01831951141357422, "kl": 0.00047901195959809684, "entropy": 1.3347071290016175, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7575136706233025, "cur_kl_coeff": 1.52587890625e-06, "cur_lr": 5e-05, "total_loss": 9.546794724464416, "policy_loss": -0.002608949108980596, "vf_loss": 9.549403762817382, "vf_explained_var": -0.0028166741132736204, "kl": 0.0026838440659511117, "entropy": 0.8217056035995484, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.139092588424683, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 8.076000881195068, "policy_loss": -0.009924736991524696, "vf_loss": 8.085757410526275, "vf_explained_var": 0.00025892555713653566, "kl": 0.013452231609199625, "entropy": 3.2201500058174135, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920}, "env_runners": {"episode_reward_max": 4566.322711289452, "episode_reward_min": 4248.648906342018, "episode_reward_mean": 4407.485808815734, "episode_len_mean": 2400.0, "episode_media": {}, "episodes_timesteps_total": 4800, "policy_reward_min": {"high_level_policy": 1999.4675817606794, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 2054.3276835436923, "DC3_ls_policy": 1791.5711525315492}, "policy_reward_max": {"high_level_policy": 2400.00109806875, "DC1_ls_policy": -1680.2320649328985, "DC2_ls_policy": 2137.8422369826835, "DC3_ls_policy": 2008.3013673458254}, "policy_reward_mean": {"high_level_policy": 2199.734339914715, "DC1_ls_policy": -1788.2697513008634, "DC2_ls_policy": 2096.084960263188, "DC3_ls_policy": 1899.9362599386873}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 92039.38619281995, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.21999999999999997, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.15958333333333333, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.036458333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 2.94, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 71810.92548700084, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 73248.38773762801, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.0, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 75321.88957195586, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 76031.18307205845, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.12125000000000001, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.2325, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 70711055.49443987, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 72231511.61544786, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 55.0371875, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 46.36708333333333, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 63.70729166666667, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 716.21609375, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 752.8836458333334}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018], "episode_lengths": [2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6086873851388852, "mean_inference_ms": 2.228799593384943, "mean_action_processing_ms": 0.32441517084751215, "mean_env_wait_ms": 4.255943958817125, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.004851818084716797, "StateBufferConnector_ms": 0.0024437904357910156, "ViewRequirementAgentConnector_ms": 0.05384087562561035}, "num_episodes": 0, "episode_return_max": 4566.322711289452, "episode_return_min": 4248.648906342018, "episode_return_mean": 4407.485808815734, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920, "num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 551.2582705093062, "num_env_steps_trained_throughput_per_sec": 551.2582705093062, "timesteps_total": 20480, "num_env_steps_sampled_lifetime": 20480, "num_agent_steps_sampled_lifetime": 81920, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 81920, "timers": {"training_iteration_time_ms": 1825.232, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1825.114, "sample_time_ms": 1151.002, "learn_time_ms": 653.472, "learn_throughput": 1567.015, "synch_weights_time_ms": 11.013}, "counters": {"num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920}, "done": false, "training_iteration": 20, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-27", "timestamp": 1729611747, "time_this_iter_s": 1.8643677234649658, "time_total_s": 36.286776065826416, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3be0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2139d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213ac0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213b80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213c40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 36.286776065826416, "iterations_since_restore": 20, "perf": {"cpu_util_percent": 3.2000000000000006, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0762998133897783, "cur_kl_coeff": 1.52587890625e-06, "cur_lr": 5e-05, "total_loss": 9.62138249874115, "policy_loss": -0.00268766013905406, "vf_loss": 9.62407021522522, "vf_explained_var": -0.004324814677238465, "kl": 0.002214171584569158, "entropy": 1.1447412997484208, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8092756137251853, "cur_kl_coeff": 7.62939453125e-07, "cur_lr": 5e-05, "total_loss": 8.952627825737, "policy_loss": -0.005163478292524814, "vf_loss": 8.957791352272034, "vf_explained_var": -0.013023558259010314, "kl": 0.00390201564354129, "entropy": 1.294268947839737, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0791880056262015, "cur_kl_coeff": 7.62939453125e-07, "cur_lr": 5e-05, "total_loss": 9.838478469848633, "policy_loss": -0.005960675328969956, "vf_loss": 9.844439053535462, "vf_explained_var": -0.0013324350118637085, "kl": 0.010820882912798879, "entropy": 0.81939487606287, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.498958647251129, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 8.16449295282364, "policy_loss": -0.007539742672815919, "vf_loss": 8.171896815299988, "vf_explained_var": -0.0002145230770111084, "kl": 0.010868042900802405, "entropy": 3.200120437145233, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 21504, "num_env_steps_trained": 21504, "num_agent_steps_sampled": 86016, "num_agent_steps_trained": 86016}, "env_runners": {"episode_reward_max": 4566.322711289452, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4244.489840233132, "episode_len_mean": 2464.0, "episode_media": {}, "episodes_timesteps_total": 7392, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2400.00109806875, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 2137.8422369826835, "DC3_ls_policy": 2008.3013673458254}, "policy_reward_mean": {"high_level_policy": 2110.4387445758625, "DC1_ls_policy": -1417.8470254136591, "DC2_ls_policy": 2022.9941324500078, "DC3_ls_policy": 1528.9039886209157}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 90648.77338513779, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.17997427983539094, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.631944444444444, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73342.76125032309, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.13953189300411523, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 78034.74026092574, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 83460.44163886552, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004115226337448559, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.012345679012345678, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.40349279835390944, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 74000380.12437345, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 80579029.38424064, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 50.136320730452674, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 63.70729166666667, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 821.7598353909465, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1032.8473186728395}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926], "episode_lengths": [2400, 2400, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6068244099906533, "mean_inference_ms": 2.2321534621242143, "mean_action_processing_ms": 0.32621449262567, "mean_env_wait_ms": 4.277423219855874, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.004220008850097656, "StateBufferConnector_ms": 0.0024298826853434243, "ViewRequirementAgentConnector_ms": 0.05316734313964844}, "num_episodes": 1, "episode_return_max": 4566.322711289452, "episode_return_min": 3918.497903067926, "episode_return_mean": 4244.489840233132, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 86016, "num_agent_steps_trained": 86016, "num_env_steps_sampled": 21504, "num_env_steps_trained": 21504, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 533.8623308345817, "num_env_steps_trained_throughput_per_sec": 533.8623308345817, "timesteps_total": 21504, "num_env_steps_sampled_lifetime": 21504, "num_agent_steps_sampled_lifetime": 86016, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 86016, "timers": {"training_iteration_time_ms": 1836.726, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1836.607, "sample_time_ms": 1162.094, "learn_time_ms": 653.584, "learn_throughput": 1566.745, "synch_weights_time_ms": 11.068}, "counters": {"num_env_steps_sampled": 21504, "num_env_steps_trained": 21504, "num_agent_steps_sampled": 86016, "num_agent_steps_trained": 86016}, "done": false, "training_iteration": 21, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-29", "timestamp": 1729611749, "time_this_iter_s": 1.9251039028167725, "time_total_s": 38.21187996864319, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a39a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213190>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213100>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211720>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211870>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 38.21187996864319, "iterations_since_restore": 21, "perf": {"cpu_util_percent": 3.133333333333333, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5695154458284377, "cur_kl_coeff": 7.62939453125e-07, "cur_lr": 5e-05, "total_loss": 9.516501021385192, "policy_loss": -0.0032216441351920365, "vf_loss": 9.51972255706787, "vf_explained_var": -0.000687989592552185, "kl": 0.0015625824983089842, "entropy": 1.2296912729740144, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9264276683330537, "cur_kl_coeff": 3.814697265625e-07, "cur_lr": 5e-05, "total_loss": 9.045521140098572, "policy_loss": -0.00993560249917209, "vf_loss": 9.055456614494323, "vf_explained_var": -0.007537919282913208, "kl": 0.015070687990169062, "entropy": 1.18952174782753, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2657642394304274, "cur_kl_coeff": 7.62939453125e-07, "cur_lr": 5e-05, "total_loss": 9.813199281692505, "policy_loss": -0.005286571208853274, "vf_loss": 9.818485927581786, "vf_explained_var": -0.0002991616725921631, "kl": 0.010139807022642937, "entropy": 0.7752093642950058, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.022073456645012, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 7.459173405170441, "policy_loss": -0.007671442744322121, "vf_loss": 7.466730296611786, "vf_explained_var": 0.0005050361156463623, "kl": 0.009172517744082592, "entropy": 3.207748132944107, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112}, "env_runners": {"episode_reward_max": 4566.322711289452, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4244.489840233132, "episode_len_mean": 2464.0, "episode_media": {}, "episodes_timesteps_total": 7392, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2400.00109806875, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 2137.8422369826835, "DC3_ls_policy": 2008.3013673458254}, "policy_reward_mean": {"high_level_policy": 2110.4387445758625, "DC1_ls_policy": -1417.8470254136591, "DC2_ls_policy": 2022.9941324500078, "DC3_ls_policy": 1528.9039886209157}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 90648.77338513779, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.17997427983539094, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.631944444444444, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73342.76125032309, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.13953189300411523, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 78034.74026092574, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 83460.44163886552, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004115226337448559, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.012345679012345678, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.40349279835390944, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 74000380.12437345, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 80579029.38424064, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 50.136320730452674, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 63.70729166666667, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 821.7598353909465, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1032.8473186728395}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926], "episode_lengths": [2400, 2400, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6068244099906533, "mean_inference_ms": 2.2321534621242143, "mean_action_processing_ms": 0.32621449262567, "mean_env_wait_ms": 4.277423219855874, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.004220008850097656, "StateBufferConnector_ms": 0.0024298826853434243, "ViewRequirementAgentConnector_ms": 0.05316734313964844}, "num_episodes": 0, "episode_return_max": 4566.322711289452, "episode_return_min": 3918.497903067926, "episode_return_mean": 4244.489840233132, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112, "num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 588.2333125019088, "num_env_steps_trained_throughput_per_sec": 588.2333125019088, "timesteps_total": 22528, "num_env_steps_sampled_lifetime": 22528, "num_agent_steps_sampled_lifetime": 90112, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 90112, "timers": {"training_iteration_time_ms": 1832.173, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1832.054, "sample_time_ms": 1159.105, "learn_time_ms": 652.61, "learn_throughput": 1569.084, "synch_weights_time_ms": 11.035}, "counters": {"num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112}, "done": false, "training_iteration": 22, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-31", "timestamp": 1729611751, "time_this_iter_s": 1.7484424114227295, "time_total_s": 39.96032238006592, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527f760>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210cd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210df0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211360>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211930>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 39.96032238006592, "iterations_since_restore": 22, "perf": {"cpu_util_percent": 4.05, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1147172465920447, "cur_kl_coeff": 3.814697265625e-07, "cur_lr": 5e-05, "total_loss": 9.519107913970947, "policy_loss": -0.0013706234516575933, "vf_loss": 9.520478534698487, "vf_explained_var": -0.004103878140449524, "kl": 0.0013218212670837088, "entropy": 1.2695953279733658, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7850277915596962, "cur_kl_coeff": 3.814697265625e-07, "cur_lr": 5e-05, "total_loss": 9.209925603866576, "policy_loss": -0.004112868942320347, "vf_loss": 9.214038586616516, "vf_explained_var": -0.0016984313726425171, "kl": 0.0026517147141930765, "entropy": 1.2777644038200378, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0429394230246545, "cur_kl_coeff": 7.62939453125e-07, "cur_lr": 5e-05, "total_loss": 9.840143299102783, "policy_loss": -0.0017550202319398522, "vf_loss": 9.841898131370545, "vf_explained_var": -0.0033466726541519164, "kl": 0.002534392568836097, "entropy": 0.7361954942345619, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.4141382575035095, "cur_kl_coeff": 0.0125, "cur_lr": 5e-05, "total_loss": 7.925547349452972, "policy_loss": -0.002232869132421911, "vf_loss": 7.927728235721588, "vf_explained_var": 0.0010233700275421142, "kl": 0.004162073111661574, "entropy": 3.1593054115772246, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 23552, "num_env_steps_trained": 23552, "num_agent_steps_sampled": 94208, "num_agent_steps_trained": 94208}, "env_runners": {"episode_reward_max": 4566.322711289452, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4244.489840233132, "episode_len_mean": 2464.0, "episode_media": {}, "episodes_timesteps_total": 7392, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2400.00109806875, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 2137.8422369826835, "DC3_ls_policy": 2008.3013673458254}, "policy_reward_mean": {"high_level_policy": 2110.4387445758625, "DC1_ls_policy": -1417.8470254136591, "DC2_ls_policy": 2022.9941324500078, "DC3_ls_policy": 1528.9039886209157}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 90648.77338513779, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.17997427983539094, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.631944444444444, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73342.76125032309, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.13953189300411523, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 78034.74026092574, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 83460.44163886552, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004115226337448559, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.012345679012345678, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.40349279835390944, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 74000380.12437345, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 80579029.38424064, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 50.136320730452674, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 63.70729166666667, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 821.7598353909465, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1032.8473186728395}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926], "episode_lengths": [2400, 2400, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6068244099906533, "mean_inference_ms": 2.2321534621242143, "mean_action_processing_ms": 0.32621449262567, "mean_env_wait_ms": 4.277423219855874, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.004220008850097656, "StateBufferConnector_ms": 0.0024298826853434243, "ViewRequirementAgentConnector_ms": 0.05316734313964844}, "num_episodes": 0, "episode_return_max": 4566.322711289452, "episode_return_min": 3918.497903067926, "episode_return_mean": 4244.489840233132, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 94208, "num_agent_steps_trained": 94208, "num_env_steps_sampled": 23552, "num_env_steps_trained": 23552, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 571.2994142506968, "num_env_steps_trained_throughput_per_sec": 571.2994142506968, "timesteps_total": 23552, "num_env_steps_sampled_lifetime": 23552, "num_agent_steps_sampled_lifetime": 94208, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 94208, "timers": {"training_iteration_time_ms": 1816.949, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1816.83, "sample_time_ms": 1143.675, "learn_time_ms": 652.544, "learn_throughput": 1569.244, "synch_weights_time_ms": 11.103}, "counters": {"num_env_steps_sampled": 23552, "num_env_steps_trained": 23552, "num_agent_steps_sampled": 94208, "num_agent_steps_trained": 94208}, "done": false, "training_iteration": 23, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-33", "timestamp": 1729611753, "time_this_iter_s": 1.7995274066925049, "time_total_s": 41.75984978675842, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154310>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2109d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213b80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213c40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213df0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 41.75984978675842, "iterations_since_restore": 23, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.176581437885761, "cur_kl_coeff": 1.9073486328125e-07, "cur_lr": 5e-05, "total_loss": 9.46584906578064, "policy_loss": -0.008302327943965793, "vf_loss": 9.474151396751404, "vf_explained_var": -0.0073264211416244505, "kl": 0.00868147744040486, "entropy": 1.2193096667528152, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5529815308749675, "cur_kl_coeff": 1.9073486328125e-07, "cur_lr": 5e-05, "total_loss": 9.500915837287902, "policy_loss": -0.0002468151971697807, "vf_loss": 9.501162433624268, "vf_explained_var": -0.00043269991874694824, "kl": 0.000914943790394318, "entropy": 1.450046291947365, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.066184490919113, "cur_kl_coeff": 3.814697265625e-07, "cur_lr": 5e-05, "total_loss": 9.884459137916565, "policy_loss": -0.0006094190059229732, "vf_loss": 9.885068583488465, "vf_explained_var": -0.003619691729545593, "kl": 0.00038607026232284625, "entropy": 0.7354729905724525, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.326356273889542, "cur_kl_coeff": 0.00625, "cur_lr": 5e-05, "total_loss": 8.400999295711518, "policy_loss": -0.008153322897851468, "vf_loss": 8.409084713459015, "vf_explained_var": 0.0008840769529342652, "kl": 0.010862780462412642, "entropy": 3.088363468647003, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304}, "env_runners": {"episode_reward_max": 4566.322711289452, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4244.489840233132, "episode_len_mean": 2464.0, "episode_media": {}, "episodes_timesteps_total": 7392, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2400.00109806875, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 2137.8422369826835, "DC3_ls_policy": 2008.3013673458254}, "policy_reward_mean": {"high_level_policy": 2110.4387445758625, "DC1_ls_policy": -1417.8470254136591, "DC2_ls_policy": 2022.9941324500078, "DC3_ls_policy": 1528.9039886209157}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 90648.77338513779, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.17997427983539094, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.631944444444444, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73342.76125032309, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.13953189300411523, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 78034.74026092574, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 83460.44163886552, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.004115226337448559, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.012345679012345678, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.40349279835390944, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 74000380.12437345, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 80579029.38424064, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 50.136320730452674, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 63.70729166666667, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 821.7598353909465, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1032.8473186728395}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926], "episode_lengths": [2400, 2400, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6068244099906533, "mean_inference_ms": 2.2321534621242143, "mean_action_processing_ms": 0.32621449262567, "mean_env_wait_ms": 4.277423219855874, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.004220008850097656, "StateBufferConnector_ms": 0.0024298826853434243, "ViewRequirementAgentConnector_ms": 0.05316734313964844}, "num_episodes": 0, "episode_return_max": 4566.322711289452, "episode_return_min": 3918.497903067926, "episode_return_mean": 4244.489840233132, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304, "num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 535.350649991686, "num_env_steps_trained_throughput_per_sec": 535.350649991686, "timesteps_total": 24576, "num_env_steps_sampled_lifetime": 24576, "num_agent_steps_sampled_lifetime": 98304, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 98304, "timers": {"training_iteration_time_ms": 1827.211, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1827.09, "sample_time_ms": 1153.868, "learn_time_ms": 652.751, "learn_throughput": 1568.746, "synch_weights_time_ms": 11.293}, "counters": {"num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304}, "done": false, "training_iteration": 24, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-35", "timestamp": 1729611755, "time_this_iter_s": 1.9199697971343994, "time_total_s": 43.67981958389282, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a32e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2137f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213850>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213d60>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211450>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 43.67981958389282, "iterations_since_restore": 24, "perf": {"cpu_util_percent": 3.95, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.366614396870136, "cur_kl_coeff": 1.9073486328125e-07, "cur_lr": 5e-05, "total_loss": 9.576965594291687, "policy_loss": -0.004898869805037976, "vf_loss": 9.581864595413208, "vf_explained_var": 5.208700895309448e-05, "kl": 0.0069248864723421965, "entropy": 1.0981240957975387, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1002299576997756, "cur_kl_coeff": 9.5367431640625e-08, "cur_lr": 5e-05, "total_loss": 9.240237951278687, "policy_loss": -0.0012210040586069226, "vf_loss": 9.241458821296693, "vf_explained_var": -0.0004196435213088989, "kl": 0.0006911456146341741, "entropy": 1.5229069471359253, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3971274465322496, "cur_kl_coeff": 1.9073486328125e-07, "cur_lr": 5e-05, "total_loss": 9.802816820144653, "policy_loss": -0.0009597611729986966, "vf_loss": 9.803776788711549, "vf_explained_var": -0.0009837418794631958, "kl": 0.0012423181363317326, "entropy": 0.7938773736357689, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.710562837123871, "cur_kl_coeff": 0.00625, "cur_lr": 5e-05, "total_loss": 8.106876277923584, "policy_loss": -0.00527507399674505, "vf_loss": 8.112095642089844, "vf_explained_var": 0.00011107176542282104, "kl": 0.008919551338477506, "entropy": 3.0872389912605285, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 25600, "num_env_steps_trained": 25600, "num_agent_steps_sampled": 102400, "num_agent_steps_trained": 102400}, "env_runners": {"episode_reward_max": 5196.43797976538, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4482.476875116194, "episode_len_mean": 2640.0, "episode_media": {}, "episodes_timesteps_total": 10560, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2400.00109806875, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 2900.9092161624526, "DC3_ls_policy": 2008.3013673458254}, "policy_reward_mean": {"high_level_policy": 2085.8260935263816, "DC1_ls_policy": -1366.048485161601, "DC2_ls_policy": 2242.472903378119, "DC3_ls_policy": 1520.2263633732864}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 91860.87677785443, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.16599396745230077, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.5153882575757573, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73437.23315914348, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.10472783389450056, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79532.88040362402, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.025655864197530864, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.46021113916947254, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 80927215.23698813, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 101707720.57483214, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 63.089851027637486, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 101.95044191919192, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 900.6687756909371, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1137.395596590909}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538], "episode_lengths": [2400, 2400, 2592, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6067498982923949, "mean_inference_ms": 2.22965576582196, "mean_action_processing_ms": 0.3249602431865322, "mean_env_wait_ms": 4.2665803428556535, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003890693187713623, "StateBufferConnector_ms": 0.0024452805519104004, "ViewRequirementAgentConnector_ms": 0.05313307046890259}, "num_episodes": 1, "episode_return_max": 5196.43797976538, "episode_return_min": 3918.497903067926, "episode_return_mean": 4482.476875116194, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 102400, "num_agent_steps_trained": 102400, "num_env_steps_sampled": 25600, "num_env_steps_trained": 25600, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 571.9162985135523, "num_env_steps_trained_throughput_per_sec": 571.9162985135523, "timesteps_total": 25600, "num_env_steps_sampled_lifetime": 25600, "num_agent_steps_sampled_lifetime": 102400, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 102400, "timers": {"training_iteration_time_ms": 1826.746, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1826.624, "sample_time_ms": 1154.295, "learn_time_ms": 652.15, "learn_throughput": 1570.191, "synch_weights_time_ms": 11.03}, "counters": {"num_env_steps_sampled": 25600, "num_env_steps_trained": 25600, "num_agent_steps_sampled": 102400, "num_agent_steps_trained": 102400}, "done": false, "training_iteration": 25, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-37", "timestamp": 1729611757, "time_this_iter_s": 1.796752691268921, "time_total_s": 45.47657227516174, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a37f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212110>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe115416800>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe115415fc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe115416680>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 45.47657227516174, "iterations_since_restore": 25, "perf": {"cpu_util_percent": 3.2000000000000006, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8167281433939935, "cur_kl_coeff": 1.9073486328125e-07, "cur_lr": 5e-05, "total_loss": 9.882011699676514, "policy_loss": -0.0035145701840519905, "vf_loss": 9.88552622795105, "vf_explained_var": -0.0006837338209152221, "kl": 0.0016311571717610774, "entropy": 1.1219474136829377, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.582318302989006, "cur_kl_coeff": 4.76837158203125e-08, "cur_lr": 5e-05, "total_loss": 9.523431205749512, "policy_loss": -0.004284963570535183, "vf_loss": 9.527716207504273, "vf_explained_var": -0.0002086728811264038, "kl": 0.0030870684624460408, "entropy": 1.5322996914386748, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8494327872991563, "cur_kl_coeff": 9.5367431640625e-08, "cur_lr": 5e-05, "total_loss": 9.86370005607605, "policy_loss": -0.0037762511055916548, "vf_loss": 9.86747636795044, "vf_explained_var": 0.0016914695501327516, "kl": 0.006533790234425396, "entropy": 0.8339491948485375, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.502054998278618, "cur_kl_coeff": 0.00625, "cur_lr": 5e-05, "total_loss": 8.542507743835449, "policy_loss": -0.012422198802232743, "vf_loss": 8.55484414100647, "vf_explained_var": 6.824731826782226e-07, "kl": 0.013733171977220057, "entropy": 2.998900663852692, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496}, "env_runners": {"episode_reward_max": 5196.43797976538, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4482.476875116194, "episode_len_mean": 2640.0, "episode_media": {}, "episodes_timesteps_total": 10560, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2400.00109806875, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 2900.9092161624526, "DC3_ls_policy": 2008.3013673458254}, "policy_reward_mean": {"high_level_policy": 2085.8260935263816, "DC1_ls_policy": -1366.048485161601, "DC2_ls_policy": 2242.472903378119, "DC3_ls_policy": 1520.2263633732864}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 91860.87677785443, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.16599396745230077, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.5153882575757573, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73437.23315914348, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.10472783389450056, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79532.88040362402, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.025655864197530864, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.46021113916947254, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 80927215.23698813, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 101707720.57483214, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 63.089851027637486, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 101.95044191919192, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 900.6687756909371, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1137.395596590909}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538], "episode_lengths": [2400, 2400, 2592, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6067498982923949, "mean_inference_ms": 2.22965576582196, "mean_action_processing_ms": 0.3249602431865322, "mean_env_wait_ms": 4.2665803428556535, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003890693187713623, "StateBufferConnector_ms": 0.0024452805519104004, "ViewRequirementAgentConnector_ms": 0.05313307046890259}, "num_episodes": 0, "episode_return_max": 5196.43797976538, "episode_return_min": 3918.497903067926, "episode_return_mean": 4482.476875116194, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496, "num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 578.2119069210405, "num_env_steps_trained_throughput_per_sec": 578.2119069210405, "timesteps_total": 26624, "num_env_steps_sampled_lifetime": 26624, "num_agent_steps_sampled_lifetime": 106496, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 106496, "timers": {"training_iteration_time_ms": 1808.944, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1808.823, "sample_time_ms": 1136.93, "learn_time_ms": 651.898, "learn_throughput": 1570.799, "synch_weights_time_ms": 11.075}, "counters": {"num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496}, "done": false, "training_iteration": 26, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-39", "timestamp": 1729611759, "time_this_iter_s": 1.778374195098877, "time_total_s": 47.25494647026062, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238520>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238700>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2388e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2389d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 47.25494647026062, "iterations_since_restore": 26, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.133113570511341, "cur_kl_coeff": 9.5367431640625e-08, "cur_lr": 5e-05, "total_loss": 9.500474238395691, "policy_loss": -0.001925971219316125, "vf_loss": 9.502400255203247, "vf_explained_var": -0.00044072866439819335, "kl": 0.0031216907424777675, "entropy": 1.2548801928758622, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.5079490944743155, "cur_kl_coeff": 2.384185791015625e-08, "cur_lr": 5e-05, "total_loss": 9.24442207813263, "policy_loss": -0.0030378499533981083, "vf_loss": 9.247459959983825, "vf_explained_var": -0.0003097563982009888, "kl": 0.004394173852324543, "entropy": 1.4298933267593383, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9313008800148963, "cur_kl_coeff": 9.5367431640625e-08, "cur_lr": 5e-05, "total_loss": 9.861131954193116, "policy_loss": -0.0009745519142597914, "vf_loss": 9.86210651397705, "vf_explained_var": -0.0004352569580078125, "kl": 0.000506436967248787, "entropy": 0.802022422850132, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7726931661367415, "cur_kl_coeff": 0.00625, "cur_lr": 5e-05, "total_loss": 7.649354255199432, "policy_loss": -0.0027433329843915997, "vf_loss": 7.6520667433738705, "vf_explained_var": 0.0015022203326225281, "kl": 0.004915101148437233, "entropy": 2.976825785636902, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 27648, "num_env_steps_trained": 27648, "num_agent_steps_sampled": 110592, "num_agent_steps_trained": 110592}, "env_runners": {"episode_reward_max": 6163.6982887286, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4818.721157838675, "episode_len_mean": 2803.2, "episode_media": {}, "episodes_timesteps_total": 14016, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3062.392932911551, "DC3_ls_policy": 2325.6425139195962}, "policy_reward_mean": {"high_level_policy": 2194.8678541941163, "DC1_ls_policy": -1463.91319912281, "DC2_ls_policy": 2406.4569092848055, "DC3_ls_policy": 1681.3095934825483}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 92265.19227285226, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.15588545173961837, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.511558291245791, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73479.9146387392, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1053679152637486, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79506.73716395859, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.02052469135802469, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.3822892817059484, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85857370.07578662, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 105577989.43098058, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 63.13756369248036, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 101.95044191919192, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 947.8680790018237, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1137.395596590909}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286], "episode_lengths": [2400, 2400, 2592, 3168, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6032654432790187, "mean_inference_ms": 2.2174868510053085, "mean_action_processing_ms": 0.32416225559017303, "mean_env_wait_ms": 4.2511044171677, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036573410034179688, "StateBufferConnector_ms": 0.0024366378784179688, "ViewRequirementAgentConnector_ms": 0.05286216735839844}, "num_episodes": 1, "episode_return_max": 6163.6982887286, "episode_return_min": 3918.497903067926, "episode_return_mean": 4818.721157838675, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 110592, "num_agent_steps_trained": 110592, "num_env_steps_sampled": 27648, "num_env_steps_trained": 27648, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.8479146016831, "num_env_steps_trained_throughput_per_sec": 576.8479146016831, "timesteps_total": 27648, "num_env_steps_sampled_lifetime": 27648, "num_agent_steps_sampled_lifetime": 110592, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 110592, "timers": {"training_iteration_time_ms": 1810.071, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1809.95, "sample_time_ms": 1137.418, "learn_time_ms": 652.295, "learn_throughput": 1569.843, "synch_weights_time_ms": 11.118}, "counters": {"num_env_steps_sampled": 27648, "num_env_steps_trained": 27648, "num_agent_steps_sampled": 110592, "num_agent_steps_trained": 110592}, "done": false, "training_iteration": 27, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-41", "timestamp": 1729611761, "time_this_iter_s": 1.7813642024993896, "time_total_s": 49.03631067276001, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fbe0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210760>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213fd0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213d00>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213df0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 49.03631067276001, "iterations_since_restore": 27, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2044033765792848, "cur_kl_coeff": 4.76837158203125e-08, "cur_lr": 5e-05, "total_loss": 9.513697910308839, "policy_loss": -0.003488873864989728, "vf_loss": 9.517186689376832, "vf_explained_var": -0.00037496089935302735, "kl": 0.003055795494219869, "entropy": 1.3698050528764725, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7848847232759, "cur_kl_coeff": 1.1920928955078126e-08, "cur_lr": 5e-05, "total_loss": 9.514076924324035, "policy_loss": -0.003787089325487614, "vf_loss": 9.517863941192626, "vf_explained_var": -0.00024374723434448243, "kl": 0.0034962885389974233, "entropy": 1.4763952195644379, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1031259909272193, "cur_kl_coeff": 4.76837158203125e-08, "cur_lr": 5e-05, "total_loss": 9.822081065177917, "policy_loss": -0.001035390794277191, "vf_loss": 9.82311658859253, "vf_explained_var": -7.23913311958313e-05, "kl": 0.0006090188314836403, "entropy": 0.8017675593495369, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.005292123556137, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 8.353397190570831, "policy_loss": -0.0033517810632474722, "vf_loss": 8.356727027893067, "vf_explained_var": 0.0008970320224761963, "kl": 0.006990233099031684, "entropy": 2.925466722249985, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688}, "env_runners": {"episode_reward_max": 6163.6982887286, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4818.721157838675, "episode_len_mean": 2803.2, "episode_media": {}, "episodes_timesteps_total": 14016, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3062.392932911551, "DC3_ls_policy": 2325.6425139195962}, "policy_reward_mean": {"high_level_policy": 2194.8678541941163, "DC1_ls_policy": -1463.91319912281, "DC2_ls_policy": 2406.4569092848055, "DC3_ls_policy": 1681.3095934825483}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 92265.19227285226, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.15588545173961837, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.511558291245791, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73479.9146387392, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1053679152637486, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79506.73716395859, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.02052469135802469, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.3822892817059484, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85857370.07578662, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 105577989.43098058, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 63.13756369248036, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 101.95044191919192, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 947.8680790018237, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1137.395596590909}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286], "episode_lengths": [2400, 2400, 2592, 3168, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6032654432790187, "mean_inference_ms": 2.2174868510053085, "mean_action_processing_ms": 0.32416225559017303, "mean_env_wait_ms": 4.2511044171677, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036573410034179688, "StateBufferConnector_ms": 0.0024366378784179688, "ViewRequirementAgentConnector_ms": 0.05286216735839844}, "num_episodes": 0, "episode_return_max": 6163.6982887286, "episode_return_min": 3918.497903067926, "episode_return_mean": 4818.721157838675, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688, "num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 532.9027846398753, "num_env_steps_trained_throughput_per_sec": 532.9027846398753, "timesteps_total": 28672, "num_env_steps_sampled_lifetime": 28672, "num_agent_steps_sampled_lifetime": 114688, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 114688, "timers": {"training_iteration_time_ms": 1823.149, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1823.029, "sample_time_ms": 1134.91, "learn_time_ms": 668.144, "learn_throughput": 1532.603, "synch_weights_time_ms": 10.938}, "counters": {"num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688}, "done": false, "training_iteration": 28, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-43", "timestamp": 1729611763, "time_this_iter_s": 1.9300341606140137, "time_total_s": 50.96634483337402, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3e20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212410>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213a60>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213cd0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2129b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 50.96634483337402, "iterations_since_restore": 28, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.383261474967003, "cur_kl_coeff": 2.384185791015625e-08, "cur_lr": 5e-05, "total_loss": 9.369744253158569, "policy_loss": -0.003762579325120896, "vf_loss": 9.373506689071656, "vf_explained_var": 5.3073465824127195e-05, "kl": 0.002566853577423213, "entropy": 1.4423649489879609, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7187828101217746, "cur_kl_coeff": 5.960464477539063e-09, "cur_lr": 5e-05, "total_loss": 9.22390387058258, "policy_loss": -0.0015413904562592506, "vf_loss": 9.225445413589478, "vf_explained_var": -9.445846080780029e-05, "kl": 0.0006194858269282122, "entropy": 1.6045380145311356, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.415030637383461, "cur_kl_coeff": 2.384185791015625e-08, "cur_lr": 5e-05, "total_loss": 9.833354687690735, "policy_loss": -0.0034638419630937277, "vf_loss": 9.836818480491639, "vf_explained_var": 0.0002527788281440735, "kl": 0.006759538206461002, "entropy": 0.6684771791100502, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.540062341094017, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 9.018971467018128, "policy_loss": -0.0036599413957446813, "vf_loss": 9.022605276107788, "vf_explained_var": 0.00019405484199523925, "kl": 0.008368609795071367, "entropy": 2.8408523738384246, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 29696, "num_env_steps_trained": 29696, "num_agent_steps_sampled": 118784, "num_agent_steps_trained": 118784}, "env_runners": {"episode_reward_max": 6163.6982887286, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 4818.721157838675, "episode_len_mean": 2803.2, "episode_media": {}, "episodes_timesteps_total": 14016, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -1896.307437668828, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3062.392932911551, "DC3_ls_policy": 2325.6425139195962}, "policy_reward_mean": {"high_level_policy": 2194.8678541941163, "DC1_ls_policy": -1463.91319912281, "DC2_ls_policy": 2406.4569092848055, "DC3_ls_policy": 1681.3095934825483}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 92265.19227285226, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 96939.77907155365, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.15588545173961837, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.511558291245791, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73479.9146387392, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1053679152637486, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79506.73716395859, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.02052469135802469, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.3822892817059484, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85857370.07578662, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 105577989.43098058, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 63.13756369248036, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 101.95044191919192, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 947.8680790018237, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1137.395596590909}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286], "episode_lengths": [2400, 2400, 2592, 3168, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6032654432790187, "mean_inference_ms": 2.2174868510053085, "mean_action_processing_ms": 0.32416225559017303, "mean_env_wait_ms": 4.2511044171677, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036573410034179688, "StateBufferConnector_ms": 0.0024366378784179688, "ViewRequirementAgentConnector_ms": 0.05286216735839844}, "num_episodes": 0, "episode_return_max": 6163.6982887286, "episode_return_min": 3918.497903067926, "episode_return_mean": 4818.721157838675, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 118784, "num_agent_steps_trained": 118784, "num_env_steps_sampled": 29696, "num_env_steps_trained": 29696, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 564.6108054842465, "num_env_steps_trained_throughput_per_sec": 564.6108054842465, "timesteps_total": 29696, "num_env_steps_sampled_lifetime": 29696, "num_agent_steps_sampled_lifetime": 118784, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 118784, "timers": {"training_iteration_time_ms": 1829.371, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1829.25, "sample_time_ms": 1140.297, "learn_time_ms": 668.965, "learn_throughput": 1530.723, "synch_weights_time_ms": 10.931}, "counters": {"num_env_steps_sampled": 29696, "num_env_steps_trained": 29696, "num_agent_steps_sampled": 118784, "num_agent_steps_trained": 118784}, "done": false, "training_iteration": 29, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-44", "timestamp": 1729611764, "time_this_iter_s": 1.8272178173065186, "time_total_s": 52.79356265068054, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156ef0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a110>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a920>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a590>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ad40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 52.79356265068054, "iterations_since_restore": 29, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0605203062295914, "cur_kl_coeff": 1.1920928955078126e-08, "cur_lr": 5e-05, "total_loss": 8.824937224388123, "policy_loss": -0.0006389637477695942, "vf_loss": 8.825576210021973, "vf_explained_var": -0.0003023684024810791, "kl": 0.0020440602532289633, "entropy": 1.404765573143959, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6032164864242078, "cur_kl_coeff": 2.9802322387695314e-09, "cur_lr": 5e-05, "total_loss": 8.689462423324585, "policy_loss": -0.0018774174619466065, "vf_loss": 8.691339778900147, "vf_explained_var": -2.0651519298553468e-05, "kl": 0.001661989236208683, "entropy": 1.620501419901848, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.287028360366821, "cur_kl_coeff": 2.384185791015625e-08, "cur_lr": 5e-05, "total_loss": 9.829161286354065, "policy_loss": -0.004420965281315148, "vf_loss": 9.833582067489624, "vf_explained_var": -0.00037291646003723145, "kl": 0.00801608554691029, "entropy": 0.6440860792994499, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.4957210421562195, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 8.611836695671082, "policy_loss": -0.0035505216801539063, "vf_loss": 8.615356874465942, "vf_explained_var": -0.0003036245703697205, "kl": 0.009711852168311452, "entropy": 2.7695876538753508, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 5058.867855366113, "episode_len_mean": 2960.0, "episode_media": {}, "episodes_timesteps_total": 17760, "policy_reward_min": {"high_level_policy": 1931.8475538981586, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3227.360053014381, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 2252.5818401993165, "DC1_ls_policy": -1579.7229002858949, "DC2_ls_policy": 2543.2740999064013, "DC3_ls_policy": 1842.734815546269}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 94137.1936784934, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 103497.20070669914, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.17019122402802955, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.09992283950617284, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.520493732733316, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73107.27103952022, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1306306701271979, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 78976.01839198593, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.017103909465020575, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.3480882903105125, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 0.9679783950617284, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90694447.00300701, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 114879831.63910897, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 74.71126880000145, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1033.6620454466765, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1462.6318776709402}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6041463243043982, "mean_inference_ms": 2.218905481324781, "mean_action_processing_ms": 0.32477471792280316, "mean_env_wait_ms": 4.255255538630343, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035872062047322593, "StateBufferConnector_ms": 0.0024884939193725586, "ViewRequirementAgentConnector_ms": 0.05319714546203613}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 3918.497903067926, "episode_return_mean": 5058.867855366113, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880, "num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 571.0840582300088, "num_env_steps_trained_throughput_per_sec": 571.0840582300088, "timesteps_total": 30720, "num_env_steps_sampled_lifetime": 30720, "num_agent_steps_sampled_lifetime": 122880, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 122880, "timers": {"training_iteration_time_ms": 1822.922, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1822.801, "sample_time_ms": 1135.212, "learn_time_ms": 668.31, "learn_throughput": 1532.223, "synch_weights_time_ms": 10.83}, "counters": {"num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880}, "done": false, "training_iteration": 30, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-46", "timestamp": 1729611766, "time_this_iter_s": 1.8007895946502686, "time_total_s": 54.59435224533081, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154160>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a080>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b1f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a8f0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b4c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 54.59435224533081, "iterations_since_restore": 30, "perf": {"cpu_util_percent": 4.1, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.75781968832016, "cur_kl_coeff": 5.960464477539063e-09, "cur_lr": 5e-05, "total_loss": 9.299612069129944, "policy_loss": -0.0042221191222779455, "vf_loss": 9.303834128379822, "vf_explained_var": 8.212029933929444e-06, "kl": 0.005133191539232485, "entropy": 1.3446539133787154, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.870682565867901, "cur_kl_coeff": 1.4901161193847657e-09, "cur_lr": 5e-05, "total_loss": 9.205998849868774, "policy_loss": -0.0010015486739575862, "vf_loss": 9.207000350952148, "vf_explained_var": -6.959587335586548e-05, "kl": 0.0008748396221562871, "entropy": 1.6825543969869614, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2303377777338027, "cur_kl_coeff": 2.384185791015625e-08, "cur_lr": 5e-05, "total_loss": 9.87710690498352, "policy_loss": -0.0017932329792529345, "vf_loss": 9.878900122642516, "vf_explained_var": -0.0004560723900794983, "kl": 0.00232041228809976, "entropy": 0.6683051586151123, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.425741356611252, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 8.52440994977951, "policy_loss": -0.008953902870416641, "vf_loss": 8.533314847946167, "vf_explained_var": -0.0009777277708053588, "kl": 0.0157319465586639, "entropy": 2.6528103053569794, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 31744, "num_env_steps_trained": 31744, "num_agent_steps_sampled": 126976, "num_agent_steps_trained": 126976}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 5045.729604867309, "episode_len_mean": 3099.4285714285716, "episode_media": {}, "episodes_timesteps_total": 21696, "policy_reward_min": {"high_level_policy": 1838.012748472349, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3835.32636816224, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 2193.3576842383213, "DC1_ls_policy": -1595.559835844963, "DC2_ls_policy": 2727.8529953715215, "DC3_ls_policy": 1720.0787611024118}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 95579.55209580927, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 104233.70259970451, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.14769294231438537, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.012703252032520325, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4496218057574763, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73341.4746377517, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1119691458233125, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79503.85319174864, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.021629134942143073, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47076266927892946, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 96012679.5219194, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 127922074.63539377, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 70.4919270463427, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1129.7505213875113, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048345981882118, "mean_inference_ms": 2.222240304836487, "mean_action_processing_ms": 0.3249680128653089, "mean_env_wait_ms": 4.259810202692484, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003488574709211077, "StateBufferConnector_ms": 0.002474444253104074, "ViewRequirementAgentConnector_ms": 0.05316649164472308}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 3918.497903067926, "episode_return_mean": 5045.729604867309, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 126976, "num_agent_steps_trained": 126976, "num_env_steps_sampled": 31744, "num_env_steps_trained": 31744, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 572.385424224122, "num_env_steps_trained_throughput_per_sec": 572.385424224122, "timesteps_total": 31744, "num_env_steps_sampled_lifetime": 31744, "num_agent_steps_sampled_lifetime": 126976, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 126976, "timers": {"training_iteration_time_ms": 1810.013, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1809.892, "sample_time_ms": 1122.547, "learn_time_ms": 668.418, "learn_throughput": 1531.975, "synch_weights_time_ms": 10.716}, "counters": {"num_env_steps_sampled": 31744, "num_env_steps_trained": 31744, "num_agent_steps_sampled": 126976, "num_agent_steps_trained": 126976}, "done": false, "training_iteration": 31, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-48", "timestamp": 1729611768, "time_this_iter_s": 1.7963147163391113, "time_total_s": 56.39066696166992, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db157250>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2396c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239690>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a830>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a710>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 56.39066696166992, "iterations_since_restore": 31, "perf": {"cpu_util_percent": 3.2999999999999994, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6798476532101632, "cur_kl_coeff": 5.960464477539063e-09, "cur_lr": 5e-05, "total_loss": 8.894504284858703, "policy_loss": -0.00022165495902299882, "vf_loss": 8.894726014137268, "vf_explained_var": 0.00034918338060379027, "kl": 0.00033884218530602086, "entropy": 1.3197524100542068, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.205262692272663, "cur_kl_coeff": 7.450580596923829e-10, "cur_lr": 5e-05, "total_loss": 9.468635416030883, "policy_loss": -0.004214855353347957, "vf_loss": 9.47285041809082, "vf_explained_var": -0.00016994774341583252, "kl": 0.0024046243283011247, "entropy": 1.6077578514814377, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.864459840208292, "cur_kl_coeff": 1.1920928955078126e-08, "cur_lr": 5e-05, "total_loss": 9.894712090492249, "policy_loss": -0.001435492397285998, "vf_loss": 9.896147418022156, "vf_explained_var": 0.0026758819818496703, "kl": 0.001295813626725817, "entropy": 0.7726174265146255, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.866212654113769, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 7.831203758716583, "policy_loss": -0.007529174804221839, "vf_loss": 7.838690388202667, "vf_explained_var": -7.658004760742187e-05, "kl": 0.013601974640914704, "entropy": 2.5765846371650696, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 5045.729604867309, "episode_len_mean": 3099.4285714285716, "episode_media": {}, "episodes_timesteps_total": 21696, "policy_reward_min": {"high_level_policy": 1838.012748472349, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3835.32636816224, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 2193.3576842383213, "DC1_ls_policy": -1595.559835844963, "DC2_ls_policy": 2727.8529953715215, "DC3_ls_policy": 1720.0787611024118}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 95579.55209580927, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 104233.70259970451, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.14769294231438537, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.012703252032520325, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4496218057574763, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73341.4746377517, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1119691458233125, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79503.85319174864, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.021629134942143073, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47076266927892946, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 96012679.5219194, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 127922074.63539377, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 70.4919270463427, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1129.7505213875113, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048345981882118, "mean_inference_ms": 2.222240304836487, "mean_action_processing_ms": 0.3249680128653089, "mean_env_wait_ms": 4.259810202692484, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003488574709211077, "StateBufferConnector_ms": 0.002474444253104074, "ViewRequirementAgentConnector_ms": 0.05316649164472308}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 3918.497903067926, "episode_return_mean": 5045.729604867309, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072, "num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 530.7955587336246, "num_env_steps_trained_throughput_per_sec": 530.7955587336246, "timesteps_total": 32768, "num_env_steps_sampled_lifetime": 32768, "num_agent_steps_sampled_lifetime": 131072, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 131072, "timers": {"training_iteration_time_ms": 1828.85, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1828.73, "sample_time_ms": 1140.555, "learn_time_ms": 668.833, "learn_throughput": 1531.025, "synch_weights_time_ms": 10.691}, "counters": {"num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072}, "done": false, "training_iteration": 32, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-50", "timestamp": 1729611770, "time_this_iter_s": 1.9357426166534424, "time_total_s": 58.326409578323364, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fdff3c8a320>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ac20>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238940>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238250>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b280>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 58.326409578323364, "iterations_since_restore": 32, "perf": {"cpu_util_percent": 3.2999999999999994, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7905100919306278, "cur_kl_coeff": 2.9802322387695314e-09, "cur_lr": 5e-05, "total_loss": 9.790290427207946, "policy_loss": -0.002930758683942258, "vf_loss": 9.793221259117127, "vf_explained_var": -0.00030029416084289553, "kl": 0.0025729503066941107, "entropy": 1.2298794656991958, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6461444914340975, "cur_kl_coeff": 3.7252902984619143e-10, "cur_lr": 5e-05, "total_loss": 9.065810179710388, "policy_loss": -0.002258926793001592, "vf_loss": 9.06806914806366, "vf_explained_var": -0.00010090172290802001, "kl": 0.0024529585521806687, "entropy": 1.661648878455162, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9881510004401206, "cur_kl_coeff": 5.960464477539063e-09, "cur_lr": 5e-05, "total_loss": 9.868979620933533, "policy_loss": -0.0008893458405509591, "vf_loss": 9.869869089126587, "vf_explained_var": 0.00015621036291122437, "kl": 0.002408197773797838, "entropy": 0.7526513174176216, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.9753330737352375, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 7.786094439029694, "policy_loss": -0.010514419642277062, "vf_loss": 7.796552467346191, "vf_explained_var": 0.0006846591830253601, "kl": 0.018083733081948595, "entropy": 2.403661197423935, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 33792, "num_env_steps_trained": 33792, "num_agent_steps_sampled": 135168, "num_agent_steps_trained": 135168}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 5045.729604867309, "episode_len_mean": 3099.4285714285716, "episode_media": {}, "episodes_timesteps_total": 21696, "policy_reward_min": {"high_level_policy": 1838.012748472349, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3835.32636816224, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 2193.3576842383213, "DC1_ls_policy": -1595.559835844963, "DC2_ls_policy": 2727.8529953715215, "DC3_ls_policy": 1720.0787611024118}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 95579.55209580927, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 104233.70259970451, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.14769294231438537, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.012703252032520325, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4496218057574763, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73341.4746377517, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1119691458233125, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79503.85319174864, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.021629134942143073, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47076266927892946, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 96012679.5219194, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 127922074.63539377, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 70.4919270463427, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1129.7505213875113, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048345981882118, "mean_inference_ms": 2.222240304836487, "mean_action_processing_ms": 0.3249680128653089, "mean_env_wait_ms": 4.259810202692484, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003488574709211077, "StateBufferConnector_ms": 0.002474444253104074, "ViewRequirementAgentConnector_ms": 0.05316649164472308}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 3918.497903067926, "episode_return_mean": 5045.729604867309, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 135168, "num_agent_steps_trained": 135168, "num_env_steps_sampled": 33792, "num_env_steps_trained": 33792, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 575.2517828588128, "num_env_steps_trained_throughput_per_sec": 575.2517828588128, "timesteps_total": 33792, "num_env_steps_sampled_lifetime": 33792, "num_agent_steps_sampled_lifetime": 135168, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 135168, "timers": {"training_iteration_time_ms": 1827.619, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1827.499, "sample_time_ms": 1139.88, "learn_time_ms": 668.509, "learn_throughput": 1531.768, "synch_weights_time_ms": 10.649}, "counters": {"num_env_steps_sampled": 33792, "num_env_steps_trained": 33792, "num_agent_steps_sampled": 135168, "num_agent_steps_trained": 135168}, "done": false, "training_iteration": 33, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-52", "timestamp": 1729611772, "time_this_iter_s": 1.787578821182251, "time_total_s": 60.113988399505615, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3d00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2385b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238610>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2383d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2386d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 60.113988399505615, "iterations_since_restore": 33, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8415326625108719, "cur_kl_coeff": 1.4901161193847657e-09, "cur_lr": 5e-05, "total_loss": 9.53964409828186, "policy_loss": -0.001580188621301204, "vf_loss": 9.541224193572997, "vf_explained_var": -0.00023132264614105224, "kl": 0.0015448677982021763, "entropy": 1.1213326454162598, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2751899465918541, "cur_kl_coeff": 1.8626451492309571e-10, "cur_lr": 5e-05, "total_loss": 9.568231129646302, "policy_loss": -0.004194224183447659, "vf_loss": 9.572425413131715, "vf_explained_var": -6.36667013168335e-05, "kl": 0.002463338265897619, "entropy": 1.5803050935268401, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9238727867603302, "cur_kl_coeff": 2.9802322387695314e-09, "cur_lr": 5e-05, "total_loss": 9.891773438453674, "policy_loss": -0.002124910242855549, "vf_loss": 9.893898224830627, "vf_explained_var": -0.0012130290269851685, "kl": 0.004166613582402556, "entropy": 0.6988307952880859, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.049578481912613, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 9.008058571815491, "policy_loss": -0.0013168316567316652, "vf_loss": 9.009347510337829, "vf_explained_var": 0.0005738571286201477, "kl": 0.008914268447915675, "entropy": 2.2896494626998902, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 5045.729604867309, "episode_len_mean": 3099.4285714285716, "episode_media": {}, "episodes_timesteps_total": 21696, "policy_reward_min": {"high_level_policy": 1838.012748472349, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3835.32636816224, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 2193.3576842383213, "DC1_ls_policy": -1595.559835844963, "DC2_ls_policy": 2727.8529953715215, "DC3_ls_policy": 1720.0787611024118}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 95579.55209580927, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 104233.70259970451, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.14769294231438537, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.012703252032520325, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4496218057574763, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73341.4746377517, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1119691458233125, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79503.85319174864, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.021629134942143073, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47076266927892946, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 96012679.5219194, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 127922074.63539377, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 70.4919270463427, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1129.7505213875113, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048345981882118, "mean_inference_ms": 2.222240304836487, "mean_action_processing_ms": 0.3249680128653089, "mean_env_wait_ms": 4.259810202692484, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003488574709211077, "StateBufferConnector_ms": 0.002474444253104074, "ViewRequirementAgentConnector_ms": 0.05316649164472308}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 3918.497903067926, "episode_return_mean": 5045.729604867309, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264, "num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 573.140840525783, "num_env_steps_trained_throughput_per_sec": 573.140840525783, "timesteps_total": 34816, "num_env_steps_sampled_lifetime": 34816, "num_agent_steps_sampled_lifetime": 139264, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 139264, "timers": {"training_iteration_time_ms": 1815.007, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1814.886, "sample_time_ms": 1127.097, "learn_time_ms": 668.682, "learn_throughput": 1531.372, "synch_weights_time_ms": 10.688}, "counters": {"num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264}, "done": false, "training_iteration": 34, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-54", "timestamp": 1729611774, "time_this_iter_s": 1.7942736148834229, "time_total_s": 61.90826201438904, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1553f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212e00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213010>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2130d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213190>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 61.90826201438904, "iterations_since_restore": 34, "perf": {"cpu_util_percent": 3.95, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6340448811650274, "cur_kl_coeff": 7.450580596923829e-10, "cur_lr": 5e-05, "total_loss": 8.833055114746093, "policy_loss": -0.0024588712491095065, "vf_loss": 8.835514092445374, "vf_explained_var": 2.333521842956543e-06, "kl": 0.0034062950037878183, "entropy": 1.2850254118442535, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4621587105095386, "cur_kl_coeff": 9.313225746154786e-11, "cur_lr": 5e-05, "total_loss": 9.00963897705078, "policy_loss": -0.0053309232229366895, "vf_loss": 9.014969849586487, "vf_explained_var": -0.00013618767261505126, "kl": 0.00768120446090279, "entropy": 1.6643845200538636, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.211083760857582, "cur_kl_coeff": 1.4901161193847657e-09, "cur_lr": 5e-05, "total_loss": 9.870125126838683, "policy_loss": -0.0009806085261516273, "vf_loss": 9.871105742454528, "vf_explained_var": -0.0005322128534317016, "kl": 0.0014419831456052635, "entropy": 0.7311587765812874, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.9514793187379835, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 8.915970468521119, "policy_loss": -0.007868254883214831, "vf_loss": 8.923802995681763, "vf_explained_var": 0.00013837367296218873, "kl": 0.011409765541999618, "entropy": 2.2703469514846804, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 35840, "num_env_steps_trained": 35840, "num_agent_steps_sampled": 143360, "num_agent_steps_trained": 143360}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 5045.729604867309, "episode_len_mean": 3099.4285714285716, "episode_media": {}, "episodes_timesteps_total": 21696, "policy_reward_min": {"high_level_policy": 1838.012748472349, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3835.32636816224, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 2193.3576842383213, "DC1_ls_policy": -1595.559835844963, "DC2_ls_policy": 2727.8529953715215, "DC3_ls_policy": 1720.0787611024118}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 95579.55209580927, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 104233.70259970451, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.14769294231438537, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.012703252032520325, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4496218057574763, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73341.4746377517, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1119691458233125, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79503.85319174864, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.021629134942143073, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47076266927892946, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 96012679.5219194, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 127922074.63539377, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 70.4919270463427, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1129.7505213875113, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048345981882118, "mean_inference_ms": 2.222240304836487, "mean_action_processing_ms": 0.3249680128653089, "mean_env_wait_ms": 4.259810202692484, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003488574709211077, "StateBufferConnector_ms": 0.002474444253104074, "ViewRequirementAgentConnector_ms": 0.05316649164472308}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 3918.497903067926, "episode_return_mean": 5045.729604867309, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 143360, "num_agent_steps_trained": 143360, "num_env_steps_sampled": 35840, "num_env_steps_trained": 35840, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.8757295451672, "num_env_steps_trained_throughput_per_sec": 576.8757295451672, "timesteps_total": 35840, "num_env_steps_sampled_lifetime": 35840, "num_agent_steps_sampled_lifetime": 143360, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 143360, "timers": {"training_iteration_time_ms": 1813.467, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1813.347, "sample_time_ms": 1125.312, "learn_time_ms": 668.858, "learn_throughput": 1530.969, "synch_weights_time_ms": 10.719}, "counters": {"num_env_steps_sampled": 35840, "num_env_steps_trained": 35840, "num_agent_steps_sampled": 143360, "num_agent_steps_trained": 143360}, "done": false, "training_iteration": 35, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-56", "timestamp": 1729611776, "time_this_iter_s": 1.781548261642456, "time_total_s": 63.689810276031494, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fdff3c8a320>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2137f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213910>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213a00>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213ac0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 63.689810276031494, "iterations_since_restore": 35, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4955044969916345, "cur_kl_coeff": 3.7252902984619143e-10, "cur_lr": 5e-05, "total_loss": 9.0879385471344, "policy_loss": -0.000745578296482563, "vf_loss": 9.088684177398681, "vf_explained_var": 8.71121883392334e-06, "kl": 0.0005689676047040848, "entropy": 1.3853407412767411, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.357849490642548, "cur_kl_coeff": 9.313225746154786e-11, "cur_lr": 5e-05, "total_loss": 8.848553895950317, "policy_loss": -0.0020404539769515394, "vf_loss": 8.850594472885131, "vf_explained_var": -0.0006619006395339966, "kl": 0.0018787009826896379, "entropy": 1.5073774218559266, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0001703932881356, "cur_kl_coeff": 7.450580596923829e-10, "cur_lr": 5e-05, "total_loss": 9.879801893234253, "policy_loss": -0.0025906354654580354, "vf_loss": 9.88239254951477, "vf_explained_var": 0.0009194418787956237, "kl": 0.0029652697320670996, "entropy": 0.7188483580946923, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.253524121642113, "cur_kl_coeff": 0.003125, "cur_lr": 5e-05, "total_loss": 8.740748810768128, "policy_loss": -0.012478309846483172, "vf_loss": 8.753163719177246, "vf_explained_var": -0.0011227071285247804, "kl": 0.02026980791051881, "entropy": 2.1724573373794556, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 5045.729604867309, "episode_len_mean": 3099.4285714285716, "episode_media": {}, "episodes_timesteps_total": 21696, "policy_reward_min": {"high_level_policy": 1838.012748472349, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3835.32636816224, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 2193.3576842383213, "DC1_ls_policy": -1595.559835844963, "DC2_ls_policy": 2727.8529953715215, "DC3_ls_policy": 1720.0787611024118}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 95579.55209580927, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 104233.70259970451, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.14769294231438537, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.012703252032520325, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4496218057574763, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73341.4746377517, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1119691458233125, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79503.85319174864, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.021629134942143073, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47076266927892946, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 96012679.5219194, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 127922074.63539377, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 70.4919270463427, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1129.7505213875113, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048345981882118, "mean_inference_ms": 2.222240304836487, "mean_action_processing_ms": 0.3249680128653089, "mean_env_wait_ms": 4.259810202692484, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003488574709211077, "StateBufferConnector_ms": 0.002474444253104074, "ViewRequirementAgentConnector_ms": 0.05316649164472308}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 3918.497903067926, "episode_return_mean": 5045.729604867309, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456, "num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 527.3040348949017, "num_env_steps_trained_throughput_per_sec": 527.3040348949017, "timesteps_total": 36864, "num_env_steps_sampled_lifetime": 36864, "num_agent_steps_sampled_lifetime": 147456, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 147456, "timers": {"training_iteration_time_ms": 1830.565, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1830.445, "sample_time_ms": 1141.954, "learn_time_ms": 669.28, "learn_throughput": 1530.001, "synch_weights_time_ms": 10.685}, "counters": {"num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456}, "done": false, "training_iteration": 36, "trial_id": "22c84_00000", "date": "2024-10-22_15-42-58", "timestamp": 1729611778, "time_this_iter_s": 1.948817253112793, "time_total_s": 65.63862752914429, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a30a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213490>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2135e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2136d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213be0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 65.63862752914429, "iterations_since_restore": 36, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.967739886045456, "cur_kl_coeff": 1.8626451492309571e-10, "cur_lr": 5e-05, "total_loss": 9.285078048706055, "policy_loss": -0.013004829874262214, "vf_loss": 9.298083114624024, "vf_explained_var": 0.00010285228490829468, "kl": 0.019005639639272272, "entropy": 1.4257842630147934, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7073450565338135, "cur_kl_coeff": 4.656612873077393e-11, "cur_lr": 5e-05, "total_loss": 9.21029760837555, "policy_loss": -0.0071397119667381045, "vf_loss": 9.217437291145325, "vf_explained_var": -0.00023905038833618164, "kl": 0.0035500260994015694, "entropy": 1.6469773024320602, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6651726946234704, "cur_kl_coeff": 3.7252902984619143e-10, "cur_lr": 5e-05, "total_loss": 9.904569149017334, "policy_loss": -0.001747337100096047, "vf_loss": 9.90631651878357, "vf_explained_var": 0.00028235316276550295, "kl": 0.001412812411865616, "entropy": 0.8013630166649819, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.896130049228669, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.224190986156463, "policy_loss": -0.00398960174061358, "vf_loss": 8.228131580352784, "vf_explained_var": -0.00043264329433441163, "kl": 0.010445227966556558, "entropy": 2.17999604344368, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 37888, "num_env_steps_trained": 37888, "num_agent_steps_sampled": 151552, "num_agent_steps_trained": 151552}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 3918.497903067926, "episode_reward_mean": 5045.729604867309, "episode_len_mean": 3099.4285714285716, "episode_media": {}, "episodes_timesteps_total": 21696, "policy_reward_min": {"high_level_policy": 1838.012748472349, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 786.8394459853729}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3835.32636816224, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 2193.3576842383213, "DC1_ls_policy": -1595.559835844963, "DC2_ls_policy": 2727.8529953715215, "DC3_ls_policy": 1720.0787611024118}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 95579.55209580927, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 104233.70259970451, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.14769294231438537, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.012703252032520325, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4496218057574763, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.8229166666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 73341.4746377517, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 70373.46323637369, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.1119691458233125, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 79503.85319174864, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 84027.30083171885, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.021629134942143073, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47076266927892946, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 96012679.5219194, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 127922074.63539377, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 70.4919270463427, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 40.334587191358025, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1129.7505213875113, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 679.5485416666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048345981882118, "mean_inference_ms": 2.222240304836487, "mean_action_processing_ms": 0.3249680128653089, "mean_env_wait_ms": 4.259810202692484, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003488574709211077, "StateBufferConnector_ms": 0.002474444253104074, "ViewRequirementAgentConnector_ms": 0.05316649164472308}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 3918.497903067926, "episode_return_mean": 5045.729604867309, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 151552, "num_agent_steps_trained": 151552, "num_env_steps_sampled": 37888, "num_env_steps_trained": 37888, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 571.1925135574473, "num_env_steps_trained_throughput_per_sec": 571.1925135574473, "timesteps_total": 37888, "num_env_steps_sampled_lifetime": 37888, "num_agent_steps_sampled_lifetime": 151552, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 151552, "timers": {"training_iteration_time_ms": 1832.323, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1832.203, "sample_time_ms": 1143.88, "learn_time_ms": 669.199, "learn_throughput": 1530.188, "synch_weights_time_ms": 10.619}, "counters": {"num_env_steps_sampled": 37888, "num_env_steps_trained": 37888, "num_agent_steps_sampled": 151552, "num_agent_steps_trained": 151552}, "done": false, "training_iteration": 37, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-00", "timestamp": 1729611780, "time_this_iter_s": 1.7987563610076904, "time_total_s": 67.43738389015198, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156680>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238280>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2382b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238550>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238100>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 67.43738389015198, "iterations_since_restore": 37, "perf": {"cpu_util_percent": 4.05, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.80791787058115, "cur_kl_coeff": 1.8626451492309571e-10, "cur_lr": 5e-05, "total_loss": 9.298212599754333, "policy_loss": -0.007183789554983377, "vf_loss": 9.30539653301239, "vf_explained_var": -1.9142031669616698e-05, "kl": 0.004033277606049523, "entropy": 1.189433142542839, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.028769299387932, "cur_kl_coeff": 2.3283064365386964e-11, "cur_lr": 5e-05, "total_loss": 9.355989456176758, "policy_loss": -0.0028043040831107644, "vf_loss": 9.35879397392273, "vf_explained_var": -0.0001881033182144165, "kl": 0.002487268985123592, "entropy": 1.6855087757110596, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.5333768099546434, "cur_kl_coeff": 1.8626451492309571e-10, "cur_lr": 5e-05, "total_loss": 9.842049884796143, "policy_loss": -0.0044064601301215586, "vf_loss": 9.84645619392395, "vf_explained_var": -2.1173059940338136e-05, "kl": 0.006261511444319012, "entropy": 0.7143246084451675, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.3354944586753845, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.454974138736725, "policy_loss": -0.005250432225875556, "vf_loss": 8.460169887542724, "vf_explained_var": 0.0007940635085105896, "kl": 0.011664594621197465, "entropy": 2.079738664627075, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2745.2236308223414, "episode_reward_mean": 4627.498850083049, "episode_len_mean": 2944.0, "episode_media": {}, "episodes_timesteps_total": 26496, "policy_reward_min": {"high_level_policy": 429.0715045680256, "DC1_ls_policy": -2158.771406101319, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 371.7755735498899}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 3835.32636816224, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1871.732448393466, "DC1_ls_policy": -1426.7666350704853, "DC2_ls_policy": 2751.6324793656813, "DC3_ls_policy": 1430.9005573943718}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 99083.59252861253, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 113834.29525454159, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.1148722884667442, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.174752145218778, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 70350.3017689394, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.08717970601072453, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 83664.88211224233, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 99185.64049137369, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.016822660510555722, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.49022281684657476, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 92174488.83504108, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 127922074.63539377, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.827054369377656, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 967.7452434865829, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6072025654277106, "mean_inference_ms": 2.227297500679337, "mean_action_processing_ms": 0.3250174204776116, "mean_env_wait_ms": 4.2766295392252935, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0037266148461235892, "StateBufferConnector_ms": 0.0024927986992730033, "ViewRequirementAgentConnector_ms": 0.05365610122680664}, "num_episodes": 2, "episode_return_max": 6259.601343003307, "episode_return_min": 2745.2236308223414, "episode_return_mean": 4627.498850083049, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648, "num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 573.5623401575085, "num_env_steps_trained_throughput_per_sec": 573.5623401575085, "timesteps_total": 38912, "num_env_steps_sampled_lifetime": 38912, "num_agent_steps_sampled_lifetime": 155648, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 155648, "timers": {"training_iteration_time_ms": 1818.701, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1818.581, "sample_time_ms": 1145.559, "learn_time_ms": 653.832, "learn_throughput": 1566.151, "synch_weights_time_ms": 10.695}, "counters": {"num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648}, "done": false, "training_iteration": 38, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-02", "timestamp": 1729611782, "time_this_iter_s": 1.793034315109253, "time_total_s": 69.23041820526123, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fa30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a530>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239cc0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239750>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239540>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 69.23041820526123, "iterations_since_restore": 38, "perf": {"cpu_util_percent": 3.4, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.310410635918379, "cur_kl_coeff": 9.313225746154786e-11, "cur_lr": 5e-05, "total_loss": 9.348032021522522, "policy_loss": -0.008526843250729143, "vf_loss": 9.356558680534363, "vf_explained_var": -1.2692809104919433e-05, "kl": 0.010365389359230903, "entropy": 1.5395915806293488, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7901118695735931, "cur_kl_coeff": 1.1641532182693482e-11, "cur_lr": 5e-05, "total_loss": 9.105192160606384, "policy_loss": -0.001979623711667955, "vf_loss": 9.107171559333802, "vf_explained_var": -2.8789043426513672e-05, "kl": 0.002029941088585474, "entropy": 1.8757172852754593, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9076660931110383, "cur_kl_coeff": 1.8626451492309571e-10, "cur_lr": 5e-05, "total_loss": 9.893159222602844, "policy_loss": -0.0007366230944171548, "vf_loss": 9.893895840644836, "vf_explained_var": 0.0003746733069419861, "kl": 0.003738662522573577, "entropy": 0.6966275051236153, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.734052562713623, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.059087419509888, "policy_loss": -0.00457571626175195, "vf_loss": 9.063621401786804, "vf_explained_var": 0.0007842257618904114, "kl": 0.008952879792559543, "entropy": 2.124664378166199, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 39936, "num_env_steps_trained": 39936, "num_agent_steps_sampled": 159744, "num_agent_steps_trained": 159744}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2745.2236308223414, "episode_reward_mean": 4654.118871020463, "episode_len_mean": 3148.8, "episode_media": {}, "episodes_timesteps_total": 31488, "policy_reward_min": {"high_level_policy": 429.0715045680256, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 371.7755735498899}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1797.8302810653684, "DC1_ls_policy": -1583.9566722425031, "DC2_ls_policy": 2996.1414321477505, "DC3_ls_policy": 1444.1038300498349}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 100075.54737909962, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 113834.29525454159, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.11484339295340311, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.157877892235362, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 70247.33697764913, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07846173540965208, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 84831.48839532681, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 99185.64049137369, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.015240554715910407, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.49995454157217367, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 99562834.13216016, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 59.88676680102964, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1038.6396093622836, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6063394538815261, "mean_inference_ms": 2.2249305177856793, "mean_action_processing_ms": 0.3244275396745701, "mean_env_wait_ms": 4.273034945695424, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036543607711791992, "StateBufferConnector_ms": 0.002486109733581543, "ViewRequirementAgentConnector_ms": 0.05351543426513672}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 2745.2236308223414, "episode_return_mean": 4654.118871020463, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 159744, "num_agent_steps_trained": 159744, "num_env_steps_sampled": 39936, "num_env_steps_trained": 39936, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 573.6948804254484, "num_env_steps_trained_throughput_per_sec": 573.6948804254484, "timesteps_total": 39936, "num_env_steps_sampled_lifetime": 39936, "num_agent_steps_sampled_lifetime": 159744, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 159744, "timers": {"training_iteration_time_ms": 1815.829, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1815.71, "sample_time_ms": 1142.97, "learn_time_ms": 653.536, "learn_throughput": 1566.861, "synch_weights_time_ms": 10.689}, "counters": {"num_env_steps_sampled": 39936, "num_env_steps_trained": 39936, "num_agent_steps_sampled": 159744, "num_agent_steps_trained": 159744}, "done": false, "training_iteration": 39, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-03", "timestamp": 1729611783, "time_this_iter_s": 1.7922496795654297, "time_total_s": 71.02266788482666, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db155090>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11780>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11a20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11ba0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11f00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 71.02266788482666, "iterations_since_restore": 39, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4591657191514968, "cur_kl_coeff": 9.313225746154786e-11, "cur_lr": 5e-05, "total_loss": 9.34755961894989, "policy_loss": -0.002515876910183579, "vf_loss": 9.350075554847717, "vf_explained_var": 4.880130290985107e-06, "kl": 0.002083261349162724, "entropy": 1.335276660323143, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.9367879144847393, "cur_kl_coeff": 5.820766091346741e-12, "cur_lr": 5e-05, "total_loss": 9.013900685310364, "policy_loss": -0.0017269358970224858, "vf_loss": 9.015627646446228, "vf_explained_var": -9.309351444244384e-05, "kl": 0.0033098182111643837, "entropy": 1.6786964029073714, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.102007181197405, "cur_kl_coeff": 9.313225746154786e-11, "cur_lr": 5e-05, "total_loss": 9.879817867279053, "policy_loss": -0.002708408673061058, "vf_loss": 9.88252625465393, "vf_explained_var": 0.0007331013679504394, "kl": 0.002198590232183051, "entropy": 0.7144392654299736, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.7289855003356935, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.286511969566345, "policy_loss": -0.005757293140050024, "vf_loss": 8.29223074913025, "vf_explained_var": 9.817630052566528e-05, "kl": 0.008232543020494632, "entropy": 2.113233137130737, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2745.2236308223414, "episode_reward_mean": 4654.118871020463, "episode_len_mean": 3148.8, "episode_media": {}, "episodes_timesteps_total": 31488, "policy_reward_min": {"high_level_policy": 429.0715045680256, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 371.7755735498899}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1797.8302810653684, "DC1_ls_policy": -1583.9566722425031, "DC2_ls_policy": 2996.1414321477505, "DC3_ls_policy": 1444.1038300498349}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 100075.54737909962, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 113834.29525454159, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.11484339295340311, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.157877892235362, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 70247.33697764913, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07846173540965208, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 84831.48839532681, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 99185.64049137369, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.015240554715910407, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.49995454157217367, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 99562834.13216016, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 59.88676680102964, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1038.6396093622836, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6063394538815261, "mean_inference_ms": 2.2249305177856793, "mean_action_processing_ms": 0.3244275396745701, "mean_env_wait_ms": 4.273034945695424, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036543607711791992, "StateBufferConnector_ms": 0.002486109733581543, "ViewRequirementAgentConnector_ms": 0.05351543426513672}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2745.2236308223414, "episode_return_mean": 4654.118871020463, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840, "num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 529.3558455689005, "num_env_steps_trained_throughput_per_sec": 529.3558455689005, "timesteps_total": 40960, "num_env_steps_sampled_lifetime": 40960, "num_agent_steps_sampled_lifetime": 163840, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 163840, "timers": {"training_iteration_time_ms": 1829.964, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1829.844, "sample_time_ms": 1155.338, "learn_time_ms": 654.691, "learn_throughput": 1564.098, "synch_weights_time_ms": 10.765}, "counters": {"num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840}, "done": false, "training_iteration": 40, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-05", "timestamp": 1729611785, "time_this_iter_s": 1.9404306411743164, "time_total_s": 72.96309852600098, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3f40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12770>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c128c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12a70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12b60>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 72.96309852600098, "iterations_since_restore": 40, "perf": {"cpu_util_percent": 4.1, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6417580395936966, "cur_kl_coeff": 4.656612873077393e-11, "cur_lr": 5e-05, "total_loss": 9.428302574157716, "policy_loss": -0.0027619343250989913, "vf_loss": 9.43106460571289, "vf_explained_var": -0.00013738274574279786, "kl": 0.002089080092036966, "entropy": 1.4400715827941895, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2902027040719988, "cur_kl_coeff": 2.9103830456733705e-12, "cur_lr": 5e-05, "total_loss": 9.159159636497497, "policy_loss": -0.014306360739283264, "vf_loss": 9.173466062545776, "vf_explained_var": -0.00024159252643585205, "kl": 0.028062570552469877, "entropy": 1.6800878912210464, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9534559011459351, "cur_kl_coeff": 4.656612873077393e-11, "cur_lr": 5e-05, "total_loss": 9.877529382705688, "policy_loss": -0.005323545192368329, "vf_loss": 9.882853031158447, "vf_explained_var": 6.694048643112183e-05, "kl": 0.008528137302710093, "entropy": 0.6504295289516449, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.448392885923385, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.046178317070007, "policy_loss": -0.005038935970515013, "vf_loss": 9.05117244720459, "vf_explained_var": -0.00022586286067962646, "kl": 0.009588234715192812, "entropy": 2.117354965209961, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 41984, "num_env_steps_trained": 41984, "num_agent_steps_sampled": 167936, "num_agent_steps_trained": 167936}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 167936, "num_agent_steps_trained": 167936, "num_env_steps_sampled": 41984, "num_env_steps_trained": 41984, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 577.1462709415323, "num_env_steps_trained_throughput_per_sec": 577.1462709415323, "timesteps_total": 41984, "num_env_steps_sampled_lifetime": 41984, "num_agent_steps_sampled_lifetime": 167936, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 167936, "timers": {"training_iteration_time_ms": 1828.488, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1828.369, "sample_time_ms": 1153.735, "learn_time_ms": 654.696, "learn_throughput": 1564.084, "synch_weights_time_ms": 10.771}, "counters": {"num_env_steps_sampled": 41984, "num_env_steps_trained": 41984, "num_agent_steps_sampled": 167936, "num_agent_steps_trained": 167936}, "done": false, "training_iteration": 41, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-07", "timestamp": 1729611787, "time_this_iter_s": 1.7815685272216797, "time_total_s": 74.74466705322266, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154430>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13610>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13e20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13f10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13340>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 74.74466705322266, "iterations_since_restore": 41, "perf": {"cpu_util_percent": 3.2000000000000006, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4190704017877578, "cur_kl_coeff": 2.3283064365386964e-11, "cur_lr": 5e-05, "total_loss": 9.306964659690857, "policy_loss": -0.003046414314303547, "vf_loss": 9.3100111246109, "vf_explained_var": -1.7195940017700196e-06, "kl": 0.005037271520859576, "entropy": 1.4690012723207473, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1527014493942263, "cur_kl_coeff": 4.365574568510056e-12, "cur_lr": 5e-05, "total_loss": 9.275206446647644, "policy_loss": -0.001475586066953838, "vf_loss": 9.276681995391845, "vf_explained_var": -0.00010419785976409913, "kl": 0.0009906294380817304, "entropy": 1.6762984216213226, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3477137595415116, "cur_kl_coeff": 4.656612873077393e-11, "cur_lr": 5e-05, "total_loss": 9.872310543060303, "policy_loss": -0.003101128013804555, "vf_loss": 9.875411581993102, "vf_explained_var": -0.0007285833358764649, "kl": 0.006398828890679867, "entropy": 0.597006943821907, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.582574236392975, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.222176933288575, "policy_loss": -0.006310365884564817, "vf_loss": 9.228423643112183, "vf_explained_var": -0.00024169981479644776, "kl": 0.013585167329804453, "entropy": 1.987659177184105, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032, "num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 577.3388276155295, "num_env_steps_trained_throughput_per_sec": 577.3388276155295, "timesteps_total": 43008, "num_env_steps_sampled_lifetime": 43008, "num_agent_steps_sampled_lifetime": 172032, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 172032, "timers": {"training_iteration_time_ms": 1812.936, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1812.816, "sample_time_ms": 1138.716, "learn_time_ms": 654.552, "learn_throughput": 1564.43, "synch_weights_time_ms": 10.766}, "counters": {"num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032}, "done": false, "training_iteration": 42, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-09", "timestamp": 1729611789, "time_this_iter_s": 1.7811074256896973, "time_total_s": 76.52577447891235, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11570>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11ff0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c120b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c121a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 76.52577447891235, "iterations_since_restore": 42, "perf": {"cpu_util_percent": 3.2000000000000006, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7536949500441552, "cur_kl_coeff": 2.3283064365386964e-11, "cur_lr": 5e-05, "total_loss": 9.007503175735474, "policy_loss": -0.007833825633861124, "vf_loss": 9.015337061882018, "vf_explained_var": 5.644559860229492e-06, "kl": 0.010890639049830498, "entropy": 1.525567889213562, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3682239659130575, "cur_kl_coeff": 2.182787284255028e-12, "cur_lr": 5e-05, "total_loss": 9.035972285270692, "policy_loss": 8.599073626101018e-05, "vf_loss": 9.03588638305664, "vf_explained_var": -0.0001017451286315918, "kl": 0.001776851510294364, "entropy": 1.7484645962715148, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.23856335580349, "cur_kl_coeff": 4.656612873077393e-11, "cur_lr": 5e-05, "total_loss": 9.88556501865387, "policy_loss": -0.002623818744905293, "vf_loss": 9.888189125061036, "vf_explained_var": -0.00029149651527404785, "kl": 0.002795641120293618, "entropy": 0.5821059927344322, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.054936331510544, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.911668229103089, "policy_loss": -0.005101095337886363, "vf_loss": 8.91670801639557, "vf_explained_var": -0.0002790719270706177, "kl": 0.013072651073571251, "entropy": 1.8148768216371536, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 44032, "num_env_steps_trained": 44032, "num_agent_steps_sampled": 176128, "num_agent_steps_trained": 176128}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 176128, "num_agent_steps_trained": 176128, "num_env_steps_sampled": 44032, "num_env_steps_trained": 44032, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 580.3006096242812, "num_env_steps_trained_throughput_per_sec": 580.3006096242812, "timesteps_total": 44032, "num_env_steps_sampled_lifetime": 44032, "num_agent_steps_sampled_lifetime": 176128, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 176128, "timers": {"training_iteration_time_ms": 1811.387, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1811.268, "sample_time_ms": 1136.622, "learn_time_ms": 655.056, "learn_throughput": 1563.225, "synch_weights_time_ms": 10.764}, "counters": {"num_env_steps_sampled": 44032, "num_env_steps_trained": 44032, "num_agent_steps_sampled": 176128, "num_agent_steps_trained": 176128}, "done": false, "training_iteration": 43, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-11", "timestamp": 1729611791, "time_this_iter_s": 1.7708148956298828, "time_total_s": 78.29658937454224, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3a30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c129b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13220>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13310>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239ff0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 78.29658937454224, "iterations_since_restore": 43, "perf": {"cpu_util_percent": 4.05, "ram_util_percent": 2.7}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.848063064366579, "cur_kl_coeff": 2.3283064365386964e-11, "cur_lr": 5e-05, "total_loss": 9.149670696258545, "policy_loss": -0.006691734341438859, "vf_loss": 9.156362628936767, "vf_explained_var": -5.9610605239868165e-05, "kl": 0.016193544732959708, "entropy": 1.6917322605848313, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5143198400735856, "cur_kl_coeff": 1.091393642127514e-12, "cur_lr": 5e-05, "total_loss": 9.471448588371278, "policy_loss": -0.008841491304337978, "vf_loss": 9.480290150642395, "vf_explained_var": -5.8785080909729e-06, "kl": 0.018634468037771513, "entropy": 1.6593844562768936, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2872656330466272, "cur_kl_coeff": 2.3283064365386964e-11, "cur_lr": 5e-05, "total_loss": 9.887210845947266, "policy_loss": -0.003903846291359514, "vf_loss": 9.891114783287048, "vf_explained_var": -0.0001546919345855713, "kl": 0.006391964763588475, "entropy": 0.5984615787863732, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.8535395860672, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.530695796012878, "policy_loss": -0.0031710825162008403, "vf_loss": 8.533823847770691, "vf_explained_var": 0.00021022707223892212, "kl": 0.009166492068652587, "entropy": 1.736735787987709, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224, "num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 530.3413493073282, "num_env_steps_trained_throughput_per_sec": 530.3413493073282, "timesteps_total": 45056, "num_env_steps_sampled_lifetime": 45056, "num_agent_steps_sampled_lifetime": 180224, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 180224, "timers": {"training_iteration_time_ms": 1825.806, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1825.688, "sample_time_ms": 1151.795, "learn_time_ms": 654.54, "learn_throughput": 1564.459, "synch_weights_time_ms": 10.499}, "counters": {"num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224}, "done": false, "training_iteration": 44, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-13", "timestamp": 1729611793, "time_this_iter_s": 1.9384334087371826, "time_total_s": 80.23502278327942, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db157a30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213c40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211a80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213d00>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211300>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 80.23502278327942, "iterations_since_restore": 44, "perf": {"cpu_util_percent": 3.2999999999999994, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8858380526304246, "cur_kl_coeff": 2.3283064365386964e-11, "cur_lr": 5e-05, "total_loss": 9.29037971496582, "policy_loss": -0.001865420350804925, "vf_loss": 9.292245221138, "vf_explained_var": 0.0001397937536239624, "kl": 0.002368690889852587, "entropy": 1.7114444971084595, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8431093141436576, "cur_kl_coeff": 1.091393642127514e-12, "cur_lr": 5e-05, "total_loss": 9.071922516822815, "policy_loss": 2.317677717655897e-05, "vf_loss": 9.07189919948578, "vf_explained_var": -0.00011725425720214844, "kl": 0.001283837879782368, "entropy": 1.6428740352392197, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.030728352069855, "cur_kl_coeff": 2.3283064365386964e-11, "cur_lr": 5e-05, "total_loss": 9.878590655326843, "policy_loss": -0.0024707701755687594, "vf_loss": 9.881061363220216, "vf_explained_var": 0.0004526212811470032, "kl": 0.0010011006559579982, "entropy": 0.6370196253061294, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.816799110174179, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.40736219882965, "policy_loss": -0.001210991945117712, "vf_loss": 8.408539521694184, "vf_explained_var": 0.00010421872138977051, "kl": 0.007179968926906572, "entropy": 1.7392624020576477, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 46080, "num_env_steps_trained": 46080, "num_agent_steps_sampled": 184320, "num_agent_steps_trained": 184320}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 184320, "num_agent_steps_trained": 184320, "num_env_steps_sampled": 46080, "num_env_steps_trained": 46080, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 568.6769422981158, "num_env_steps_trained_throughput_per_sec": 568.6769422981158, "timesteps_total": 46080, "num_env_steps_sampled_lifetime": 46080, "num_agent_steps_sampled_lifetime": 184320, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 184320, "timers": {"training_iteration_time_ms": 1828.362, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1828.249, "sample_time_ms": 1153.648, "learn_time_ms": 654.893, "learn_throughput": 1563.615, "synch_weights_time_ms": 10.509}, "counters": {"num_env_steps_sampled": 46080, "num_env_steps_trained": 46080, "num_agent_steps_sampled": 184320, "num_agent_steps_trained": 184320}, "done": false, "training_iteration": 45, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-15", "timestamp": 1729611795, "time_this_iter_s": 1.8073627948760986, "time_total_s": 82.04238557815552, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fdff3c8a320>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211ff0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212320>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2126b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212770>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 82.04238557815552, "iterations_since_restore": 45, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8319522857666015, "cur_kl_coeff": 1.1641532182693482e-11, "cur_lr": 5e-05, "total_loss": 9.376335525512696, "policy_loss": -0.0031526204431429504, "vf_loss": 9.379488039016724, "vf_explained_var": 4.484802484512329e-05, "kl": 0.0018913240100232541, "entropy": 1.646309044957161, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0603813901543617, "cur_kl_coeff": 5.45696821063757e-13, "cur_lr": 5e-05, "total_loss": 9.11175365447998, "policy_loss": -0.005002438230440021, "vf_loss": 9.116756105422974, "vf_explained_var": -6.63667917251587e-05, "kl": 0.005896402807889355, "entropy": 1.6473282903432847, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2184172362089156, "cur_kl_coeff": 1.1641532182693482e-11, "cur_lr": 5e-05, "total_loss": 9.897969245910645, "policy_loss": -0.0029963289853185415, "vf_loss": 9.900965762138366, "vf_explained_var": 0.0005566895008087159, "kl": 0.006952627830652191, "entropy": 0.628504964709282, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.711224460601807, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.729934239387513, "policy_loss": -0.0037727736867964267, "vf_loss": 8.73366982936859, "vf_explained_var": -5.715042352676392e-05, "kl": 0.007942987585101946, "entropy": 1.803800928592682, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416, "num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 575.3944323365827, "num_env_steps_trained_throughput_per_sec": 575.3944323365827, "timesteps_total": 47104, "num_env_steps_sampled_lifetime": 47104, "num_agent_steps_sampled_lifetime": 188416, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 188416, "timers": {"training_iteration_time_ms": 1812.131, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1812.019, "sample_time_ms": 1137.326, "learn_time_ms": 654.901, "learn_throughput": 1563.596, "synch_weights_time_ms": 10.507}, "counters": {"num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416}, "done": false, "training_iteration": 46, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-17", "timestamp": 1729611797, "time_this_iter_s": 1.7869224548339844, "time_total_s": 83.8293080329895, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154160>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211780>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211930>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211a50>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212890>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 83.8293080329895, "iterations_since_restore": 46, "perf": {"cpu_util_percent": 3.3333333333333335, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3373739674687384, "cur_kl_coeff": 5.820766091346741e-12, "cur_lr": 5e-05, "total_loss": 9.48196520805359, "policy_loss": -0.0030525751179084184, "vf_loss": 9.48501784801483, "vf_explained_var": 1.2612342834472656e-05, "kl": 0.00219377739877018, "entropy": 1.830352884531021, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.037498351186514, "cur_kl_coeff": 5.45696821063757e-13, "cur_lr": 5e-05, "total_loss": 9.07950999736786, "policy_loss": -0.003596553485840559, "vf_loss": 9.083106541633606, "vf_explained_var": -1.6698241233825682e-05, "kl": 0.003358133533424734, "entropy": 1.6065816074609756, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7394932433962822, "cur_kl_coeff": 1.1641532182693482e-11, "cur_lr": 5e-05, "total_loss": 9.8913902759552, "policy_loss": -0.0013859112048521637, "vf_loss": 9.892775988578796, "vf_explained_var": 2.8112530708312987e-05, "kl": 0.0027757361091062193, "entropy": 0.5674853235483169, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.372413444519043, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.962892889976501, "policy_loss": -0.0018662256305105984, "vf_loss": 8.964730644226075, "vf_explained_var": -0.00016079545021057128, "kl": 0.006067634997637265, "entropy": 1.8169792234897613, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 48128, "num_env_steps_trained": 48128, "num_agent_steps_sampled": 192512, "num_agent_steps_trained": 192512}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 192512, "num_agent_steps_trained": 192512, "num_env_steps_sampled": 48128, "num_env_steps_trained": 48128, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 570.2729385571706, "num_env_steps_trained_throughput_per_sec": 570.2729385571706, "timesteps_total": 48128, "num_env_steps_sampled_lifetime": 48128, "num_agent_steps_sampled_lifetime": 192512, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 192512, "timers": {"training_iteration_time_ms": 1812.42, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1812.306, "sample_time_ms": 1137.123, "learn_time_ms": 655.186, "learn_throughput": 1562.914, "synch_weights_time_ms": 10.672}, "counters": {"num_env_steps_sampled": 48128, "num_env_steps_trained": 48128, "num_agent_steps_sampled": 192512, "num_agent_steps_trained": 192512}, "done": false, "training_iteration": 47, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-19", "timestamp": 1729611799, "time_this_iter_s": 1.8025531768798828, "time_total_s": 85.63186120986938, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213100>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2131f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213340>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213400>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 85.63186120986938, "iterations_since_restore": 47, "perf": {"cpu_util_percent": 4.05, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9739241793751716, "cur_kl_coeff": 2.9103830456733705e-12, "cur_lr": 5e-05, "total_loss": 9.432834839820861, "policy_loss": -0.010099069960415364, "vf_loss": 9.442933988571166, "vf_explained_var": 0.00011981278657913208, "kl": 0.02097996301135936, "entropy": 1.985763853788376, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1996684446930885, "cur_kl_coeff": 2.728484105318785e-13, "cur_lr": 5e-05, "total_loss": 8.789024186134338, "policy_loss": -0.010583810531534255, "vf_loss": 8.799608087539672, "vf_explained_var": -0.000295412540435791, "kl": 0.011690568399080803, "entropy": 1.3501080483198167, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.555294248461723, "cur_kl_coeff": 5.820766091346741e-12, "cur_lr": 5e-05, "total_loss": 9.863184785842895, "policy_loss": 6.512594409286976e-05, "vf_loss": 9.863119792938232, "vf_explained_var": 0.0003171458840370178, "kl": 0.0012507158275525398, "entropy": 0.57617017775774, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.200428220629692, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.173105263710022, "policy_loss": -0.0102706300560385, "vf_loss": 9.183308458328247, "vf_explained_var": -6.871819496154786e-05, "kl": 0.014347057694249089, "entropy": 1.901940506696701, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608, "num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 525.6033557612869, "num_env_steps_trained_throughput_per_sec": 525.6033557612869, "timesteps_total": 49152, "num_env_steps_sampled_lifetime": 49152, "num_agent_steps_sampled_lifetime": 196608, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 196608, "timers": {"training_iteration_time_ms": 1828.713, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1828.596, "sample_time_ms": 1153.16, "learn_time_ms": 655.271, "learn_throughput": 1562.712, "synch_weights_time_ms": 10.596}, "counters": {"num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608}, "done": false, "training_iteration": 48, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-21", "timestamp": 1729611801, "time_this_iter_s": 1.9561448097229004, "time_total_s": 87.58800601959229, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1552d0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213910>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211390>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2114e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2117e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 87.58800601959229, "iterations_since_restore": 48, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.553955551981926, "cur_kl_coeff": 4.365574568510056e-12, "cur_lr": 5e-05, "total_loss": 9.44974582195282, "policy_loss": -0.0014125981833785772, "vf_loss": 9.45115852355957, "vf_explained_var": -1.7270445823669434e-05, "kl": 0.001839447396059768, "entropy": 1.74873084127903, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5180070206522942, "cur_kl_coeff": 2.728484105318785e-13, "cur_lr": 5e-05, "total_loss": 9.569751286506653, "policy_loss": -0.006048090988770127, "vf_loss": 9.57579939365387, "vf_explained_var": -0.00017705857753753663, "kl": 0.006102811269920917, "entropy": 1.4124755054712295, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6672670155763627, "cur_kl_coeff": 2.9103830456733705e-12, "cur_lr": 5e-05, "total_loss": 9.870411229133605, "policy_loss": -0.0010663816472515463, "vf_loss": 9.871477437019347, "vf_explained_var": -0.00015119463205337524, "kl": 0.0025748658825989422, "entropy": 0.4641944982111454, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.129427325725556, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.89971706867218, "policy_loss": -0.010660708684008568, "vf_loss": 8.910289287567139, "vf_explained_var": 0.00019025355577468873, "kl": 0.018869272416487958, "entropy": 1.802493330836296, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 50176, "num_env_steps_trained": 50176, "num_agent_steps_sampled": 200704, "num_agent_steps_trained": 200704}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4432.547227082482, "episode_len_mean": 3098.181818181818, "episode_media": {}, "episodes_timesteps_total": 34080, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": 171.55880874537374}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -677.0015736392511, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1652.6646572282132, "DC1_ls_policy": -1555.7183213807277, "DC2_ls_policy": 3007.1829722128286, "DC3_ls_policy": 1328.4179190221566}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101602.09381517953, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.10440308450309374, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.086637028855941, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 1.2058333333333333, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 69343.00997546445, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 56721.318880608196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.07132885037241098, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 86570.00987346115, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 103955.22465480457, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013855049741736734, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.487963724661572, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.2068089430894309, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98565476.69598936, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 54.442515273663304, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 999.279406028002, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6062205860350052, "mean_inference_ms": 2.225840518875896, "mean_action_processing_ms": 0.32472100598166725, "mean_env_wait_ms": 4.280246161876227, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00360228798606179, "StateBufferConnector_ms": 0.002491474151611328, "ViewRequirementAgentConnector_ms": 0.053541768680919304}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4432.547227082482, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 200704, "num_agent_steps_trained": 200704, "num_env_steps_sampled": 50176, "num_env_steps_trained": 50176, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 568.3547831223677, "num_env_steps_trained_throughput_per_sec": 568.3547831223677, "timesteps_total": 50176, "num_env_steps_sampled_lifetime": 50176, "num_agent_steps_sampled_lifetime": 200704, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 200704, "timers": {"training_iteration_time_ms": 1830.39, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1830.273, "sample_time_ms": 1154.871, "learn_time_ms": 655.305, "learn_throughput": 1562.632, "synch_weights_time_ms": 10.544}, "counters": {"num_env_steps_sampled": 50176, "num_env_steps_trained": 50176, "num_agent_steps_sampled": 200704, "num_agent_steps_trained": 200704}, "done": false, "training_iteration": 49, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-23", "timestamp": 1729611803, "time_this_iter_s": 1.8096404075622559, "time_total_s": 89.39764642715454, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fdff3c8a320>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211d80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211e70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212350>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2122f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 89.39764642715454, "iterations_since_restore": 49, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7000000000000006}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.219429109990597, "cur_kl_coeff": 2.182787284255028e-12, "cur_lr": 5e-05, "total_loss": 9.269339013099671, "policy_loss": -0.005747013702057302, "vf_loss": 9.275086069107056, "vf_explained_var": 2.881884574890137e-06, "kl": 0.007016205078254274, "entropy": 1.4928392559289931, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.029240122437477, "cur_kl_coeff": 2.728484105318785e-13, "cur_lr": 5e-05, "total_loss": 9.196612477302551, "policy_loss": -0.0037551075685769318, "vf_loss": 9.200367617607117, "vf_explained_var": -0.00020751357078552246, "kl": 0.010636816286751127, "entropy": 1.0796689689159393, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4854907155036927, "cur_kl_coeff": 1.4551915228366853e-12, "cur_lr": 5e-05, "total_loss": 9.860232472419739, "policy_loss": -0.0008008896373212337, "vf_loss": 9.861033320426941, "vf_explained_var": 0.001745489239692688, "kl": 0.0033258438767006736, "entropy": 0.5307006277143955, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.190379619598389, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.234101676940918, "policy_loss": -0.006081825541332364, "vf_loss": 9.240138030052185, "vf_explained_var": 8.331239223480225e-05, "kl": 0.00968724933663907, "entropy": 1.806840917468071, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4266.055315222502, "episode_len_mean": 3104.0, "episode_media": {}, "episodes_timesteps_total": 37248, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -377.3775790175337, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1554.602355277566, "DC1_ls_policy": -1457.5232595171283, "DC2_ls_policy": 3118.4330953309727, "DC3_ls_policy": 1050.5431241310816}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101943.10333765495, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09570282746116926, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.9672539767879795, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.6540404040404041, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 67784.166339584, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 50636.88634489895, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0653847795080434, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 89452.30811305235, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 121157.58874855557, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.014436573374369785, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5776925472697406, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.564709595959596, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 99282982.37082522, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 50.181174301783955, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 986.0232399848436, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6065816728592521, "mean_inference_ms": 2.2256039771817693, "mean_action_processing_ms": 0.32437754097506366, "mean_env_wait_ms": 4.285844405674097, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003576775391896566, "StateBufferConnector_ms": 0.0024899840354919434, "ViewRequirementAgentConnector_ms": 0.05355477333068848}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4266.055315222502, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800, "num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 578.8399952776, "num_env_steps_trained_throughput_per_sec": 578.8399952776, "timesteps_total": 51200, "num_env_steps_sampled_lifetime": 51200, "num_agent_steps_sampled_lifetime": 204800, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 204800, "timers": {"training_iteration_time_ms": 1813.853, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1813.736, "sample_time_ms": 1139.826, "learn_time_ms": 654.45, "learn_throughput": 1564.673, "synch_weights_time_ms": 10.52}, "counters": {"num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800}, "done": false, "training_iteration": 50, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-24", "timestamp": 1729611804, "time_this_iter_s": 1.7765474319458008, "time_total_s": 91.17419385910034, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1553f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13d90>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12d40>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13700>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239bd0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 91.17419385910034, "iterations_since_restore": 50, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.75}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9648418344557286, "cur_kl_coeff": 2.182787284255028e-12, "cur_lr": 5e-05, "total_loss": 9.198701667785645, "policy_loss": -0.0013484468450769781, "vf_loss": 9.200050163269044, "vf_explained_var": 7.135123014450074e-05, "kl": 0.00585179849614529, "entropy": 1.5324291646480561, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7803403228521346, "cur_kl_coeff": 2.728484105318785e-13, "cur_lr": 5e-05, "total_loss": 9.132770872116089, "policy_loss": -0.0014265443431213498, "vf_loss": 9.13419749736786, "vf_explained_var": -0.00026352107524871824, "kl": 0.00259082645323474, "entropy": 1.1220410972833634, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.47125249505043, "cur_kl_coeff": 7.275957614183426e-13, "cur_lr": 5e-05, "total_loss": 9.871113157272339, "policy_loss": -0.0013713078806176782, "vf_loss": 9.872484350204468, "vf_explained_var": -0.0001703500747680664, "kl": 0.0013323682695060971, "entropy": 0.5420632399618626, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.086507090926171, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.071646213531494, "policy_loss": -0.004999236995354294, "vf_loss": 9.0766019821167, "vf_explained_var": 0.0002755805850028992, "kl": 0.009262740081980615, "entropy": 1.7457229226827622, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 52224, "num_env_steps_trained": 52224, "num_agent_steps_sampled": 208896, "num_agent_steps_trained": 208896}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4266.055315222502, "episode_len_mean": 3104.0, "episode_media": {}, "episodes_timesteps_total": 37248, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -377.3775790175337, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1554.602355277566, "DC1_ls_policy": -1457.5232595171283, "DC2_ls_policy": 3118.4330953309727, "DC3_ls_policy": 1050.5431241310816}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101943.10333765495, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09570282746116926, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.9672539767879795, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.6540404040404041, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 67784.166339584, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 50636.88634489895, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0653847795080434, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 89452.30811305235, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 121157.58874855557, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.014436573374369785, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5776925472697406, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.564709595959596, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 99282982.37082522, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 50.181174301783955, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 986.0232399848436, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6065816728592521, "mean_inference_ms": 2.2256039771817693, "mean_action_processing_ms": 0.32437754097506366, "mean_env_wait_ms": 4.285844405674097, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003576775391896566, "StateBufferConnector_ms": 0.0024899840354919434, "ViewRequirementAgentConnector_ms": 0.05355477333068848}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4266.055315222502, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 208896, "num_agent_steps_trained": 208896, "num_env_steps_sampled": 52224, "num_env_steps_trained": 52224, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 581.7683774850808, "num_env_steps_trained_throughput_per_sec": 581.7683774850808, "timesteps_total": 52224, "num_env_steps_sampled_lifetime": 52224, "num_agent_steps_sampled_lifetime": 208896, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 208896, "timers": {"training_iteration_time_ms": 1812.444, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1812.326, "sample_time_ms": 1138.419, "learn_time_ms": 654.372, "learn_throughput": 1564.859, "synch_weights_time_ms": 10.555}, "counters": {"num_env_steps_sampled": 52224, "num_env_steps_trained": 52224, "num_agent_steps_sampled": 208896, "num_agent_steps_trained": 208896}, "done": false, "training_iteration": 51, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-26", "timestamp": 1729611806, "time_this_iter_s": 1.7673864364624023, "time_total_s": 92.94158029556274, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1570a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a830>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239e70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b6d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239870>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 92.94158029556274, "iterations_since_restore": 51, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.997001726925373, "cur_kl_coeff": 2.182787284255028e-12, "cur_lr": 5e-05, "total_loss": 9.255610418319701, "policy_loss": -0.0024136662017554046, "vf_loss": 9.258024096488953, "vf_explained_var": -4.8090517520904544e-05, "kl": 0.004297987896144223, "entropy": 1.663241484761238, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1482206866145135, "cur_kl_coeff": 1.3642420526593926e-13, "cur_lr": 5e-05, "total_loss": 9.063745260238647, "policy_loss": -0.003338506305590272, "vf_loss": 9.06708378791809, "vf_explained_var": -0.00014231503009796143, "kl": 0.003987973658240662, "entropy": 1.1703529894351958, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.498401464521885, "cur_kl_coeff": 3.637978807091713e-13, "cur_lr": 5e-05, "total_loss": 9.864362931251526, "policy_loss": -0.00538898203521967, "vf_loss": 9.86975200176239, "vf_explained_var": 0.0005751311779022217, "kl": 0.008962045239833653, "entropy": 0.468838008493185, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.807635968923568, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.573704481124878, "policy_loss": -0.0034194182604551314, "vf_loss": 8.577090167999268, "vf_explained_var": -0.00011779665946960449, "kl": 0.007193050146820049, "entropy": 1.7953134983778, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4266.055315222502, "episode_len_mean": 3104.0, "episode_media": {}, "episodes_timesteps_total": 37248, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -377.3775790175337, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1554.602355277566, "DC1_ls_policy": -1457.5232595171283, "DC2_ls_policy": 3118.4330953309727, "DC3_ls_policy": 1050.5431241310816}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101943.10333765495, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09570282746116926, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.9672539767879795, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.6540404040404041, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 67784.166339584, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 50636.88634489895, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0653847795080434, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 89452.30811305235, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 121157.58874855557, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.014436573374369785, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5776925472697406, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.564709595959596, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 99282982.37082522, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 50.181174301783955, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 986.0232399848436, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6065816728592521, "mean_inference_ms": 2.2256039771817693, "mean_action_processing_ms": 0.32437754097506366, "mean_env_wait_ms": 4.285844405674097, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003576775391896566, "StateBufferConnector_ms": 0.0024899840354919434, "ViewRequirementAgentConnector_ms": 0.05355477333068848}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4266.055315222502, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992, "num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 472.98318171326275, "num_env_steps_trained_throughput_per_sec": 472.98318171326275, "timesteps_total": 53248, "num_env_steps_sampled_lifetime": 53248, "num_agent_steps_sampled_lifetime": 212992, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 212992, "timers": {"training_iteration_time_ms": 1851.576, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1851.459, "sample_time_ms": 1177.299, "learn_time_ms": 654.405, "learn_throughput": 1564.779, "synch_weights_time_ms": 10.57}, "counters": {"num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992}, "done": false, "training_iteration": 52, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-29", "timestamp": 1729611809, "time_this_iter_s": 2.1720573902130127, "time_total_s": 95.11363768577576, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fb50>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238eb0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239b70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2393f0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239480>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 95.11363768577576, "iterations_since_restore": 52, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1742023229599, "cur_kl_coeff": 1.091393642127514e-12, "cur_lr": 5e-05, "total_loss": 9.073010563850403, "policy_loss": -0.0021527815610170365, "vf_loss": 9.075163412094117, "vf_explained_var": -0.00019549131393432618, "kl": 0.0036236320727084602, "entropy": 1.864870262145996, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.972009678184986, "cur_kl_coeff": 6.821210263296963e-14, "cur_lr": 5e-05, "total_loss": 8.74487738609314, "policy_loss": -0.00295943901874125, "vf_loss": 8.747836828231812, "vf_explained_var": -5.660057067871094e-05, "kl": 0.004276776280676924, "entropy": 1.3512233167886734, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.880852095782757, "cur_kl_coeff": 3.637978807091713e-13, "cur_lr": 5e-05, "total_loss": 9.868075633049012, "policy_loss": -0.0013454543892294168, "vf_loss": 9.869421148300171, "vf_explained_var": -0.0003783285617828369, "kl": 0.0027330241151503286, "entropy": 0.4131469659507275, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.025635153055191, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.22480628490448, "policy_loss": -0.004987941728904844, "vf_loss": 9.229744458198548, "vf_explained_var": -0.00031130313873291017, "kl": 0.010604645140892899, "entropy": 1.7621558129787445, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 54272, "num_env_steps_trained": 54272, "num_agent_steps_sampled": 217088, "num_agent_steps_trained": 217088}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4266.055315222502, "episode_len_mean": 3104.0, "episode_media": {}, "episodes_timesteps_total": 37248, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -377.3775790175337, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1554.602355277566, "DC1_ls_policy": -1457.5232595171283, "DC2_ls_policy": 3118.4330953309727, "DC3_ls_policy": 1050.5431241310816}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 101943.10333765495, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.09570282746116926, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.9672539767879795, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.6540404040404041, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 67784.166339584, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 50636.88634489895, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0653847795080434, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 89452.30811305235, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 121157.58874855557, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.014436573374369785, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5776925472697406, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.564709595959596, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 99282982.37082522, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 50.181174301783955, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 986.0232399848436, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6065816728592521, "mean_inference_ms": 2.2256039771817693, "mean_action_processing_ms": 0.32437754097506366, "mean_env_wait_ms": 4.285844405674097, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003576775391896566, "StateBufferConnector_ms": 0.0024899840354919434, "ViewRequirementAgentConnector_ms": 0.05355477333068848}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4266.055315222502, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 217088, "num_agent_steps_trained": 217088, "num_env_steps_sampled": 54272, "num_env_steps_trained": 54272, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 582.1231264166911, "num_env_steps_trained_throughput_per_sec": 582.1231264166911, "timesteps_total": 54272, "num_env_steps_sampled_lifetime": 54272, "num_agent_steps_sampled_lifetime": 217088, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 217088, "timers": {"training_iteration_time_ms": 1851.024, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1850.906, "sample_time_ms": 1176.775, "learn_time_ms": 654.435, "learn_throughput": 1564.709, "synch_weights_time_ms": 10.544}, "counters": {"num_env_steps_sampled": 54272, "num_env_steps_trained": 54272, "num_agent_steps_sampled": 217088, "num_agent_steps_trained": 217088}, "done": false, "training_iteration": 53, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-30", "timestamp": 1729611810, "time_this_iter_s": 1.7665743827819824, "time_total_s": 96.88021206855774, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13910>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13a30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13dc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13e80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 96.88021206855774, "iterations_since_restore": 53, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6655116461217403, "cur_kl_coeff": 5.45696821063757e-13, "cur_lr": 5e-05, "total_loss": 9.462015748023987, "policy_loss": -0.005183706758543849, "vf_loss": 9.467199397087096, "vf_explained_var": -0.0002928793430328369, "kl": 0.008249170376711846, "entropy": 1.6717078775167464, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8140161529183387, "cur_kl_coeff": 3.4106051316484814e-14, "cur_lr": 5e-05, "total_loss": 9.422568774223327, "policy_loss": -0.0007325658574700355, "vf_loss": 9.423301458358765, "vf_explained_var": -8.794963359832763e-05, "kl": 0.002471107873861911, "entropy": 1.321305274963379, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.291335129737854, "cur_kl_coeff": 1.8189894035458566e-13, "cur_lr": 5e-05, "total_loss": 9.864450263977051, "policy_loss": -0.004115955648012459, "vf_loss": 9.86856632232666, "vf_explained_var": 6.171464920043946e-05, "kl": 0.007520164034303889, "entropy": 0.3208535607904196, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.661147010326386, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.023992991447448, "policy_loss": -0.006948743108659982, "vf_loss": 9.030872488021851, "vf_explained_var": 6.76378607749939e-05, "kl": 0.014809487116144738, "entropy": 1.687158927321434, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4181.049911746839, "episode_len_mean": 3131.076923076923, "episode_media": {}, "episodes_timesteps_total": 40704, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -377.3775790175337, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1516.6789107247928, "DC1_ls_policy": -1420.361675248359, "DC2_ls_policy": 3239.6722200603417, "DC3_ls_policy": 845.0604562100539}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 102521.88576405322, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.08916461138865767, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.8930056295706703, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.6540404040404041, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 66325.64540347556, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48823.394170174404, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.06035518108434775, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 91136.78977518814, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 121157.58874855557, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013326067730187493, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6426074011834644, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.564709595959596, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 100338037.57839765, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 46.909809264680916, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 995.7931369892145, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605593360988792, "mean_inference_ms": 2.223369811175094, "mean_action_processing_ms": 0.3240715507471502, "mean_env_wait_ms": 4.284579805739204, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00350796259366549, "StateBufferConnector_ms": 0.0024850551898662862, "ViewRequirementAgentConnector_ms": 0.05351992753835825}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4181.049911746839, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184, "num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 521.0871812790574, "num_env_steps_trained_throughput_per_sec": 521.0871812790574, "timesteps_total": 55296, "num_env_steps_sampled_lifetime": 55296, "num_agent_steps_sampled_lifetime": 221184, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 221184, "timers": {"training_iteration_time_ms": 1854.453, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1854.335, "sample_time_ms": 1180.423, "learn_time_ms": 654.257, "learn_throughput": 1565.134, "synch_weights_time_ms": 10.587}, "counters": {"num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184}, "done": false, "training_iteration": 54, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-32", "timestamp": 1729611812, "time_this_iter_s": 1.9728586673736572, "time_total_s": 98.8530707359314, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3b50>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11ba0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11c60>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12980>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11ed0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 98.8530707359314, "iterations_since_restore": 54, "perf": {"cpu_util_percent": 3.3333333333333335, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.076473617553711, "cur_kl_coeff": 5.45696821063757e-13, "cur_lr": 5e-05, "total_loss": 9.189303755760193, "policy_loss": -0.005607242765836418, "vf_loss": 9.194910883903503, "vf_explained_var": -0.00018471777439117433, "kl": 0.009734877314888025, "entropy": 1.5716935008764268, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3177376687526703, "cur_kl_coeff": 1.7053025658242407e-14, "cur_lr": 5e-05, "total_loss": 9.519117736816407, "policy_loss": -0.005837474670261145, "vf_loss": 9.524955201148988, "vf_explained_var": 9.18358564376831e-06, "kl": 0.007890379871492841, "entropy": 1.0569225132465363, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8363321483135224, "cur_kl_coeff": 1.8189894035458566e-13, "cur_lr": 5e-05, "total_loss": 9.876456117630005, "policy_loss": -0.002165481331758201, "vf_loss": 9.878621554374694, "vf_explained_var": -1.1549890041351319e-05, "kl": 0.00334552078793422, "entropy": 0.471055568754673, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.480385148525238, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.861410999298096, "policy_loss": -0.008097098884172737, "vf_loss": 8.869430541992188, "vf_explained_var": 0.0002485319972038269, "kl": 0.016499612101327256, "entropy": 1.6356094270944594, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 56320, "num_env_steps_trained": 56320, "num_agent_steps_sampled": 225280, "num_agent_steps_trained": 225280}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4181.049911746839, "episode_len_mean": 3131.076923076923, "episode_media": {}, "episodes_timesteps_total": 40704, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -377.3775790175337, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1516.6789107247928, "DC1_ls_policy": -1420.361675248359, "DC2_ls_policy": 3239.6722200603417, "DC3_ls_policy": 845.0604562100539}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 102521.88576405322, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.08916461138865767, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.8930056295706703, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.6540404040404041, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 66325.64540347556, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48823.394170174404, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.06035518108434775, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 91136.78977518814, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 121157.58874855557, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013326067730187493, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6426074011834644, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.564709595959596, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 100338037.57839765, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 46.909809264680916, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 995.7931369892145, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605593360988792, "mean_inference_ms": 2.223369811175094, "mean_action_processing_ms": 0.3240715507471502, "mean_env_wait_ms": 4.284579805739204, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00350796259366549, "StateBufferConnector_ms": 0.0024850551898662862, "ViewRequirementAgentConnector_ms": 0.05351992753835825}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4181.049911746839, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 225280, "num_agent_steps_trained": 225280, "num_env_steps_sampled": 56320, "num_env_steps_trained": 56320, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 571.827209676322, "num_env_steps_trained_throughput_per_sec": 571.827209676322, "timesteps_total": 56320, "num_env_steps_sampled_lifetime": 56320, "num_agent_steps_sampled_lifetime": 225280, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 225280, "timers": {"training_iteration_time_ms": 1853.461, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1853.343, "sample_time_ms": 1178.394, "learn_time_ms": 655.078, "learn_throughput": 1563.173, "synch_weights_time_ms": 10.598}, "counters": {"num_env_steps_sampled": 56320, "num_env_steps_trained": 56320, "num_agent_steps_sampled": 225280, "num_agent_steps_trained": 225280}, "done": false, "training_iteration": 55, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-34", "timestamp": 1729611814, "time_this_iter_s": 1.7976441383361816, "time_total_s": 100.65071487426758, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154310>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212080>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211de0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211e70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212200>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 100.65071487426758, "iterations_since_restore": 55, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8285248085856438, "cur_kl_coeff": 5.45696821063757e-13, "cur_lr": 5e-05, "total_loss": 9.024442267417907, "policy_loss": -0.002513056877069175, "vf_loss": 9.026955270767212, "vf_explained_var": 2.1281838417053223e-05, "kl": 0.0036480882370607494, "entropy": 1.453192737698555, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0980114534497263, "cur_kl_coeff": 1.7053025658242407e-14, "cur_lr": 5e-05, "total_loss": 9.334440422058105, "policy_loss": -0.0023172617424279452, "vf_loss": 9.336757731437682, "vf_explained_var": -7.161498069763184e-05, "kl": 0.0033518620886764964, "entropy": 0.8633818536996841, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4264540791511537, "cur_kl_coeff": 9.094947017729283e-14, "cur_lr": 5e-05, "total_loss": 9.847651386260987, "policy_loss": -0.00148695376701653, "vf_loss": 9.849138283729554, "vf_explained_var": -0.0008187860250473023, "kl": 0.0027308203259975477, "entropy": 0.5245922580361366, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.470505812764168, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.399470233917237, "policy_loss": -0.004669818165712059, "vf_loss": 8.404091084003449, "vf_explained_var": 0.00028842538595199587, "kl": 0.010435106749355327, "entropy": 1.6478770524263382, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 2216.8307877026764, "episode_reward_mean": 4181.049911746839, "episode_len_mean": 3131.076923076923, "episode_media": {}, "episodes_timesteps_total": 40704, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": -377.3775790175337, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1516.6789107247928, "DC1_ls_policy": -1420.361675248359, "DC2_ls_policy": 3239.6722200603417, "DC3_ls_policy": 845.0604562100539}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 102521.88576405322, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.08916461138865767, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.8930056295706703, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.6540404040404041, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 66325.64540347556, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48823.394170174404, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.06035518108434775, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 91136.78977518814, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 121157.58874855557, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.013326067730187493, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6426074011834644, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.564709595959596, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 100338037.57839765, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 46.909809264680916, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 995.7931369892145, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605593360988792, "mean_inference_ms": 2.223369811175094, "mean_action_processing_ms": 0.3240715507471502, "mean_env_wait_ms": 4.284579805739204, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00350796259366549, "StateBufferConnector_ms": 0.0024850551898662862, "ViewRequirementAgentConnector_ms": 0.05351992753835825}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 2216.8307877026764, "episode_return_mean": 4181.049911746839, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376, "num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 539.6638749266988, "num_env_steps_trained_throughput_per_sec": 539.6638749266988, "timesteps_total": 57344, "num_env_steps_sampled_lifetime": 57344, "num_agent_steps_sampled_lifetime": 229376, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 229376, "timers": {"training_iteration_time_ms": 1865.243, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1865.125, "sample_time_ms": 1190.378, "learn_time_ms": 654.907, "learn_throughput": 1563.582, "synch_weights_time_ms": 10.633}, "counters": {"num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376}, "done": false, "training_iteration": 56, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-36", "timestamp": 1729611816, "time_this_iter_s": 1.9047329425811768, "time_total_s": 102.55544781684875, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3b50>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe1154164d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2389d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ada0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a050>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 102.55544781684875, "iterations_since_restore": 56, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.860624161362648, "cur_kl_coeff": 2.728484105318785e-13, "cur_lr": 5e-05, "total_loss": 9.42663061618805, "policy_loss": -0.0019513925304636358, "vf_loss": 9.428582119941712, "vf_explained_var": -0.0002815812826156616, "kl": 0.001316052202948169, "entropy": 1.4255255073308946, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4776214957237244, "cur_kl_coeff": 8.526512829121203e-15, "cur_lr": 5e-05, "total_loss": 8.809656810760497, "policy_loss": -0.003193106036633253, "vf_loss": 8.8128502368927, "vf_explained_var": -5.3548812866210936e-05, "kl": 0.004101421908593604, "entropy": 1.1241766557097435, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.748749631643295, "cur_kl_coeff": 4.5474735088646414e-14, "cur_lr": 5e-05, "total_loss": 9.774666619300842, "policy_loss": -0.0039606942562386395, "vf_loss": 9.778627252578735, "vf_explained_var": 0.0013189107179641725, "kl": 0.006240978344749237, "entropy": 0.4570379011332989, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.015684658288956, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.041532015800476, "policy_loss": -0.007122261566109955, "vf_loss": 9.04859230518341, "vf_explained_var": -0.00014618933200836182, "kl": 0.013174946874646093, "entropy": 1.6463071018457414, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 58368, "num_env_steps_trained": 58368, "num_agent_steps_sampled": 233472, "num_agent_steps_trained": 233472}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3915.0819584671085, "episode_len_mean": 3033.6, "episode_media": {}, "episodes_timesteps_total": 45504, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1365.1900569733014, "DC1_ls_policy": -1199.0827149050185, "DC2_ls_policy": 3246.6281567749497, "DC3_ls_policy": 502.3464596238667}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 102437.57627926223, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.07727599653683664, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.68032710118347, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 63930.17346669563, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.05230782360643472, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 95895.01588331735, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.015965925366162495, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7578986365812247, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98203179.92202663, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 43.19617497383457, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 955.2116076128748, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6071279473256924, "mean_inference_ms": 2.2290209405404746, "mean_action_processing_ms": 0.3241707264817834, "mean_env_wait_ms": 4.296543508247154, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003658930460611979, "StateBufferConnector_ms": 0.002514521280924479, "ViewRequirementAgentConnector_ms": 0.05382537841796875}, "num_episodes": 2, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3915.0819584671085, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 233472, "num_agent_steps_trained": 233472, "num_env_steps_sampled": 58368, "num_env_steps_trained": 58368, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 570.1246433375285, "num_env_steps_trained_throughput_per_sec": 570.1246433375285, "timesteps_total": 58368, "num_env_steps_sampled_lifetime": 58368, "num_agent_steps_sampled_lifetime": 233472, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 233472, "timers": {"training_iteration_time_ms": 1865.29, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1865.174, "sample_time_ms": 1190.919, "learn_time_ms": 654.635, "learn_throughput": 1564.231, "synch_weights_time_ms": 10.439}, "counters": {"num_env_steps_sampled": 58368, "num_env_steps_trained": 58368, "num_agent_steps_sampled": 233472, "num_agent_steps_trained": 233472}, "done": false, "training_iteration": 57, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-38", "timestamp": 1729611818, "time_this_iter_s": 1.8030457496643066, "time_total_s": 104.35849356651306, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238910>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b400>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238310>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239a50>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 104.35849356651306, "iterations_since_restore": 57, "perf": {"cpu_util_percent": 3.3000000000000003, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.160599809885025, "cur_kl_coeff": 1.3642420526593926e-13, "cur_lr": 5e-05, "total_loss": 8.933506941795349, "policy_loss": -0.010497256647795439, "vf_loss": 8.944004249572753, "vf_explained_var": -7.811188697814941e-05, "kl": 0.021843972991337068, "entropy": 1.8533939123153687, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2565307572484015, "cur_kl_coeff": 4.263256414560602e-15, "cur_lr": 5e-05, "total_loss": 9.393082213401794, "policy_loss": -0.005643531680107117, "vf_loss": 9.398725843429565, "vf_explained_var": -2.4220347404479982e-05, "kl": 0.01240767584938567, "entropy": 1.5504811942577361, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7706804648041725, "cur_kl_coeff": 4.5474735088646414e-14, "cur_lr": 5e-05, "total_loss": 9.877156901359559, "policy_loss": -0.00035928981378674507, "vf_loss": 9.87751612663269, "vf_explained_var": -0.0001204565167427063, "kl": 0.0021352197512101156, "entropy": 0.2862004157155752, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.990738099813461, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 9.19903290271759, "policy_loss": -0.004545978968963027, "vf_loss": 9.203514981269837, "vf_explained_var": -6.669759750366211e-05, "kl": 0.01359188822134456, "entropy": 1.5970729380846023, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3915.0819584671085, "episode_len_mean": 3033.6, "episode_media": {}, "episodes_timesteps_total": 45504, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2006.0796196707436}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1365.1900569733014, "DC1_ls_policy": -1199.0827149050185, "DC2_ls_policy": 3246.6281567749497, "DC3_ls_policy": 502.3464596238667}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 102437.57627926223, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.07727599653683664, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.68032710118347, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 63930.17346669563, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.05230782360643472, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 95895.01588331735, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.015965925366162495, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7578986365812247, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 98203179.92202663, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 43.19617497383457, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 955.2116076128748, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6071279473256924, "mean_inference_ms": 2.2290209405404746, "mean_action_processing_ms": 0.3241707264817834, "mean_env_wait_ms": 4.296543508247154, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003658930460611979, "StateBufferConnector_ms": 0.002514521280924479, "ViewRequirementAgentConnector_ms": 0.05382537841796875}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3915.0819584671085, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568, "num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.7278748782495, "num_env_steps_trained_throughput_per_sec": 579.7278748782495, "timesteps_total": 59392, "num_env_steps_sampled_lifetime": 59392, "num_agent_steps_sampled_lifetime": 237568, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 237568, "timers": {"training_iteration_time_ms": 1847.098, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1846.985, "sample_time_ms": 1173.184, "learn_time_ms": 654.38, "learn_throughput": 1564.841, "synch_weights_time_ms": 10.512}, "counters": {"num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568}, "done": false, "training_iteration": 58, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-40", "timestamp": 1729611820, "time_this_iter_s": 1.7733287811279297, "time_total_s": 106.13182234764099, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156170>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a7a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239b70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238eb0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238760>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 106.13182234764099, "iterations_since_restore": 58, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6988363564014435, "cur_kl_coeff": 2.0463630789890888e-13, "cur_lr": 5e-05, "total_loss": 8.972084641456604, "policy_loss": -0.004385284427553415, "vf_loss": 8.976469779014588, "vf_explained_var": 0.00016861110925674437, "kl": 0.0016430993548055995, "entropy": 1.5080924898386001, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.108619974553585, "cur_kl_coeff": 4.263256414560602e-15, "cur_lr": 5e-05, "total_loss": 9.031713891029359, "policy_loss": 0.000869545922614634, "vf_loss": 9.030844402313232, "vf_explained_var": -9.48399305343628e-05, "kl": 0.005906212991113664, "entropy": 1.260902190208435, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.213076488673687, "cur_kl_coeff": 2.2737367544323207e-14, "cur_lr": 5e-05, "total_loss": 9.801259922981263, "policy_loss": -0.0076157934963703156, "vf_loss": 9.808875608444215, "vf_explained_var": 9.943544864654541e-05, "kl": 0.01029619906712469, "entropy": 0.1762695875018835, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.783109587430954, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.757666206359863, "policy_loss": -0.006396032474003732, "vf_loss": 8.764007234573365, "vf_explained_var": -3.837794065475464e-05, "kl": 0.01174770482103146, "entropy": 1.5840818196535111, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 60416, "num_env_steps_trained": 60416, "num_agent_steps_sampled": 241664, "num_agent_steps_trained": 241664}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3851.1492008720743, "episode_len_mean": 3078.0, "episode_media": {}, "episodes_timesteps_total": 49248, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1302.5379576366613, "DC1_ls_policy": -1122.0605584135615, "DC2_ls_policy": 3366.866019872052, "DC3_ls_policy": 303.80578177691444}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 102544.30465514124, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.07244624675328436, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.6054882812911269, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 63022.320469145394, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.04903858463103255, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 97814.43614642556, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.014968055030777336, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7866684600427614, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 100196185.01856521, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 40.496414037969906, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 960.1208038451364, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075142525189492, "mean_inference_ms": 2.2292950208967, "mean_action_processing_ms": 0.3243802722584448, "mean_env_wait_ms": 4.301099269119968, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003631412982940674, "StateBufferConnector_ms": 0.002527981996536255, "ViewRequirementAgentConnector_ms": 0.05389787256717682}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3851.1492008720743, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 241664, "num_agent_steps_trained": 241664, "num_env_steps_sampled": 60416, "num_env_steps_trained": 60416, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 534.5033960202528, "num_env_steps_trained_throughput_per_sec": 534.5033960202528, "timesteps_total": 60416, "num_env_steps_sampled_lifetime": 60416, "num_agent_steps_sampled_lifetime": 241664, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 241664, "timers": {"training_iteration_time_ms": 1858.509, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1858.395, "sample_time_ms": 1184.696, "learn_time_ms": 654.151, "learn_throughput": 1565.387, "synch_weights_time_ms": 10.528}, "counters": {"num_env_steps_sampled": 60416, "num_env_steps_trained": 60416, "num_agent_steps_sampled": 241664, "num_agent_steps_trained": 241664}, "done": false, "training_iteration": 59, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-42", "timestamp": 1729611822, "time_this_iter_s": 1.9225327968597412, "time_total_s": 108.05435514450073, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1541f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b430>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239cf0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2390c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238850>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 108.05435514450073, "iterations_since_restore": 59, "perf": {"cpu_util_percent": 4.3, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.280631272494793, "cur_kl_coeff": 1.0231815394945444e-13, "cur_lr": 5e-05, "total_loss": 8.859979176521302, "policy_loss": -0.0012892700731754303, "vf_loss": 8.861268401145935, "vf_explained_var": 3.565847873687744e-05, "kl": 0.0017854627305496252, "entropy": 1.2992935687303544, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8092591241002083, "cur_kl_coeff": 4.263256414560602e-15, "cur_lr": 5e-05, "total_loss": 8.831364631652832, "policy_loss": -0.003136672277469188, "vf_loss": 8.834501242637634, "vf_explained_var": -7.568597793579101e-05, "kl": 0.0025356619711601525, "entropy": 1.316405925154686, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0654971301555634, "cur_kl_coeff": 2.2737367544323207e-14, "cur_lr": 5e-05, "total_loss": 9.861725449562073, "policy_loss": -0.0017886356450617313, "vf_loss": 9.863514184951782, "vf_explained_var": 0.00023853182792663575, "kl": 0.003633208318935775, "entropy": 0.2447223760187626, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.050856113433838, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.63849651813507, "policy_loss": -0.003015119954943657, "vf_loss": 8.641476845741272, "vf_explained_var": -0.0002397686243057251, "kl": 0.007410184618584026, "entropy": 1.499332642555237, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3851.1492008720743, "episode_len_mean": 3078.0, "episode_media": {}, "episodes_timesteps_total": 49248, "policy_reward_min": {"high_level_policy": 201.00841885666023, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1302.5379576366613, "DC1_ls_policy": -1122.0605584135615, "DC2_ls_policy": 3366.866019872052, "DC3_ls_policy": 303.80578177691444}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 102544.30465514124, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.07244624675328436, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.6054882812911269, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 63022.320469145394, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.04903858463103255, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 97814.43614642556, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.014968055030777336, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7866684600427614, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 100196185.01856521, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 40.496414037969906, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 960.1208038451364, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 390.4608333333333, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075142525189492, "mean_inference_ms": 2.2292950208967, "mean_action_processing_ms": 0.3243802722584448, "mean_env_wait_ms": 4.301099269119968, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003631412982940674, "StateBufferConnector_ms": 0.002527981996536255, "ViewRequirementAgentConnector_ms": 0.05389787256717682}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3851.1492008720743, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760, "num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 540.0786415818452, "num_env_steps_trained_throughput_per_sec": 540.0786415818452, "timesteps_total": 61440, "num_env_steps_sampled_lifetime": 61440, "num_agent_steps_sampled_lifetime": 245760, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 245760, "timers": {"training_iteration_time_ms": 1871.205, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1871.092, "sample_time_ms": 1197.312, "learn_time_ms": 654.182, "learn_throughput": 1565.313, "synch_weights_time_ms": 10.501}, "counters": {"num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760}, "done": false, "training_iteration": 60, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-44", "timestamp": 1729611824, "time_this_iter_s": 1.904142141342163, "time_total_s": 109.9584972858429, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d3c70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a860>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2382b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ad70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a5c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 109.9584972858429, "iterations_since_restore": 60, "perf": {"cpu_util_percent": 3.1666666666666665, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.041603517532349, "cur_kl_coeff": 5.115907697472722e-14, "cur_lr": 5e-05, "total_loss": 9.381845951080322, "policy_loss": -0.001037489203736186, "vf_loss": 9.38288357257843, "vf_explained_var": -0.0002215087413787842, "kl": 0.004538270122429822, "entropy": 1.0453412041068078, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7736558079719544, "cur_kl_coeff": 2.131628207280301e-15, "cur_lr": 5e-05, "total_loss": 9.184846019744873, "policy_loss": -0.0013267376460134983, "vf_loss": 9.186172890663148, "vf_explained_var": -0.00015632212162017823, "kl": 0.0022303251425910275, "entropy": 0.7476381599903107, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.664119151234627, "cur_kl_coeff": 1.1368683772161604e-14, "cur_lr": 5e-05, "total_loss": 9.840764617919922, "policy_loss": -0.006593165430240333, "vf_loss": 9.847357726097107, "vf_explained_var": -3.79517674446106e-05, "kl": 0.01275810891565925, "entropy": 0.28339452259242537, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.685070616006851, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 7.916672646999359, "policy_loss": -0.005020488612353801, "vf_loss": 7.921637547016144, "vf_explained_var": -0.0002744823694229126, "kl": 0.011850204529037001, "entropy": 1.5007788985967636, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 62464, "num_env_steps_trained": 62464, "num_agent_steps_sampled": 249856, "num_agent_steps_trained": 249856}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3772.798092276862, "episode_len_mean": 3049.4117647058824, "episode_media": {}, "episodes_timesteps_total": 51840, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5196.722007186375, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1213.5266355043004, "DC1_ls_policy": -1046.1686215624554, "DC2_ls_policy": 3369.8281050874916, "DC3_ls_policy": 235.6119732475169}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103074.57660179619, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06818470282662058, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.5262756445557737, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 62550.73236085139, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.046153962005677694, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 99266.48703748066, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.014087581205437493, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.7558486377744508, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 99746064.46168342, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.114272035736384, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 917.7557865165554, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6076698978482962, "mean_inference_ms": 2.2297744998146527, "mean_action_processing_ms": 0.3245931723858643, "mean_env_wait_ms": 4.305856725889315, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003601523006663603, "StateBufferConnector_ms": 0.002527938169591567, "ViewRequirementAgentConnector_ms": 0.05390048027038574}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3772.798092276862, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 249856, "num_agent_steps_trained": 249856, "num_env_steps_sampled": 62464, "num_env_steps_trained": 62464, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.1834786078014, "num_env_steps_trained_throughput_per_sec": 576.1834786078014, "timesteps_total": 62464, "num_env_steps_sampled_lifetime": 62464, "num_agent_steps_sampled_lifetime": 249856, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 249856, "timers": {"training_iteration_time_ms": 1872.911, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1872.798, "sample_time_ms": 1198.455, "learn_time_ms": 654.44, "learn_throughput": 1564.696, "synch_weights_time_ms": 10.483}, "counters": {"num_env_steps_sampled": 62464, "num_env_steps_trained": 62464, "num_agent_steps_sampled": 249856, "num_agent_steps_trained": 249856}, "done": false, "training_iteration": 61, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-46", "timestamp": 1729611826, "time_this_iter_s": 1.7839250564575195, "time_total_s": 111.74242234230042, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ac80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238be0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238550>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238a90>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 111.74242234230042, "iterations_since_restore": 61, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.077339930832386, "cur_kl_coeff": 2.557953848736361e-14, "cur_lr": 5e-05, "total_loss": 9.486308169364928, "policy_loss": -0.006228168681263924, "vf_loss": 9.492536354064942, "vf_explained_var": -0.00011602938175201417, "kl": 0.007769363898569281, "entropy": 1.2257456988096238, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.204347737133503, "cur_kl_coeff": 1.0658141036401504e-15, "cur_lr": 5e-05, "total_loss": 9.333453392982483, "policy_loss": -0.0032873839139938355, "vf_loss": 9.336740708351135, "vf_explained_var": -5.760490894317627e-05, "kl": 0.0035876847444569647, "entropy": 0.8771032601594925, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7023016303777694, "cur_kl_coeff": 1.1368683772161604e-14, "cur_lr": 5e-05, "total_loss": 9.828905320167541, "policy_loss": -0.0023643973749130965, "vf_loss": 9.83126974105835, "vf_explained_var": -0.0007738947868347168, "kl": 0.0061170476364184115, "entropy": 0.26891104616224765, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.118388855457306, "cur_kl_coeff": 0.004687500000000001, "cur_lr": 5e-05, "total_loss": 8.129844772815705, "policy_loss": -0.011162017309106886, "vf_loss": 8.140903913974762, "vf_explained_var": 0.0002321958541870117, "kl": 0.021958734188228846, "entropy": 1.556832566857338, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 1, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952, "num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 538.9795346845697, "num_env_steps_trained_throughput_per_sec": 538.9795346845697, "timesteps_total": 63488, "num_env_steps_sampled_lifetime": 63488, "num_agent_steps_sampled_lifetime": 253952, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 253952, "timers": {"training_iteration_time_ms": 1846.402, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1846.288, "sample_time_ms": 1171.86, "learn_time_ms": 654.685, "learn_throughput": 1564.11, "synch_weights_time_ms": 10.488}, "counters": {"num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952}, "done": false, "training_iteration": 62, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-48", "timestamp": 1729611828, "time_this_iter_s": 1.9064385890960693, "time_total_s": 113.64886093139648, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fbe0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11c00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12890>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11960>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11cf0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 113.64886093139648, "iterations_since_restore": 62, "perf": {"cpu_util_percent": 3.266666666666666, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4258293375372886, "cur_kl_coeff": 2.557953848736361e-14, "cur_lr": 5e-05, "total_loss": 9.134494876861572, "policy_loss": 0.0002856939099729061, "vf_loss": 9.134209251403808, "vf_explained_var": -0.0001434028148651123, "kl": 0.00033097224762896753, "entropy": 1.5506082415580749, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0910302117466926, "cur_kl_coeff": 5.329070518200752e-16, "cur_lr": 5e-05, "total_loss": 9.245787215232848, "policy_loss": -0.006492530438117683, "vf_loss": 9.252279710769653, "vf_explained_var": -7.407665252685547e-05, "kl": 0.010490675604523858, "entropy": 1.0224618926644324, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.614352914690971, "cur_kl_coeff": 1.1368683772161604e-14, "cur_lr": 5e-05, "total_loss": 9.829984831809998, "policy_loss": -0.004265864007174968, "vf_loss": 9.834250688552856, "vf_explained_var": -0.0012652918696403504, "kl": 0.007096341133730946, "entropy": 0.07724275158252566, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.6928184747695925, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.495918416976929, "policy_loss": -0.0022736167069524527, "vf_loss": 8.498131644725799, "vf_explained_var": 0.00033988356590270997, "kl": 0.008584388632520363, "entropy": 1.5464701682329178, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 64512, "num_env_steps_trained": 64512, "num_agent_steps_sampled": 258048, "num_agent_steps_trained": 258048}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 258048, "num_agent_steps_trained": 258048, "num_env_steps_sampled": 64512, "num_env_steps_trained": 64512, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.3295394490676, "num_env_steps_trained_throughput_per_sec": 579.3295394490676, "timesteps_total": 64512, "num_env_steps_sampled_lifetime": 64512, "num_agent_steps_sampled_lifetime": 258048, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 258048, "timers": {"training_iteration_time_ms": 1847.25, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1847.136, "sample_time_ms": 1172.88, "learn_time_ms": 654.499, "learn_throughput": 1564.555, "synch_weights_time_ms": 10.525}, "counters": {"num_env_steps_sampled": 64512, "num_env_steps_trained": 64512, "num_agent_steps_sampled": 258048, "num_agent_steps_trained": 258048}, "done": false, "training_iteration": 63, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-50", "timestamp": 1729611830, "time_this_iter_s": 1.77449369430542, "time_total_s": 115.4233546257019, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c129e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12bf0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12d70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13250>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 115.4233546257019, "iterations_since_restore": 63, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8501476764678957, "cur_kl_coeff": 1.2789769243681805e-14, "cur_lr": 5e-05, "total_loss": 8.731140899658204, "policy_loss": -0.0004958802834153176, "vf_loss": 8.731636714935302, "vf_explained_var": -0.0002968519926071167, "kl": 0.0015810145152509573, "entropy": 1.5146018743515015, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.759363576769829, "cur_kl_coeff": 5.329070518200752e-16, "cur_lr": 5e-05, "total_loss": 9.526548075675965, "policy_loss": -0.0030750006437301634, "vf_loss": 9.529623079299927, "vf_explained_var": -8.332133293151856e-05, "kl": 0.01140535017621005, "entropy": 0.8852338775992393, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.2764161482453344, "cur_kl_coeff": 1.1368683772161604e-14, "cur_lr": 5e-05, "total_loss": 9.838440775871277, "policy_loss": -0.0008616885170340538, "vf_loss": 9.839302563667298, "vf_explained_var": 0.0001738712191581726, "kl": 0.004765806682553375, "entropy": 0.06445327593246475, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.590776067972183, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 9.130511617660522, "policy_loss": -0.004313527443446219, "vf_loss": 9.134760975837708, "vf_explained_var": -0.00021992921829223634, "kl": 0.009094247925537008, "entropy": 1.5163762837648391, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144, "num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 536.0476098771799, "num_env_steps_trained_throughput_per_sec": 536.0476098771799, "timesteps_total": 65536, "num_env_steps_sampled_lifetime": 65536, "num_agent_steps_sampled_lifetime": 262144, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 262144, "timers": {"training_iteration_time_ms": 1841.766, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1841.65, "sample_time_ms": 1166.356, "learn_time_ms": 655.252, "learn_throughput": 1562.758, "synch_weights_time_ms": 10.729}, "counters": {"num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144}, "done": false, "training_iteration": 64, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-52", "timestamp": 1729611832, "time_this_iter_s": 1.9182541370391846, "time_total_s": 117.34160876274109, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3f40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c135e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13730>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c139d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13c10>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 117.34160876274109, "iterations_since_restore": 64, "perf": {"cpu_util_percent": 3.2999999999999994, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.5141540095210075, "cur_kl_coeff": 6.394884621840903e-15, "cur_lr": 5e-05, "total_loss": 8.464410066604614, "policy_loss": -0.0010125837987288832, "vf_loss": 8.465422677993775, "vf_explained_var": -0.00016214698553085327, "kl": 0.0037359343437870507, "entropy": 1.424319177865982, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1893595710396765, "cur_kl_coeff": 5.329070518200752e-16, "cur_lr": 5e-05, "total_loss": 9.645660305023194, "policy_loss": -0.0028726502787321806, "vf_loss": 9.648532962799072, "vf_explained_var": -4.338920116424561e-05, "kl": 0.01185845941763546, "entropy": 0.7460020318627357, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.886482036113739, "cur_kl_coeff": 5.684341886080802e-15, "cur_lr": 5e-05, "total_loss": 9.850234699249267, "policy_loss": -0.0036202398128807544, "vf_loss": 9.85385503768921, "vf_explained_var": 9.370297193527222e-05, "kl": 0.005582990336832838, "entropy": 0.22758792266249656, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.692517465353012, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.1668825507164, "policy_loss": -0.01134619596414268, "vf_loss": 8.178109538555145, "vf_explained_var": -0.0003492474555969238, "kl": 0.01696071881070106, "entropy": 1.4949615567922592, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 66560, "num_env_steps_trained": 66560, "num_agent_steps_sampled": 266240, "num_agent_steps_trained": 266240}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 266240, "num_agent_steps_trained": 266240, "num_env_steps_sampled": 66560, "num_env_steps_trained": 66560, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 578.4556552114066, "num_env_steps_trained_throughput_per_sec": 578.4556552114066, "timesteps_total": 66560, "num_env_steps_sampled_lifetime": 66560, "num_agent_steps_sampled_lifetime": 266240, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 266240, "timers": {"training_iteration_time_ms": 1839.716, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1839.597, "sample_time_ms": 1165.801, "learn_time_ms": 654.28, "learn_throughput": 1565.08, "synch_weights_time_ms": 10.678}, "counters": {"num_env_steps_sampled": 66560, "num_env_steps_trained": 66560, "num_agent_steps_sampled": 266240, "num_agent_steps_trained": 266240}, "done": false, "training_iteration": 65, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-54", "timestamp": 1729611834, "time_this_iter_s": 1.7782466411590576, "time_total_s": 119.11985540390015, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d05e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2102b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210430>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210550>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210640>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 119.11985540390015, "iterations_since_restore": 65, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.078743712604046, "cur_kl_coeff": 3.1974423109204513e-15, "cur_lr": 5e-05, "total_loss": 9.16514732837677, "policy_loss": -0.0013466435251757503, "vf_loss": 9.16649396419525, "vf_explained_var": -0.00023374855518341065, "kl": 0.0026439559602306497, "entropy": 1.494078704714775, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.395758618414402, "cur_kl_coeff": 5.329070518200752e-16, "cur_lr": 5e-05, "total_loss": 9.435507822036744, "policy_loss": -0.00398732724133879, "vf_loss": 9.439495396614074, "vf_explained_var": -9.420216083526612e-05, "kl": 0.006134812047093874, "entropy": 0.5739436514675618, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6188336983323097, "cur_kl_coeff": 5.684341886080802e-15, "cur_lr": 5e-05, "total_loss": 9.853307604789734, "policy_loss": -0.0036138938507065178, "vf_loss": 9.856921362876893, "vf_explained_var": 0.00014052242040634154, "kl": 0.005396857047526282, "entropy": 0.1383313075173646, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.93969978094101, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.995809936523438, "policy_loss": -0.0034713552799075843, "vf_loss": 8.999212765693665, "vf_explained_var": -0.00020107924938201905, "kl": 0.009744455681633879, "entropy": 1.4555234402418136, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336, "num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 584.5830456559432, "num_env_steps_trained_throughput_per_sec": 584.5830456559432, "timesteps_total": 67584, "num_env_steps_sampled_lifetime": 67584, "num_agent_steps_sampled_lifetime": 270336, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 270336, "timers": {"training_iteration_time_ms": 1825.136, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1825.017, "sample_time_ms": 1151.159, "learn_time_ms": 654.248, "learn_throughput": 1565.156, "synch_weights_time_ms": 10.787}, "counters": {"num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336}, "done": false, "training_iteration": 66, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-56", "timestamp": 1729611836, "time_this_iter_s": 1.7604856491088867, "time_total_s": 120.88034105300903, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a30a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c118d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12560>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11d80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11ff0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 120.88034105300903, "iterations_since_restore": 66, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1565890200436115, "cur_kl_coeff": 1.5987211554602257e-15, "cur_lr": 5e-05, "total_loss": 9.042196893692017, "policy_loss": -0.007339746505022049, "vf_loss": 9.049536681175232, "vf_explained_var": -0.0001523822546005249, "kl": 0.008769745310564759, "entropy": 1.5341022461652756, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.310346555709839, "cur_kl_coeff": 5.329070518200752e-16, "cur_lr": 5e-05, "total_loss": 9.580540180206299, "policy_loss": -0.0008345689391717314, "vf_loss": 9.581374788284302, "vf_explained_var": -9.33617353439331e-05, "kl": 0.003577464508704546, "entropy": 0.7722436234354972, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.566513532400131, "cur_kl_coeff": 5.684341886080802e-15, "cur_lr": 5e-05, "total_loss": 9.865177845954895, "policy_loss": -0.001561498548835516, "vf_loss": 9.866739416122437, "vf_explained_var": 5.491077899932861e-05, "kl": 0.002035253607755294, "entropy": 0.17009917013347148, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.585112690925598, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.574225091934204, "policy_loss": -0.012764692166820168, "vf_loss": 8.58687424659729, "vf_explained_var": 0.00014710575342178345, "kl": 0.01642319626226242, "entropy": 1.4101817101240157, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 68608, "num_env_steps_trained": 68608, "num_agent_steps_sampled": 274432, "num_agent_steps_trained": 274432}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 274432, "num_agent_steps_trained": 274432, "num_env_steps_sampled": 68608, "num_env_steps_trained": 68608, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 581.8498707524806, "num_env_steps_trained_throughput_per_sec": 581.8498707524806, "timesteps_total": 68608, "num_env_steps_sampled_lifetime": 68608, "num_agent_steps_sampled_lifetime": 274432, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 274432, "timers": {"training_iteration_time_ms": 1821.517, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1821.398, "sample_time_ms": 1147.833, "learn_time_ms": 654.028, "learn_throughput": 1565.682, "synch_weights_time_ms": 10.857}, "counters": {"num_env_steps_sampled": 68608, "num_env_steps_trained": 68608, "num_agent_steps_sampled": 274432, "num_agent_steps_trained": 274432}, "done": false, "training_iteration": 67, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-57", "timestamp": 1729611837, "time_this_iter_s": 1.767704963684082, "time_total_s": 122.64804601669312, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fbe0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c128c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2106a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2105b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2104c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 122.64804601669312, "iterations_since_restore": 67, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4165062695741653, "cur_kl_coeff": 1.5987211554602257e-15, "cur_lr": 5e-05, "total_loss": 8.97989263534546, "policy_loss": -0.004354919912293554, "vf_loss": 8.98424756526947, "vf_explained_var": 0.0001279979944229126, "kl": 0.007953357695646446, "entropy": 1.6434781074523925, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.880892130732536, "cur_kl_coeff": 2.664535259100376e-16, "cur_lr": 5e-05, "total_loss": 9.032117104530334, "policy_loss": -0.00347210222389549, "vf_loss": 9.035589241981507, "vf_explained_var": -1.671314239501953e-05, "kl": 0.006196174568687237, "entropy": 1.030681236088276, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.779093962907791, "cur_kl_coeff": 2.842170943040401e-15, "cur_lr": 5e-05, "total_loss": 9.825886297225953, "policy_loss": -0.001333461096510291, "vf_loss": 9.827219700813293, "vf_explained_var": 0.0005123123526573181, "kl": 0.002764536277845764, "entropy": 0.04812343866797164, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.993470919132233, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.876350951194762, "policy_loss": -0.0048250329680740835, "vf_loss": 8.881088352203369, "vf_explained_var": 0.000395125150680542, "kl": 0.012484769773442043, "entropy": 1.3893843919038773, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528, "num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 528.1861452829174, "num_env_steps_trained_throughput_per_sec": 528.1861452829174, "timesteps_total": 69632, "num_env_steps_sampled_lifetime": 69632, "num_agent_steps_sampled_lifetime": 278528, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 278528, "timers": {"training_iteration_time_ms": 1838.753, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1838.634, "sample_time_ms": 1164.871, "learn_time_ms": 654.157, "learn_throughput": 1565.374, "synch_weights_time_ms": 10.836}, "counters": {"num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528}, "done": false, "training_iteration": 68, "trial_id": "22c84_00000", "date": "2024-10-22_15-43-59", "timestamp": 1729611839, "time_this_iter_s": 1.9470746517181396, "time_total_s": 124.59512066841125, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a30a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213ca0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213cd0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213070>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213310>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 124.59512066841125, "iterations_since_restore": 68, "perf": {"cpu_util_percent": 3.233333333333334, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.77415836751461, "cur_kl_coeff": 1.5987211554602257e-15, "cur_lr": 5e-05, "total_loss": 9.051649522781371, "policy_loss": -0.0031943322857841848, "vf_loss": 9.05484380722046, "vf_explained_var": -0.0003405243158340454, "kl": 0.005535082373899059, "entropy": 1.3724531710147858, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.5849498838186262, "cur_kl_coeff": 2.664535259100376e-16, "cur_lr": 5e-05, "total_loss": 9.114484524726867, "policy_loss": -0.00233299657702446, "vf_loss": 9.116817545890807, "vf_explained_var": -2.384185791015625e-05, "kl": 0.0027768419373387586, "entropy": 1.2089068919420243, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.339893278479576, "cur_kl_coeff": 1.4210854715202005e-15, "cur_lr": 5e-05, "total_loss": 9.826690506935119, "policy_loss": -0.0011155209969729186, "vf_loss": 9.827805972099304, "vf_explained_var": -1.0842084884643555e-05, "kl": 0.0034480117457860613, "entropy": 0.008584727963898331, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.691595816612244, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 9.025553345680237, "policy_loss": -0.0015709825791418552, "vf_loss": 9.027086019515991, "vf_explained_var": -7.33688473701477e-05, "kl": 0.0054554454552544485, "entropy": 1.409395843744278, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 70656, "num_env_steps_trained": 70656, "num_agent_steps_sampled": 282624, "num_agent_steps_trained": 282624}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 282624, "num_agent_steps_trained": 282624, "num_env_steps_sampled": 70656, "num_env_steps_trained": 70656, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 575.5889842552766, "num_env_steps_trained_throughput_per_sec": 575.5889842552766, "timesteps_total": 70656, "num_env_steps_sampled_lifetime": 70656, "num_agent_steps_sampled_lifetime": 282624, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 282624, "timers": {"training_iteration_time_ms": 1825.078, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1824.959, "sample_time_ms": 1150.768, "learn_time_ms": 654.656, "learn_throughput": 1564.181, "synch_weights_time_ms": 10.852}, "counters": {"num_env_steps_sampled": 70656, "num_env_steps_trained": 70656, "num_agent_steps_sampled": 282624, "num_agent_steps_trained": 282624}, "done": false, "training_iteration": 69, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-01", "timestamp": 1729611841, "time_this_iter_s": 1.7868924140930176, "time_total_s": 126.38201308250427, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3a30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211060>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211810>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212830>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212d40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 126.38201308250427, "iterations_since_restore": 69, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7376496620476245, "cur_kl_coeff": 1.5987211554602257e-15, "cur_lr": 5e-05, "total_loss": 9.08482904434204, "policy_loss": -4.2153452523052695e-05, "vf_loss": 9.084871220588685, "vf_explained_var": -0.00011372566223144531, "kl": 0.002289346221004962, "entropy": 1.2563462644815444, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.9318270534276962, "cur_kl_coeff": 1.332267629550188e-16, "cur_lr": 5e-05, "total_loss": 9.18643901348114, "policy_loss": -0.0004313414916396141, "vf_loss": 9.18687026500702, "vf_explained_var": -2.810955047607422e-05, "kl": 0.0033078139843382816, "entropy": 1.0081758812069892, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5731166929006575, "cur_kl_coeff": 7.105427357601002e-16, "cur_lr": 5e-05, "total_loss": 9.853430843353271, "policy_loss": -0.0019966759311500935, "vf_loss": 9.855427455902099, "vf_explained_var": -2.9405951499938966e-05, "kl": 0.006957897139568558, "entropy": -0.021483574039302768, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.643339985609055, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.625182342529296, "policy_loss": -0.004457375453785062, "vf_loss": 8.62956964969635, "vf_explained_var": -0.0003226280212402344, "kl": 0.009980721802276094, "entropy": 1.3609643250703811, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720, "num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 575.8142364886406, "num_env_steps_trained_throughput_per_sec": 575.8142364886406, "timesteps_total": 71680, "num_env_steps_sampled_lifetime": 71680, "num_agent_steps_sampled_lifetime": 286720, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 286720, "timers": {"training_iteration_time_ms": 1813.312, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1813.192, "sample_time_ms": 1138.677, "learn_time_ms": 654.807, "learn_throughput": 1563.82, "synch_weights_time_ms": 10.946}, "counters": {"num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720}, "done": false, "training_iteration": 70, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-03", "timestamp": 1729611843, "time_this_iter_s": 1.7871761322021484, "time_total_s": 128.16918921470642, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db157ac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213220>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212e30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2134c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210100>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 128.16918921470642, "iterations_since_restore": 70, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8691462889313697, "cur_kl_coeff": 7.993605777301128e-16, "cur_lr": 5e-05, "total_loss": 8.400002646446229, "policy_loss": -0.0002208353718742728, "vf_loss": 8.400223457813263, "vf_explained_var": -0.00018866360187530518, "kl": 0.0036804676608326163, "entropy": 1.1356935784220696, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.860572728514671, "cur_kl_coeff": 6.66133814775094e-17, "cur_lr": 5e-05, "total_loss": 9.227084040641785, "policy_loss": -0.0018493270501494408, "vf_loss": 9.228933572769165, "vf_explained_var": -5.302131175994873e-05, "kl": 0.003189233090961352, "entropy": 0.9505171880126, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.8587513089179994, "cur_kl_coeff": 7.105427357601002e-16, "cur_lr": 5e-05, "total_loss": 9.842692112922668, "policy_loss": -0.0061649343930184845, "vf_loss": 9.848856997489928, "vf_explained_var": -5.9048831462860105e-05, "kl": 0.010409214405812401, "entropy": -0.15281789246946573, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.200274085998535, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.341485249996186, "policy_loss": -0.002481074957177043, "vf_loss": 8.343906259536743, "vf_explained_var": -0.00031530261039733885, "kl": 0.0085323065628927, "entropy": 1.2669799417257308, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 72704, "num_env_steps_trained": 72704, "num_agent_steps_sampled": 290816, "num_agent_steps_trained": 290816}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 290816, "num_agent_steps_trained": 290816, "num_env_steps_sampled": 72704, "num_env_steps_trained": 72704, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.5033821936886, "num_env_steps_trained_throughput_per_sec": 579.5033821936886, "timesteps_total": 72704, "num_env_steps_sampled_lifetime": 72704, "num_agent_steps_sampled_lifetime": 290816, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 290816, "timers": {"training_iteration_time_ms": 1812.294, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1812.174, "sample_time_ms": 1137.847, "learn_time_ms": 654.891, "learn_throughput": 1563.62, "synch_weights_time_ms": 10.947}, "counters": {"num_env_steps_sampled": 72704, "num_env_steps_trained": 72704, "num_agent_steps_sampled": 290816, "num_agent_steps_trained": 290816}, "done": false, "training_iteration": 71, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-05", "timestamp": 1729611845, "time_this_iter_s": 1.7747387886047363, "time_total_s": 129.94392800331116, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156cb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2114b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2122c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211e10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211c30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 129.94392800331116, "iterations_since_restore": 71, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.331845556199551, "cur_kl_coeff": 3.996802888650564e-16, "cur_lr": 5e-05, "total_loss": 9.293465924263, "policy_loss": -0.00024087857455015182, "vf_loss": 9.293706917762757, "vf_explained_var": -0.00010936260223388672, "kl": 0.0019317603808303829, "entropy": 1.1640225693583488, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.266763098537922, "cur_kl_coeff": 3.33066907387547e-17, "cur_lr": 5e-05, "total_loss": 9.544442796707154, "policy_loss": -0.004275361611507833, "vf_loss": 9.54871826171875, "vf_explained_var": -6.057620048522949e-05, "kl": 0.004267453932880016, "entropy": 1.0768699303269387, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.760607048869133, "cur_kl_coeff": 7.105427357601002e-16, "cur_lr": 5e-05, "total_loss": 9.835911345481872, "policy_loss": -0.0015896589029580355, "vf_loss": 9.837500977516175, "vf_explained_var": 0.0001454666256904602, "kl": 0.0071494576535769735, "entropy": -0.07981443665921688, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.879058504104615, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.43105889558792, "policy_loss": -0.004026430076919496, "vf_loss": 8.435013914108277, "vf_explained_var": 5.6533515453338624e-05, "kl": 0.010147491101815832, "entropy": 1.1938283830881118, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912, "num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 535.2328319179152, "num_env_steps_trained_throughput_per_sec": 535.2328319179152, "timesteps_total": 73728, "num_env_steps_sampled_lifetime": 73728, "num_agent_steps_sampled_lifetime": 294912, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 294912, "timers": {"training_iteration_time_ms": 1813.624, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1813.504, "sample_time_ms": 1139.179, "learn_time_ms": 654.758, "learn_throughput": 1563.937, "synch_weights_time_ms": 10.917}, "counters": {"num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912}, "done": false, "training_iteration": 72, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-07", "timestamp": 1729611847, "time_this_iter_s": 1.9199280738830566, "time_total_s": 131.8638560771942, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2109a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210c70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210d60>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210e20>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 131.8638560771942, "iterations_since_restore": 72, "perf": {"cpu_util_percent": 3.1333333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4242988876998424, "cur_kl_coeff": 1.998401444325282e-16, "cur_lr": 5e-05, "total_loss": 9.208719515800476, "policy_loss": -0.0010722470004111528, "vf_loss": 9.209791898727417, "vf_explained_var": -0.0003799140453338623, "kl": 0.0031742397834022993, "entropy": 1.394910129904747, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8622113853693008, "cur_kl_coeff": 1.665334536937735e-17, "cur_lr": 5e-05, "total_loss": 9.43205006122589, "policy_loss": -0.0024945224053226412, "vf_loss": 9.434544658660888, "vf_explained_var": -9.316205978393555e-06, "kl": 0.008393268147667271, "entropy": 1.2903036504983902, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.436389744281769, "cur_kl_coeff": 7.105427357601002e-16, "cur_lr": 5e-05, "total_loss": 9.838664007186889, "policy_loss": -0.0028150240890681744, "vf_loss": 9.841478991508485, "vf_explained_var": 0.00022027939558029176, "kl": 0.005807497607239942, "entropy": -0.02867313987808302, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.525364688038826, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 9.092473077774049, "policy_loss": -0.002610511751845479, "vf_loss": 9.095036172866822, "vf_explained_var": 0.0002511829137802124, "kl": 0.006768888760962, "entropy": 1.2124745875597, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 74752, "num_env_steps_trained": 74752, "num_agent_steps_sampled": 299008, "num_agent_steps_trained": 299008}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 299008, "num_agent_steps_trained": 299008, "num_env_steps_sampled": 74752, "num_env_steps_trained": 74752, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 572.6716979491797, "num_env_steps_trained_throughput_per_sec": 572.6716979491797, "timesteps_total": 74752, "num_env_steps_sampled_lifetime": 74752, "num_agent_steps_sampled_lifetime": 299008, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 299008, "timers": {"training_iteration_time_ms": 1815.679, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1815.559, "sample_time_ms": 1140.803, "learn_time_ms": 655.082, "learn_throughput": 1563.163, "synch_weights_time_ms": 10.929}, "counters": {"num_env_steps_sampled": 74752, "num_env_steps_trained": 74752, "num_agent_steps_sampled": 299008, "num_agent_steps_trained": 299008}, "done": false, "training_iteration": 73, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-09", "timestamp": 1729611849, "time_this_iter_s": 1.794917106628418, "time_total_s": 133.65877318382263, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a32e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2138b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2114e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211870>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211a50>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 133.65877318382263, "iterations_since_restore": 73, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.692779490351677, "cur_kl_coeff": 9.99200722162641e-17, "cur_lr": 5e-05, "total_loss": 8.933440327644348, "policy_loss": -0.0010526938131079078, "vf_loss": 8.93449296951294, "vf_explained_var": -0.00038515627384185793, "kl": 0.0035609619266324445, "entropy": 1.3597201019525529, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.327843441069126, "cur_kl_coeff": 1.665334536937735e-17, "cur_lr": 5e-05, "total_loss": 9.332538509368897, "policy_loss": -3.531347028911114e-05, "vf_loss": 9.332573747634887, "vf_explained_var": -2.6467442512512208e-05, "kl": 0.0016000174451619386, "entropy": 1.480782401561737, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.574396935105324, "cur_kl_coeff": 7.105427357601002e-16, "cur_lr": 5e-05, "total_loss": 9.828004550933837, "policy_loss": -0.004630801198072731, "vf_loss": 9.832635307312012, "vf_explained_var": 7.399171590805054e-05, "kl": 0.00938011931048095, "entropy": -0.05748206367716193, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.735030925273895, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.744226360321045, "policy_loss": -0.0047569309128448365, "vf_loss": 8.748913431167603, "vf_explained_var": 0.00014991164207458496, "kl": 0.009932484586624924, "entropy": 1.277428326010704, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3753.6121560034744, "episode_len_mean": 3098.6666666666665, "episode_media": {}, "episodes_timesteps_total": 55776, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1145.0485301061717, "DC1_ls_policy": -1006.8818616238914, "DC2_ls_policy": 3483.3184500047496, "DC3_ls_policy": 132.1270375164369}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103414.95965962575, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.06706434670752648, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.479366473697436, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61825.74423637567, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.043589853005362264, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100781.67947464673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01330493780513541, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.746419716163675, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 101923616.73134251, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 38.563790374536936, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 912.1656459941813, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 239.91550925925927, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6075747382323687, "mean_inference_ms": 2.2295621539026853, "mean_action_processing_ms": 0.3245609462485894, "mean_env_wait_ms": 4.307282928171647, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563695483737522, "StateBufferConnector_ms": 0.0025252501169840493, "ViewRequirementAgentConnector_ms": 0.05386239952511258}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3753.6121560034744, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104, "num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 566.2342637751541, "num_env_steps_trained_throughput_per_sec": 566.2342637751541, "timesteps_total": 75776, "num_env_steps_sampled_lifetime": 75776, "num_agent_steps_sampled_lifetime": 303104, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 303104, "timers": {"training_iteration_time_ms": 1805.495, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1805.376, "sample_time_ms": 1130.127, "learn_time_ms": 655.168, "learn_throughput": 1562.958, "synch_weights_time_ms": 10.779}, "counters": {"num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104}, "done": false, "training_iteration": 74, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-11", "timestamp": 1729611851, "time_this_iter_s": 1.8163087368011475, "time_total_s": 135.47508192062378, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db155240>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211fc0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212a70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212560>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2126e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 135.47508192062378, "iterations_since_restore": 74, "perf": {"cpu_util_percent": 3.3333333333333335, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.66117013245821, "cur_kl_coeff": 4.996003610813205e-17, "cur_lr": 5e-05, "total_loss": 9.218377256393433, "policy_loss": -0.0017423415556550026, "vf_loss": 9.22011969089508, "vf_explained_var": -0.000268787145614624, "kl": 0.001898412914306391, "entropy": 1.1463747441768646, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.417169488966465, "cur_kl_coeff": 8.326672684688675e-18, "cur_lr": 5e-05, "total_loss": 9.56883409023285, "policy_loss": -0.0011895925970748066, "vf_loss": 9.570023775100708, "vf_explained_var": -4.4706463813781736e-05, "kl": 0.00540956397471941, "entropy": 1.328502345085144, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.288187462091446, "cur_kl_coeff": 7.105427357601002e-16, "cur_lr": 5e-05, "total_loss": 9.808537197113036, "policy_loss": -0.001071852073073387, "vf_loss": 9.809609007835387, "vf_explained_var": -2.249479293823242e-05, "kl": 0.0026486399663587443, "entropy": -0.041900864872150126, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.64538659453392, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.859771227836609, "policy_loss": -0.004825428407639265, "vf_loss": 8.864535403251647, "vf_explained_var": -0.0001936495304107666, "kl": 0.008709004946831555, "entropy": 1.334480780363083, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 76800, "num_env_steps_trained": 76800, "num_agent_steps_sampled": 307200, "num_agent_steps_trained": 307200}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3731.7945462468742, "episode_len_mean": 3035.4285714285716, "episode_media": {}, "episodes_timesteps_total": 63744, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1014.3102546007256, "DC1_ls_policy": -817.5019460787028, "DC2_ls_policy": 3473.4388430950266, "DC3_ls_policy": 61.547394629817646}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103923.86142931526, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05748372574930841, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.3000864868344546, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61000.61835882419, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03736273114745337, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 103212.98520232673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01140423240440178, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6596392179911826, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 100651160.82079595, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 33.0546774638888, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 805.8869179469127, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 96.90166666666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6087693251336804, "mean_inference_ms": 2.23325183937636, "mean_action_processing_ms": 0.32441845934159397, "mean_env_wait_ms": 4.317486047146577, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0037289801098051526, "StateBufferConnector_ms": 0.0025337650662376767, "ViewRequirementAgentConnector_ms": 0.053965761547996885}, "num_episodes": 3, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3731.7945462468742, "episodes_this_iter": 3}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 307200, "num_agent_steps_trained": 307200, "num_env_steps_sampled": 76800, "num_env_steps_trained": 76800, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 530.8666115484082, "num_env_steps_trained_throughput_per_sec": 530.8666115484082, "timesteps_total": 76800, "num_env_steps_sampled_lifetime": 76800, "num_agent_steps_sampled_lifetime": 307200, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 307200, "timers": {"training_iteration_time_ms": 1821.36, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1821.247, "sample_time_ms": 1145.883, "learn_time_ms": 655.072, "learn_throughput": 1563.187, "synch_weights_time_ms": 10.812}, "counters": {"num_env_steps_sampled": 76800, "num_env_steps_trained": 76800, "num_agent_steps_sampled": 307200, "num_agent_steps_trained": 307200}, "done": false, "training_iteration": 75, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-13", "timestamp": 1729611853, "time_this_iter_s": 1.9360651969909668, "time_total_s": 137.41114711761475, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db157d00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213bb0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211420>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db210850>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212860>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 137.41114711761475, "iterations_since_restore": 75, "perf": {"cpu_util_percent": 4.05, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.423822668194771, "cur_kl_coeff": 2.4980018054066026e-17, "cur_lr": 5e-05, "total_loss": 9.073982501029969, "policy_loss": -0.0035427432274445893, "vf_loss": 9.077525210380553, "vf_explained_var": -7.558614015579224e-05, "kl": 0.005486062676211366, "entropy": 1.1646774515509606, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1942261710762976, "cur_kl_coeff": 8.326672684688675e-18, "cur_lr": 5e-05, "total_loss": 9.463415455818176, "policy_loss": -0.004181799630168825, "vf_loss": 9.467597484588623, "vf_explained_var": -5.148649215698242e-05, "kl": 0.004141654107755484, "entropy": 1.173243173956871, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.958085435628891, "cur_kl_coeff": 3.552713678800501e-16, "cur_lr": 5e-05, "total_loss": 9.831722974777222, "policy_loss": -0.00358832145575434, "vf_loss": 9.835311341285706, "vf_explained_var": 0.0003660082817077637, "kl": 0.004994776235525933, "entropy": 0.023676422249991447, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.25293442606926, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.56340832710266, "policy_loss": -0.008829583565238863, "vf_loss": 8.572111535072327, "vf_explained_var": -0.00011348128318786622, "kl": 0.017947865364840256, "entropy": 1.2971874594688415, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3731.7945462468742, "episode_len_mean": 3035.4285714285716, "episode_media": {}, "episodes_timesteps_total": 63744, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1014.3102546007256, "DC1_ls_policy": -817.5019460787028, "DC2_ls_policy": 3473.4388430950266, "DC3_ls_policy": 61.547394629817646}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103923.86142931526, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05748372574930841, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.3000864868344546, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61000.61835882419, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03736273114745337, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 103212.98520232673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01140423240440178, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6596392179911826, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 100651160.82079595, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 33.0546774638888, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 805.8869179469127, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 96.90166666666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6087693251336804, "mean_inference_ms": 2.23325183937636, "mean_action_processing_ms": 0.32441845934159397, "mean_env_wait_ms": 4.317486047146577, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0037289801098051526, "StateBufferConnector_ms": 0.0025337650662376767, "ViewRequirementAgentConnector_ms": 0.053965761547996885}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3731.7945462468742, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296, "num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 573.4195257310454, "num_env_steps_trained_throughput_per_sec": 573.4195257310454, "timesteps_total": 77824, "num_env_steps_sampled_lifetime": 77824, "num_agent_steps_sampled_lifetime": 311296, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 311296, "timers": {"training_iteration_time_ms": 1824.771, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1824.657, "sample_time_ms": 1149.047, "learn_time_ms": 655.291, "learn_throughput": 1562.665, "synch_weights_time_ms": 10.711}, "counters": {"num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296}, "done": false, "training_iteration": 76, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-15", "timestamp": 1729611855, "time_this_iter_s": 1.7935197353363037, "time_total_s": 139.20466685295105, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db155090>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a740>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ad70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239540>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a0b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 139.20466685295105, "iterations_since_restore": 76, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.440613742172718, "cur_kl_coeff": 2.4980018054066026e-17, "cur_lr": 5e-05, "total_loss": 9.387357020378113, "policy_loss": -0.0009347701445221901, "vf_loss": 9.388291692733764, "vf_explained_var": -0.00013111233711242675, "kl": 0.003364864222567121, "entropy": 1.410673698782921, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.854861694574356, "cur_kl_coeff": 4.163336342344338e-18, "cur_lr": 5e-05, "total_loss": 8.863887238502503, "policy_loss": -0.004218932217918336, "vf_loss": 8.868106031417847, "vf_explained_var": -2.728104591369629e-05, "kl": 0.01068219819881051, "entropy": 1.3132654398679733, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6873020797967913, "cur_kl_coeff": 1.7763568394002506e-16, "cur_lr": 5e-05, "total_loss": 9.807379603385925, "policy_loss": -0.002235010638833046, "vf_loss": 9.809614562988282, "vf_explained_var": 0.001366494596004486, "kl": 0.005121947490351886, "entropy": 0.12366166226565838, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.957933032512665, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 9.126926851272582, "policy_loss": -0.010022497223690151, "vf_loss": 9.136836791038514, "vf_explained_var": 0.00012391358613967897, "kl": 0.01598502909474197, "entropy": 1.3073918610811233, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 78848, "num_env_steps_trained": 78848, "num_agent_steps_sampled": 315392, "num_agent_steps_trained": 315392}, "env_runners": {"episode_reward_max": 6259.601343003307, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3731.7945462468742, "episode_len_mean": 3035.4285714285716, "episode_media": {}, "episodes_timesteps_total": 63744, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 5412.654313598132, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1014.3102546007256, "DC1_ls_policy": -817.5019460787028, "DC2_ls_policy": 3473.4388430950266, "DC3_ls_policy": 61.547394629817646}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103923.86142931526, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05748372574930841, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.3000864868344546, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 61000.61835882419, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03736273114745337, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 103212.98520232673, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.01140423240440178, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6596392179911826, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 100651160.82079595, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 166057941.80623183, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 33.0546774638888, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 805.8869179469127, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 96.90166666666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6087693251336804, "mean_inference_ms": 2.23325183937636, "mean_action_processing_ms": 0.32441845934159397, "mean_env_wait_ms": 4.317486047146577, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0037289801098051526, "StateBufferConnector_ms": 0.0025337650662376767, "ViewRequirementAgentConnector_ms": 0.053965761547996885}, "num_episodes": 0, "episode_return_max": 6259.601343003307, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3731.7945462468742, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 315392, "num_agent_steps_trained": 315392, "num_env_steps_sampled": 78848, "num_env_steps_trained": 78848, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 577.4741285586862, "num_env_steps_trained_throughput_per_sec": 577.4741285586862, "timesteps_total": 78848, "num_env_steps_sampled_lifetime": 78848, "num_agent_steps_sampled_lifetime": 315392, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 315392, "timers": {"training_iteration_time_ms": 1826.104, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1825.991, "sample_time_ms": 1149.941, "learn_time_ms": 655.571, "learn_throughput": 1561.998, "synch_weights_time_ms": 10.712}, "counters": {"num_env_steps_sampled": 78848, "num_env_steps_trained": 78848, "num_agent_steps_sampled": 315392, "num_agent_steps_trained": 315392}, "done": false, "training_iteration": 77, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-16", "timestamp": 1729611856, "time_this_iter_s": 1.7799708843231201, "time_total_s": 140.98463773727417, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2387c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23af80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239ae0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23aaa0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 140.98463773727417, "iterations_since_restore": 77, "perf": {"cpu_util_percent": 3.2999999999999994, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6286931052803992, "cur_kl_coeff": 1.2490009027033013e-17, "cur_lr": 5e-05, "total_loss": 9.025567436218262, "policy_loss": -0.0033007644931785764, "vf_loss": 9.028868198394775, "vf_explained_var": -1.7662346363067626e-05, "kl": 0.004347644149430252, "entropy": 1.2952116534113884, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.207482545077801, "cur_kl_coeff": 4.163336342344338e-18, "cur_lr": 5e-05, "total_loss": 9.14889590740204, "policy_loss": -0.0027049717027693987, "vf_loss": 9.151600909233093, "vf_explained_var": -4.6387314796447754e-05, "kl": 0.005295160840435345, "entropy": 1.3059694975614549, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.711002227663994, "cur_kl_coeff": 1.7763568394002506e-16, "cur_lr": 5e-05, "total_loss": 9.814181208610535, "policy_loss": 0.00014406931586563587, "vf_loss": 9.814036989212036, "vf_explained_var": -0.00044068843126296995, "kl": 0.0015035249420210866, "entropy": 0.10791609669104218, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.22245979309082, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.70433509349823, "policy_loss": -0.011258174083195627, "vf_loss": 8.715484762191773, "vf_explained_var": 0.0002886444330215454, "kl": 0.015438414421805647, "entropy": 1.3619682222604752, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3870.7622692363148, "episode_len_mean": 3124.3636363636365, "episode_media": {}, "episodes_timesteps_total": 68736, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1004.8925953777599, "DC1_ls_policy": -772.9770040325876, "DC2_ls_policy": 3619.0834059579097, "DC3_ls_policy": 19.763271933225283}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103762.00701774674, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05487082912433985, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2584286366170376, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60678.01014787837, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03566442518620549, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104096.4652270739, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.010885858204201699, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6361205064507909, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104080276.52353778, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 31.55219212462113, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 788.5178115185274, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 96.90166666666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6083235498987825, "mean_inference_ms": 2.2320621405734986, "mean_action_processing_ms": 0.32416011726104343, "mean_env_wait_ms": 4.315012486959772, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003692778674038974, "StateBufferConnector_ms": 0.0025294043801047587, "ViewRequirementAgentConnector_ms": 0.05394247445193204}, "num_episodes": 1, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3870.7622692363148, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488, "num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.4826953878483, "num_env_steps_trained_throughput_per_sec": 576.4826953878483, "timesteps_total": 79872, "num_env_steps_sampled_lifetime": 79872, "num_agent_steps_sampled_lifetime": 319488, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 319488, "timers": {"training_iteration_time_ms": 1809.862, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1809.748, "sample_time_ms": 1133.591, "learn_time_ms": 655.733, "learn_throughput": 1561.612, "synch_weights_time_ms": 10.706}, "counters": {"num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488}, "done": false, "training_iteration": 78, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-18", "timestamp": 1729611858, "time_this_iter_s": 1.7838830947875977, "time_total_s": 142.76852083206177, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156320>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b4f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ae00>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a7d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2396c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 142.76852083206177, "iterations_since_restore": 78, "perf": {"cpu_util_percent": 3.95, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.865040746331215, "cur_kl_coeff": 6.2450045135165065e-18, "cur_lr": 5e-05, "total_loss": 9.572197222709656, "policy_loss": -0.001999357808381319, "vf_loss": 9.574196529388427, "vf_explained_var": -7.29680061340332e-05, "kl": 0.0038286079991848966, "entropy": 0.9412137314677238, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.42313824146986, "cur_kl_coeff": 4.163336342344338e-18, "cur_lr": 5e-05, "total_loss": 9.250266528129577, "policy_loss": -0.0023370176553726197, "vf_loss": 9.252603697776795, "vf_explained_var": -3.039836883544922e-05, "kl": 0.0018791058166268873, "entropy": 1.4857759028673172, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8181070774793624, "cur_kl_coeff": 8.881784197001253e-17, "cur_lr": 5e-05, "total_loss": 9.841181564331055, "policy_loss": -0.0020838559605181215, "vf_loss": 9.843265438079834, "vf_explained_var": 0.00020683854818344117, "kl": 0.00358480097111169, "entropy": 0.0703638658626005, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.5165125846862795, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.9660174369812, "policy_loss": -0.0021852421574294566, "vf_loss": 8.968149447441101, "vf_explained_var": 0.00024229437112808228, "kl": 0.007587241745204665, "entropy": 1.3732930570840836, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 80896, "num_env_steps_trained": 80896, "num_agent_steps_sampled": 323584, "num_agent_steps_trained": 323584}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3870.7622692363148, "episode_len_mean": 3124.3636363636365, "episode_media": {}, "episodes_timesteps_total": 68736, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1004.8925953777599, "DC1_ls_policy": -772.9770040325876, "DC2_ls_policy": 3619.0834059579097, "DC3_ls_policy": 19.763271933225283}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103762.00701774674, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05487082912433985, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2584286366170376, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60678.01014787837, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03566442518620549, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104096.4652270739, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.010885858204201699, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6361205064507909, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104080276.52353778, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 31.55219212462113, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 788.5178115185274, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 96.90166666666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6083235498987825, "mean_inference_ms": 2.2320621405734986, "mean_action_processing_ms": 0.32416011726104343, "mean_env_wait_ms": 4.315012486959772, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003692778674038974, "StateBufferConnector_ms": 0.0025294043801047587, "ViewRequirementAgentConnector_ms": 0.05394247445193204}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3870.7622692363148, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 323584, "num_agent_steps_trained": 323584, "num_env_steps_sampled": 80896, "num_env_steps_trained": 80896, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 542.0300214983743, "num_env_steps_trained_throughput_per_sec": 542.0300214983743, "timesteps_total": 80896, "num_env_steps_sampled_lifetime": 80896, "num_agent_steps_sampled_lifetime": 323584, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 323584, "timers": {"training_iteration_time_ms": 1820.877, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1820.763, "sample_time_ms": 1145.3, "learn_time_ms": 654.947, "learn_throughput": 1563.485, "synch_weights_time_ms": 10.678}, "counters": {"num_env_steps_sampled": 80896, "num_env_steps_trained": 80896, "num_agent_steps_sampled": 323584, "num_agent_steps_trained": 323584}, "done": false, "training_iteration": 79, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-20", "timestamp": 1729611860, "time_this_iter_s": 1.8964073657989502, "time_total_s": 144.66492819786072, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154670>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c118a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c134c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12650>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11b10>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 144.66492819786072, "iterations_since_restore": 79, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0520577013492582, "cur_kl_coeff": 3.1225022567582532e-18, "cur_lr": 5e-05, "total_loss": 9.47088143825531, "policy_loss": -0.004043666296638548, "vf_loss": 9.474925136566162, "vf_explained_var": -0.00014649927616119384, "kl": 0.008705120653214746, "entropy": 0.8991674050688744, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2945239946246145, "cur_kl_coeff": 2.081668171172169e-18, "cur_lr": 5e-05, "total_loss": 9.356768989562989, "policy_loss": -0.0014071257086470724, "vf_loss": 9.358176159858704, "vf_explained_var": -9.188055992126465e-06, "kl": 0.0037149349257788343, "entropy": 1.666295236349106, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.3214975386857986, "cur_kl_coeff": 4.4408920985006264e-17, "cur_lr": 5e-05, "total_loss": 9.840556335449218, "policy_loss": -0.0013891043607145547, "vf_loss": 9.841945505142212, "vf_explained_var": -0.00025151968002319337, "kl": 0.003889391234338291, "entropy": -0.012992278416641056, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.3777247905731205, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.296458554267883, "policy_loss": -0.0022285064216703175, "vf_loss": 8.298641324043274, "vf_explained_var": -9.138733148574829e-05, "kl": 0.0065190576155146115, "entropy": 1.4431946247816085, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3870.7622692363148, "episode_len_mean": 3124.3636363636365, "episode_media": {}, "episodes_timesteps_total": 68736, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 1004.8925953777599, "DC1_ls_policy": -772.9770040325876, "DC2_ls_policy": 3619.0834059579097, "DC3_ls_policy": 19.763271933225283}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103762.00701774674, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05487082912433985, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2584286366170376, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60678.01014787837, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03566442518620549, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104096.4652270739, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.010885858204201699, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.6361205064507909, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.01, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104080276.52353778, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 31.55219212462113, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 788.5178115185274, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 96.90166666666667, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6083235498987825, "mean_inference_ms": 2.2320621405734986, "mean_action_processing_ms": 0.32416011726104343, "mean_env_wait_ms": 4.315012486959772, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003692778674038974, "StateBufferConnector_ms": 0.0025294043801047587, "ViewRequirementAgentConnector_ms": 0.05394247445193204}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3870.7622692363148, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680, "num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.4822716201827, "num_env_steps_trained_throughput_per_sec": 579.4822716201827, "timesteps_total": 81920, "num_env_steps_sampled_lifetime": 81920, "num_agent_steps_sampled_lifetime": 327680, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 327680, "timers": {"training_iteration_time_ms": 1819.751, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1819.638, "sample_time_ms": 1144.543, "learn_time_ms": 654.762, "learn_throughput": 1563.928, "synch_weights_time_ms": 10.619}, "counters": {"num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680}, "done": false, "training_iteration": 80, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-22", "timestamp": 1729611862, "time_this_iter_s": 1.7744789123535156, "time_total_s": 146.43940711021423, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1570a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b3d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23aaa0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239ae0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23af80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 146.43940711021423, "iterations_since_restore": 80, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9433765918016435, "cur_kl_coeff": 3.1225022567582532e-18, "cur_lr": 5e-05, "total_loss": 9.21931233406067, "policy_loss": -0.003325319918803871, "vf_loss": 9.222637629508972, "vf_explained_var": -7.614493370056152e-05, "kl": 0.0030762370901356918, "entropy": 0.5301917925477028, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.798120266199112, "cur_kl_coeff": 1.0408340855860844e-18, "cur_lr": 5e-05, "total_loss": 9.612528777122497, "policy_loss": -0.002857449627481401, "vf_loss": 9.615386199951171, "vf_explained_var": -1.3381242752075195e-05, "kl": 0.005950328311155317, "entropy": 1.8344327598810195, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9651783898472788, "cur_kl_coeff": 2.2204460492503132e-17, "cur_lr": 5e-05, "total_loss": 9.828519034385682, "policy_loss": -0.0049016917124390606, "vf_loss": 9.833420777320862, "vf_explained_var": -3.463327884674072e-05, "kl": 0.0058714746670375465, "entropy": -0.1303627667017281, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.331919181346893, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.942475366592408, "policy_loss": -0.002775625349022448, "vf_loss": 8.945202493667603, "vf_explained_var": -0.00014916062355041504, "kl": 0.006879850932455156, "entropy": 1.499858894944191, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 82944, "num_env_steps_trained": 82944, "num_agent_steps_sampled": 331776, "num_agent_steps_trained": 331776}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3905.9917755094107, "episode_len_mean": 3116.0, "episode_media": {}, "episodes_timesteps_total": 74784, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 981.2886637580751, "DC1_ls_policy": -719.166121322438, "DC2_ls_policy": 3641.7584450721165, "DC3_ls_policy": 2.1107880016515423}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103666.05050717508, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05029826003064485, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.200856555016235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60206.153596794196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0326923897540217, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105064.16061509214, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009978703353851558, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.594427336674542, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103975782.16583256, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 28.9228427809027, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 737.7081263106433, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6079614158313363, "mean_inference_ms": 2.230318871610955, "mean_action_processing_ms": 0.3241496738748382, "mean_env_wait_ms": 4.3170082676461625, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003629674514134725, "StateBufferConnector_ms": 0.0025331974029541016, "ViewRequirementAgentConnector_ms": 0.053986161947250366}, "num_episodes": 2, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3905.9917755094107, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 331776, "num_agent_steps_trained": 331776, "num_env_steps_sampled": 82944, "num_env_steps_trained": 82944, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 574.4691264297803, "num_env_steps_trained_throughput_per_sec": 574.4691264297803, "timesteps_total": 82944, "num_env_steps_sampled_lifetime": 82944, "num_agent_steps_sampled_lifetime": 331776, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 331776, "timers": {"training_iteration_time_ms": 1821.3, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1821.186, "sample_time_ms": 1146.298, "learn_time_ms": 654.495, "learn_throughput": 1564.565, "synch_weights_time_ms": 10.668}, "counters": {"num_env_steps_sampled": 82944, "num_env_steps_trained": 82944, "num_agent_steps_sampled": 331776, "num_agent_steps_trained": 331776}, "done": false, "training_iteration": 81, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-24", "timestamp": 1729611864, "time_this_iter_s": 1.7896854877471924, "time_total_s": 148.22909259796143, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1541f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2133d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213e50>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211cf0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2130a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 148.22909259796143, "iterations_since_restore": 81, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.124975278973579, "cur_kl_coeff": 1.5612511283791266e-18, "cur_lr": 5e-05, "total_loss": 8.9760333776474, "policy_loss": -0.0012630488025024533, "vf_loss": 8.977296376228333, "vf_explained_var": -0.00022592842578887938, "kl": 0.010734965973097133, "entropy": 0.40430618412792685, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2734433501958846, "cur_kl_coeff": 1.0408340855860844e-18, "cur_lr": 5e-05, "total_loss": 9.390104818344117, "policy_loss": -0.0025782604236155747, "vf_loss": 9.392683267593384, "vf_explained_var": -3.3855438232421873e-06, "kl": 0.0037605164146991775, "entropy": 2.019526022672653, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.63533037006855, "cur_kl_coeff": 2.2204460492503132e-17, "cur_lr": 5e-05, "total_loss": 9.852125310897828, "policy_loss": -0.006156204687431455, "vf_loss": 9.85828139781952, "vf_explained_var": 3.129243850708008e-07, "kl": 0.009967134515321703, "entropy": -0.09526930912397802, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.120267325639725, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.734622383117676, "policy_loss": -0.00728311762213707, "vf_loss": 8.741797089576721, "vf_explained_var": -0.00011692643165588379, "kl": 0.015400634739853558, "entropy": 1.428601935505867, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3905.9917755094107, "episode_len_mean": 3116.0, "episode_media": {}, "episodes_timesteps_total": 74784, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 981.2886637580751, "DC1_ls_policy": -719.166121322438, "DC2_ls_policy": 3641.7584450721165, "DC3_ls_policy": 2.1107880016515423}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103666.05050717508, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05029826003064485, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.200856555016235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60206.153596794196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0326923897540217, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105064.16061509214, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009978703353851558, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.594427336674542, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103975782.16583256, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 28.9228427809027, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 737.7081263106433, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6079614158313363, "mean_inference_ms": 2.230318871610955, "mean_action_processing_ms": 0.3241496738748382, "mean_env_wait_ms": 4.3170082676461625, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003629674514134725, "StateBufferConnector_ms": 0.0025331974029541016, "ViewRequirementAgentConnector_ms": 0.053986161947250366}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3905.9917755094107, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872, "num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.1048784449691, "num_env_steps_trained_throughput_per_sec": 576.1048784449691, "timesteps_total": 83968, "num_env_steps_sampled_lifetime": 83968, "num_agent_steps_sampled_lifetime": 335872, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 335872, "timers": {"training_iteration_time_ms": 1807.726, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1807.612, "sample_time_ms": 1132.3, "learn_time_ms": 654.729, "learn_throughput": 1564.005, "synch_weights_time_ms": 10.665}, "counters": {"num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872}, "done": false, "training_iteration": 82, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-26", "timestamp": 1729611866, "time_this_iter_s": 1.7840015888214111, "time_total_s": 150.01309418678284, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156680>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23aaa0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b3d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a800>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238760>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 150.01309418678284, "iterations_since_restore": 82, "perf": {"cpu_util_percent": 4.15, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.803828120231628, "cur_kl_coeff": 1.5612511283791266e-18, "cur_lr": 5e-05, "total_loss": 9.326518249511718, "policy_loss": -0.005415327451191843, "vf_loss": 9.331933784484864, "vf_explained_var": -5.73769211769104e-05, "kl": 0.010851982851459689, "entropy": 0.16596156076993793, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8270344197750092, "cur_kl_coeff": 5.204170427930422e-19, "cur_lr": 5e-05, "total_loss": 9.576023054122924, "policy_loss": -0.004286664840765298, "vf_loss": 9.580309653282166, "vf_explained_var": 4.5388936996459964e-06, "kl": 0.00571846021730822, "entropy": 2.2428287476301194, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.0105154573917385, "cur_kl_coeff": 2.2204460492503132e-17, "cur_lr": 5e-05, "total_loss": 9.863959074020386, "policy_loss": -0.0072210067766718565, "vf_loss": 9.871180009841918, "vf_explained_var": 9.509474039077759e-05, "kl": 0.011274617060416858, "entropy": -0.04799463315866888, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.900023418664932, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.579530942440034, "policy_loss": -0.006650411733426153, "vf_loss": 8.586106872558593, "vf_explained_var": 0.00013010352849960328, "kl": 0.010591349114474725, "entropy": 1.3924892663955688, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 84992, "num_env_steps_trained": 84992, "num_agent_steps_sampled": 339968, "num_agent_steps_trained": 339968}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3905.9917755094107, "episode_len_mean": 3116.0, "episode_media": {}, "episodes_timesteps_total": 74784, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 981.2886637580751, "DC1_ls_policy": -719.166121322438, "DC2_ls_policy": 3641.7584450721165, "DC3_ls_policy": 2.1107880016515423}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103666.05050717508, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05029826003064485, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.200856555016235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60206.153596794196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0326923897540217, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105064.16061509214, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009978703353851558, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.594427336674542, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103975782.16583256, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 28.9228427809027, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 737.7081263106433, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6079614158313363, "mean_inference_ms": 2.230318871610955, "mean_action_processing_ms": 0.3241496738748382, "mean_env_wait_ms": 4.3170082676461625, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003629674514134725, "StateBufferConnector_ms": 0.0025331974029541016, "ViewRequirementAgentConnector_ms": 0.053986161947250366}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3905.9917755094107, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 339968, "num_agent_steps_trained": 339968, "num_env_steps_sampled": 84992, "num_env_steps_trained": 84992, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 575.7412938071079, "num_env_steps_trained_throughput_per_sec": 575.7412938071079, "timesteps_total": 84992, "num_env_steps_sampled_lifetime": 84992, "num_agent_steps_sampled_lifetime": 339968, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 339968, "timers": {"training_iteration_time_ms": 1806.773, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1806.659, "sample_time_ms": 1131.362, "learn_time_ms": 654.693, "learn_throughput": 1564.093, "synch_weights_time_ms": 10.636}, "counters": {"num_env_steps_sampled": 84992, "num_env_steps_trained": 84992, "num_agent_steps_sampled": 339968, "num_agent_steps_trained": 339968}, "done": false, "training_iteration": 83, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-28", "timestamp": 1729611868, "time_this_iter_s": 1.7860236167907715, "time_total_s": 151.7991178035736, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db155090>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2395d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238430>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a170>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239db0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 151.7991178035736, "iterations_since_restore": 83, "perf": {"cpu_util_percent": 3.3000000000000003, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.613978779315948, "cur_kl_coeff": 1.5612511283791266e-18, "cur_lr": 5e-05, "total_loss": 9.384346342086792, "policy_loss": 0.0017919500009156764, "vf_loss": 9.382554197311402, "vf_explained_var": -7.521212100982665e-05, "kl": 0.0075034050358226525, "entropy": 0.2910148181021214, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8014781311154366, "cur_kl_coeff": 5.204170427930422e-19, "cur_lr": 5e-05, "total_loss": 9.409627723693848, "policy_loss": -0.004483573418110609, "vf_loss": 9.414111375808716, "vf_explained_var": -2.3961067199707033e-06, "kl": 0.013461079617902497, "entropy": 1.664300999045372, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7268624752759933, "cur_kl_coeff": 2.2204460492503132e-17, "cur_lr": 5e-05, "total_loss": 9.841383838653565, "policy_loss": -0.0025601426139473917, "vf_loss": 9.843944025039672, "vf_explained_var": 7.705241441726684e-05, "kl": 0.006958147022305639, "entropy": -0.058748899784404784, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.720502740144729, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.808032870292664, "policy_loss": -0.005106966756284237, "vf_loss": 8.813039016723632, "vf_explained_var": 0.00035456568002700806, "kl": 0.014324099908026255, "entropy": 1.2260121405124664, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3905.9917755094107, "episode_len_mean": 3116.0, "episode_media": {}, "episodes_timesteps_total": 74784, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 981.2886637580751, "DC1_ls_policy": -719.166121322438, "DC2_ls_policy": 3641.7584450721165, "DC3_ls_policy": 2.1107880016515423}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103666.05050717508, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05029826003064485, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.200856555016235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60206.153596794196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0326923897540217, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105064.16061509214, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009978703353851558, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.594427336674542, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103975782.16583256, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 28.9228427809027, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 737.7081263106433, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6079614158313363, "mean_inference_ms": 2.230318871610955, "mean_action_processing_ms": 0.3241496738748382, "mean_env_wait_ms": 4.3170082676461625, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003629674514134725, "StateBufferConnector_ms": 0.0025331974029541016, "ViewRequirementAgentConnector_ms": 0.053986161947250366}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3905.9917755094107, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064, "num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 535.1638730359834, "num_env_steps_trained_throughput_per_sec": 535.1638730359834, "timesteps_total": 86016, "num_env_steps_sampled_lifetime": 86016, "num_agent_steps_sampled_lifetime": 344064, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 344064, "timers": {"training_iteration_time_ms": 1817.272, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1817.161, "sample_time_ms": 1142.687, "learn_time_ms": 654.269, "learn_throughput": 1565.107, "synch_weights_time_ms": 10.721}, "counters": {"num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064}, "done": false, "training_iteration": 84, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-30", "timestamp": 1729611870, "time_this_iter_s": 1.9207210540771484, "time_total_s": 153.71983885765076, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1570a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238610>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b0a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239cc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a830>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 153.71983885765076, "iterations_since_restore": 84, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.817051672935486, "cur_kl_coeff": 1.5612511283791266e-18, "cur_lr": 5e-05, "total_loss": 9.217764139175415, "policy_loss": -0.005672250175848603, "vf_loss": 9.223436450958252, "vf_explained_var": 3.5552680492401124e-05, "kl": 0.00812611835390271, "entropy": 0.7049784414470196, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.2230454295873643, "cur_kl_coeff": 5.204170427930422e-19, "cur_lr": 5e-05, "total_loss": 9.087313532829285, "policy_loss": -0.006712410179898143, "vf_loss": 9.094025897979737, "vf_explained_var": -1.1205673217773438e-05, "kl": 0.009459628927652374, "entropy": 1.2633177667856217, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.787243565917015, "cur_kl_coeff": 2.2204460492503132e-17, "cur_lr": 5e-05, "total_loss": 9.826675081253052, "policy_loss": -0.00527739089448005, "vf_loss": 9.831952500343323, "vf_explained_var": 1.064389944076538e-05, "kl": 0.006959394128165286, "entropy": -0.11058791857212782, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.468008261919022, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.920769023895264, "policy_loss": -0.005415481748059392, "vf_loss": 8.926089906692505, "vf_explained_var": -6.365180015563965e-05, "kl": 0.013458697554597165, "entropy": 1.1188353955745698, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 87040, "num_env_steps_trained": 87040, "num_agent_steps_sampled": 348160, "num_agent_steps_trained": 348160}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3905.9917755094107, "episode_len_mean": 3116.0, "episode_media": {}, "episodes_timesteps_total": 74784, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 981.2886637580751, "DC1_ls_policy": -719.166121322438, "DC2_ls_policy": 3641.7584450721165, "DC3_ls_policy": 2.1107880016515423}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103666.05050717508, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05029826003064485, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.200856555016235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60206.153596794196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0326923897540217, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105064.16061509214, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009978703353851558, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.594427336674542, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103975782.16583256, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 28.9228427809027, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 737.7081263106433, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6079614158313363, "mean_inference_ms": 2.230318871610955, "mean_action_processing_ms": 0.3241496738748382, "mean_env_wait_ms": 4.3170082676461625, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003629674514134725, "StateBufferConnector_ms": 0.0025331974029541016, "ViewRequirementAgentConnector_ms": 0.053986161947250366}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3905.9917755094107, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 348160, "num_agent_steps_trained": 348160, "num_env_steps_sampled": 87040, "num_env_steps_trained": 87040, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 575.0456017981726, "num_env_steps_trained_throughput_per_sec": 575.0456017981726, "timesteps_total": 87040, "num_env_steps_sampled_lifetime": 87040, "num_agent_steps_sampled_lifetime": 348160, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 348160, "timers": {"training_iteration_time_ms": 1802.452, "restore_workers_time_ms": 0.042, "training_step_time_ms": 1802.344, "sample_time_ms": 1128.039, "learn_time_ms": 654.321, "learn_throughput": 1564.98, "synch_weights_time_ms": 10.723}, "counters": {"num_env_steps_sampled": 87040, "num_env_steps_trained": 87040, "num_agent_steps_sampled": 348160, "num_agent_steps_trained": 348160}, "done": false, "training_iteration": 85, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-31", "timestamp": 1729611871, "time_this_iter_s": 1.787923812866211, "time_total_s": 155.50776267051697, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3c70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2392d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239720>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ab60>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2393f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 155.50776267051697, "iterations_since_restore": 85, "perf": {"cpu_util_percent": 4.15, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.822645804286003, "cur_kl_coeff": 1.5612511283791266e-18, "cur_lr": 5e-05, "total_loss": 8.914029145240784, "policy_loss": 0.0004253278952091932, "vf_loss": 8.913603854179382, "vf_explained_var": -0.0001008540391921997, "kl": 0.0032751696220657323, "entropy": 0.783132727444172, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8495326399803163, "cur_kl_coeff": 5.204170427930422e-19, "cur_lr": 5e-05, "total_loss": 9.13114333152771, "policy_loss": -0.0034067717380821703, "vf_loss": 9.13455023765564, "vf_explained_var": -5.140900611877441e-06, "kl": 0.006353750605921959, "entropy": 1.7802502810955048, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.750016850233078, "cur_kl_coeff": 2.2204460492503132e-17, "cur_lr": 5e-05, "total_loss": 9.847522020339966, "policy_loss": -4.5428622979670766e-05, "vf_loss": 9.847567367553712, "vf_explained_var": 0.00024704784154891966, "kl": 0.002834067536199894, "entropy": -0.21369804367423056, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.290999883413315, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.6747403383255, "policy_loss": -0.006942080100998282, "vf_loss": 8.681593346595765, "vf_explained_var": -0.000249442458152771, "kl": 0.012669600918894413, "entropy": 1.0665555030107499, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3905.9917755094107, "episode_len_mean": 3116.0, "episode_media": {}, "episodes_timesteps_total": 74784, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 981.2886637580751, "DC1_ls_policy": -719.166121322438, "DC2_ls_policy": 3641.7584450721165, "DC3_ls_policy": 2.1107880016515423}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103666.05050717508, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05029826003064485, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.200856555016235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60206.153596794196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0326923897540217, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105064.16061509214, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009978703353851558, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.594427336674542, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103975782.16583256, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 28.9228427809027, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 737.7081263106433, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6079614158313363, "mean_inference_ms": 2.230318871610955, "mean_action_processing_ms": 0.3241496738748382, "mean_env_wait_ms": 4.3170082676461625, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003629674514134725, "StateBufferConnector_ms": 0.0025331974029541016, "ViewRequirementAgentConnector_ms": 0.053986161947250366}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3905.9917755094107, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256, "num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 573.2137377490479, "num_env_steps_trained_throughput_per_sec": 573.2137377490479, "timesteps_total": 88064, "num_env_steps_sampled_lifetime": 88064, "num_agent_steps_sampled_lifetime": 352256, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 352256, "timers": {"training_iteration_time_ms": 1802.516, "restore_workers_time_ms": 0.042, "training_step_time_ms": 1802.406, "sample_time_ms": 1127.331, "learn_time_ms": 655.039, "learn_throughput": 1563.266, "synch_weights_time_ms": 10.871}, "counters": {"num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256}, "done": false, "training_iteration": 86, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-34", "timestamp": 1729611874, "time_this_iter_s": 1.7933456897735596, "time_total_s": 157.30110836029053, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a30a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23aa70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b130>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a3b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239750>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 157.30110836029053, "iterations_since_restore": 86, "perf": {"cpu_util_percent": 3.1666666666666665, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.32274484038353, "cur_kl_coeff": 7.806255641895633e-19, "cur_lr": 5e-05, "total_loss": 9.15657548904419, "policy_loss": -0.003337766567710787, "vf_loss": 9.159913063049316, "vf_explained_var": -6.206333637237549e-05, "kl": 0.008823775955719747, "entropy": 1.1918381467461585, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.517144525051117, "cur_kl_coeff": 5.204170427930422e-19, "cur_lr": 5e-05, "total_loss": 9.656899762153625, "policy_loss": 0.0007211970165371895, "vf_loss": 9.6561785697937, "vf_explained_var": 4.954636096954346e-06, "kl": 0.0012749291161559817, "entropy": 2.0087368309497835, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.967042969167233, "cur_kl_coeff": 1.1102230246251566e-17, "cur_lr": 5e-05, "total_loss": 9.857463788986205, "policy_loss": -0.002666666964069009, "vf_loss": 9.860130286216735, "vf_explained_var": 5.995631217956543e-05, "kl": 0.0031211910598358374, "entropy": -0.30112391002476213, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.308577364683151, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 9.374790358543397, "policy_loss": -0.007697455491870642, "vf_loss": 9.382380175590516, "vf_explained_var": -0.00021789371967315674, "kl": 0.015313166681698931, "entropy": 1.1095497220754624, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 89088, "num_env_steps_trained": 89088, "num_agent_steps_sampled": 356352, "num_agent_steps_trained": 356352}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1974.4039312078407, "episode_reward_mean": 3905.9917755094107, "episode_len_mean": 3116.0, "episode_media": {}, "episodes_timesteps_total": 74784, "policy_reward_min": {"high_level_policy": -210.6545186134727, "DC1_ls_policy": -2998.667006790663, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 981.2886637580751, "DC1_ls_policy": -719.166121322438, "DC2_ls_policy": 3641.7584450721165, "DC3_ls_policy": 2.1107880016515423}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 103666.05050717508, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 116867.5581759787, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.05029826003064485, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.200856555016235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 60206.153596794196, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.0326923897540217, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105064.16061509214, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009978703353851558, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.594427336674542, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103975782.16583256, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 28.9228427809027, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 737.7081263106433, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6079614158313363, "mean_inference_ms": 2.230318871610955, "mean_action_processing_ms": 0.3241496738748382, "mean_env_wait_ms": 4.3170082676461625, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003629674514134725, "StateBufferConnector_ms": 0.0025331974029541016, "ViewRequirementAgentConnector_ms": 0.053986161947250366}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1974.4039312078407, "episode_return_mean": 3905.9917755094107, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 356352, "num_agent_steps_trained": 356352, "num_env_steps_sampled": 89088, "num_env_steps_trained": 89088, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 532.5133552142815, "num_env_steps_trained_throughput_per_sec": 532.5133552142815, "timesteps_total": 89088, "num_env_steps_sampled_lifetime": 89088, "num_agent_steps_sampled_lifetime": 356352, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 356352, "timers": {"training_iteration_time_ms": 1817.491, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1817.376, "sample_time_ms": 1142.444, "learn_time_ms": 654.967, "learn_throughput": 1563.437, "synch_weights_time_ms": 10.788}, "counters": {"num_env_steps_sampled": 89088, "num_env_steps_trained": 89088, "num_agent_steps_sampled": 356352, "num_agent_steps_trained": 356352}, "done": false, "training_iteration": 87, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-35", "timestamp": 1729611875, "time_this_iter_s": 1.9313960075378418, "time_total_s": 159.23250436782837, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154dc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211ba0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212380>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212b90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213220>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 159.23250436782837, "iterations_since_restore": 87, "perf": {"cpu_util_percent": 3.3333333333333335, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.878273469209671, "cur_kl_coeff": 7.806255641895633e-19, "cur_lr": 5e-05, "total_loss": 9.563992357254028, "policy_loss": -0.0033881501061841846, "vf_loss": 9.567380571365357, "vf_explained_var": -0.000163230299949646, "kl": 0.005624332197294279, "entropy": 0.5480725295841694, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.286585658788681, "cur_kl_coeff": 2.602085213965211e-19, "cur_lr": 5e-05, "total_loss": 9.631701397895814, "policy_loss": -0.0009763928188476712, "vf_loss": 9.632677793502808, "vf_explained_var": -1.236945390701294e-05, "kl": 0.008881881205343233, "entropy": 1.268078202009201, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.269022342562676, "cur_kl_coeff": 5.551115123125783e-18, "cur_lr": 5e-05, "total_loss": 9.808456087112427, "policy_loss": -0.0007217238890007138, "vf_loss": 9.809177613258361, "vf_explained_var": 0.00011384040117263794, "kl": 0.0044895871231346975, "entropy": -0.32262156084179877, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.722180545330048, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.865481162071228, "policy_loss": -0.006391785747837275, "vf_loss": 8.871804213523864, "vf_explained_var": -0.00017258226871490477, "kl": 0.009761242692638917, "entropy": 1.013896070420742, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3793.4850973472303, "episode_len_mean": 3141.12, "episode_media": {}, "episodes_timesteps_total": 78528, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 916.1858062672651, "DC1_ls_policy": -823.5991660340848, "DC2_ls_policy": 3690.8854997163594, "DC3_ls_policy": 10.012957397684506}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 104421.33580578539, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 122548.18297243326, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.048286329629419054, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2219248569181496, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59998.26702051062, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03138469416386083, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105504.54382831501, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009579555219697495, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5717399867973039, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105226217.65709242, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.765929069666594, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.6072478394141, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6081439478633153, "mean_inference_ms": 2.2301934375068786, "mean_action_processing_ms": 0.32423247268866767, "mean_env_wait_ms": 4.320074578679282, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036079883575439453, "StateBufferConnector_ms": 0.0025374889373779297, "ViewRequirementAgentConnector_ms": 0.053980112075805664}, "num_episodes": 1, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3793.4850973472303, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448, "num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 580.8280515443855, "num_env_steps_trained_throughput_per_sec": 580.8280515443855, "timesteps_total": 90112, "num_env_steps_sampled_lifetime": 90112, "num_agent_steps_sampled_lifetime": 360448, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 360448, "timers": {"training_iteration_time_ms": 1816.162, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1816.048, "sample_time_ms": 1141.479, "learn_time_ms": 654.505, "learn_throughput": 1564.54, "synch_weights_time_ms": 10.799}, "counters": {"num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448}, "done": false, "training_iteration": 88, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-37", "timestamp": 1729611877, "time_this_iter_s": 1.7702016830444336, "time_total_s": 161.0027060508728, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d1a20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12290>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13130>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11de0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12f80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 161.0027060508728, "iterations_since_restore": 88, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.53285449296236, "cur_kl_coeff": 7.806255641895633e-19, "cur_lr": 5e-05, "total_loss": 9.039017987251281, "policy_loss": -0.0005548072047531604, "vf_loss": 9.039572858810425, "vf_explained_var": -1.4215707778930664e-05, "kl": 0.0037604255514500527, "entropy": 1.0222632110118866, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.896385419368745, "cur_kl_coeff": 2.602085213965211e-19, "cur_lr": 5e-05, "total_loss": 9.448175692558289, "policy_loss": 0.0007635582587681711, "vf_loss": 9.447412109375, "vf_explained_var": 2.662837505340576e-06, "kl": 0.025669534262856602, "entropy": 1.0922295987606048, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.785468715429306, "cur_kl_coeff": 2.7755575615628915e-18, "cur_lr": 5e-05, "total_loss": 9.841831254959107, "policy_loss": -0.003199285757727921, "vf_loss": 9.845030450820923, "vf_explained_var": 6.754398345947266e-05, "kl": 0.006627919221959053, "entropy": -0.21614860612899064, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.513808578252792, "cur_kl_coeff": 0.007031250000000001, "cur_lr": 5e-05, "total_loss": 8.735490250587464, "policy_loss": -0.010713230876717716, "vf_loss": 8.746035933494568, "vf_explained_var": 9.061992168426513e-05, "kl": 0.02380971792518007, "entropy": 0.9174767389893532, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 91136, "num_env_steps_trained": 91136, "num_agent_steps_sampled": 364544, "num_agent_steps_trained": 364544}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3793.4850973472303, "episode_len_mean": 3141.12, "episode_media": {}, "episodes_timesteps_total": 78528, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 916.1858062672651, "DC1_ls_policy": -823.5991660340848, "DC2_ls_policy": 3690.8854997163594, "DC3_ls_policy": 10.012957397684506}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 104421.33580578539, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 122548.18297243326, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.048286329629419054, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2219248569181496, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59998.26702051062, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03138469416386083, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105504.54382831501, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009579555219697495, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5717399867973039, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105226217.65709242, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.765929069666594, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.6072478394141, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6081439478633153, "mean_inference_ms": 2.2301934375068786, "mean_action_processing_ms": 0.32423247268866767, "mean_env_wait_ms": 4.320074578679282, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036079883575439453, "StateBufferConnector_ms": 0.0025374889373779297, "ViewRequirementAgentConnector_ms": 0.053980112075805664}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3793.4850973472303, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 364544, "num_agent_steps_trained": 364544, "num_env_steps_sampled": 91136, "num_env_steps_trained": 91136, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.4245136490177, "num_env_steps_trained_throughput_per_sec": 576.4245136490177, "timesteps_total": 91136, "num_env_steps_sampled_lifetime": 91136, "num_agent_steps_sampled_lifetime": 364544, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 364544, "timers": {"training_iteration_time_ms": 1804.89, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1804.775, "sample_time_ms": 1129.66, "learn_time_ms": 655.101, "learn_throughput": 1563.118, "synch_weights_time_ms": 10.841}, "counters": {"num_env_steps_sampled": 91136, "num_env_steps_trained": 91136, "num_agent_steps_sampled": 364544, "num_agent_steps_trained": 364544}, "done": false, "training_iteration": 89, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-39", "timestamp": 1729611879, "time_this_iter_s": 1.7844159603118896, "time_total_s": 162.7871220111847, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db155630>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11360>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11d20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11e40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c122c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 162.7871220111847, "iterations_since_restore": 89, "perf": {"cpu_util_percent": 3.1666666666666665, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.243478617072105, "cur_kl_coeff": 3.9031278209478165e-19, "cur_lr": 5e-05, "total_loss": 9.036648678779603, "policy_loss": -0.002959135069977492, "vf_loss": 9.03960747718811, "vf_explained_var": -0.0001102834939956665, "kl": 0.006710982681761379, "entropy": 0.6014917902648449, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.911922973394394, "cur_kl_coeff": 3.9031278209478165e-19, "cur_lr": 5e-05, "total_loss": 9.165872526168823, "policy_loss": -0.0004832240752875805, "vf_loss": 9.166355657577515, "vf_explained_var": -2.0697712898254395e-06, "kl": 0.008465158609035853, "entropy": 0.8872652903199196, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.368163341283799, "cur_kl_coeff": 2.7755575615628915e-18, "cur_lr": 5e-05, "total_loss": 9.8203364610672, "policy_loss": -0.0021494069369509816, "vf_loss": 9.822485971450806, "vf_explained_var": -8.95470380783081e-05, "kl": 0.0060063063827328735, "entropy": -0.20604754537343978, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.229948425292969, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.397363531589509, "policy_loss": -0.008783703297376632, "vf_loss": 8.40596729516983, "vf_explained_var": 9.151548147201538e-05, "kl": 0.017063257060726755, "entropy": 0.8876983970403671, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3793.4850973472303, "episode_len_mean": 3141.12, "episode_media": {}, "episodes_timesteps_total": 78528, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 916.1858062672651, "DC1_ls_policy": -823.5991660340848, "DC2_ls_policy": 3690.8854997163594, "DC3_ls_policy": 10.012957397684506}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 104421.33580578539, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 122548.18297243326, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.048286329629419054, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2219248569181496, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59998.26702051062, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03138469416386083, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105504.54382831501, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009579555219697495, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5717399867973039, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105226217.65709242, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.765929069666594, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.6072478394141, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6081439478633153, "mean_inference_ms": 2.2301934375068786, "mean_action_processing_ms": 0.32423247268866767, "mean_env_wait_ms": 4.320074578679282, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036079883575439453, "StateBufferConnector_ms": 0.0025374889373779297, "ViewRequirementAgentConnector_ms": 0.053980112075805664}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3793.4850973472303, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640, "num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.3475492093175, "num_env_steps_trained_throughput_per_sec": 576.3475492093175, "timesteps_total": 92160, "num_env_steps_sampled_lifetime": 92160, "num_agent_steps_sampled_lifetime": 368640, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 368640, "timers": {"training_iteration_time_ms": 1805.851, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1805.736, "sample_time_ms": 1130.472, "learn_time_ms": 655.169, "learn_throughput": 1562.956, "synch_weights_time_ms": 10.811}, "counters": {"num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640}, "done": false, "training_iteration": 90, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-41", "timestamp": 1729611881, "time_this_iter_s": 1.7840447425842285, "time_total_s": 164.57116675376892, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156b00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12c50>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13070>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13910>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13d60>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 164.57116675376892, "iterations_since_restore": 90, "perf": {"cpu_util_percent": 3.3666666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.009484106302262, "cur_kl_coeff": 3.9031278209478165e-19, "cur_lr": 5e-05, "total_loss": 8.38901436328888, "policy_loss": -0.0014535943511873484, "vf_loss": 8.390467917919159, "vf_explained_var": 6.120204925537109e-05, "kl": 0.003042123920749873, "entropy": 0.7712249994277954, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.077846238017083, "cur_kl_coeff": 3.9031278209478165e-19, "cur_lr": 5e-05, "total_loss": 9.248605847358704, "policy_loss": -0.004715738585218787, "vf_loss": 9.25332169532776, "vf_explained_var": 1.2069940567016602e-06, "kl": 0.01228009025899155, "entropy": 0.872651245445013, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.959718805551529, "cur_kl_coeff": 2.7755575615628915e-18, "cur_lr": 5e-05, "total_loss": 9.812411761283874, "policy_loss": -0.0019949858076870443, "vf_loss": 9.814406704902648, "vf_explained_var": -1.1466443538665771e-05, "kl": 0.002826339979583281, "entropy": -0.1464969627559185, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.59838553071022, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.51688791513443, "policy_loss": -0.0060256415279582145, "vf_loss": 8.522780752182006, "vf_explained_var": -0.0001156732439994812, "kl": 0.012584643188173147, "entropy": 0.8471561968326569, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 93184, "num_env_steps_trained": 93184, "num_agent_steps_sampled": 372736, "num_agent_steps_trained": 372736}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3793.4850973472303, "episode_len_mean": 3141.12, "episode_media": {}, "episodes_timesteps_total": 78528, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 916.1858062672651, "DC1_ls_policy": -823.5991660340848, "DC2_ls_policy": 3690.8854997163594, "DC3_ls_policy": 10.012957397684506}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 104421.33580578539, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 122548.18297243326, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.048286329629419054, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2219248569181496, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59998.26702051062, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03138469416386083, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105504.54382831501, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009579555219697495, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5717399867973039, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105226217.65709242, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.765929069666594, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.6072478394141, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6081439478633153, "mean_inference_ms": 2.2301934375068786, "mean_action_processing_ms": 0.32423247268866767, "mean_env_wait_ms": 4.320074578679282, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036079883575439453, "StateBufferConnector_ms": 0.0025374889373779297, "ViewRequirementAgentConnector_ms": 0.053980112075805664}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3793.4850973472303, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 372736, "num_agent_steps_trained": 372736, "num_env_steps_sampled": 93184, "num_env_steps_trained": 93184, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.6855443140244, "num_env_steps_trained_throughput_per_sec": 579.6855443140244, "timesteps_total": 93184, "num_env_steps_sampled_lifetime": 93184, "num_agent_steps_sampled_lifetime": 372736, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 372736, "timers": {"training_iteration_time_ms": 1804.247, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1804.132, "sample_time_ms": 1129.157, "learn_time_ms": 655.038, "learn_throughput": 1563.268, "synch_weights_time_ms": 10.752}, "counters": {"num_env_steps_sampled": 93184, "num_env_steps_trained": 93184, "num_agent_steps_sampled": 372736, "num_agent_steps_trained": 372736}, "done": false, "training_iteration": 91, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-43", "timestamp": 1729611883, "time_this_iter_s": 1.774824619293213, "time_total_s": 166.34599137306213, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3e20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13e20>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c117b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12560>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13fd0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 166.34599137306213, "iterations_since_restore": 91, "perf": {"cpu_util_percent": 3.95, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.919763681292534, "cur_kl_coeff": 1.9515639104739083e-19, "cur_lr": 5e-05, "total_loss": 9.28007960319519, "policy_loss": -0.005167043348774314, "vf_loss": 9.28524661064148, "vf_explained_var": -0.00011513233184814453, "kl": 0.015886064039295888, "entropy": 1.256007868051529, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.511201161146165, "cur_kl_coeff": 3.9031278209478165e-19, "cur_lr": 5e-05, "total_loss": 9.336753416061402, "policy_loss": -0.006082372693344951, "vf_loss": 9.342835927009583, "vf_explained_var": -6.216764450073242e-06, "kl": 0.032342838040676725, "entropy": 0.7318316303193569, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.115395882725716, "cur_kl_coeff": 1.3877787807814458e-18, "cur_lr": 5e-05, "total_loss": 9.814964890480042, "policy_loss": -0.0062220916384831074, "vf_loss": 9.821187067031861, "vf_explained_var": -2.8899312019348146e-05, "kl": 0.008784822976397776, "entropy": -0.18241729363799095, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.628592848777771, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.696597385406495, "policy_loss": -0.0026819678023457527, "vf_loss": 8.699203372001648, "vf_explained_var": -0.00013337135314941406, "kl": 0.007200571788419782, "entropy": 0.8945845156908036, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3793.4850973472303, "episode_len_mean": 3141.12, "episode_media": {}, "episodes_timesteps_total": 78528, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 916.1858062672651, "DC1_ls_policy": -823.5991660340848, "DC2_ls_policy": 3690.8854997163594, "DC3_ls_policy": 10.012957397684506}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 104421.33580578539, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 122548.18297243326, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.048286329629419054, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2219248569181496, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59998.26702051062, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.03138469416386083, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105504.54382831501, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.009579555219697495, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5717399867973039, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105226217.65709242, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.765929069666594, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.6072478394141, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6081439478633153, "mean_inference_ms": 2.2301934375068786, "mean_action_processing_ms": 0.32423247268866767, "mean_env_wait_ms": 4.320074578679282, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036079883575439453, "StateBufferConnector_ms": 0.0025374889373779297, "ViewRequirementAgentConnector_ms": 0.053980112075805664}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3793.4850973472303, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832, "num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 540.3906791397418, "num_env_steps_trained_throughput_per_sec": 540.3906791397418, "timesteps_total": 94208, "num_env_steps_sampled_lifetime": 94208, "num_agent_steps_sampled_lifetime": 376832, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 376832, "timers": {"training_iteration_time_ms": 1815.994, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1815.88, "sample_time_ms": 1141.206, "learn_time_ms": 654.992, "learn_throughput": 1563.377, "synch_weights_time_ms": 10.803}, "counters": {"num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832}, "done": false, "training_iteration": 92, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-45", "timestamp": 1729611885, "time_this_iter_s": 1.9053008556365967, "time_total_s": 168.25129222869873, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154dc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2395a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b280>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238e20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239a20>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 168.25129222869873, "iterations_since_restore": 92, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.17348994910717, "cur_kl_coeff": 1.9515639104739083e-19, "cur_lr": 5e-05, "total_loss": 9.3382728099823, "policy_loss": -0.0045598501339554785, "vf_loss": 9.342832732200623, "vf_explained_var": -5.5342912673950195e-05, "kl": 0.0071651157530141065, "entropy": 1.421377770602703, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.060716390609741, "cur_kl_coeff": 5.854691731421724e-19, "cur_lr": 5e-05, "total_loss": 9.057515358924865, "policy_loss": 0.005228697694838047, "vf_loss": 9.052286744117737, "vf_explained_var": -7.749497890472413e-05, "kl": 0.017304659108054246, "entropy": 0.7232103109359741, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.367074885964394, "cur_kl_coeff": 1.3877787807814458e-18, "cur_lr": 5e-05, "total_loss": 9.785359263420105, "policy_loss": -0.004040016513317824, "vf_loss": 9.789399218559264, "vf_explained_var": 3.8646161556243896e-05, "kl": 0.008178626166773029, "entropy": -0.18538416735827923, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.2397340655326845, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.875667810440063, "policy_loss": -0.009306812565773726, "vf_loss": 8.884808206558228, "vf_explained_var": -0.00013104677200317382, "kl": 0.015781946357128616, "entropy": 0.9060361489653588, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 95232, "num_env_steps_trained": 95232, "num_agent_steps_sampled": 380928, "num_agent_steps_trained": 380928}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3767.869455654389, "episode_len_mean": 3171.6923076923076, "episode_media": {}, "episodes_timesteps_total": 82464, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 858.0494625175123, "DC1_ls_policy": -842.8530378231231, "DC2_ls_policy": 3743.464310883736, "DC3_ls_policy": 9.208720076258272}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 105023.03885536772, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 122548.18297243326, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04642916310521063, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.212011471239309, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59715.501120931636, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.030177590542173876, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 106056.33169520469, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.00921111078817067, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5533166696065381, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 106561019.93810606, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.698008720833265, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 713.6750111143522, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6079751501891674, "mean_inference_ms": 2.2294819062160807, "mean_action_processing_ms": 0.3241627692592504, "mean_env_wait_ms": 4.320376120874735, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003582926896902231, "StateBufferConnector_ms": 0.002534343646122859, "ViewRequirementAgentConnector_ms": 0.053976820065424994}, "num_episodes": 1, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3767.869455654389, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 380928, "num_agent_steps_trained": 380928, "num_env_steps_sampled": 95232, "num_env_steps_trained": 95232, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.4912629727089, "num_env_steps_trained_throughput_per_sec": 579.4912629727089, "timesteps_total": 95232, "num_env_steps_sampled_lifetime": 95232, "num_agent_steps_sampled_lifetime": 380928, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 380928, "timers": {"training_iteration_time_ms": 1814.843, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1814.729, "sample_time_ms": 1140.033, "learn_time_ms": 655.125, "learn_throughput": 1563.061, "synch_weights_time_ms": 10.8}, "counters": {"num_env_steps_sampled": 95232, "num_env_steps_trained": 95232, "num_agent_steps_sampled": 380928, "num_agent_steps_trained": 380928}, "done": false, "training_iteration": 93, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-47", "timestamp": 1729611887, "time_this_iter_s": 1.7760591506958008, "time_total_s": 170.02735137939453, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fb50>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c12080>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c11870>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13ee0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238c10>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 170.02735137939453, "iterations_since_restore": 93, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.881422472000122, "cur_kl_coeff": 1.9515639104739083e-19, "cur_lr": 5e-05, "total_loss": 9.348727130889893, "policy_loss": -0.0014065449009649455, "vf_loss": 9.350133419036865, "vf_explained_var": -7.336735725402833e-05, "kl": 0.003027804600613487, "entropy": 1.0224708497524262, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.718090254068375, "cur_kl_coeff": 5.854691731421724e-19, "cur_lr": 5e-05, "total_loss": 8.900894498825073, "policy_loss": -0.0019243023823946714, "vf_loss": 8.902818655967712, "vf_explained_var": -7.545948028564453e-06, "kl": 0.007951973192393779, "entropy": 0.5988930098712444, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.745616987347603, "cur_kl_coeff": 1.3877787807814458e-18, "cur_lr": 5e-05, "total_loss": 9.752700781822204, "policy_loss": -0.0016685406677424907, "vf_loss": 9.754369235038757, "vf_explained_var": 5.572587251663208e-05, "kl": 0.006778273688041736, "entropy": -0.17369990535080432, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.404980802536011, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.064052534103393, "policy_loss": -0.0055467260186560455, "vf_loss": 9.069474506378175, "vf_explained_var": 0.00034553706645965574, "kl": 0.011836600424430799, "entropy": 0.8356049194931984, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3670.3666204783053, "episode_len_mean": 3116.5714285714284, "episode_media": {}, "episodes_timesteps_total": 87264, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 824.4161359328881, "DC1_ls_policy": -913.3426568061262, "DC2_ls_policy": 3701.818996162901, "DC3_ls_policy": 57.47414518863783}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 106435.14520095971, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 131063.0226533277, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0446455324072194, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2437279137698347, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59127.29510626063, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.028022048360590027, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105670.91837237157, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.008553174303301336, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5137940503489283, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104860623.53915147, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.35814351458327, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 698.3043406776129, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6087001722144797, "mean_inference_ms": 2.232134046984331, "mean_action_processing_ms": 0.3242413506078631, "mean_env_wait_ms": 4.325998712220565, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036578093256269184, "StateBufferConnector_ms": 0.0025466084480285645, "ViewRequirementAgentConnector_ms": 0.05408248731068203}, "num_episodes": 2, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3670.3666204783053, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024, "num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.6694669251025, "num_env_steps_trained_throughput_per_sec": 576.6694669251025, "timesteps_total": 96256, "num_env_steps_sampled_lifetime": 96256, "num_agent_steps_sampled_lifetime": 385024, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 385024, "timers": {"training_iteration_time_ms": 1801.072, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1800.955, "sample_time_ms": 1126.547, "learn_time_ms": 654.972, "learn_throughput": 1563.425, "synch_weights_time_ms": 10.773}, "counters": {"num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024}, "done": false, "training_iteration": 94, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-49", "timestamp": 1729611889, "time_this_iter_s": 1.7850322723388672, "time_total_s": 171.8123836517334, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154670>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a680>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239ae0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2398a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239de0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 171.8123836517334, "iterations_since_restore": 94, "perf": {"cpu_util_percent": 3.95, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7438455879688264, "cur_kl_coeff": 9.757819552369541e-20, "cur_lr": 5e-05, "total_loss": 9.164762735366821, "policy_loss": -0.003847438213415444, "vf_loss": 9.168610215187073, "vf_explained_var": -4.2334198951721195e-06, "kl": 0.007230349871684293, "entropy": 1.2479828342795372, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.671505737304688, "cur_kl_coeff": 5.854691731421724e-19, "cur_lr": 5e-05, "total_loss": 9.092733526229859, "policy_loss": 0.0043230570619925855, "vf_loss": 9.088410592079162, "vf_explained_var": -4.662573337554931e-06, "kl": 0.023779000277863817, "entropy": 0.8552082777023315, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.807276728749275, "cur_kl_coeff": 1.3877787807814458e-18, "cur_lr": 5e-05, "total_loss": 9.800418996810913, "policy_loss": -0.0019275522558018566, "vf_loss": 9.802346515655518, "vf_explained_var": -0.00013944506645202637, "kl": 0.0035667562992557577, "entropy": -0.0965874175541103, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.381798851490021, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.34496692419052, "policy_loss": -0.00763397456612438, "vf_loss": 8.352445483207703, "vf_explained_var": 0.0003762096166610718, "kl": 0.014741017143574666, "entropy": 0.7628352239727973, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 97280, "num_env_steps_trained": 97280, "num_agent_steps_sampled": 389120, "num_agent_steps_trained": 389120}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3670.3666204783053, "episode_len_mean": 3116.5714285714284, "episode_media": {}, "episodes_timesteps_total": 87264, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 824.4161359328881, "DC1_ls_policy": -913.3426568061262, "DC2_ls_policy": 3701.818996162901, "DC3_ls_policy": 57.47414518863783}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 106435.14520095971, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 131063.0226533277, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0446455324072194, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2437279137698347, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59127.29510626063, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.028022048360590027, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105670.91837237157, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.008553174303301336, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5137940503489283, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104860623.53915147, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.35814351458327, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 698.3043406776129, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6087001722144797, "mean_inference_ms": 2.232134046984331, "mean_action_processing_ms": 0.3242413506078631, "mean_env_wait_ms": 4.325998712220565, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036578093256269184, "StateBufferConnector_ms": 0.0025466084480285645, "ViewRequirementAgentConnector_ms": 0.05408248731068203}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3670.3666204783053, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 389120, "num_agent_steps_trained": 389120, "num_env_steps_sampled": 97280, "num_env_steps_trained": 97280, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 572.8644126981333, "num_env_steps_trained_throughput_per_sec": 572.8644126981333, "timesteps_total": 97280, "num_env_steps_sampled_lifetime": 97280, "num_agent_steps_sampled_lifetime": 389120, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 389120, "timers": {"training_iteration_time_ms": 1801.75, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1801.631, "sample_time_ms": 1127.332, "learn_time_ms": 654.886, "learn_throughput": 1563.63, "synch_weights_time_ms": 10.741}, "counters": {"num_env_steps_sampled": 97280, "num_env_steps_trained": 97280, "num_agent_steps_sampled": 389120, "num_agent_steps_trained": 389120}, "done": false, "training_iteration": 95, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-50", "timestamp": 1729611890, "time_this_iter_s": 1.7959864139556885, "time_total_s": 173.6083700656891, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154430>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238e50>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239720>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238e80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b250>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 173.6083700656891, "iterations_since_restore": 95, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.044361400604248, "cur_kl_coeff": 9.757819552369541e-20, "cur_lr": 5e-05, "total_loss": 9.1830664396286, "policy_loss": -0.004340109997428954, "vf_loss": 9.18740646839142, "vf_explained_var": -5.6846439838409425e-05, "kl": 0.012524696195760044, "entropy": 0.6044832699000835, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.630902054905891, "cur_kl_coeff": 8.782037597132587e-19, "cur_lr": 5e-05, "total_loss": 9.206132555007935, "policy_loss": -0.0007767176488414407, "vf_loss": 9.206909418106079, "vf_explained_var": -2.3698806762695314e-05, "kl": 0.008141669759788783, "entropy": 0.9308753222227096, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.797720837593078, "cur_kl_coeff": 6.938893903907229e-19, "cur_lr": 5e-05, "total_loss": 9.81243555545807, "policy_loss": -0.003242960711941123, "vf_loss": 9.815678429603576, "vf_explained_var": -3.91155481338501e-06, "kl": 0.005257485870974694, "entropy": -0.21374275982379914, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.935473573207855, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.56294471025467, "policy_loss": -0.010126934642903507, "vf_loss": 8.572907257080079, "vf_explained_var": 3.001093864440918e-05, "kl": 0.015581010637106374, "entropy": 0.7350580811500549, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3820.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3670.3666204783053, "episode_len_mean": 3116.5714285714284, "episode_media": {}, "episodes_timesteps_total": 87264, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 824.4161359328881, "DC1_ls_policy": -913.3426568061262, "DC2_ls_policy": 3701.818996162901, "DC3_ls_policy": 57.47414518863783}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 106435.14520095971, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 131063.0226533277, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0446455324072194, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2437279137698347, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59127.29510626063, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.028022048360590027, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105670.91837237157, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.008553174303301336, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5137940503489283, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104860623.53915147, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.35814351458327, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 698.3043406776129, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6087001722144797, "mean_inference_ms": 2.232134046984331, "mean_action_processing_ms": 0.3242413506078631, "mean_env_wait_ms": 4.325998712220565, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036578093256269184, "StateBufferConnector_ms": 0.0025466084480285645, "ViewRequirementAgentConnector_ms": 0.05408248731068203}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3670.3666204783053, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216, "num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 542.9549255488722, "num_env_steps_trained_throughput_per_sec": 542.9549255488722, "timesteps_total": 98304, "num_env_steps_sampled_lifetime": 98304, "num_agent_steps_sampled_lifetime": 393216, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 393216, "timers": {"training_iteration_time_ms": 1811.706, "restore_workers_time_ms": 0.046, "training_step_time_ms": 1811.588, "sample_time_ms": 1138.193, "learn_time_ms": 654.251, "learn_throughput": 1565.148, "synch_weights_time_ms": 10.533}, "counters": {"num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216}, "done": false, "training_iteration": 96, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-52", "timestamp": 1729611892, "time_this_iter_s": 1.8937444686889648, "time_total_s": 175.50211453437805, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a30a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238f10>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239030>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a620>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238c40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 175.50211453437805, "iterations_since_restore": 96, "perf": {"cpu_util_percent": 3.3333333333333335, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.406886231899262, "cur_kl_coeff": 9.757819552369541e-20, "cur_lr": 5e-05, "total_loss": 9.532822966575623, "policy_loss": 0.0002937115030363202, "vf_loss": 9.532529282569886, "vf_explained_var": 6.994009017944336e-05, "kl": 0.007544335510835205, "entropy": 0.42817143388092516, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 14.611330771446228, "cur_kl_coeff": 8.782037597132587e-19, "cur_lr": 5e-05, "total_loss": 9.54554603099823, "policy_loss": -0.0015975801274180413, "vf_loss": 9.547143507003785, "vf_explained_var": -3.0243396759033202e-05, "kl": 0.013970795264322078, "entropy": 0.5041462859138847, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5337357342243196, "cur_kl_coeff": 6.938893903907229e-19, "cur_lr": 5e-05, "total_loss": 9.843165278434753, "policy_loss": -0.0008925576345063746, "vf_loss": 9.844057846069337, "vf_explained_var": -1.2205541133880616e-05, "kl": 0.00318108580486296, "entropy": -0.0942373669706285, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.9741468846797945, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.410952997207641, "policy_loss": -0.00597831120248884, "vf_loss": 8.416777276992798, "vf_explained_var": -0.00021285712718963624, "kl": 0.01459058180480497, "entropy": 0.6550166964530945, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3860.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 99328, "num_env_steps_trained": 99328, "num_agent_steps_sampled": 397312, "num_agent_steps_trained": 397312}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3670.3666204783053, "episode_len_mean": 3116.5714285714284, "episode_media": {}, "episodes_timesteps_total": 87264, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 824.4161359328881, "DC1_ls_policy": -913.3426568061262, "DC2_ls_policy": 3701.818996162901, "DC3_ls_policy": 57.47414518863783}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 106435.14520095971, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 131063.0226533277, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0446455324072194, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2437279137698347, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59127.29510626063, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.028022048360590027, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105670.91837237157, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.008553174303301336, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5137940503489283, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104860623.53915147, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.35814351458327, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 698.3043406776129, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6087001722144797, "mean_inference_ms": 2.232134046984331, "mean_action_processing_ms": 0.3242413506078631, "mean_env_wait_ms": 4.325998712220565, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036578093256269184, "StateBufferConnector_ms": 0.0025466084480285645, "ViewRequirementAgentConnector_ms": 0.05408248731068203}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3670.3666204783053, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 397312, "num_agent_steps_trained": 397312, "num_env_steps_sampled": 99328, "num_env_steps_trained": 99328, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 583.1289261032218, "num_env_steps_trained_throughput_per_sec": 583.1289261032218, "timesteps_total": 99328, "num_env_steps_sampled_lifetime": 99328, "num_agent_steps_sampled_lifetime": 397312, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 397312, "timers": {"training_iteration_time_ms": 1795.011, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1794.899, "sample_time_ms": 1121.448, "learn_time_ms": 654.359, "learn_throughput": 1564.891, "synch_weights_time_ms": 10.585}, "counters": {"num_env_steps_sampled": 99328, "num_env_steps_trained": 99328, "num_agent_steps_sampled": 397312, "num_agent_steps_trained": 397312}, "done": false, "training_iteration": 97, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-54", "timestamp": 1729611894, "time_this_iter_s": 1.764059066772461, "time_total_s": 177.2661736011505, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156b00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212320>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211780>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213580>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211660>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 177.2661736011505, "iterations_since_restore": 97, "perf": {"cpu_util_percent": 3.9499999999999997, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.119425374269485, "cur_kl_coeff": 9.757819552369541e-20, "cur_lr": 5e-05, "total_loss": 8.818275809288025, "policy_loss": 0.00159107802901417, "vf_loss": 8.816684794425964, "vf_explained_var": -0.0001770317554473877, "kl": 0.008545330000924879, "entropy": 0.5303957749158144, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.297104108333588, "cur_kl_coeff": 8.782037597132587e-19, "cur_lr": 5e-05, "total_loss": 9.307337856292724, "policy_loss": -0.0034863926703110337, "vf_loss": 9.310824251174926, "vf_explained_var": -4.0084123611450195e-05, "kl": 0.009498415827692952, "entropy": 0.6952251106500625, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8975584864616395, "cur_kl_coeff": 3.4694469519536144e-19, "cur_lr": 5e-05, "total_loss": 9.79151418209076, "policy_loss": -0.0024273574352264406, "vf_loss": 9.793941497802734, "vf_explained_var": -7.40453600883484e-05, "kl": 0.004589923200914088, "entropy": 0.015391033724881709, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.576655399799347, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.344924819469451, "policy_loss": -0.0016000621835701168, "vf_loss": 8.346454584598542, "vf_explained_var": 5.151480436325073e-05, "kl": 0.006651380109178717, "entropy": 0.6655879229307174, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3900.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3670.3666204783053, "episode_len_mean": 3116.5714285714284, "episode_media": {}, "episodes_timesteps_total": 87264, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 824.4161359328881, "DC1_ls_policy": -913.3426568061262, "DC2_ls_policy": 3701.818996162901, "DC3_ls_policy": 57.47414518863783}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 106435.14520095971, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 131063.0226533277, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0446455324072194, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2437279137698347, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 59127.29510626063, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.028022048360590027, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105670.91837237157, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.008553174303301336, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.5137940503489283, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104860623.53915147, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.35814351458327, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 698.3043406776129, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6087001722144797, "mean_inference_ms": 2.232134046984331, "mean_action_processing_ms": 0.3242413506078631, "mean_env_wait_ms": 4.325998712220565, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036578093256269184, "StateBufferConnector_ms": 0.0025466084480285645, "ViewRequirementAgentConnector_ms": 0.05408248731068203}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3670.3666204783053, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408, "num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 576.2046587205717, "num_env_steps_trained_throughput_per_sec": 576.2046587205717, "timesteps_total": 100352, "num_env_steps_sampled_lifetime": 100352, "num_agent_steps_sampled_lifetime": 401408, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 401408, "timers": {"training_iteration_time_ms": 1796.426, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1796.313, "sample_time_ms": 1122.284, "learn_time_ms": 654.919, "learn_throughput": 1563.553, "synch_weights_time_ms": 10.545}, "counters": {"num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408}, "done": false, "training_iteration": 98, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-56", "timestamp": 1729611896, "time_this_iter_s": 1.7862465381622314, "time_total_s": 179.05242013931274, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23acb0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b4c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a380>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b3d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 179.05242013931274, "iterations_since_restore": 98, "perf": {"cpu_util_percent": 3.3333333333333335, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.177710011601448, "cur_kl_coeff": 9.757819552369541e-20, "cur_lr": 5e-05, "total_loss": 9.452257966995239, "policy_loss": -0.0019059507176280022, "vf_loss": 9.454163813591004, "vf_explained_var": -1.2150406837463379e-05, "kl": 0.00591677461306972, "entropy": 1.199026557803154, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.997635024785996, "cur_kl_coeff": 8.782037597132587e-19, "cur_lr": 5e-05, "total_loss": 9.274569368362426, "policy_loss": -0.0016900174785405397, "vf_loss": 9.276259398460388, "vf_explained_var": -1.138448715209961e-05, "kl": 0.013115774601465091, "entropy": 0.714933393150568, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.028463017940521, "cur_kl_coeff": 1.7347234759768072e-19, "cur_lr": 5e-05, "total_loss": 9.815287923812866, "policy_loss": -0.00314467087155208, "vf_loss": 9.8184326171875, "vf_explained_var": -6.180405616760254e-05, "kl": 0.005364366564117517, "entropy": 0.0038878165883943438, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.588069713115692, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.900284337997437, "policy_loss": -0.0037500445265322923, "vf_loss": 8.903929018974305, "vf_explained_var": 0.00014059096574783325, "kl": 0.009985173000684333, "entropy": 0.6323498234152793, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3940.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 101376, "num_env_steps_trained": 101376, "num_agent_steps_sampled": 405504, "num_agent_steps_trained": 405504}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3638.5790259396413, "episode_len_mean": 3118.344827586207, "episode_media": {}, "episodes_timesteps_total": 90432, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 794.8613590725323, "DC1_ls_policy": -964.0138103511008, "DC2_ls_policy": 3716.5529072132986, "DC3_ls_policy": 91.1785700049067}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 107098.33316245743, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 131063.0226533277, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04316045483553193, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.261784230919534, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58972.686209846885, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02705577083091451, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105654.83255173557, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.00825823725835991, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.49607701412999977, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105221840.6239191, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.508337821290425, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 698.9097247852117, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6088011497707927, "mean_inference_ms": 2.231904116000563, "mean_action_processing_ms": 0.32411593125372723, "mean_env_wait_ms": 4.327950472726361, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003634650131751751, "StateBufferConnector_ms": 0.0025471736644876414, "ViewRequirementAgentConnector_ms": 0.05408957086760422}, "num_episodes": 1, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3638.5790259396413, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 405504, "num_agent_steps_trained": 405504, "num_env_steps_sampled": 101376, "num_env_steps_trained": 101376, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 538.7028383396287, "num_env_steps_trained_throughput_per_sec": 538.7028383396287, "timesteps_total": 101376, "num_env_steps_sampled_lifetime": 101376, "num_agent_steps_sampled_lifetime": 405504, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 405504, "timers": {"training_iteration_time_ms": 1808.865, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1808.753, "sample_time_ms": 1133.385, "learn_time_ms": 655.573, "learn_throughput": 1561.992, "synch_weights_time_ms": 10.592}, "counters": {"num_env_steps_sampled": 101376, "num_env_steps_trained": 101376, "num_agent_steps_sampled": 405504, "num_agent_steps_trained": 405504}, "done": false, "training_iteration": 99, "trial_id": "22c84_00000", "date": "2024-10-22_15-44-58", "timestamp": 1729611898, "time_this_iter_s": 1.909242868423462, "time_total_s": 180.9616630077362, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d27a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238be0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a4a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2394b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a680>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 180.9616630077362, "iterations_since_restore": 99, "perf": {"cpu_util_percent": 3.3000000000000003, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.514081475138664, "cur_kl_coeff": 9.757819552369541e-20, "cur_lr": 5e-05, "total_loss": 9.612422657012939, "policy_loss": -0.002120210789144039, "vf_loss": 9.614542913436889, "vf_explained_var": -3.42443585395813e-05, "kl": 0.00492687664427649, "entropy": 0.8179709956049919, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 12.114221906661987, "cur_kl_coeff": 8.782037597132587e-19, "cur_lr": 5e-05, "total_loss": 9.324863243103028, "policy_loss": 0.0014160528429783882, "vf_loss": 9.323447275161744, "vf_explained_var": -1.2820959091186523e-05, "kl": 0.010931301283566678, "entropy": 1.1872187227010726, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.690673589706421, "cur_kl_coeff": 1.7347234759768072e-19, "cur_lr": 5e-05, "total_loss": 9.773325538635254, "policy_loss": -0.0033395404345355926, "vf_loss": 9.776664757728577, "vf_explained_var": -9.63851809501648e-05, "kl": 0.004545291206250112, "entropy": 0.046598376519978044, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.213954335451126, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.001429677009583, "policy_loss": -0.0024325035978108645, "vf_loss": 9.003736996650696, "vf_explained_var": 0.0001259729266166687, "kl": 0.011875671026069672, "entropy": 0.6027413994073868, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3980.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3638.5790259396413, "episode_len_mean": 3118.344827586207, "episode_media": {}, "episodes_timesteps_total": 90432, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 794.8613590725323, "DC1_ls_policy": -964.0138103511008, "DC2_ls_policy": 3716.5529072132986, "DC3_ls_policy": 91.1785700049067}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 107098.33316245743, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 131063.0226533277, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04316045483553193, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.261784230919534, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58972.686209846885, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02705577083091451, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105654.83255173557, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.00825823725835991, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.49607701412999977, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105221840.6239191, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.508337821290425, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 698.9097247852117, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6088011497707927, "mean_inference_ms": 2.231904116000563, "mean_action_processing_ms": 0.32411593125372723, "mean_env_wait_ms": 4.327950472726361, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003634650131751751, "StateBufferConnector_ms": 0.0025471736644876414, "ViewRequirementAgentConnector_ms": 0.05408957086760422}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3638.5790259396413, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600, "num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 578.2410991592081, "num_env_steps_trained_throughput_per_sec": 578.2410991592081, "timesteps_total": 102400, "num_env_steps_sampled_lifetime": 102400, "num_agent_steps_sampled_lifetime": 409600, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 409600, "timers": {"training_iteration_time_ms": 1808.283, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1808.171, "sample_time_ms": 1132.741, "learn_time_ms": 655.719, "learn_throughput": 1561.645, "synch_weights_time_ms": 10.594}, "counters": {"num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600}, "done": false, "training_iteration": 100, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-00", "timestamp": 1729611900, "time_this_iter_s": 1.779693841934204, "time_total_s": 182.7413568496704, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154dc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2123e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2126e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212830>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213520>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 182.7413568496704, "iterations_since_restore": 100, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.202971750497818, "cur_kl_coeff": 4.8789097761847707e-20, "cur_lr": 5e-05, "total_loss": 9.255518436431885, "policy_loss": -0.0018634313892107457, "vf_loss": 9.257381892204284, "vf_explained_var": -4.008859395980835e-05, "kl": 0.00967867267173092, "entropy": 0.1768906716722995, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.747629536688327, "cur_kl_coeff": 8.782037597132587e-19, "cur_lr": 5e-05, "total_loss": 9.340329313278199, "policy_loss": -0.00024674239102751017, "vf_loss": 9.34057583808899, "vf_explained_var": -2.1836161613464357e-05, "kl": 0.009662484675936866, "entropy": 1.5962533563375474, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.264665147662162, "cur_kl_coeff": 8.673617379884036e-20, "cur_lr": 5e-05, "total_loss": 9.824144577980041, "policy_loss": -0.0020864129764959216, "vf_loss": 9.826231026649475, "vf_explained_var": 4.745125770568848e-05, "kl": 0.0046514254731640035, "entropy": -0.009430379769764841, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.227261227369308, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 7.974622619152069, "policy_loss": -0.0057530779857188465, "vf_loss": 7.9802338004112245, "vf_explained_var": -4.1516125202178954e-05, "kl": 0.013448273752510431, "entropy": 0.5883144944906235, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4020.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 103424, "num_env_steps_trained": 103424, "num_agent_steps_sampled": 413696, "num_agent_steps_trained": 413696}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3638.5790259396413, "episode_len_mean": 3118.344827586207, "episode_media": {}, "episodes_timesteps_total": 90432, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 794.8613590725323, "DC1_ls_policy": -964.0138103511008, "DC2_ls_policy": 3716.5529072132986, "DC3_ls_policy": 91.1785700049067}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 107098.33316245743, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 131063.0226533277, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04316045483553193, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.261784230919534, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58972.686209846885, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02705577083091451, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105654.83255173557, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.00825823725835991, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.49607701412999977, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105221840.6239191, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.508337821290425, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 698.9097247852117, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6088011497707927, "mean_inference_ms": 2.231904116000563, "mean_action_processing_ms": 0.32411593125372723, "mean_env_wait_ms": 4.327950472726361, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003634650131751751, "StateBufferConnector_ms": 0.0025471736644876414, "ViewRequirementAgentConnector_ms": 0.05408957086760422}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3638.5790259396413, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 413696, "num_agent_steps_trained": 413696, "num_env_steps_sampled": 103424, "num_env_steps_trained": 103424, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 578.1449705177472, "num_env_steps_trained_throughput_per_sec": 578.1449705177472, "timesteps_total": 103424, "num_env_steps_sampled_lifetime": 103424, "num_agent_steps_sampled_lifetime": 413696, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 413696, "timers": {"training_iteration_time_ms": 1808.754, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1808.641, "sample_time_ms": 1132.538, "learn_time_ms": 656.432, "learn_throughput": 1559.948, "synch_weights_time_ms": 10.607}, "counters": {"num_env_steps_sampled": 103424, "num_env_steps_trained": 103424, "num_agent_steps_sampled": 413696, "num_agent_steps_trained": 413696}, "done": false, "training_iteration": 101, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-02", "timestamp": 1729611902, "time_this_iter_s": 1.7790791988372803, "time_total_s": 184.5204360485077, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156b00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212fe0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213190>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2132e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211cc0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 184.5204360485077, "iterations_since_restore": 101, "perf": {"cpu_util_percent": 2.75, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.424748635292053, "cur_kl_coeff": 4.8789097761847707e-20, "cur_lr": 5e-05, "total_loss": 9.354540038108826, "policy_loss": -0.0035797183052636685, "vf_loss": 9.358119893074036, "vf_explained_var": -8.131861686706543e-05, "kl": 0.018993654939924907, "entropy": -0.2794741197489202, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.44989667236805, "cur_kl_coeff": 8.782037597132587e-19, "cur_lr": 5e-05, "total_loss": 8.738823914527893, "policy_loss": -7.879147306084633e-05, "vf_loss": 8.738902688026428, "vf_explained_var": -8.559226989746093e-06, "kl": 0.0032712133889718094, "entropy": 0.9382231801748275, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5990408211946487, "cur_kl_coeff": 4.336808689942018e-20, "cur_lr": 5e-05, "total_loss": 9.795773816108703, "policy_loss": -0.005088240501936525, "vf_loss": 9.80086190700531, "vf_explained_var": 6.589442491531373e-05, "kl": 0.006798613085993566, "entropy": -0.04831252648727968, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.979611504077912, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.143126285076141, "policy_loss": -0.009026047494262456, "vf_loss": 8.151979267597198, "vf_explained_var": -0.00039674639701843263, "kl": 0.016407790783523522, "entropy": 0.550688487291336, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4060.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3595.8519783472975, "episode_len_mean": 3100.8, "episode_media": {}, "episodes_timesteps_total": 93024, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 762.757641762606, "DC1_ls_policy": -992.0455945990651, "DC2_ls_policy": 3705.850255954861, "DC3_ls_policy": 119.28967522889128}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108012.42806928039, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04172177300768087, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2564274314526689, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58819.36465654707, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02615391180321736, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105444.71634615677, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007982962683081246, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47954111365899976, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104870169.37031813, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.691393227247413, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 694.0159972049228, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608999260019471, "mean_inference_ms": 2.231989958554126, "mean_action_processing_ms": 0.3242356513117315, "mean_env_wait_ms": 4.330551924964186, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003619988759358724, "StateBufferConnector_ms": 0.0025528669357299805, "ViewRequirementAgentConnector_ms": 0.054134527842203774}, "num_episodes": 1, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3595.8519783472975, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792, "num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 577.3164776248844, "num_env_steps_trained_throughput_per_sec": 577.3164776248844, "timesteps_total": 104448, "num_env_steps_sampled_lifetime": 104448, "num_agent_steps_sampled_lifetime": 417792, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 417792, "timers": {"training_iteration_time_ms": 1796.634, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1796.52, "sample_time_ms": 1120.581, "learn_time_ms": 656.206, "learn_throughput": 1560.485, "synch_weights_time_ms": 10.535}, "counters": {"num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792}, "done": false, "training_iteration": 102, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-04", "timestamp": 1729611904, "time_this_iter_s": 1.7819445133209229, "time_total_s": 186.3023805618286, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db156c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238280>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2382b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239900>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238370>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 186.3023805618286, "iterations_since_restore": 102, "perf": {"cpu_util_percent": 3.95, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.446142169833184, "cur_kl_coeff": 4.8789097761847707e-20, "cur_lr": 5e-05, "total_loss": 9.608485174179076, "policy_loss": -0.0003934674896299839, "vf_loss": 9.608878707885742, "vf_explained_var": -3.113597631454468e-05, "kl": 0.015921798317145092, "entropy": 0.09800352908205241, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.231966757774353, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 8.993189525604247, "policy_loss": -0.004755859659053385, "vf_loss": 8.997945523262024, "vf_explained_var": -1.1727213859558106e-06, "kl": 0.00829216008514777, "entropy": 1.0840727716684342, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6438181340694427, "cur_kl_coeff": 4.336808689942018e-20, "cur_lr": 5e-05, "total_loss": 9.795456266403198, "policy_loss": -0.005289264186285436, "vf_loss": 9.800745534896851, "vf_explained_var": -3.135949373245239e-05, "kl": 0.011421183849384007, "entropy": -0.059890605427790435, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.667834681272507, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.29223530292511, "policy_loss": -0.0034067959059029818, "vf_loss": 8.295502305030823, "vf_explained_var": 0.00012536495923995972, "kl": 0.013263571713479583, "entropy": 0.5668153330683708, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4100.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 105472, "num_env_steps_trained": 105472, "num_agent_steps_sampled": 421888, "num_agent_steps_trained": 421888}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3595.8519783472975, "episode_len_mean": 3100.8, "episode_media": {}, "episodes_timesteps_total": 93024, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 762.757641762606, "DC1_ls_policy": -992.0455945990651, "DC2_ls_policy": 3705.850255954861, "DC3_ls_policy": 119.28967522889128}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108012.42806928039, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04172177300768087, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2564274314526689, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58819.36465654707, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02615391180321736, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105444.71634615677, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007982962683081246, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47954111365899976, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104870169.37031813, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.691393227247413, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 694.0159972049228, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608999260019471, "mean_inference_ms": 2.231989958554126, "mean_action_processing_ms": 0.3242356513117315, "mean_env_wait_ms": 4.330551924964186, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003619988759358724, "StateBufferConnector_ms": 0.0025528669357299805, "ViewRequirementAgentConnector_ms": 0.054134527842203774}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3595.8519783472975, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 421888, "num_agent_steps_trained": 421888, "num_env_steps_sampled": 105472, "num_env_steps_trained": 105472, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 536.4649421550242, "num_env_steps_trained_throughput_per_sec": 536.4649421550242, "timesteps_total": 105472, "num_env_steps_sampled_lifetime": 105472, "num_agent_steps_sampled_lifetime": 421888, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 421888, "timers": {"training_iteration_time_ms": 1810.807, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1810.693, "sample_time_ms": 1134.488, "learn_time_ms": 656.277, "learn_throughput": 1560.316, "synch_weights_time_ms": 10.499}, "counters": {"num_env_steps_sampled": 105472, "num_env_steps_trained": 105472, "num_agent_steps_sampled": 421888, "num_agent_steps_trained": 421888}, "done": false, "training_iteration": 103, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-06", "timestamp": 1729611906, "time_this_iter_s": 1.9170660972595215, "time_total_s": 188.21944665908813, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d29e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ab60>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239bd0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ad10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a770>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 188.21944665908813, "iterations_since_restore": 103, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 12.017399832606316, "cur_kl_coeff": 4.8789097761847707e-20, "cur_lr": 5e-05, "total_loss": 9.297381854057312, "policy_loss": 0.0016536807175725698, "vf_loss": 9.2957279920578, "vf_explained_var": -5.11467456817627e-05, "kl": 0.016501096516731196, "entropy": 1.1334321215748786, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.693561604619026, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 9.532547664642333, "policy_loss": -0.0027644401183351875, "vf_loss": 9.53531198501587, "vf_explained_var": -9.462237358093262e-07, "kl": 0.007087308760674205, "entropy": 1.7233675062656402, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.103306065499782, "cur_kl_coeff": 4.336808689942018e-20, "cur_lr": 5e-05, "total_loss": 9.760858130455016, "policy_loss": -0.001079437625594437, "vf_loss": 9.761937570571899, "vf_explained_var": 0.00022543072700500488, "kl": 0.0022517760100527083, "entropy": -0.12296301182359456, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.631536281108856, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.103638005256652, "policy_loss": -0.0032536021899431944, "vf_loss": 9.10679488182068, "vf_explained_var": 0.00032350122928619384, "kl": 0.009176494141138391, "entropy": 0.5412961736321449, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4140.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3595.8519783472975, "episode_len_mean": 3100.8, "episode_media": {}, "episodes_timesteps_total": 93024, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 762.757641762606, "DC1_ls_policy": -992.0455945990651, "DC2_ls_policy": 3705.850255954861, "DC3_ls_policy": 119.28967522889128}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108012.42806928039, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04172177300768087, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2564274314526689, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58819.36465654707, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02615391180321736, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105444.71634615677, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007982962683081246, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47954111365899976, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104870169.37031813, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.691393227247413, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 694.0159972049228, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608999260019471, "mean_inference_ms": 2.231989958554126, "mean_action_processing_ms": 0.3242356513117315, "mean_env_wait_ms": 4.330551924964186, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003619988759358724, "StateBufferConnector_ms": 0.0025528669357299805, "ViewRequirementAgentConnector_ms": 0.054134527842203774}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3595.8519783472975, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984, "num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 578.8117565850952, "num_env_steps_trained_throughput_per_sec": 578.8117565850952, "timesteps_total": 106496, "num_env_steps_sampled_lifetime": 106496, "num_agent_steps_sampled_lifetime": 425984, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 425984, "timers": {"training_iteration_time_ms": 1810.149, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1810.036, "sample_time_ms": 1133.575, "learn_time_ms": 656.629, "learn_throughput": 1559.481, "synch_weights_time_ms": 10.4}, "counters": {"num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984}, "done": false, "training_iteration": 104, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-08", "timestamp": 1729611908, "time_this_iter_s": 1.7773959636688232, "time_total_s": 189.99684262275696, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d3c70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b220>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239b10>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239840>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a3b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 189.99684262275696, "iterations_since_restore": 104, "perf": {"cpu_util_percent": 3.3666666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.834827914834023, "cur_kl_coeff": 4.8789097761847707e-20, "cur_lr": 5e-05, "total_loss": 8.744208455085754, "policy_loss": 0.0016350571298971773, "vf_loss": 8.742573666572572, "vf_explained_var": 6.153136491775513e-05, "kl": 0.018215757928564797, "entropy": 0.7125983573496342, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 16.6536846101284, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 9.482737636566162, "policy_loss": 0.00523439459502697, "vf_loss": 9.477503299713135, "vf_explained_var": -9.447336196899414e-07, "kl": 0.012105759910991765, "entropy": 1.958217453956604, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.990430873632431, "cur_kl_coeff": 2.168404344971009e-20, "cur_lr": 5e-05, "total_loss": 9.81877143383026, "policy_loss": -0.000873428350314498, "vf_loss": 9.819644856452943, "vf_explained_var": 0.0003743767738342285, "kl": 0.0018610408102209374, "entropy": -0.1348231341689825, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.717077061533928, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.896963596343994, "policy_loss": -0.0015695634414441884, "vf_loss": 8.898463940620422, "vf_explained_var": 0.00012061893939971924, "kl": 0.006560473064382677, "entropy": 0.5266152322292328, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4180.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 107520, "num_env_steps_trained": 107520, "num_agent_steps_sampled": 430080, "num_agent_steps_trained": 430080}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3595.8519783472975, "episode_len_mean": 3100.8, "episode_media": {}, "episodes_timesteps_total": 93024, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 762.757641762606, "DC1_ls_policy": -992.0455945990651, "DC2_ls_policy": 3705.850255954861, "DC3_ls_policy": 119.28967522889128}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108012.42806928039, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04172177300768087, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2564274314526689, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58819.36465654707, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02615391180321736, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105444.71634615677, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007982962683081246, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47954111365899976, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104870169.37031813, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.691393227247413, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 694.0159972049228, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608999260019471, "mean_inference_ms": 2.231989958554126, "mean_action_processing_ms": 0.3242356513117315, "mean_env_wait_ms": 4.330551924964186, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003619988759358724, "StateBufferConnector_ms": 0.0025528669357299805, "ViewRequirementAgentConnector_ms": 0.054134527842203774}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3595.8519783472975, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 430080, "num_agent_steps_trained": 430080, "num_env_steps_sampled": 107520, "num_env_steps_trained": 107520, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 575.0719342139477, "num_env_steps_trained_throughput_per_sec": 575.0719342139477, "timesteps_total": 107520, "num_env_steps_sampled_lifetime": 107520, "num_agent_steps_sampled_lifetime": 430080, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 430080, "timers": {"training_iteration_time_ms": 1809.463, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1809.35, "sample_time_ms": 1132.952, "learn_time_ms": 656.548, "learn_throughput": 1559.673, "synch_weights_time_ms": 10.414}, "counters": {"num_env_steps_sampled": 107520, "num_env_steps_trained": 107520, "num_agent_steps_sampled": 430080, "num_agent_steps_trained": 430080}, "done": false, "training_iteration": 105, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-10", "timestamp": 1729611910, "time_this_iter_s": 1.7882747650146484, "time_total_s": 191.7851173877716, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3e20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a6e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a110>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23aad0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2390f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 191.7851173877716, "iterations_since_restore": 105, "perf": {"cpu_util_percent": 4.0, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 14.709910064935684, "cur_kl_coeff": 4.8789097761847707e-20, "cur_lr": 5e-05, "total_loss": 9.466485190391541, "policy_loss": -0.0020340150338597597, "vf_loss": 9.46851921081543, "vf_explained_var": -6.729960441589355e-05, "kl": 0.012790557209518738, "entropy": 0.13436680929735303, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.206303456425667, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 9.735935711860657, "policy_loss": 0.002143055014312267, "vf_loss": 9.733792567253113, "vf_explained_var": -9.6052885055542e-06, "kl": 0.009493258121801773, "entropy": 1.5784060508012772, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.984133926033974, "cur_kl_coeff": 1.0842021724855045e-20, "cur_lr": 5e-05, "total_loss": 9.78824861049652, "policy_loss": -0.0018079424742609262, "vf_loss": 9.790056705474854, "vf_explained_var": 0.00013033002614974975, "kl": 0.004156372035621169, "entropy": -0.13357983296737075, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.244001126289367, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.261765122413635, "policy_loss": -0.0021298827370628713, "vf_loss": 9.263803744316101, "vf_explained_var": -0.00029866695404052735, "kl": 0.008643823833335774, "entropy": 0.5220232121646404, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4220.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3595.8519783472975, "episode_len_mean": 3100.8, "episode_media": {}, "episodes_timesteps_total": 93024, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 762.757641762606, "DC1_ls_policy": -992.0455945990651, "DC2_ls_policy": 3705.850255954861, "DC3_ls_policy": 119.28967522889128}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108012.42806928039, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04172177300768087, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2564274314526689, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58819.36465654707, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02615391180321736, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105444.71634615677, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007982962683081246, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47954111365899976, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104870169.37031813, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.691393227247413, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 694.0159972049228, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608999260019471, "mean_inference_ms": 2.231989958554126, "mean_action_processing_ms": 0.3242356513117315, "mean_env_wait_ms": 4.330551924964186, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003619988759358724, "StateBufferConnector_ms": 0.0025528669357299805, "ViewRequirementAgentConnector_ms": 0.054134527842203774}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3595.8519783472975, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176, "num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 573.0293505333283, "num_env_steps_trained_throughput_per_sec": 573.0293505333283, "timesteps_total": 108544, "num_env_steps_sampled_lifetime": 108544, "num_agent_steps_sampled_lifetime": 434176, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 434176, "timers": {"training_iteration_time_ms": 1799.565, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1799.452, "sample_time_ms": 1122.958, "learn_time_ms": 656.554, "learn_throughput": 1559.657, "synch_weights_time_ms": 10.5}, "counters": {"num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176}, "done": false, "training_iteration": 106, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-12", "timestamp": 1729611912, "time_this_iter_s": 1.794525384902954, "time_total_s": 193.57964277267456, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13430>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c13cd0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c114b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fdff3c115d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 193.57964277267456, "iterations_since_restore": 106, "perf": {"cpu_util_percent": 3.366666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 27.593481647968293, "cur_kl_coeff": 4.8789097761847707e-20, "cur_lr": 5e-05, "total_loss": 9.402940726280212, "policy_loss": 0.019983077491633593, "vf_loss": 9.382957887649535, "vf_explained_var": -0.00012109279632568359, "kl": 0.06439138143759919, "entropy": -0.6556556083261966, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.390408688783646, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 9.198756051063537, "policy_loss": -0.002730712527409196, "vf_loss": 9.201486778259277, "vf_explained_var": -6.9409608840942385e-06, "kl": 0.00869776790495962, "entropy": 1.0504898518323897, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.678921854496002, "cur_kl_coeff": 5.4210108624275225e-21, "cur_lr": 5e-05, "total_loss": 9.832012844085693, "policy_loss": -0.0017857408383861184, "vf_loss": 9.833798456192017, "vf_explained_var": 3.9874017238616945e-05, "kl": 0.005377073802814003, "entropy": -0.20442281067371368, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.393348729610443, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.58066737651825, "policy_loss": -0.0009106846060603857, "vf_loss": 8.581513738632202, "vf_explained_var": -0.00038493573665618894, "kl": 0.0060980190950431275, "entropy": 0.5023916214704514, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4260.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 109568, "num_env_steps_trained": 109568, "num_agent_steps_sampled": 438272, "num_agent_steps_trained": 438272}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3595.8519783472975, "episode_len_mean": 3100.8, "episode_media": {}, "episodes_timesteps_total": 93024, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -3329.9922391136047, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 762.757641762606, "DC1_ls_policy": -992.0455945990651, "DC2_ls_policy": 3705.850255954861, "DC3_ls_policy": 119.28967522889128}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108012.42806928039, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04172177300768087, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2564274314526689, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58819.36465654707, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.02615391180321736, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105444.71634615677, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007982962683081246, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.47954111365899976, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 104870169.37031813, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.691393227247413, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 694.0159972049228, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608999260019471, "mean_inference_ms": 2.231989958554126, "mean_action_processing_ms": 0.3242356513117315, "mean_env_wait_ms": 4.330551924964186, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003619988759358724, "StateBufferConnector_ms": 0.0025528669357299805, "ViewRequirementAgentConnector_ms": 0.054134527842203774}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3595.8519783472975, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 438272, "num_agent_steps_trained": 438272, "num_env_steps_sampled": 109568, "num_env_steps_trained": 109568, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 542.5330582625572, "num_env_steps_trained_throughput_per_sec": 542.5330582625572, "timesteps_total": 109568, "num_env_steps_sampled_lifetime": 109568, "num_agent_steps_sampled_lifetime": 438272, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 438272, "timers": {"training_iteration_time_ms": 1812.705, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1812.592, "sample_time_ms": 1135.947, "learn_time_ms": 656.669, "learn_throughput": 1559.386, "synch_weights_time_ms": 10.474}, "counters": {"num_env_steps_sampled": 109568, "num_env_steps_trained": 109568, "num_agent_steps_sampled": 438272, "num_agent_steps_trained": 438272}, "done": false, "training_iteration": 107, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-14", "timestamp": 1729611914, "time_this_iter_s": 1.8952198028564453, "time_total_s": 195.474862575531, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db154670>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213f40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2127a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2123e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2136d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 195.474862575531, "iterations_since_restore": 107, "perf": {"cpu_util_percent": 3.1666666666666665, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 26.30815930366516, "cur_kl_coeff": 7.318364664277155e-20, "cur_lr": 5e-05, "total_loss": 9.260090494155884, "policy_loss": 0.011083171609789133, "vf_loss": 9.249007391929627, "vf_explained_var": -6.356239318847657e-05, "kl": 0.02523394784730044, "entropy": -0.7018195703625679, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.340336173772812, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 8.873191642761231, "policy_loss": 0.0033689457923173904, "vf_loss": 8.86982283592224, "vf_explained_var": -4.333257675170899e-06, "kl": 0.012218204060263815, "entropy": 1.2580344036221505, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.786857533454895, "cur_kl_coeff": 5.4210108624275225e-21, "cur_lr": 5e-05, "total_loss": 9.831213521957398, "policy_loss": -0.0014146860223263503, "vf_loss": 9.832628154754639, "vf_explained_var": 7.092952728271485e-07, "kl": 0.01123147393718682, "entropy": -0.29909178577363493, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.412868469953537, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.296913766860962, "policy_loss": -0.0013453593477606774, "vf_loss": 8.298183429241181, "vf_explained_var": -0.00010403096675872802, "kl": 0.0071918239791330055, "entropy": 0.4524475000798702, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4300.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3535.7560650901573, "episode_len_mean": 3112.2580645161293, "episode_media": {}, "episodes_timesteps_total": 96480, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 738.6250285285998, "DC1_ls_policy": -1092.8071248041954, "DC2_ls_policy": 3732.3908602684887, "DC3_ls_policy": 157.54730109726032}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108664.97074779813, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04381079586167443, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2986148082158446, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58727.95377592732, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.025310237228920025, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105287.1842073071, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0077254477578205605, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.46407204547645137, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105423809.9109203, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.280880374486742, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 704.7248272308691, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608585122902396, "mean_inference_ms": 2.230321864636427, "mean_action_processing_ms": 0.32410634066035454, "mean_env_wait_ms": 4.329293499503051, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035895455268121533, "StateBufferConnector_ms": 0.002551463342482044, "ViewRequirementAgentConnector_ms": 0.054110250165385586}, "num_episodes": 1, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3535.7560650901573, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368, "num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.6150592561384, "num_env_steps_trained_throughput_per_sec": 579.6150592561384, "timesteps_total": 110592, "num_env_steps_sampled_lifetime": 110592, "num_agent_steps_sampled_lifetime": 442368, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 442368, "timers": {"training_iteration_time_ms": 1811.659, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1811.547, "sample_time_ms": 1135.112, "learn_time_ms": 656.584, "learn_throughput": 1559.587, "synch_weights_time_ms": 10.496}, "counters": {"num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368}, "done": false, "training_iteration": 108, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-15", "timestamp": 1729611915, "time_this_iter_s": 1.7742846012115479, "time_total_s": 197.24914717674255, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d1480>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212a70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212c20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212ce0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212fb0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 197.24914717674255, "iterations_since_restore": 108, "perf": {"cpu_util_percent": 3.1666666666666665, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 17.548385018110274, "cur_kl_coeff": 1.0977546996415734e-19, "cur_lr": 5e-05, "total_loss": 8.306448972225189, "policy_loss": 0.007485217321664095, "vf_loss": 8.298963797092437, "vf_explained_var": -1.6789138317108155e-05, "kl": 0.037052545320338394, "entropy": 0.22562183372210712, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.922922450304032, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 9.744269371032715, "policy_loss": -0.0038146481849253176, "vf_loss": 9.748084163665771, "vf_explained_var": -4.225969314575196e-06, "kl": 0.0175506233856197, "entropy": 1.8437798231840135, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.664338690042496, "cur_kl_coeff": 5.4210108624275225e-21, "cur_lr": 5e-05, "total_loss": 9.739268946647645, "policy_loss": -0.003677333821542561, "vf_loss": 9.742946195602418, "vf_explained_var": -2.6720762252807618e-05, "kl": 0.004207872419647174, "entropy": -0.378928791731596, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.872712981700897, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.225116634368897, "policy_loss": -0.002515352563932538, "vf_loss": 9.227533268928529, "vf_explained_var": 0.00021623522043228148, "kl": 0.009365762574179825, "entropy": 0.3903678461909294, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4340.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 111616, "num_env_steps_trained": 111616, "num_agent_steps_sampled": 446464, "num_agent_steps_trained": 446464}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3535.7560650901573, "episode_len_mean": 3112.2580645161293, "episode_media": {}, "episodes_timesteps_total": 96480, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 738.6250285285998, "DC1_ls_policy": -1092.8071248041954, "DC2_ls_policy": 3732.3908602684887, "DC3_ls_policy": 157.54730109726032}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108664.97074779813, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04381079586167443, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2986148082158446, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58727.95377592732, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.025310237228920025, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105287.1842073071, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0077254477578205605, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.46407204547645137, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105423809.9109203, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.280880374486742, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 704.7248272308691, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608585122902396, "mean_inference_ms": 2.230321864636427, "mean_action_processing_ms": 0.32410634066035454, "mean_env_wait_ms": 4.329293499503051, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035895455268121533, "StateBufferConnector_ms": 0.002551463342482044, "ViewRequirementAgentConnector_ms": 0.054110250165385586}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3535.7560650901573, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 446464, "num_agent_steps_trained": 446464, "num_env_steps_sampled": 111616, "num_env_steps_trained": 111616, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 538.7475718229989, "num_env_steps_trained_throughput_per_sec": 538.7475718229989, "timesteps_total": 111616, "num_env_steps_sampled_lifetime": 111616, "num_agent_steps_sampled_lifetime": 446464, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 446464, "timers": {"training_iteration_time_ms": 1811.644, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1811.53, "sample_time_ms": 1136.311, "learn_time_ms": 656.093, "learn_throughput": 1560.754, "synch_weights_time_ms": 10.409}, "counters": {"num_env_steps_sampled": 111616, "num_env_steps_trained": 111616, "num_agent_steps_sampled": 446464, "num_agent_steps_trained": 446464}, "done": false, "training_iteration": 109, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-17", "timestamp": 1729611917, "time_this_iter_s": 1.9096019268035889, "time_total_s": 199.15874910354614, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527fa30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213790>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213e80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2113f0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2117b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 199.15874910354614, "iterations_since_restore": 109, "perf": {"cpu_util_percent": 4.25, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 23.620972937345506, "cur_kl_coeff": 1.6466320494623601e-19, "cur_lr": 5e-05, "total_loss": 9.19443371295929, "policy_loss": 0.005543412547558546, "vf_loss": 9.1888902425766, "vf_explained_var": -4.874467849731445e-05, "kl": 0.011319952632766217, "entropy": 1.0361583918333053, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.59645617902279, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 9.821037411689758, "policy_loss": 0.0035311457584612073, "vf_loss": 9.817506217956543, "vf_explained_var": 2.0757317543029787e-06, "kl": 0.006753818362631137, "entropy": 2.7504384934902193, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.0279648244380954, "cur_kl_coeff": 2.7105054312137612e-21, "cur_lr": 5e-05, "total_loss": 9.777555203437805, "policy_loss": -0.0003394935978576541, "vf_loss": 9.77789490222931, "vf_explained_var": 0.0003788694739341736, "kl": 0.0011516417776874731, "entropy": -0.3464832067489624, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.022931200265884, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.345016479492188, "policy_loss": -0.005307470634579659, "vf_loss": 9.350151634216308, "vf_explained_var": 0.0001659110188484192, "kl": 0.01634711328333651, "entropy": 0.2787882573902607, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4380.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3535.7560650901573, "episode_len_mean": 3112.2580645161293, "episode_media": {}, "episodes_timesteps_total": 96480, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 738.6250285285998, "DC1_ls_policy": -1092.8071248041954, "DC2_ls_policy": 3732.3908602684887, "DC3_ls_policy": 157.54730109726032}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108664.97074779813, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04381079586167443, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2986148082158446, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58727.95377592732, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.025310237228920025, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105287.1842073071, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0077254477578205605, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.46407204547645137, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105423809.9109203, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.280880374486742, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 704.7248272308691, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608585122902396, "mean_inference_ms": 2.230321864636427, "mean_action_processing_ms": 0.32410634066035454, "mean_env_wait_ms": 4.329293499503051, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035895455268121533, "StateBufferConnector_ms": 0.002551463342482044, "ViewRequirementAgentConnector_ms": 0.054110250165385586}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3535.7560650901573, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560, "num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 515.6120344645151, "num_env_steps_trained_throughput_per_sec": 515.6120344645151, "timesteps_total": 112640, "num_env_steps_sampled_lifetime": 112640, "num_agent_steps_sampled_lifetime": 450560, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 450560, "timers": {"training_iteration_time_ms": 1833.153, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1833.04, "sample_time_ms": 1157.292, "learn_time_ms": 656.185, "learn_throughput": 1560.535, "synch_weights_time_ms": 10.491}, "counters": {"num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560}, "done": false, "training_iteration": 110, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-19", "timestamp": 1729611919, "time_this_iter_s": 1.99330735206604, "time_total_s": 201.15205645561218, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db157a30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213880>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211660>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2116f0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211ae0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 201.15205645561218, "iterations_since_restore": 110, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 18.180049765110017, "cur_kl_coeff": 1.6466320494623601e-19, "cur_lr": 5e-05, "total_loss": 8.950897932052612, "policy_loss": 0.0014157513622194528, "vf_loss": 8.949482131004334, "vf_explained_var": -6.580799818038941e-05, "kl": 0.007295862292085076, "entropy": 0.5196554364636541, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.454174172878265, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 9.614208483695984, "policy_loss": -0.0002736113965511322, "vf_loss": 9.614482021331787, "vf_explained_var": -1.023709774017334e-06, "kl": 0.008614987895998637, "entropy": 1.7374714463949203, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.880509902536869, "cur_kl_coeff": 1.3552527156068806e-21, "cur_lr": 5e-05, "total_loss": 9.830914783477784, "policy_loss": -0.0011048460379242896, "vf_loss": 9.832019591331482, "vf_explained_var": -0.00012356191873550416, "kl": 0.003266933533886526, "entropy": -0.29088822677731513, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.356679821014405, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.376049971580505, "policy_loss": -0.00256473122863099, "vf_loss": 9.378492450714111, "vf_explained_var": -0.0002455294132232666, "kl": 0.011588718893472105, "entropy": 0.17549676299095154, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4420.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 113664, "num_env_steps_trained": 113664, "num_agent_steps_sampled": 454656, "num_agent_steps_trained": 454656}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3535.7560650901573, "episode_len_mean": 3112.2580645161293, "episode_media": {}, "episodes_timesteps_total": 96480, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 738.6250285285998, "DC1_ls_policy": -1092.8071248041954, "DC2_ls_policy": 3732.3908602684887, "DC3_ls_policy": 157.54730109726032}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108664.97074779813, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04381079586167443, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2986148082158446, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58727.95377592732, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.025310237228920025, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105287.1842073071, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0077254477578205605, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.46407204547645137, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105423809.9109203, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.280880374486742, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 704.7248272308691, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608585122902396, "mean_inference_ms": 2.230321864636427, "mean_action_processing_ms": 0.32410634066035454, "mean_env_wait_ms": 4.329293499503051, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035895455268121533, "StateBufferConnector_ms": 0.002551463342482044, "ViewRequirementAgentConnector_ms": 0.054110250165385586}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3535.7560650901573, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 454656, "num_agent_steps_trained": 454656, "num_env_steps_sampled": 113664, "num_env_steps_trained": 113664, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 493.15069847089967, "num_env_steps_trained_throughput_per_sec": 493.15069847089967, "timesteps_total": 113664, "num_env_steps_sampled_lifetime": 113664, "num_agent_steps_sampled_lifetime": 454656, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 454656, "timers": {"training_iteration_time_ms": 1863.68, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1863.567, "sample_time_ms": 1188.456, "learn_time_ms": 655.444, "learn_throughput": 1562.3, "synch_weights_time_ms": 10.498}, "counters": {"num_env_steps_sampled": 113664, "num_env_steps_trained": 113664, "num_agent_steps_sampled": 454656, "num_agent_steps_trained": 454656}, "done": false, "training_iteration": 111, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-22", "timestamp": 1729611922, "time_this_iter_s": 2.084774971008301, "time_total_s": 203.23683142662048, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1570a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212b00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2106d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211c60>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212da0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 203.23683142662048, "iterations_since_restore": 111, "perf": {"cpu_util_percent": 3.233333333333333, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 15.289185523986816, "cur_kl_coeff": 1.6466320494623601e-19, "cur_lr": 5e-05, "total_loss": 9.414297723770142, "policy_loss": -0.0028857403667643666, "vf_loss": 9.41718361377716, "vf_explained_var": -5.838871002197266e-05, "kl": 0.016487016378960107, "entropy": -0.10177248734980822, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 23.94774815440178, "cur_kl_coeff": 4.391018798566294e-19, "cur_lr": 5e-05, "total_loss": 9.229329752922059, "policy_loss": -0.006388505990616977, "vf_loss": 9.235718131065369, "vf_explained_var": -5.53131103515625e-06, "kl": 0.05186909771292414, "entropy": 0.5995871342718602, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.982671853899956, "cur_kl_coeff": 6.776263578034403e-22, "cur_lr": 5e-05, "total_loss": 9.806440544128417, "policy_loss": -0.0017800530418753623, "vf_loss": 9.808220648765564, "vf_explained_var": 3.09482216835022e-05, "kl": 0.00347087274549267, "entropy": -0.28873347379267217, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.688890314102172, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.102585220336914, "policy_loss": 0.0010812795255333186, "vf_loss": 8.101423966884614, "vf_explained_var": -0.00020473301410675048, "kl": 0.0075907595717648445, "entropy": 0.1225627450272441, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4460.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": 1093.3248214548935, "episode_reward_mean": 3535.7560650901573, "episode_len_mean": 3112.2580645161293, "episode_media": {}, "episodes_timesteps_total": 96480, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 738.6250285285998, "DC1_ls_policy": -1092.8071248041954, "DC2_ls_policy": 3732.3908602684887, "DC3_ls_policy": 157.54730109726032}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 108664.97074779813, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 134521.18036714583, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04381079586167443, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.2986148082158446, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.1329166666666666, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58727.95377592732, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.025310237228920025, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105287.1842073071, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0077254477578205605, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.46407204547645137, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 105423809.9109203, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.280880374486742, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 704.7248272308691, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.608585122902396, "mean_inference_ms": 2.230321864636427, "mean_action_processing_ms": 0.32410634066035454, "mean_env_wait_ms": 4.329293499503051, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035895455268121533, "StateBufferConnector_ms": 0.002551463342482044, "ViewRequirementAgentConnector_ms": 0.054110250165385586}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": 1093.3248214548935, "episode_return_mean": 3535.7560650901573, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752, "num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 535.0102133542307, "num_env_steps_trained_throughput_per_sec": 535.0102133542307, "timesteps_total": 114688, "num_env_steps_sampled_lifetime": 114688, "num_agent_steps_sampled_lifetime": 458752, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 458752, "timers": {"training_iteration_time_ms": 1877.705, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1877.593, "sample_time_ms": 1202.836, "learn_time_ms": 655.25, "learn_throughput": 1562.763, "synch_weights_time_ms": 10.503}, "counters": {"num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752}, "done": false, "training_iteration": 112, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-24", "timestamp": 1729611924, "time_this_iter_s": 1.9214589595794678, "time_total_s": 205.15829038619995, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3f40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2121d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db213430>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211e40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2127d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 205.15829038619995, "iterations_since_restore": 112, "perf": {"cpu_util_percent": 3.2000000000000006, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 19.355556440353393, "cur_kl_coeff": 1.6466320494623601e-19, "cur_lr": 5e-05, "total_loss": 9.32932369709015, "policy_loss": 0.004169581108726561, "vf_loss": 9.325154066085815, "vf_explained_var": -8.063316345214843e-05, "kl": 0.027430797823762988, "entropy": -0.12132109608501196, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 35.33065442442894, "cur_kl_coeff": 6.586528197849441e-19, "cur_lr": 5e-05, "total_loss": 9.451747941970826, "policy_loss": -0.003610642277635634, "vf_loss": 9.455358338356017, "vf_explained_var": -6.723403930664062e-05, "kl": 0.021550383273279294, "entropy": -0.2072644572239369, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.376479291915894, "cur_kl_coeff": 3.3881317890172015e-22, "cur_lr": 5e-05, "total_loss": 9.79045844078064, "policy_loss": -0.0057375016389414665, "vf_loss": 9.796195983886719, "vf_explained_var": 1.9916892051696776e-05, "kl": 0.0093275005763644, "entropy": -0.29059067741036415, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.110031080245971, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.586384117603302, "policy_loss": -0.0036508430843241514, "vf_loss": 8.589924550056457, "vf_explained_var": -0.00011196136474609376, "kl": 0.010475039364064288, "entropy": 0.17173485457897186, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4500.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 115712, "num_env_steps_trained": 115712, "num_agent_steps_sampled": 462848, "num_agent_steps_trained": 462848}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": -324.88259311663063, "episode_reward_mean": 3404.9672146041166, "episode_len_mean": 3069.090909090909, "episode_media": {}, "episodes_timesteps_total": 101280, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 727.1192131384275, "DC1_ls_policy": -1223.9462896728023, "DC2_ls_policy": 3698.6484877333014, "DC3_ls_policy": 203.145803405186}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 109843.1582153133, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 138578.45730440682, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04317579813268406, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.393181082465389, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.175, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58261.222899269116, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.023776283457470328, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104629.48482139922, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007257238802801133, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4390146487809089, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103839036.60792026, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.907828281083507, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 702.978859166372, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947, -324.88259311663063, 3080.3626572576213], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964, -319.8273801402909, 1417.3855293218044], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101, -3921.4750959833164, -2591.7315942890978], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318, 3167.3722960761197, 3183.911130799696], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332, 749.0475869308527, 1070.797591425215]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6091874079191916, "mean_inference_ms": 2.232661511726334, "mean_action_processing_ms": 0.32417564181604713, "mean_env_wait_ms": 4.334205960072671, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036514166629675665, "StateBufferConnector_ms": 0.002557219880999941, "ViewRequirementAgentConnector_ms": 0.05419471047141335}, "num_episodes": 2, "episode_return_max": 6789.084452014565, "episode_return_min": -324.88259311663063, "episode_return_mean": 3404.9672146041166, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 462848, "num_agent_steps_trained": 462848, "num_env_steps_sampled": 115712, "num_env_steps_trained": 115712, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 578.6477614244732, "num_env_steps_trained_throughput_per_sec": 578.6477614244732, "timesteps_total": 115712, "num_env_steps_sampled_lifetime": 115712, "num_agent_steps_sampled_lifetime": 462848, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 462848, "timers": {"training_iteration_time_ms": 1863.79, "restore_workers_time_ms": 0.042, "training_step_time_ms": 1863.678, "sample_time_ms": 1189.404, "learn_time_ms": 654.89, "learn_throughput": 1563.622, "synch_weights_time_ms": 10.583}, "counters": {"num_env_steps_sampled": 115712, "num_env_steps_trained": 115712, "num_agent_steps_sampled": 462848, "num_agent_steps_trained": 462848}, "done": false, "training_iteration": 113, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-26", "timestamp": 1729611926, "time_this_iter_s": 1.7782752513885498, "time_total_s": 206.9365656375885, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d0d30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b640>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211ae0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db212200>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db211210>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 206.9365656375885, "iterations_since_restore": 113, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 37.97837024927139, "cur_kl_coeff": 2.46994807419354e-19, "cur_lr": 5e-05, "total_loss": 8.977432298660279, "policy_loss": 0.03956696088425815, "vf_loss": 8.937865257263184, "vf_explained_var": -4.665553569793701e-05, "kl": 0.08179717239109788, "entropy": 0.4944868835620582, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.990759411454201, "cur_kl_coeff": 9.87979229677416e-19, "cur_lr": 5e-05, "total_loss": 9.745552587509156, "policy_loss": 0.0014378878753632308, "vf_loss": 9.744114685058594, "vf_explained_var": -3.3706426620483397e-06, "kl": 0.002145426422804471, "entropy": 2.2968558073043823, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.023796579241752, "cur_kl_coeff": 3.3881317890172015e-22, "cur_lr": 5e-05, "total_loss": 9.763691806793213, "policy_loss": -0.0025246687699109318, "vf_loss": 9.766216468811034, "vf_explained_var": -4.407912492752075e-05, "kl": 0.004478744773132348, "entropy": -0.29635597094893457, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.822587203979491, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.320889210700988, "policy_loss": 0.0014996381476521492, "vf_loss": 9.31931231021881, "vf_explained_var": -0.00019100606441497804, "kl": 0.007312027328225668, "entropy": 0.20041953027248383, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4540.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": -324.88259311663063, "episode_reward_mean": 3404.9672146041166, "episode_len_mean": 3069.090909090909, "episode_media": {}, "episodes_timesteps_total": 101280, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 727.1192131384275, "DC1_ls_policy": -1223.9462896728023, "DC2_ls_policy": 3698.6484877333014, "DC3_ls_policy": 203.145803405186}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 109843.1582153133, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 138578.45730440682, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04317579813268406, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.393181082465389, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.175, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58261.222899269116, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.023776283457470328, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104629.48482139922, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007257238802801133, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4390146487809089, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103839036.60792026, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.907828281083507, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 702.978859166372, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947, -324.88259311663063, 3080.3626572576213], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964, -319.8273801402909, 1417.3855293218044], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101, -3921.4750959833164, -2591.7315942890978], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318, 3167.3722960761197, 3183.911130799696], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332, 749.0475869308527, 1070.797591425215]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6091874079191916, "mean_inference_ms": 2.232661511726334, "mean_action_processing_ms": 0.32417564181604713, "mean_env_wait_ms": 4.334205960072671, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036514166629675665, "StateBufferConnector_ms": 0.002557219880999941, "ViewRequirementAgentConnector_ms": 0.05419471047141335}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": -324.88259311663063, "episode_return_mean": 3404.9672146041166, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944, "num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.8959279384374, "num_env_steps_trained_throughput_per_sec": 579.8959279384374, "timesteps_total": 116736, "num_env_steps_sampled_lifetime": 116736, "num_agent_steps_sampled_lifetime": 466944, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 466944, "timers": {"training_iteration_time_ms": 1863.46, "restore_workers_time_ms": 0.042, "training_step_time_ms": 1863.348, "sample_time_ms": 1189.795, "learn_time_ms": 654.178, "learn_throughput": 1565.322, "synch_weights_time_ms": 10.556}, "counters": {"num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944}, "done": false, "training_iteration": 114, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-27", "timestamp": 1729611927, "time_this_iter_s": 1.7743093967437744, "time_total_s": 208.71087503433228, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d0040>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a260>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a9e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a650>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2386a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 208.71087503433228, "iterations_since_restore": 114, "perf": {"cpu_util_percent": 4.199999999999999, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 19.5850381731987, "cur_kl_coeff": 3.7049221112903095e-19, "cur_lr": 5e-05, "total_loss": 9.39972767829895, "policy_loss": 0.012181818648241461, "vf_loss": 9.387545776367187, "vf_explained_var": -1.1323392391204834e-05, "kl": 0.05128207720118624, "entropy": 1.2250602915883064, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.723141393065452, "cur_kl_coeff": 4.93989614838708e-19, "cur_lr": 5e-05, "total_loss": 9.751687455177308, "policy_loss": -0.0016836849972605705, "vf_loss": 9.753371143341065, "vf_explained_var": -6.091594696044922e-06, "kl": 0.0029636958617743404, "entropy": 3.4304968416690826, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.087173995375633, "cur_kl_coeff": 1.6940658945086008e-22, "cur_lr": 5e-05, "total_loss": 9.791516947746278, "policy_loss": -0.0013426987454295159, "vf_loss": 9.792859601974488, "vf_explained_var": 4.539936780929565e-05, "kl": 0.011148162639301518, "entropy": -0.3601043313741684, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.370133095979691, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 9.64783444404602, "policy_loss": 0.003081635292619467, "vf_loss": 9.644606852531433, "vf_explained_var": 0.00011145919561386108, "kl": 0.013844526116372435, "entropy": 0.19976511746644973, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4580.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 117760, "num_env_steps_trained": 117760, "num_agent_steps_sampled": 471040, "num_agent_steps_trained": 471040}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": -324.88259311663063, "episode_reward_mean": 3404.9672146041166, "episode_len_mean": 3069.090909090909, "episode_media": {}, "episodes_timesteps_total": 101280, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 727.1192131384275, "DC1_ls_policy": -1223.9462896728023, "DC2_ls_policy": 3698.6484877333014, "DC3_ls_policy": 203.145803405186}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 109843.1582153133, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 138578.45730440682, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04317579813268406, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.393181082465389, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.175, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58261.222899269116, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.023776283457470328, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104629.48482139922, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007257238802801133, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4390146487809089, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103839036.60792026, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.907828281083507, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 702.978859166372, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947, -324.88259311663063, 3080.3626572576213], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964, -319.8273801402909, 1417.3855293218044], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101, -3921.4750959833164, -2591.7315942890978], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318, 3167.3722960761197, 3183.911130799696], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332, 749.0475869308527, 1070.797591425215]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6091874079191916, "mean_inference_ms": 2.232661511726334, "mean_action_processing_ms": 0.32417564181604713, "mean_env_wait_ms": 4.334205960072671, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036514166629675665, "StateBufferConnector_ms": 0.002557219880999941, "ViewRequirementAgentConnector_ms": 0.05419471047141335}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": -324.88259311663063, "episode_return_mean": 3404.9672146041166, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 471040, "num_agent_steps_trained": 471040, "num_env_steps_sampled": 117760, "num_env_steps_trained": 117760, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 567.0557877560699, "num_env_steps_trained_throughput_per_sec": 567.0557877560699, "timesteps_total": 117760, "num_env_steps_sampled_lifetime": 117760, "num_agent_steps_sampled_lifetime": 471040, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 471040, "timers": {"training_iteration_time_ms": 1865.977, "restore_workers_time_ms": 0.043, "training_step_time_ms": 1865.863, "sample_time_ms": 1191.584, "learn_time_ms": 654.662, "learn_throughput": 1564.167, "synch_weights_time_ms": 10.761}, "counters": {"num_env_steps_sampled": 117760, "num_env_steps_trained": 117760, "num_agent_steps_sampled": 471040, "num_agent_steps_trained": 471040}, "done": false, "training_iteration": 115, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-29", "timestamp": 1729611929, "time_this_iter_s": 1.8139402866363525, "time_total_s": 210.52481532096863, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d0700>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238970>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2398a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2388e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a530>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 210.52481532096863, "iterations_since_restore": 115, "perf": {"cpu_util_percent": 3.266666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 36.358360183238986, "cur_kl_coeff": 5.557383166935465e-19, "cur_lr": 5e-05, "total_loss": 9.249867057800293, "policy_loss": 0.01610056421486661, "vf_loss": 9.23376636505127, "vf_explained_var": -5.5801868438720706e-05, "kl": 0.023987544735064148, "entropy": 0.01207937514409423, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.869289126992226, "cur_kl_coeff": 2.46994807419354e-19, "cur_lr": 5e-05, "total_loss": 9.828715085983276, "policy_loss": -0.006240976182743907, "vf_loss": 9.83495614528656, "vf_explained_var": -1.641213893890381e-05, "kl": 0.01528939845579771, "entropy": 3.4107365012168884, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.7653740987181665, "cur_kl_coeff": 1.6940658945086008e-22, "cur_lr": 5e-05, "total_loss": 9.826161575317382, "policy_loss": -0.0017555078258737922, "vf_loss": 9.827917122840882, "vf_explained_var": 2.7754902839660643e-05, "kl": 0.004155068087493418, "entropy": -0.3115397073328495, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.924153757095336, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.902036261558532, "policy_loss": -0.0011505085509270429, "vf_loss": 8.903094220161439, "vf_explained_var": 0.00013288110494613647, "kl": 0.008762270660190552, "entropy": 0.16287431083619594, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4620.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": -324.88259311663063, "episode_reward_mean": 3404.9672146041166, "episode_len_mean": 3069.090909090909, "episode_media": {}, "episodes_timesteps_total": 101280, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -4115.653030958101, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6677.619226078465, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 727.1192131384275, "DC1_ls_policy": -1223.9462896728023, "DC2_ls_policy": 3698.6484877333014, "DC3_ls_policy": 203.145803405186}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 109843.1582153133, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 138578.45730440682, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04317579813268406, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.393181082465389, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.175, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 58261.222899269116, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.023776283457470328, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104629.48482139922, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.007257238802801133, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.4390146487809089, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 103839036.60792026, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.907828281083507, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 702.978859166372, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947, -324.88259311663063, 3080.3626572576213], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456, 2400, 2400], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964, -319.8273801402909, 1417.3855293218044], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101, -3921.4750959833164, -2591.7315942890978], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318, 3167.3722960761197, 3183.911130799696], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332, 749.0475869308527, 1070.797591425215]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6091874079191916, "mean_inference_ms": 2.232661511726334, "mean_action_processing_ms": 0.32417564181604713, "mean_env_wait_ms": 4.334205960072671, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036514166629675665, "StateBufferConnector_ms": 0.002557219880999941, "ViewRequirementAgentConnector_ms": 0.05419471047141335}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": -324.88259311663063, "episode_return_mean": 3404.9672146041166, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136, "num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 526.8780765405719, "num_env_steps_trained_throughput_per_sec": 526.8780765405719, "timesteps_total": 118784, "num_env_steps_sampled_lifetime": 118784, "num_agent_steps_sampled_lifetime": 475136, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 475136, "timers": {"training_iteration_time_ms": 1881.634, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1881.515, "sample_time_ms": 1206.944, "learn_time_ms": 654.962, "learn_throughput": 1563.45, "synch_weights_time_ms": 10.731}, "counters": {"num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136}, "done": false, "training_iteration": 116, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-31", "timestamp": 1729611931, "time_this_iter_s": 1.9525222778320312, "time_total_s": 212.47733759880066, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239a20>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239720>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b3d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238610>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 212.47733759880066, "iterations_since_restore": 116, "perf": {"cpu_util_percent": 3.3666666666666667, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 23.88036293387413, "cur_kl_coeff": 8.336074750403197e-19, "cur_lr": 5e-05, "total_loss": 9.604023551940918, "policy_loss": 0.0034388886298984287, "vf_loss": 9.600584864616394, "vf_explained_var": -4.9258768558502195e-05, "kl": 0.011345853289822117, "entropy": -0.941734229773283, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.47909968495369, "cur_kl_coeff": 2.46994807419354e-19, "cur_lr": 5e-05, "total_loss": 9.315104532241822, "policy_loss": -0.002946910448372364, "vf_loss": 9.318051481246949, "vf_explained_var": 1.6823410987854005e-06, "kl": 0.005924020908605598, "entropy": 2.784565007686615, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.81496661901474, "cur_kl_coeff": 8.470329472543004e-23, "cur_lr": 5e-05, "total_loss": 9.819685673713684, "policy_loss": -0.0014591576298698782, "vf_loss": 9.821144962310791, "vf_explained_var": 1.481175422668457e-05, "kl": 0.004769216786375386, "entropy": -0.2591754227876663, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.692928302288056, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 8.613223779201508, "policy_loss": -0.001881455909460783, "vf_loss": 8.614973855018615, "vf_explained_var": 6.557554006576538e-05, "kl": 0.012449017825565534, "entropy": 0.12277993969619275, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4660.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 119808, "num_env_steps_trained": 119808, "num_agent_steps_sampled": 479232, "num_agent_steps_trained": 479232}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": -324.88259311663063, "episode_reward_mean": 3341.704559533539, "episode_len_mean": 3143.3142857142857, "episode_media": {}, "episodes_timesteps_total": 110016, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -5892.095729470454, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6722.608203232185, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 713.4411131299959, "DC1_ls_policy": -1474.4031285215897, "DC2_ls_policy": 3822.8122138113117, "DC3_ls_policy": 279.8543611138186}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 110667.62689928454, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 138578.45730440682, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04623364019298978, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.4677908203660235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.175, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 57952.91115556468, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.022417638688472023, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104539.04786039142, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.006842539442641068, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.41594656506546746, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 106492924.63269767, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.44969904063209, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.5400593919688, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947, -324.88259311663063, 3080.3626572576213, 708.7191246161048, 3887.022377121921], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456, 2400, 2400, 3744, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964, -319.8273801402909, 1417.3855293218044, -41.51751480366369, 1017.0224407854112], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101, -3921.4750959833164, -2591.7315942890978, -5321.786209582706, -5892.095729470454], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318, 3167.3722960761197, 3183.911130799696, 5020.419184964771, 6722.608203232185], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332, 749.0475869308527, 1070.797591425215, 1051.6036640377063, 2039.4874625748075]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6089796201598466, "mean_inference_ms": 2.231615131601277, "mean_action_processing_ms": 0.324064545093779, "mean_env_wait_ms": 4.334389987180142, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00361459595816476, "StateBufferConnector_ms": 0.0025556768689836773, "ViewRequirementAgentConnector_ms": 0.05414928708757673}, "num_episodes": 2, "episode_return_max": 6789.084452014565, "episode_return_min": -324.88259311663063, "episode_return_mean": 3341.704559533539, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 479232, "num_agent_steps_trained": 479232, "num_env_steps_sampled": 119808, "num_env_steps_trained": 119808, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 579.1817301362079, "num_env_steps_trained_throughput_per_sec": 579.1817301362079, "timesteps_total": 119808, "num_env_steps_sampled_lifetime": 119808, "num_agent_steps_sampled_lifetime": 479232, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 479232, "timers": {"training_iteration_time_ms": 1869.691, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1869.572, "sample_time_ms": 1195.192, "learn_time_ms": 654.826, "learn_throughput": 1563.775, "synch_weights_time_ms": 10.761}, "counters": {"num_env_steps_sampled": 119808, "num_env_steps_trained": 119808, "num_agent_steps_sampled": 479232, "num_agent_steps_trained": 479232}, "done": false, "training_iteration": 117, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-33", "timestamp": 1729611933, "time_this_iter_s": 1.7767493724822998, "time_total_s": 214.25408697128296, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe11527f760>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2392a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b6d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2392d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238c10>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 214.25408697128296, "iterations_since_restore": 117, "perf": {"cpu_util_percent": 3.1999999999999997, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 30.373985207080842, "cur_kl_coeff": 8.336074750403197e-19, "cur_lr": 5e-05, "total_loss": 9.113273549079896, "policy_loss": 0.003750862879678607, "vf_loss": 9.10952286720276, "vf_explained_var": -5.0520896911621095e-05, "kl": 0.011190538984388704, "entropy": -0.938985176384449, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 37.10888692736626, "cur_kl_coeff": 2.46994807419354e-19, "cur_lr": 5e-05, "total_loss": 8.952616858482362, "policy_loss": 0.016714616352692245, "vf_loss": 8.935902333259582, "vf_explained_var": 1.7121434211730958e-06, "kl": 0.16223622109973804, "entropy": 1.1797650203108787, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.703898924589157, "cur_kl_coeff": 4.235164736271502e-23, "cur_lr": 5e-05, "total_loss": 9.754137110710143, "policy_loss": -9.08716581761837e-05, "vf_loss": 9.754228043556214, "vf_explained_var": 0.0008620992302894592, "kl": 0.0048658668383723125, "entropy": -0.1409498043358326, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.774848008155823, "cur_kl_coeff": 0.010546875, "cur_lr": 5e-05, "total_loss": 7.756068527698517, "policy_loss": -0.006530424696393311, "vf_loss": 7.762368834018707, "vf_explained_var": -5.547851324081421e-05, "kl": 0.0218306878686235, "entropy": -0.0625212628627196, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4700.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": -324.88259311663063, "episode_reward_mean": 3341.704559533539, "episode_len_mean": 3143.3142857142857, "episode_media": {}, "episodes_timesteps_total": 110016, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -5892.095729470454, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6722.608203232185, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 713.4411131299959, "DC1_ls_policy": -1474.4031285215897, "DC2_ls_policy": 3822.8122138113117, "DC3_ls_policy": 279.8543611138186}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 110667.62689928454, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 138578.45730440682, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04623364019298978, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.4677908203660235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.175, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 57952.91115556468, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.022417638688472023, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104539.04786039142, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.006842539442641068, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.41594656506546746, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 106492924.63269767, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.44969904063209, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.5400593919688, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947, -324.88259311663063, 3080.3626572576213, 708.7191246161048, 3887.022377121921], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456, 2400, 2400, 3744, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964, -319.8273801402909, 1417.3855293218044, -41.51751480366369, 1017.0224407854112], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101, -3921.4750959833164, -2591.7315942890978, -5321.786209582706, -5892.095729470454], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318, 3167.3722960761197, 3183.911130799696, 5020.419184964771, 6722.608203232185], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332, 749.0475869308527, 1070.797591425215, 1051.6036640377063, 2039.4874625748075]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6089796201598466, "mean_inference_ms": 2.231615131601277, "mean_action_processing_ms": 0.324064545093779, "mean_env_wait_ms": 4.334389987180142, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00361459595816476, "StateBufferConnector_ms": 0.0025556768689836773, "ViewRequirementAgentConnector_ms": 0.05414928708757673}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": -324.88259311663063, "episode_return_mean": 3341.704559533539, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328, "num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 527.8942679341305, "num_env_steps_trained_throughput_per_sec": 527.8942679341305, "timesteps_total": 120832, "num_env_steps_sampled_lifetime": 120832, "num_agent_steps_sampled_lifetime": 483328, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 483328, "timers": {"training_iteration_time_ms": 1887.0, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1886.881, "sample_time_ms": 1212.923, "learn_time_ms": 654.407, "learn_throughput": 1564.776, "synch_weights_time_ms": 10.767}, "counters": {"num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328}, "done": false, "training_iteration": 118, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-35", "timestamp": 1729611935, "time_this_iter_s": 1.9476239681243896, "time_total_s": 216.20171093940735, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe0db1d1ea0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2394b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ae30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db2388b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db238370>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 216.20171093940735, "iterations_since_restore": 118, "perf": {"cpu_util_percent": 3.9499999999999997, "ram_util_percent": 2.8}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 26.8518648147583, "cur_kl_coeff": 8.336074750403197e-19, "cur_lr": 5e-05, "total_loss": 9.003070306777953, "policy_loss": 0.010324296588078142, "vf_loss": 8.992745804786683, "vf_explained_var": -2.056807279586792e-05, "kl": 0.02050643256953704, "entropy": -0.04871443286538124, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 21.067477482557297, "cur_kl_coeff": 3.7049221112903095e-19, "cur_lr": 5e-05, "total_loss": 9.248434138298034, "policy_loss": 0.006155083444900811, "vf_loss": 9.242279195785523, "vf_explained_var": 3.0279159545898436e-06, "kl": 0.01571745734618162, "entropy": 2.185232844948769, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.813789531588554, "cur_kl_coeff": 2.117582368135751e-23, "cur_lr": 5e-05, "total_loss": 9.8183012008667, "policy_loss": -0.0028720383066684007, "vf_loss": 9.821173191070557, "vf_explained_var": 0.0002053782343864441, "kl": 0.0022177205935804524, "entropy": -0.18734793812036515, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.979202032089233, "cur_kl_coeff": 0.015820312500000003, "cur_lr": 5e-05, "total_loss": 8.618461000919343, "policy_loss": 0.00021486904006451368, "vf_loss": 8.618055415153503, "vf_explained_var": -0.000145837664604187, "kl": 0.012059663456602721, "entropy": -0.17371910605579616, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4740.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 121856, "num_env_steps_trained": 121856, "num_agent_steps_sampled": 487424, "num_agent_steps_trained": 487424}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": -324.88259311663063, "episode_reward_mean": 3341.704559533539, "episode_len_mean": 3143.3142857142857, "episode_media": {}, "episodes_timesteps_total": 110016, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -5892.095729470454, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6722.608203232185, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 713.4411131299959, "DC1_ls_policy": -1474.4031285215897, "DC2_ls_policy": 3822.8122138113117, "DC3_ls_policy": 279.8543611138186}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 110667.62689928454, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 138578.45730440682, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04623364019298978, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.4677908203660235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.175, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 57952.91115556468, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.022417638688472023, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104539.04786039142, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.006842539442641068, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.41594656506546746, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 106492924.63269767, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.44969904063209, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.5400593919688, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947, -324.88259311663063, 3080.3626572576213, 708.7191246161048, 3887.022377121921], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456, 2400, 2400, 3744, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964, -319.8273801402909, 1417.3855293218044, -41.51751480366369, 1017.0224407854112], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101, -3921.4750959833164, -2591.7315942890978, -5321.786209582706, -5892.095729470454], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318, 3167.3722960761197, 3183.911130799696, 5020.419184964771, 6722.608203232185], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332, 749.0475869308527, 1070.797591425215, 1051.6036640377063, 2039.4874625748075]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6089796201598466, "mean_inference_ms": 2.231615131601277, "mean_action_processing_ms": 0.324064545093779, "mean_env_wait_ms": 4.334389987180142, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00361459595816476, "StateBufferConnector_ms": 0.0025556768689836773, "ViewRequirementAgentConnector_ms": 0.05414928708757673}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": -324.88259311663063, "episode_return_mean": 3341.704559533539, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 487424, "num_agent_steps_trained": 487424, "num_env_steps_sampled": 121856, "num_env_steps_trained": 121856, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 504.26181331815485, "num_env_steps_trained_throughput_per_sec": 504.26181331815485, "timesteps_total": 121856, "num_env_steps_sampled_lifetime": 121856, "num_agent_steps_sampled_lifetime": 487424, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 487424, "timers": {"training_iteration_time_ms": 1899.999, "restore_workers_time_ms": 0.044, "training_step_time_ms": 1899.879, "sample_time_ms": 1226.284, "learn_time_ms": 653.906, "learn_throughput": 1565.973, "synch_weights_time_ms": 10.783}, "counters": {"num_env_steps_sampled": 121856, "num_env_steps_trained": 121856, "num_agent_steps_sampled": 487424, "num_agent_steps_trained": 487424}, "done": false, "training_iteration": 119, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-37", "timestamp": 1729611937, "time_this_iter_s": 2.0454258918762207, "time_total_s": 218.24713683128357, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3eb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239960>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239420>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23b430>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23ad10>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 218.24713683128357, "iterations_since_restore": 119, "perf": {"cpu_util_percent": 3.3000000000000003, "ram_util_percent": 2.7999999999999994}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.622308805584908, "cur_kl_coeff": 1.2504112125604796e-18, "cur_lr": 5e-05, "total_loss": 9.295950055122375, "policy_loss": -0.005120046902447939, "vf_loss": 9.301070046424865, "vf_explained_var": -7.65293836593628e-05, "kl": 0.009329937690199585, "entropy": 0.8198280930519104, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 15.121039283275604, "cur_kl_coeff": 3.7049221112903095e-19, "cur_lr": 5e-05, "total_loss": 9.808352732658387, "policy_loss": -0.0005374402739107609, "vf_loss": 9.80889015197754, "vf_explained_var": 1.2442469596862793e-06, "kl": 0.009573934656525267, "entropy": 3.02661247253418, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.589074170589447, "cur_kl_coeff": 1.0587911840678755e-23, "cur_lr": 5e-05, "total_loss": 9.756911468505859, "policy_loss": -0.000773037620820105, "vf_loss": 9.757684254646302, "vf_explained_var": -5.955994129180908e-06, "kl": 0.006304831481793371, "entropy": -0.26636667624115945, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.220263206958771, "cur_kl_coeff": 0.015820312500000003, "cur_lr": 5e-05, "total_loss": 9.168052148818969, "policy_loss": -0.010771233611740172, "vf_loss": 9.178535962104798, "vf_explained_var": 0.0001787826418876648, "kl": 0.018164901369527798, "entropy": -0.26689561679959295, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4780.5, "diff_num_grad_updates_vs_sampler_policy": 19.5}}, "num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520}, "env_runners": {"episode_reward_max": 6789.084452014565, "episode_reward_min": -324.88259311663063, "episode_reward_mean": 3341.704559533539, "episode_len_mean": 3143.3142857142857, "episode_media": {}, "episodes_timesteps_total": 110016, "policy_reward_min": {"high_level_policy": -646.2827735121747, "DC1_ls_policy": -5892.095729470454, "DC2_ls_policy": 1876.8124768236476, "DC3_ls_policy": -2674.304385927371}, "policy_reward_max": {"high_level_policy": 2631.034896865054, "DC1_ls_policy": 409.2290856690479, "DC2_ls_policy": 6722.608203232185, "DC3_ls_policy": 2649.860925864871}, "policy_reward_mean": {"high_level_policy": 713.4411131299959, "DC1_ls_policy": -1474.4031285215897, "DC2_ls_policy": 3822.8122138113117, "DC3_ls_policy": 279.8543611138186}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 110667.62689928454, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 87138.99331408626, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 138578.45730440682, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.04623364019298978, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.28041666666666665, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.4677908203660235, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.08416666666666667, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 3.175, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 57952.91115556468, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 48070.869003359265, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 76406.43277696759, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.022417638688472023, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 0.4185956790123457, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 104539.04786039142, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 74612.59607185329, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128307.57803445513, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.006842539442641068, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.09027777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 0.41594656506546746, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 1.5775, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 106492924.63269767, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 69190599.37343186, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 176091706.28111643, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.44969904063209, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 132.57979433760684, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 728.5400593919688, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 37.73010706018518, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1706.2813770325204}, "hist_stats": {"episode_reward": [4566.322711289452, 4248.648906342018, 3918.497903067926, 5196.43797976538, 6163.6982887286, 6259.601343003307, 4966.900101874485, 3582.158785853927, 2745.2236308223414, 4893.699059457192, 2216.8307877026764, 2434.6442847627195, 3160.9850700388847, 2398.176593089878, 1974.4039312078407, 2892.1578369465583, 2519.1803547534632, 3427.4512393558775, 4424.012587103135, 2803.919603978136, 3574.734472040559, 6789.084452014565, 3383.28621936105, 5203.746469665883, 1093.3248214548935, 3127.478413333354, 3392.448430601259, 1413.211095777185, 2748.526378857041, 2356.767598169326, 1732.878667375947, -324.88259311663063, 3080.3626572576213, 708.7191246161048, 3887.022377121921], "episode_lengths": [2400, 2400, 2592, 3168, 3456, 3744, 3936, 2400, 2400, 4992, 2592, 3168, 3456, 2400, 2400, 3744, 2592, 3936, 3168, 2400, 2400, 4992, 2592, 3456, 3744, 3936, 2400, 2400, 3168, 2592, 3456, 2400, 2400, 3744, 4992], "policy_high_level_policy_reward": [2400.00109806875, 1999.4675817606794, 1931.8475538981586, 2011.988140377938, 2631.034896865054, 2541.1517702253186, 1838.012748472349, 1063.0167413049226, 429.0715045680256, 1132.7107751124902, 201.00841885666023, 475.917033820446, 1061.597576091512, 480.2706156737421, 280.7543995034759, 362.7564675870567, -210.6545186134727, -19.079261662019995, 366.57754177298716, 38.360456409379644, 284.70380652178255, 807.1217516954812, 507.80714578236035, 935.4836861007258, -646.2827735121747, -595.3591312263102, 717.2373901057915, 57.128390559755246, -32.672393017431055, -168.2501602252559, 14.646631508413964, -319.8273801402909, 1417.3855293218044, -41.51751480366369, 1017.0224407854112], "policy_DC1_ls_policy_reward": [-1896.307437668828, -1680.2320649328985, -677.0015736392511, -1210.652864405427, -1855.372054967646, -2158.771406101319, -1690.581449199372, -748.8635000034227, -923.1173647162047, -2998.667006790663, -1273.334812762973, -377.3775790175337, -974.4226640231291, 409.2290856690479, 69.2319689843427, 33.271788958291346, 168.1023680552421, -339.00694266830385, 397.5986523563922, 272.3812687660611, 286.3527204548332, 162.04677893583127, -118.67356387238806, -135.81925914919677, -3329.9922391136047, -1324.1998325490822, -1173.6166665058777, -2485.7987406644575, -2382.80610961039, -1804.967337790029, -4115.653030958101, -3921.4750959833164, -2591.7315942890978, -5321.786209582706, -5892.095729470454], "policy_DC2_ls_policy_reward": [2054.3276835436923, 2137.8422369826835, 1876.8124768236476, 2900.9092161624526, 3062.392932911551, 3227.360053014381, 3835.32636816224, 2896.229971002547, 2773.491375687941, 5196.722007186375, 3117.5983728636065, 4342.1844496305575, 4694.541716812765, 3265.636620745951, 3318.046870093859, 5170.433966328585, 3417.221468534524, 5412.654313598132, 4118.780104007578, 3029.743874096598, 3093.959626805885, 6677.619226078465, 3408.634821309182, 4373.732929347586, 4869.934811178183, 5057.934590068145, 3170.221250529653, 3150.6385590544455, 4129.102416624426, 3395.4733694601673, 4528.608989677318, 3167.3722960761197, 3183.911130799696, 5020.419184964771, 6722.608203232185], "policy_DC3_ls_policy_reward": [2008.3013673458254, 1791.5711525315492, 786.8394459853729, 1494.1934876303987, 2325.6425139195962, 2649.860925864871, 984.1424344392689, 371.7755735498899, 465.77811528257575, 1562.933283949002, 171.55880874537374, -2006.0796196707436, -1620.7315588422782, -1756.9597289988637, -1693.629307373837, -2674.304385927371, -855.4889632228442, -1627.1168699119223, -458.9437110338263, -536.5659952939068, -90.28168174196074, -857.7033046952143, -414.48218385810577, 30.349113366787147, 199.6650229024756, -10.897212959397535, 678.6064564717112, 691.242886827433, 1034.9024648604347, 934.511726724444, 1305.276077148332, 749.0475869308527, 1070.797591425215, 1051.6036640377063, 2039.4874625748075]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6089796201598466, "mean_inference_ms": 2.231615131601277, "mean_action_processing_ms": 0.324064545093779, "mean_env_wait_ms": 4.334389987180142, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00361459595816476, "StateBufferConnector_ms": 0.0025556768689836773, "ViewRequirementAgentConnector_ms": 0.05414928708757673}, "num_episodes": 0, "episode_return_max": 6789.084452014565, "episode_return_min": -324.88259311663063, "episode_return_mean": 3341.704559533539, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520, "num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_env_steps_sampled_this_iter": 1024, "num_env_steps_trained_this_iter": 1024, "num_env_steps_sampled_throughput_per_sec": 531.4070511262017, "num_env_steps_trained_throughput_per_sec": 531.4070511262017, "timesteps_total": 122880, "num_env_steps_sampled_lifetime": 122880, "num_agent_steps_sampled_lifetime": 491520, "num_steps_trained_this_iter": 1024, "agent_timesteps_total": 491520, "timers": {"training_iteration_time_ms": 1894.096, "restore_workers_time_ms": 0.045, "training_step_time_ms": 1893.976, "sample_time_ms": 1221.023, "learn_time_ms": 653.649, "learn_throughput": 1566.591, "synch_weights_time_ms": 10.734}, "counters": {"num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520}, "done": false, "training_iteration": 120, "trial_id": "22c84_00000", "date": "2024-10-22_15-45-39", "timestamp": 1729611939, "time_this_iter_s": 1.9352152347564697, "time_total_s": 220.18235206604004, "pid": 1967484, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 1024, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7fe1152a3880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239540>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db239000>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23a020>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7fe0db23aad0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 220.18235206604004, "iterations_since_restore": 120, "perf": {"cpu_util_percent": 3.2999999999999994, "ram_util_percent": 2.7999999999999994}}

{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2567883588373663, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.425041329860687, "policy_loss": -0.0009375271270982921, "vf_loss": 8.425683337450028, "vf_explained_var": 3.4343451261520386e-05, "kl": 0.0014769777633773628, "entropy": 4.274820399284363, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.799900745227933, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.892108821868897, "policy_loss": -0.003433310613036156, "vf_loss": 9.894993329048157, "vf_explained_var": 2.8430670499801636e-05, "kl": 0.002744180116633288, "entropy": 1.389835287630558, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.7712423957884311, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.821203303337096, "policy_loss": -0.004619213560363278, "vf_loss": 9.825173044204712, "vf_explained_var": -6.808117032051087e-05, "kl": 0.003248154806033199, "entropy": 1.3800097420811652, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.7283957548439502, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.793296313285827, "policy_loss": -0.0007581142708659172, "vf_loss": 9.79397896528244, "vf_explained_var": -0.0002131551504135132, "kl": 0.0003778286698661759, "entropy": 1.407175524532795, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192, "num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 516.5369196221543, "num_env_steps_trained_throughput_per_sec": 516.5369196221543, "timesteps_total": 2048, "num_env_steps_sampled_lifetime": 2048, "num_agent_steps_sampled_lifetime": 8192, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 8192, "timers": {"training_iteration_time_ms": 3964.879, "restore_workers_time_ms": 0.035, "training_step_time_ms": 3964.788, "sample_time_ms": 2485.614, "learn_time_ms": 1401.577, "learn_throughput": 1461.211, "synch_weights_time_ms": 24.91}, "counters": {"num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192}, "done": false, "training_iteration": 1, "trial_id": "04bcd_00000", "date": "2024-10-21_22-08-49", "timestamp": 1729548529, "time_this_iter_s": 3.973968982696533, "time_total_s": 3.973968982696533, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bfbe0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3507c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3508e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d33cf2800>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d33cf28c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 3.973968982696533, "iterations_since_restore": 1, "perf": {"cpu_util_percent": 22.549999999999997, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2262845814228056, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.263284635543823, "policy_loss": -0.004163164657074958, "vf_loss": 9.266836380958557, "vf_explained_var": 0.0007120773196220398, "kl": 0.00611482808703273, "entropy": 4.127675014734268, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0193951098248362, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.87996643781662, "policy_loss": -0.0016198722762055695, "vf_loss": 9.881504189968108, "vf_explained_var": -0.0014416120946407318, "kl": 0.000820942642275236, "entropy": 1.3928427904844285, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8538596767932176, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.611812269687652, "policy_loss": -0.0010948148905299605, "vf_loss": 9.612741243839263, "vf_explained_var": -0.0008891962468624115, "kl": 0.0016571696070656118, "entropy": 1.3531576558947562, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.802252096682787, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.870175004005432, "policy_loss": -0.000586208829190582, "vf_loss": 9.87072331905365, "vf_explained_var": -0.000717240571975708, "kl": 0.0003799354531921151, "entropy": 1.3914094015955925, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384, "num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 527.9709064303044, "num_env_steps_trained_throughput_per_sec": 527.9709064303044, "timesteps_total": 4096, "num_env_steps_sampled_lifetime": 4096, "num_agent_steps_sampled_lifetime": 16384, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 16384, "timers": {"training_iteration_time_ms": 3921.946, "restore_workers_time_ms": 0.032, "training_step_time_ms": 3921.858, "sample_time_ms": 2455.644, "learn_time_ms": 1386.042, "learn_throughput": 1477.589, "synch_weights_time_ms": 30.054}, "counters": {"num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384}, "done": false, "training_iteration": 2, "trial_id": "04bcd_00000", "date": "2024-10-21_22-08-53", "timestamp": 1729548533, "time_this_iter_s": 3.8864667415618896, "time_total_s": 7.860435724258423, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bfa30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d410a30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d410b50>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d433280>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d432410>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 7.860435724258423, "iterations_since_restore": 2, "perf": {"cpu_util_percent": 19.483333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.908601964265108, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.743129020929336, "policy_loss": -0.008621578116435557, "vf_loss": 7.750792968273163, "vf_explained_var": -0.0014402464032173157, "kl": 0.009575793050589778, "entropy": 4.055038750171661, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2539660762995481, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.70046795606613, "policy_loss": -0.004530999914277345, "vf_loss": 9.704753172397613, "vf_explained_var": -0.00784103274345398, "kl": 0.004916699294797431, "entropy": 1.3439541846513747, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.180769768729806, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.795213890075683, "policy_loss": -0.003573277161922306, "vf_loss": 9.798489761352538, "vf_explained_var": -0.002585487812757492, "kl": 0.005945437771711681, "entropy": 1.3184376806020737, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0381085336208344, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.672369086742401, "policy_loss": -0.0013305238913744687, "vf_loss": 9.673671126365662, "vf_explained_var": -0.003954216837882996, "kl": 0.0005690626659230786, "entropy": 1.3972789824008942, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576, "num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 566.8650154117187, "num_env_steps_trained_throughput_per_sec": 566.8650154117187, "timesteps_total": 6144, "num_env_steps_sampled_lifetime": 6144, "num_agent_steps_sampled_lifetime": 24576, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 24576, "timers": {"training_iteration_time_ms": 3818.924, "restore_workers_time_ms": 0.032, "training_step_time_ms": 3818.837, "sample_time_ms": 2379.521, "learn_time_ms": 1375.84, "learn_throughput": 1488.545, "synch_weights_time_ms": 24.949}, "counters": {"num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576}, "done": false, "training_iteration": 3, "trial_id": "04bcd_00000", "date": "2024-10-21_22-08-57", "timestamp": 1729548537, "time_this_iter_s": 3.619107723236084, "time_total_s": 11.479543447494507, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351030>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351120>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3511e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3512a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 11.479543447494507, "iterations_since_restore": 3, "perf": {"cpu_util_percent": 21.26, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8147974640130995, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.96279284954071, "policy_loss": -0.0016758195939473807, "vf_loss": 7.9641285061836244, "vf_explained_var": 0.00038312748074531555, "kl": 0.0034024219503351106, "entropy": 4.028638142347336, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3119713328778744, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.718640625476837, "policy_loss": -0.0024688921868801115, "vf_loss": 9.72101777791977, "vf_explained_var": -0.0022370070219039917, "kl": 0.003675461206879049, "entropy": 1.2798467963933944, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.158170336857438, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.890945625305175, "policy_loss": -0.0010983020067214966, "vf_loss": 9.892012453079223, "vf_explained_var": -0.0023510091006755827, "kl": 0.0006275243786035764, "entropy": 1.3185491532087326, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9494454160332679, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.870115220546722, "policy_loss": -9.612913709133863e-05, "vf_loss": 9.870209288597106, "vf_explained_var": -0.004671929776668549, "kl": 7.590623858658441e-05, "entropy": 1.408387841284275, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768, "num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 527.43632874012, "num_env_steps_trained_throughput_per_sec": 527.43632874012, "timesteps_total": 8192, "num_env_steps_sampled_lifetime": 8192, "num_agent_steps_sampled_lifetime": 32768, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 32768, "timers": {"training_iteration_time_ms": 3834.929, "restore_workers_time_ms": 0.029, "training_step_time_ms": 3834.845, "sample_time_ms": 2399.367, "learn_time_ms": 1373.737, "learn_throughput": 1490.824, "synch_weights_time_ms": 23.822}, "counters": {"num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768}, "done": false, "training_iteration": 4, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-01", "timestamp": 1729548541, "time_this_iter_s": 3.8899781703948975, "time_total_s": 15.369521617889404, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bfbe0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351480>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351570>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351630>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3516f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 15.369521617889404, "iterations_since_restore": 4, "perf": {"cpu_util_percent": 21.64, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.152223438024521, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.114372605085373, "policy_loss": -0.006665633199736476, "vf_loss": 8.120557910203933, "vf_explained_var": 0.0017436079680919648, "kl": 0.009606058428353492, "entropy": 3.9564216822385787, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.863910297304392, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.682545244693756, "policy_loss": -0.0016868531936779618, "vf_loss": 9.684205639362336, "vf_explained_var": -0.0078798308968544, "kl": 0.002123658752884694, "entropy": 1.238209430873394, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.334397341310978, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.815585494041443, "policy_loss": -0.00210589743219316, "vf_loss": 9.81764771938324, "vf_explained_var": -0.0011123865842819214, "kl": 0.0017474088504002678, "entropy": 1.2931451082229615, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2211666252464055, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.805969071388244, "policy_loss": -0.0007498962339013814, "vf_loss": 9.806711876392365, "vf_explained_var": -0.0049945726990699765, "kl": 0.0005648456360091813, "entropy": 1.4294276803731918, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960, "num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 600.5798605651297, "num_env_steps_trained_throughput_per_sec": 600.5798605651297, "timesteps_total": 10240, "num_env_steps_sampled_lifetime": 10240, "num_agent_steps_sampled_lifetime": 40960, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 40960, "timers": {"training_iteration_time_ms": 3749.955, "restore_workers_time_ms": 0.028, "training_step_time_ms": 3749.872, "sample_time_ms": 2341.915, "learn_time_ms": 1351.05, "learn_throughput": 1515.859, "synch_weights_time_ms": 21.315}, "counters": {"num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960}, "done": false, "training_iteration": 5, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-04", "timestamp": 1729548544, "time_this_iter_s": 3.4161758422851562, "time_total_s": 18.78569746017456, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bfa30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3518d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3519c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351a80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351b40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 18.78569746017456, "iterations_since_restore": 5, "perf": {"cpu_util_percent": 15.339999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.602927730977535, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.212260985374451, "policy_loss": -0.013157645164756104, "vf_loss": 7.224527537822723, "vf_explained_var": -0.0017565011978149414, "kl": 0.017820085562198152, "entropy": 3.8166885673999786, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.783475711941719, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.68225165605545, "policy_loss": -0.001265879743732512, "vf_loss": 9.683499896526337, "vf_explained_var": -0.0008074387907981873, "kl": 0.00281988625642959, "entropy": 1.1754875540733338, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4733301531523466, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.730784273147583, "policy_loss": -0.0026678597088903187, "vf_loss": 9.733390879631042, "vf_explained_var": -0.00023624747991561889, "kl": 0.004902852240059067, "entropy": 1.2961033493280412, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0849626492708921, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.849039363861085, "policy_loss": -0.00204046496655792, "vf_loss": 9.851072442531585, "vf_explained_var": -0.004340358078479767, "kl": 0.0011685382451442918, "entropy": 1.451383650302887, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152, "num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 520.0563525003913, "num_env_steps_trained_throughput_per_sec": 520.0563525003913, "timesteps_total": 12288, "num_env_steps_sampled_lifetime": 12288, "num_agent_steps_sampled_lifetime": 49152, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 49152, "timers": {"training_iteration_time_ms": 3781.306, "restore_workers_time_ms": 0.035, "training_step_time_ms": 3781.208, "sample_time_ms": 2380.228, "learn_time_ms": 1339.69, "learn_throughput": 1528.712, "synch_weights_time_ms": 19.801}, "counters": {"num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152}, "done": false, "training_iteration": 6, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-08", "timestamp": 1729548548, "time_this_iter_s": 3.9464640617370605, "time_total_s": 22.73216152191162, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d5288b0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350940>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3503a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350760>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3507f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 22.73216152191162, "iterations_since_restore": 6, "perf": {"cpu_util_percent": 5.233333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.0348517671227455, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.757166343927383, "policy_loss": -0.012349600018933416, "vf_loss": 7.768597739934921, "vf_explained_var": 0.001304016262292862, "kl": 0.018364840403683046, "entropy": 3.682456758618355, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.784206821769476, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.708555340766907, "policy_loss": -0.0020294854301027955, "vf_loss": 9.710571706295013, "vf_explained_var": -0.0007299304008483887, "kl": 0.0042510619932245, "entropy": 1.150007066130638, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3016601450741292, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.844587230682373, "policy_loss": -0.005410847638268023, "vf_loss": 9.849947273731232, "vf_explained_var": -0.0002841919660568237, "kl": 0.008131812206579525, "entropy": 1.2957146272063256, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8455851916223764, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.955073833465576, "policy_loss": -0.00012895646505057813, "vf_loss": 9.955202317237854, "vf_explained_var": 3.568902611732483e-05, "kl": 0.00020316063694140947, "entropy": 1.463876524567604, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344, "num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 566.1250339166838, "num_env_steps_trained_throughput_per_sec": 566.1250339166838, "timesteps_total": 14336, "num_env_steps_sampled_lifetime": 14336, "num_agent_steps_sampled_lifetime": 57344, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 57344, "timers": {"training_iteration_time_ms": 3757.92, "restore_workers_time_ms": 0.036, "training_step_time_ms": 3757.814, "sample_time_ms": 2368.148, "learn_time_ms": 1330.494, "learn_throughput": 1539.278, "synch_weights_time_ms": 18.879}, "counters": {"num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344}, "done": false, "training_iteration": 7, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-12", "timestamp": 1729548552, "time_this_iter_s": 3.6250338554382324, "time_total_s": 26.357195377349854, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7f40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d432440>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d432650>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d432590>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d432890>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 26.357195377349854, "iterations_since_restore": 7, "perf": {"cpu_util_percent": 15.62, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.1340681746602055, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.520227181911468, "policy_loss": -0.005870537098962814, "vf_loss": 7.525599992275238, "vf_explained_var": -0.0003055885434150696, "kl": 0.009956429773387936, "entropy": 3.6360980719327927, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7191696651279926, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.605451226234436, "policy_loss": -0.0033671628218144177, "vf_loss": 9.60880880355835, "vf_explained_var": -0.0017590537667274476, "kl": 0.006211884806498448, "entropy": 1.1286485627293588, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2527558974921704, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.848654067516327, "policy_loss": -0.0012753392627928406, "vf_loss": 9.849923384189605, "vf_explained_var": -0.00029703229665756226, "kl": 0.0009767641740922428, "entropy": 1.2458355993032455, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8565240737050772, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.935433542728424, "policy_loss": -0.0007369011349510401, "vf_loss": 9.936169803142548, "vf_explained_var": -0.0002778768539428711, "kl": 0.00046512511007446716, "entropy": 1.4717356637120247, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536, "num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 529.6042125989301, "num_env_steps_trained_throughput_per_sec": 529.6042125989301, "timesteps_total": 16384, "num_env_steps_sampled_lifetime": 16384, "num_agent_steps_sampled_lifetime": 65536, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 65536, "timers": {"training_iteration_time_ms": 3771.576, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3771.45, "sample_time_ms": 2395.046, "learn_time_ms": 1321.21, "learn_throughput": 1550.094, "synch_weights_time_ms": 17.85}, "counters": {"num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536}, "done": false, "training_iteration": 8, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-16", "timestamp": 1729548556, "time_this_iter_s": 3.873105764389038, "time_total_s": 30.23030114173889, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c6c20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351960>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3518a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351840>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351600>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 30.23030114173889, "iterations_since_restore": 8, "perf": {"cpu_util_percent": 20.419999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.573762831091881, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.339596349000931, "policy_loss": -0.003384831768926233, "vf_loss": 7.342644655704499, "vf_explained_var": -0.0004433572292327881, "kl": 0.00672819885418247, "entropy": 3.648240315914154, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5684790652245284, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.764792370796204, "policy_loss": -0.0019208863726817072, "vf_loss": 9.766708087921142, "vf_explained_var": -0.0005118563771247864, "kl": 0.003292194033883858, "entropy": 1.1332534790039062, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4618843641132115, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.793101143836974, "policy_loss": -0.00108924163505435, "vf_loss": 9.794187092781067, "vf_explained_var": 4.516392946243286e-05, "kl": 0.0010243435857092199, "entropy": 1.278550735116005, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9614671636372805, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.927448344230651, "policy_loss": -0.0006720400415360928, "vf_loss": 9.928120279312134, "vf_explained_var": 0.0016953781247138976, "kl": 0.0003473110816031667, "entropy": 1.5018675789237022, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728, "num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 548.3288604081972, "num_env_steps_trained_throughput_per_sec": 548.3288604081972, "timesteps_total": 18432, "num_env_steps_sampled_lifetime": 18432, "num_agent_steps_sampled_lifetime": 73728, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 73728, "timers": {"training_iteration_time_ms": 3767.513, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3767.387, "sample_time_ms": 2396.924, "learn_time_ms": 1315.362, "learn_throughput": 1556.986, "synch_weights_time_ms": 17.322}, "counters": {"num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728}, "done": false, "training_iteration": 9, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-20", "timestamp": 1729548560, "time_this_iter_s": 3.7413628101348877, "time_total_s": 33.97166395187378, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d5293f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350c70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350d60>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350e20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350ee0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 33.97166395187378, "iterations_since_restore": 9, "perf": {"cpu_util_percent": 20.183333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.448179901391268, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.591375476121902, "policy_loss": -0.0020737217855639756, "vf_loss": 7.593157577514648, "vf_explained_var": 0.0005575023591518402, "kl": 0.005831070549379748, "entropy": 3.626686728000641, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5299339469522237, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.763249671459198, "policy_loss": -0.0007944851531647146, "vf_loss": 9.764043581485748, "vf_explained_var": -0.0005053296685218811, "kl": 0.0007494448836014911, "entropy": 1.0895423412322998, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0057272583246233, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.496950578689574, "policy_loss": -0.004881704424042255, "vf_loss": 9.50182203054428, "vf_explained_var": -0.00041164606809616087, "kl": 0.006539752330491021, "entropy": 1.3052801042795181, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0489574655890466, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.890381503105164, "policy_loss": -0.0010717839933931828, "vf_loss": 9.891453099250793, "vf_explained_var": -0.0015930823981761932, "kl": 0.0006130032791702656, "entropy": 1.5105893075466157, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920}, "env_runners": {"episode_reward_max": 3982.911748994701, "episode_reward_min": 2789.1021975135986, "episode_reward_mean": 3388.8131826800945, "episode_len_mean": 2432.0, "episode_media": {}, "episodes_timesteps_total": 7296, "policy_reward_min": {"high_level_policy": 1394.7267230574528, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -21.29142306337962, "DC3_ls_policy": -1011.6859859448873}, "policy_reward_max": {"high_level_policy": 2121.5433061177937, "DC1_ls_policy": 2317.723730816918, "DC2_ls_policy": 625.6035792702161, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1648.1769437076136, "DC1_ls_policy": 2205.1936364318813, "DC2_ls_policy": 194.43625057041902, "DC3_ls_policy": -658.9936480298317}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 72123.47524338239, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 67829.65638359112, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 87938.33128416778, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 90526.25600801306, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.046891025641025645, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0275, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.07791666666666666, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.249097222222222, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 1.02875, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 1.3904166666666666, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 90982.65372692475, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.09508547008547008, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.18583333333333332, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.9629220085470085, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 2.3054166666666664, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 76428424.84011705, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 80479409.18500346, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 8.506940438034187, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 10.566875, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 320.6456543803419, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 380.21915064102564}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986], "episode_lengths": [2496, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6340972523538455, "mean_inference_ms": 2.3155228538965007, "mean_action_processing_ms": 0.34184768053139464, "mean_env_wait_ms": 4.523266018111927, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.004456440607706706, "StateBufferConnector_ms": 0.0026702880859375, "ViewRequirementAgentConnector_ms": 0.05819598833719889}, "num_episodes": 3, "episode_return_max": 3982.911748994701, "episode_return_min": 2789.1021975135986, "episode_return_mean": 3388.8131826800945, "episodes_this_iter": 3}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920, "num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 524.7514813651633, "num_env_steps_trained_throughput_per_sec": 524.7514813651633, "timesteps_total": 20480, "num_env_steps_sampled_lifetime": 20480, "num_agent_steps_sampled_lifetime": 81920, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 81920, "timers": {"training_iteration_time_ms": 3781.047, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3780.918, "sample_time_ms": 2416.474, "learn_time_ms": 1310.94, "learn_throughput": 1562.237, "synch_weights_time_ms": 16.768}, "counters": {"num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920}, "done": false, "training_iteration": 10, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-24", "timestamp": 1729548564, "time_this_iter_s": 3.910754919052124, "time_total_s": 37.8824188709259, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7f40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3529e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352ad0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352b90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352c50>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 37.8824188709259, "iterations_since_restore": 10, "perf": {"cpu_util_percent": 20.58, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.638632592558861, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.154192340373992, "policy_loss": -0.00767944521503523, "vf_loss": 8.161129599809646, "vf_explained_var": 0.0001893647015094757, "kl": 0.014842641511075052, "entropy": 3.4986438930034636, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4591764450073241, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.872571003437042, "policy_loss": -0.003960718947928399, "vf_loss": 9.876529371738433, "vf_explained_var": -0.00045918971300125123, "kl": 0.0060667561321224635, "entropy": 1.0647952988743783, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4267715059220791, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.761807703971863, "policy_loss": -0.0004333721473813057, "vf_loss": 9.762240052223206, "vf_explained_var": -0.0004526600241661072, "kl": 0.0006896879235000597, "entropy": 1.3344374299049377, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9893391173332929, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.892241036891937, "policy_loss": -0.0006489459599833935, "vf_loss": 9.892889881134034, "vf_explained_var": 0.002611890435218811, "kl": 0.00017783108183951762, "entropy": 1.5285023003816605, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": 1548.1343634593247, "episode_reward_mean": 3298.8101139314394, "episode_len_mean": 2496.0, "episode_media": {}, "episodes_timesteps_total": 12480, "policy_reward_min": {"high_level_policy": 1394.7267230574528, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -21.29142306337962, "DC3_ls_policy": -2482.2048400764543}, "policy_reward_max": {"high_level_policy": 2148.686241947451, "DC1_ls_policy": 2370.275804555554, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1737.0031352952315, "DC1_ls_policy": 2263.4687862020123, "DC2_ls_policy": 366.18641045604966, "DC3_ls_policy": -1067.848218021867}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 71438.32574228282, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 67829.65638359112, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 87184.69410024767, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 90526.25600801306, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.028134615384615386, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.07791666666666666, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.085337962962963, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.4193672839506173, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 1.3904166666666666, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 91572.77341913087, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17418091168091168, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.34202789648623, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 77508464.3493289, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 80721927.24538945, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 20.8308232134378, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 383.8624890788224, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 644.6447723765432}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247], "episode_lengths": [2496, 2400, 2400, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.61535994755206, "mean_inference_ms": 2.2729952063333583, "mean_action_processing_ms": 0.3335374774613251, "mean_env_wait_ms": 4.376517820141172, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0037920475006103516, "StateBufferConnector_ms": 0.002588033676147461, "ViewRequirementAgentConnector_ms": 0.05604267120361328}, "num_episodes": 2, "episode_return_max": 4779.476658157588, "episode_return_min": 1548.1343634593247, "episode_return_mean": 3298.8101139314394, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112, "num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 513.6030564338062, "num_env_steps_trained_throughput_per_sec": 513.6030564338062, "timesteps_total": 22528, "num_env_steps_sampled_lifetime": 22528, "num_agent_steps_sampled_lifetime": 90112, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 90112, "timers": {"training_iteration_time_ms": 3783.313, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3783.181, "sample_time_ms": 2436.77, "learn_time_ms": 1297.294, "learn_throughput": 1578.67, "synch_weights_time_ms": 15.675}, "counters": {"num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112}, "done": false, "training_iteration": 11, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-28", "timestamp": 1729548568, "time_this_iter_s": 3.9948577880859375, "time_total_s": 41.87727665901184, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d5291b0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351690>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351b40>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351fc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352110>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 41.87727665901184, "iterations_since_restore": 11, "perf": {"cpu_util_percent": 20.633333333333336, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6128904581069947, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.916555714607239, "policy_loss": -0.0018381237692665308, "vf_loss": 7.918060028553009, "vf_explained_var": 0.0006054304540157318, "kl": 0.00667429223402678, "entropy": 3.412795549631119, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7570763207972049, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.726939499378204, "policy_loss": -0.0018981676665134728, "vf_loss": 9.728836572170257, "vf_explained_var": -0.0002589777112007141, "kl": 0.002565553727311109, "entropy": 1.1068807125091553, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4711722634732722, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.434749376773834, "policy_loss": -0.0038668072782456877, "vf_loss": 9.43861243724823, "vf_explained_var": -0.0002125546336174011, "kl": 0.004757552034450922, "entropy": 1.389586414396763, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9393536761403084, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.931317496299744, "policy_loss": -0.001376126171089709, "vf_loss": 9.932693660259247, "vf_explained_var": 5.752146244049072e-05, "kl": 0.000795890506766063, "entropy": 1.5087390139698982, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": 225.6746585899132, "episode_reward_mean": 2786.620871374518, "episode_len_mean": 2576.0, "episode_media": {}, "episodes_timesteps_total": 15456, "policy_reward_min": {"high_level_policy": 1327.2694101584887, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1134.519418490151, "DC3_ls_policy": -2685.301808922399}, "policy_reward_max": {"high_level_policy": 2148.686241947451, "DC1_ls_policy": 2718.2264758439605, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1668.7141811057745, "DC1_ls_policy": 2339.2617344756704, "DC2_ls_policy": 116.06877229834951, "DC3_ls_policy": -1337.423816505289}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 71584.84192939328, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 67829.65638359112, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 5.600358422939069e-05, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0003360215053763441, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 88254.78772352658, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 93605.2558399211, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.026637717121588092, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.07791666666666666, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.3087941806053365, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.4193672839506173, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4260752688172045, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 92440.2725214527, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19566599270900345, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4832759352439013, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 80693271.00343154, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 96617304.27394481, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.715594165320027, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 453.05711455493264, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 799.0302419354839}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6206723505990172, "mean_inference_ms": 2.287861016478733, "mean_action_processing_ms": 0.3368357610849959, "mean_env_wait_ms": 4.442628258944626, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036249558130900064, "StateBufferConnector_ms": 0.0026057163874308267, "ViewRequirementAgentConnector_ms": 0.05579491456349691}, "num_episodes": 1, "episode_return_max": 4779.476658157588, "episode_return_min": 225.6746585899132, "episode_return_mean": 2786.620871374518, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304, "num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 548.4700246398363, "num_env_steps_trained_throughput_per_sec": 548.4700246398363, "timesteps_total": 24576, "num_env_steps_sampled_lifetime": 24576, "num_agent_steps_sampled_lifetime": 98304, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 98304, "timers": {"training_iteration_time_ms": 3768.819, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3768.68, "sample_time_ms": 2437.298, "learn_time_ms": 1286.758, "learn_throughput": 1591.597, "synch_weights_time_ms": 13.253}, "counters": {"num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304}, "done": false, "training_iteration": 12, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-31", "timestamp": 1729548571, "time_this_iter_s": 3.753333330154419, "time_total_s": 45.63060998916626, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52a170>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352ec0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352fb0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353070>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353130>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 45.63060998916626, "iterations_since_restore": 12, "perf": {"cpu_util_percent": 21.119999999999997, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.845943693816662, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.793254399299622, "policy_loss": -0.007577370322542265, "vf_loss": 7.7999354839324955, "vf_explained_var": -0.00027754828333854676, "kl": 0.017926090092987578, "entropy": 3.232932963967323, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1711079448461534, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.380407071113586, "policy_loss": -0.001607061270624399, "vf_loss": 9.382013845443726, "vf_explained_var": -0.0004175320267677307, "kl": 0.001960010626999158, "entropy": 1.1418058708310128, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4192713350057602, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.54933557510376, "policy_loss": -0.003121167578501627, "vf_loss": 9.552455389499665, "vf_explained_var": -0.0003777042031288147, "kl": 0.003684060348149387, "entropy": 1.3208000853657722, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9240202002227307, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.874942862987519, "policy_loss": -0.0016848756000399589, "vf_loss": 9.8766277551651, "vf_explained_var": -0.00036297217011451723, "kl": 0.0007486327053122646, "entropy": 1.4985706508159637, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": 225.6746585899132, "episode_reward_mean": 3054.0778553803043, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 21888, "policy_reward_min": {"high_level_policy": 1327.2694101584887, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1134.519418490151, "DC3_ls_policy": -2685.301808922399}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3367.023742231189, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1829.2091912645028, "DC1_ls_policy": 2577.580638893383, "DC2_ls_policy": 87.02702187203687, "DC3_ls_policy": -1439.7389966496253}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 70910.63730324831, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 66263.86813120906, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011859582542694497, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0006127450980392157, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 88250.0985656583, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 93605.2558399211, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.038169157939230286, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.357808360127205, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.4193672839506173, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4260752688172045, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 92351.69334948447, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17153781895242995, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4720988669112387, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85491252.43744785, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.686226026823505, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 593.8458215398997, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1161.240962009804}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6178326432944868, "mean_inference_ms": 2.2873644792385623, "mean_action_processing_ms": 0.3360422588977061, "mean_env_wait_ms": 4.4434718420148815, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035434961318969727, "StateBufferConnector_ms": 0.00260770320892334, "ViewRequirementAgentConnector_ms": 0.05642548203468323}, "num_episodes": 2, "episode_return_max": 4779.476658157588, "episode_return_min": 225.6746585899132, "episode_return_mean": 3054.0778553803043, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496, "num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 551.328254998769, "num_env_steps_trained_throughput_per_sec": 551.328254998769, "timesteps_total": 26624, "num_env_steps_sampled_lifetime": 26624, "num_agent_steps_sampled_lifetime": 106496, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 106496, "timers": {"training_iteration_time_ms": 3779.0, "restore_workers_time_ms": 0.05, "training_step_time_ms": 3778.858, "sample_time_ms": 2457.028, "learn_time_ms": 1277.241, "learn_throughput": 1603.456, "synch_weights_time_ms": 13.016}, "counters": {"num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496}, "done": false, "training_iteration": 13, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-35", "timestamp": 1729548575, "time_this_iter_s": 3.7213730812072754, "time_total_s": 49.351983070373535, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7f40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3538e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3539d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353a90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353b50>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 49.351983070373535, "iterations_since_restore": 13, "perf": {"cpu_util_percent": 12.08, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.0767332971096035, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.897434717416763, "policy_loss": -0.006250669260043651, "vf_loss": 7.903032398223877, "vf_explained_var": 0.0010335773229598999, "kl": 0.013059174292902754, "entropy": 3.160057371854782, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5418594542890787, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.54082531929016, "policy_loss": -0.0010536741465330124, "vf_loss": 9.54187890291214, "vf_explained_var": -0.00031831562519073485, "kl": 0.001254133030556659, "entropy": 1.1409519180655479, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6510679587721824, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.661153185367585, "policy_loss": -0.002054763864725828, "vf_loss": 9.663207447528839, "vf_explained_var": -0.00023656636476516725, "kl": 0.0027669854548037164, "entropy": 1.3232135415077209, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8661320511251688, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.948393559455871, "policy_loss": -0.0020664743322413416, "vf_loss": 9.950459980964661, "vf_explained_var": -0.000882083922624588, "kl": 0.001911513429502109, "entropy": 1.4592956453561783, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": 225.6746585899132, "episode_reward_mean": 3054.0778553803043, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 21888, "policy_reward_min": {"high_level_policy": 1327.2694101584887, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1134.519418490151, "DC3_ls_policy": -2685.301808922399}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3367.023742231189, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1829.2091912645028, "DC1_ls_policy": 2577.580638893383, "DC2_ls_policy": 87.02702187203687, "DC3_ls_policy": -1439.7389966496253}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 70910.63730324831, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 66263.86813120906, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011859582542694497, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0006127450980392157, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 88250.0985656583, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 93605.2558399211, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.038169157939230286, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.357808360127205, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.4193672839506173, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4260752688172045, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 92351.69334948447, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17153781895242995, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4720988669112387, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85491252.43744785, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.686226026823505, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 593.8458215398997, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1161.240962009804}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6178326432944868, "mean_inference_ms": 2.2873644792385623, "mean_action_processing_ms": 0.3360422588977061, "mean_env_wait_ms": 4.4434718420148815, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035434961318969727, "StateBufferConnector_ms": 0.00260770320892334, "ViewRequirementAgentConnector_ms": 0.05642548203468323}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": 225.6746585899132, "episode_return_mean": 3054.0778553803043, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688, "num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 589.988457842222, "num_env_steps_trained_throughput_per_sec": 589.988457842222, "timesteps_total": 28672, "num_env_steps_sampled_lifetime": 28672, "num_agent_steps_sampled_lifetime": 114688, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 114688, "timers": {"training_iteration_time_ms": 3737.836, "restore_workers_time_ms": 0.053, "training_step_time_ms": 3737.685, "sample_time_ms": 2428.112, "learn_time_ms": 1266.693, "learn_throughput": 1616.809, "synch_weights_time_ms": 12.142}, "counters": {"num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688}, "done": false, "training_iteration": 14, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-39", "timestamp": 1729548579, "time_this_iter_s": 3.4778828620910645, "time_total_s": 52.8298659324646, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d529bd0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354580>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3543d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3546d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354790>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 52.8298659324646, "iterations_since_restore": 14, "perf": {"cpu_util_percent": 5.6, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9331306114792826, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.722729164361954, "policy_loss": -0.00486087427707389, "vf_loss": 8.727013301849365, "vf_explained_var": -0.0008276566863059997, "kl": 0.011534244022278246, "entropy": 3.078576001524925, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.939607322216034, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.384375488758087, "policy_loss": -0.0022068612510338427, "vf_loss": 9.38658229112625, "vf_explained_var": -0.00015683919191360473, "kl": 0.002601997015403931, "entropy": 1.2432684123516082, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6505886640399694, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.712388908863067, "policy_loss": -0.0012034224811941386, "vf_loss": 9.713592410087585, "vf_explained_var": -2.3503601551055908e-05, "kl": 0.0020394378116563735, "entropy": 1.3798327997326851, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8878097202628851, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.936001932621002, "policy_loss": -0.0012526992766652256, "vf_loss": 9.937254655361176, "vf_explained_var": -0.0004936680197715759, "kl": 0.001063583785776956, "entropy": 1.4312733486294746, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": 225.6746585899132, "episode_reward_mean": 3054.0778553803043, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 21888, "policy_reward_min": {"high_level_policy": 1327.2694101584887, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1134.519418490151, "DC3_ls_policy": -2685.301808922399}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3367.023742231189, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1829.2091912645028, "DC1_ls_policy": 2577.580638893383, "DC2_ls_policy": 87.02702187203687, "DC3_ls_policy": -1439.7389966496253}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 70910.63730324831, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 66263.86813120906, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011859582542694497, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0006127450980392157, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 88250.0985656583, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 93605.2558399211, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.038169157939230286, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.357808360127205, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.4193672839506173, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4260752688172045, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 92351.69334948447, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17153781895242995, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4720988669112387, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85491252.43744785, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.686226026823505, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 593.8458215398997, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1161.240962009804}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6178326432944868, "mean_inference_ms": 2.2873644792385623, "mean_action_processing_ms": 0.3360422588977061, "mean_env_wait_ms": 4.4434718420148815, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035434961318969727, "StateBufferConnector_ms": 0.00260770320892334, "ViewRequirementAgentConnector_ms": 0.05642548203468323}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": 225.6746585899132, "episode_return_mean": 3054.0778553803043, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880, "num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 543.3365146487233, "num_env_steps_trained_throughput_per_sec": 543.3365146487233, "timesteps_total": 30720, "num_env_steps_sampled_lifetime": 30720, "num_agent_steps_sampled_lifetime": 122880, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 122880, "timers": {"training_iteration_time_ms": 3773.763, "restore_workers_time_ms": 0.055, "training_step_time_ms": 3773.608, "sample_time_ms": 2462.549, "learn_time_ms": 1268.759, "learn_throughput": 1614.175, "synch_weights_time_ms": 12.236}, "counters": {"num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880}, "done": false, "training_iteration": 15, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-43", "timestamp": 1729548583, "time_this_iter_s": 3.774949073791504, "time_total_s": 56.6048150062561, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c6b90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352a70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352380>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352290>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351690>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 56.6048150062561, "iterations_since_restore": 15, "perf": {"cpu_util_percent": 15.5, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8532698184251784, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.819925850629806, "policy_loss": -0.0016801991150714457, "vf_loss": 7.821219217777252, "vf_explained_var": 8.445829153060913e-05, "kl": 0.007735681249096668, "entropy": 3.0125841379165648, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6727143339812756, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.62177803516388, "policy_loss": -0.0009716752916574478, "vf_loss": 9.622749638557433, "vf_explained_var": -0.0005328118801116944, "kl": 0.002383870162375956, "entropy": 1.170885169506073, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1920617416501047, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.060281825065612, "policy_loss": -0.0013900142395868898, "vf_loss": 9.061671781539918, "vf_explained_var": -0.00036869943141937256, "kl": 0.002091604769069022, "entropy": 1.3349838078022003, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.901553688198328, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.942252206802369, "policy_loss": -0.0009198981570079923, "vf_loss": 9.94317194223404, "vf_explained_var": 6.441548466682435e-05, "kl": 0.0004098307069000384, "entropy": 1.3834670409560204, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": 225.6746585899132, "episode_reward_mean": 3054.0778553803043, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 21888, "policy_reward_min": {"high_level_policy": 1327.2694101584887, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1134.519418490151, "DC3_ls_policy": -2685.301808922399}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3367.023742231189, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1829.2091912645028, "DC1_ls_policy": 2577.580638893383, "DC2_ls_policy": 87.02702187203687, "DC3_ls_policy": -1439.7389966496253}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 70910.63730324831, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 66263.86813120906, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011859582542694497, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0006127450980392157, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 88250.0985656583, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 93605.2558399211, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.038169157939230286, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.357808360127205, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.4193672839506173, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4260752688172045, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 92351.69334948447, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17153781895242995, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4720988669112387, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85491252.43744785, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.686226026823505, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 593.8458215398997, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1161.240962009804}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6178326432944868, "mean_inference_ms": 2.2873644792385623, "mean_action_processing_ms": 0.3360422588977061, "mean_env_wait_ms": 4.4434718420148815, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035434961318969727, "StateBufferConnector_ms": 0.00260770320892334, "ViewRequirementAgentConnector_ms": 0.05642548203468323}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": 225.6746585899132, "episode_return_mean": 3054.0778553803043, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072, "num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 552.5790774342227, "num_env_steps_trained_throughput_per_sec": 552.5790774342227, "timesteps_total": 32768, "num_env_steps_sampled_lifetime": 32768, "num_agent_steps_sampled_lifetime": 131072, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 131072, "timers": {"training_iteration_time_ms": 3750.589, "restore_workers_time_ms": 0.055, "training_step_time_ms": 3750.434, "sample_time_ms": 2446.215, "learn_time_ms": 1266.497, "learn_throughput": 1617.058, "synch_weights_time_ms": 12.225}, "counters": {"num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072}, "done": false, "training_iteration": 16, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-46", "timestamp": 1729548586, "time_this_iter_s": 3.714323043823242, "time_total_s": 60.319138050079346, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d529b40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351180>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350790>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353d90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3506d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 60.319138050079346, "iterations_since_restore": 16, "perf": {"cpu_util_percent": 20.2, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.02305596023798, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.828342080116272, "policy_loss": -0.001924231869634241, "vf_loss": 8.829729115962982, "vf_explained_var": 0.00026599764823913573, "kl": 0.010743564696622344, "entropy": 2.9140572130680082, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5503079503774644, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.588067197799683, "policy_loss": -0.003606203699018806, "vf_loss": 9.591673350334167, "vf_explained_var": -0.00010837316513061524, "kl": 0.0046860618509840125, "entropy": 1.2350342094898223, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6198647364974021, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.558821082115173, "policy_loss": -0.002397239033598453, "vf_loss": 9.561218273639678, "vf_explained_var": -8.851885795593261e-05, "kl": 0.003292100449402824, "entropy": 1.3790884226560594, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9357060600072146, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.943524074554443, "policy_loss": -0.0007838704739697277, "vf_loss": 9.944307887554169, "vf_explained_var": -0.0005229145288467407, "kl": 0.0009476224623142758, "entropy": 1.3875598698854446, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": 225.6746585899132, "episode_reward_mean": 3054.0778553803043, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 21888, "policy_reward_min": {"high_level_policy": 1327.2694101584887, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1134.519418490151, "DC3_ls_policy": -2685.301808922399}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3367.023742231189, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1829.2091912645028, "DC1_ls_policy": 2577.580638893383, "DC2_ls_policy": 87.02702187203687, "DC3_ls_policy": -1439.7389966496253}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 70910.63730324831, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 66263.86813120906, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011859582542694497, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0006127450980392157, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 88250.0985656583, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 93605.2558399211, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.038169157939230286, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.357808360127205, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.4193672839506173, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4260752688172045, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 92351.69334948447, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17153781895242995, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4720988669112387, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85491252.43744785, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.686226026823505, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 593.8458215398997, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1161.240962009804}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6178326432944868, "mean_inference_ms": 2.2873644792385623, "mean_action_processing_ms": 0.3360422588977061, "mean_env_wait_ms": 4.4434718420148815, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035434961318969727, "StateBufferConnector_ms": 0.00260770320892334, "ViewRequirementAgentConnector_ms": 0.05642548203468323}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": 225.6746585899132, "episode_return_mean": 3054.0778553803043, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264, "num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 533.2060865907207, "num_env_steps_trained_throughput_per_sec": 533.2060865907207, "timesteps_total": 34816, "num_env_steps_sampled_lifetime": 34816, "num_agent_steps_sampled_lifetime": 139264, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 139264, "timers": {"training_iteration_time_ms": 3772.922, "restore_workers_time_ms": 0.055, "training_step_time_ms": 3772.772, "sample_time_ms": 2472.202, "learn_time_ms": 1264.808, "learn_throughput": 1619.218, "synch_weights_time_ms": 11.949}, "counters": {"num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264}, "done": false, "training_iteration": 17, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-50", "timestamp": 1729548590, "time_this_iter_s": 3.8469128608703613, "time_total_s": 64.1660509109497, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c6cb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352170>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352350>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352410>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3524a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 64.1660509109497, "iterations_since_restore": 17, "perf": {"cpu_util_percent": 20.78, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8697012260556223, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.600562262535096, "policy_loss": -0.004789219796657562, "vf_loss": 8.604732847213745, "vf_explained_var": -0.001790030300617218, "kl": 0.012372158503785613, "entropy": 2.8189515441656114, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5360899180173875, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.416770672798156, "policy_loss": -0.004768101993249729, "vf_loss": 9.42153878211975, "vf_explained_var": -5.580335855484009e-05, "kl": 0.005549501319092145, "entropy": 1.3062755569815636, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3968117654323577, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.703089010715484, "policy_loss": -0.002036638872232288, "vf_loss": 9.705125629901886, "vf_explained_var": -8.725523948669434e-05, "kl": 0.002999766654977579, "entropy": 1.4091540277004242, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8367297202348709, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.944045329093933, "policy_loss": -0.0006565001793205738, "vf_loss": 9.94470180273056, "vf_explained_var": 0.0014774680137634277, "kl": 0.00023273018572924769, "entropy": 1.4024990156292916, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": 225.6746585899132, "episode_reward_mean": 3054.0778553803043, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 21888, "policy_reward_min": {"high_level_policy": 1327.2694101584887, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1134.519418490151, "DC3_ls_policy": -2685.301808922399}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3367.023742231189, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1829.2091912645028, "DC1_ls_policy": 2577.580638893383, "DC2_ls_policy": 87.02702187203687, "DC3_ls_policy": -1439.7389966496253}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 70910.63730324831, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 66263.86813120906, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011859582542694497, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0006127450980392157, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 88250.0985656583, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 93605.2558399211, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.038169157939230286, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.357808360127205, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.4193672839506173, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4260752688172045, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 92351.69334948447, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 96894.47437193553, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17153781895242995, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4720988669112387, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85491252.43744785, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 27.686226026823505, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 593.8458215398997, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1161.240962009804}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6178326432944868, "mean_inference_ms": 2.2873644792385623, "mean_action_processing_ms": 0.3360422588977061, "mean_env_wait_ms": 4.4434718420148815, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035434961318969727, "StateBufferConnector_ms": 0.00260770320892334, "ViewRequirementAgentConnector_ms": 0.05642548203468323}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": 225.6746585899132, "episode_return_mean": 3054.0778553803043, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456, "num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 531.4224699133094, "num_env_steps_trained_throughput_per_sec": 531.4224699133094, "timesteps_total": 36864, "num_env_steps_sampled_lifetime": 36864, "num_agent_steps_sampled_lifetime": 147456, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 147456, "timers": {"training_iteration_time_ms": 3771.588, "restore_workers_time_ms": 0.049, "training_step_time_ms": 3771.454, "sample_time_ms": 2469.649, "learn_time_ms": 1265.466, "learn_throughput": 1618.376, "synch_weights_time_ms": 12.14}, "counters": {"num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456}, "done": false, "training_iteration": 18, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-54", "timestamp": 1729548594, "time_this_iter_s": 3.85986590385437, "time_total_s": 68.02591681480408, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bcee0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3526e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352860>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3529e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352b60>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 68.02591681480408, "iterations_since_restore": 18, "perf": {"cpu_util_percent": 20.35, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.256660342216492, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.807223546504974, "policy_loss": -0.004188351356424392, "vf_loss": 7.8109079718589784, "vf_explained_var": 0.0006315156817436219, "kl": 0.010076455897888924, "entropy": 2.7990875035524367, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.334337618201971, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.262211167812348, "policy_loss": -0.0022418807027861478, "vf_loss": 9.264453041553498, "vf_explained_var": -0.00037705302238464353, "kl": 0.003205602450202732, "entropy": 1.0912475153803824, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7627580098807811, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.613960123062133, "policy_loss": -0.0026324805803596973, "vf_loss": 9.616592717170715, "vf_explained_var": -0.00017423927783966064, "kl": 0.002637016392918739, "entropy": 1.3848416402935981, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0852440904825926, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.926213133335114, "policy_loss": -0.0006559489062055946, "vf_loss": 9.926869106292724, "vf_explained_var": 5.929917097091675e-05, "kl": 0.00023725290043544872, "entropy": 1.408619962632656, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -1160.0676121233462, "episode_reward_mean": 2679.896595233131, "episode_len_mean": 2668.8, "episode_media": {}, "episodes_timesteps_total": 26688, "policy_reward_min": {"high_level_policy": 566.9234561433101, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1746.2848818095513, "DC3_ls_policy": -3012.852050053611}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3367.023742231189, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1665.4634575583193, "DC1_ls_policy": 2685.43171436386, "DC2_ls_policy": -12.468792770710706, "DC3_ls_policy": -1658.5297839183434}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 67798.87232209336, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 51081.54605273146, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 9.487666034155598e-05, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0006127450980392157, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 90508.58098870749, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 101790.86752419433, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.03053532635138423, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.347996688101764, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4654166666666666, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 95692.1545525221, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 111776.14839727139, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.15481358849527732, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.5608874268623243, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 84064859.73884612, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 29.011199571458803, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 736.783553065253, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1857.4336458333332}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6228018832366337, "mean_inference_ms": 2.295280062751056, "mean_action_processing_ms": 0.3382607190710942, "mean_env_wait_ms": 4.4975354437494675, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0037413835525512695, "StateBufferConnector_ms": 0.002592802047729492, "ViewRequirementAgentConnector_ms": 0.056444406509399414}, "num_episodes": 2, "episode_return_max": 4779.476658157588, "episode_return_min": -1160.0676121233462, "episode_return_mean": 2679.896595233131, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648, "num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 514.4949787243626, "num_env_steps_trained_throughput_per_sec": 514.4949787243626, "timesteps_total": 38912, "num_env_steps_sampled_lifetime": 38912, "num_agent_steps_sampled_lifetime": 155648, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 155648, "timers": {"training_iteration_time_ms": 3796.153, "restore_workers_time_ms": 0.05, "training_step_time_ms": 3796.016, "sample_time_ms": 2496.96, "learn_time_ms": 1265.151, "learn_throughput": 1618.779, "synch_weights_time_ms": 11.932}, "counters": {"num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648}, "done": false, "training_iteration": 19, "trial_id": "04bcd_00000", "date": "2024-10-21_22-09-58", "timestamp": 1729548598, "time_this_iter_s": 3.987471342086792, "time_total_s": 72.01338815689087, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52be20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351000>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352110>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355240>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354b80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 72.01338815689087, "iterations_since_restore": 19, "perf": {"cpu_util_percent": 21.82, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.643670904636383, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.729797905683517, "policy_loss": -0.004763659765012562, "vf_loss": 8.734092354774475, "vf_explained_var": 0.0004654280841350555, "kl": 0.009385830120913851, "entropy": 2.7599048644304274, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.098384153842926, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 8.896206986904144, "policy_loss": -0.0008940652129240334, "vf_loss": 8.897101044654846, "vf_explained_var": -0.00021488219499588013, "kl": 0.0028098951751701407, "entropy": 1.0748562425374986, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1233192164450885, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.809706687927246, "policy_loss": -0.004861062287818641, "vf_loss": 9.814567708969117, "vf_explained_var": -1.3805180788040162e-05, "kl": 0.005654109017774578, "entropy": 1.4530665844678878, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9197486370801926, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.940004193782807, "policy_loss": -0.0017257161845918745, "vf_loss": 9.941729950904847, "vf_explained_var": -0.00030413419008255003, "kl": 0.001088952213834027, "entropy": 1.3974430397152902, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -1160.0676121233462, "episode_reward_mean": 2548.5441517855456, "episode_len_mean": 2653.090909090909, "episode_media": {}, "episodes_timesteps_total": 29184, "policy_reward_min": {"high_level_policy": 566.9234561433101, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -1746.2848818095513, "DC3_ls_policy": -3012.852050053611}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3367.023742231189, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1625.3939552417432, "DC1_ls_policy": 2743.435325362314, "DC2_ls_policy": -142.2371007892931, "DC3_ls_policy": -1678.048028029224}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 66239.87866116826, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 50649.94205191734, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00015909533224523737, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 91613.59579472244, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 102663.74385487192, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.02899773258051247, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.4224576535190863, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.4654166666666666, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 96734.05707327387, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 111776.14839727139, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.14900739979757144, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.5398000500613205, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 83606515.05336134, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 30.760800601093084, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 68.15972222222223, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 789.1601921076891, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1857.4336458333332}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6222261215945811, "mean_inference_ms": 2.290889526375186, "mean_action_processing_ms": 0.33684930699414795, "mean_env_wait_ms": 4.485995786236967, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036776065826416016, "StateBufferConnector_ms": 0.0025830485604026103, "ViewRequirementAgentConnector_ms": 0.056249445134943184}, "num_episodes": 1, "episode_return_max": 4779.476658157588, "episode_return_min": -1160.0676121233462, "episode_return_mean": 2548.5441517855456, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840, "num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 504.91084446834805, "num_env_steps_trained_throughput_per_sec": 504.91084446834805, "timesteps_total": 40960, "num_env_steps_sampled_lifetime": 40960, "num_agent_steps_sampled_lifetime": 163840, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 163840, "timers": {"training_iteration_time_ms": 3811.486, "restore_workers_time_ms": 0.049, "training_step_time_ms": 3811.354, "sample_time_ms": 2513.664, "learn_time_ms": 1263.707, "learn_throughput": 1620.629, "synch_weights_time_ms": 11.822}, "counters": {"num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840}, "done": false, "training_iteration": 20, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-02", "timestamp": 1729548602, "time_this_iter_s": 4.064864635467529, "time_total_s": 76.0782527923584, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d599090>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355a50>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355090>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3542e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3544c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 76.0782527923584, "iterations_since_restore": 20, "perf": {"cpu_util_percent": 20.55, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9377063512802124, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.586874330043793, "policy_loss": -0.0030713867337908594, "vf_loss": 8.589560598134995, "vf_explained_var": -0.0007260471582412719, "kl": 0.007702288659585008, "entropy": 2.7633550345897673, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.110420769453049, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.42270245552063, "policy_loss": -0.0013911851216107606, "vf_loss": 9.424093520641327, "vf_explained_var": -0.0004806920886039734, "kl": 0.0022528743216753354, "entropy": 1.1192722931504249, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2772722162306307, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.426305735111237, "policy_loss": -0.0048402307671494785, "vf_loss": 9.431145918369293, "vf_explained_var": -0.00032342523336410524, "kl": 0.00678210167179719, "entropy": 1.3862596556544304, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9497751876711845, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.925795781612397, "policy_loss": -0.0013030453468672932, "vf_loss": 9.92709881067276, "vf_explained_var": 0.0016058556735515594, "kl": 0.0007919762851898548, "entropy": 1.3894519060850143, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -2261.1773885273155, "episode_reward_mean": 2000.9531574752307, "episode_len_mean": 2643.6923076923076, "episode_media": {}, "episodes_timesteps_total": 34368, "policy_reward_min": {"high_level_policy": 320.70503293735214, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -2418.046071572381, "DC3_ls_policy": -3694.2811784206697}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3530.4448285283756, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1430.089710883464, "DC1_ls_policy": 2857.1517184680033, "DC2_ls_policy": -366.2442087342251, "DC3_ls_policy": -1920.0440631420172}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 64178.054198072256, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 50233.38334191303, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016429624029487796, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 93733.3714155203, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 109142.2935934005, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.032133883883415586, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.527484348799151, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.8391203703703702, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100298.69019446315, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 126938.19591309456, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.14507653677078458, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.5987291971554, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 84168534.03013556, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.418571840526056, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 77.05883487654322, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 869.5916250407892, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1857.4336458333332}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6176128479061392, "mean_inference_ms": 2.2799100333750664, "mean_action_processing_ms": 0.3342362847731665, "mean_env_wait_ms": 4.454850034367936, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003541891391460712, "StateBufferConnector_ms": 0.002575379151564378, "ViewRequirementAgentConnector_ms": 0.05600177324735201}, "num_episodes": 2, "episode_return_max": 4779.476658157588, "episode_return_min": -2261.1773885273155, "episode_return_mean": 2000.9531574752307, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032, "num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 583.2876687362559, "num_env_steps_trained_throughput_per_sec": 583.2876687362559, "timesteps_total": 43008, "num_env_steps_sampled_lifetime": 43008, "num_agent_steps_sampled_lifetime": 172032, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 172032, "timers": {"training_iteration_time_ms": 3763.847, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3763.718, "sample_time_ms": 2465.189, "learn_time_ms": 1264.783, "learn_throughput": 1619.25, "synch_weights_time_ms": 11.586}, "counters": {"num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032}, "done": false, "training_iteration": 21, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-06", "timestamp": 1729548606, "time_this_iter_s": 3.5180463790893555, "time_total_s": 79.59629917144775, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52be20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355630>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355870>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355ab0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354250>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 79.59629917144775, "iterations_since_restore": 21, "perf": {"cpu_util_percent": 5.64, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.023225262761116, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.172486710548402, "policy_loss": -0.007344958116300404, "vf_loss": 8.17920497059822, "vf_explained_var": 0.0008871965110301971, "kl": 0.012533775618624076, "entropy": 2.6662374794483186, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1726956240832807, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.451306486129761, "policy_loss": -0.008061584760434925, "vf_loss": 9.459368073940277, "vf_explained_var": -0.00010060518980026245, "kl": 0.010076832005779579, "entropy": 1.185866342484951, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7215076617896556, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.2752720952034, "policy_loss": -0.0035585384699515997, "vf_loss": 9.278830623626709, "vf_explained_var": -0.0007867544889450073, "kl": 0.007290729932401518, "entropy": 1.297736218571663, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9267901711165905, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.937828326225281, "policy_loss": -0.0011222761473618447, "vf_loss": 9.938950514793396, "vf_explained_var": 0.00034419521689414977, "kl": 0.0010601784635594137, "entropy": 1.430606871843338, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -2261.1773885273155, "episode_reward_mean": 2000.9531574752307, "episode_len_mean": 2643.6923076923076, "episode_media": {}, "episodes_timesteps_total": 34368, "policy_reward_min": {"high_level_policy": 320.70503293735214, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -2418.046071572381, "DC3_ls_policy": -3694.2811784206697}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3530.4448285283756, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1430.089710883464, "DC1_ls_policy": 2857.1517184680033, "DC2_ls_policy": -366.2442087342251, "DC3_ls_policy": -1920.0440631420172}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 64178.054198072256, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 50233.38334191303, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016429624029487796, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 93733.3714155203, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 109142.2935934005, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.032133883883415586, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.527484348799151, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.8391203703703702, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100298.69019446315, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 126938.19591309456, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.14507653677078458, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.5987291971554, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 84168534.03013556, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.418571840526056, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 77.05883487654322, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 869.5916250407892, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1857.4336458333332}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6176128479061392, "mean_inference_ms": 2.2799100333750664, "mean_action_processing_ms": 0.3342362847731665, "mean_env_wait_ms": 4.454850034367936, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003541891391460712, "StateBufferConnector_ms": 0.002575379151564378, "ViewRequirementAgentConnector_ms": 0.05600177324735201}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -2261.1773885273155, "episode_return_mean": 2000.9531574752307, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224, "num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 559.586887013987, "num_env_steps_trained_throughput_per_sec": 559.586887013987, "timesteps_total": 45056, "num_env_steps_sampled_lifetime": 45056, "num_agent_steps_sampled_lifetime": 180224, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 180224, "timers": {"training_iteration_time_ms": 3756.428, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3756.3, "sample_time_ms": 2458.286, "learn_time_ms": 1265.364, "learn_throughput": 1618.507, "synch_weights_time_ms": 11.632}, "counters": {"num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224}, "done": false, "training_iteration": 22, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-10", "timestamp": 1729548610, "time_this_iter_s": 3.667180299758911, "time_total_s": 83.26347947120667, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52beb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357130>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357250>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357310>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3573d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 83.26347947120667, "iterations_since_restore": 22, "perf": {"cpu_util_percent": 7.783333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9660538390278814, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.533878111839295, "policy_loss": -0.0038921877508983015, "vf_loss": 9.537303006649017, "vf_explained_var": 0.0006354779005050659, "kl": 0.009345676086752519, "entropy": 2.6915705114603043, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5259968318045138, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.607242608070374, "policy_loss": -0.0035196564509533345, "vf_loss": 9.610762405395509, "vf_explained_var": -7.406547665596008e-05, "kl": 0.005541531965565235, "entropy": 1.3278428718447686, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.496400437131524, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.590024864673614, "policy_loss": -0.001288472965825349, "vf_loss": 9.59131338596344, "vf_explained_var": -2.575218677520752e-05, "kl": 0.001033238197976516, "entropy": 1.5305486053228379, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.968922733142972, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.93002347946167, "policy_loss": -0.0014221587916836143, "vf_loss": 9.931445550918578, "vf_explained_var": 0.0004894055426120758, "kl": 0.0019213090168364033, "entropy": 1.4120614513754846, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -2261.1773885273155, "episode_reward_mean": 2000.9531574752307, "episode_len_mean": 2643.6923076923076, "episode_media": {}, "episodes_timesteps_total": 34368, "policy_reward_min": {"high_level_policy": 320.70503293735214, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -2418.046071572381, "DC3_ls_policy": -3694.2811784206697}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 3530.4448285283756, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1430.089710883464, "DC1_ls_policy": 2857.1517184680033, "DC2_ls_policy": -366.2442087342251, "DC3_ls_policy": -1920.0440631420172}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 64178.054198072256, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 50233.38334191303, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016429624029487796, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 93733.3714155203, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 109142.2935934005, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.032133883883415586, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.527484348799151, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.8391203703703702, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 100298.69019446315, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 126938.19591309456, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.14507653677078458, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.5987291971554, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 84168534.03013556, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.418571840526056, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 77.05883487654322, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 869.5916250407892, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1857.4336458333332}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6176128479061392, "mean_inference_ms": 2.2799100333750664, "mean_action_processing_ms": 0.3342362847731665, "mean_env_wait_ms": 4.454850034367936, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003541891391460712, "StateBufferConnector_ms": 0.002575379151564378, "ViewRequirementAgentConnector_ms": 0.05600177324735201}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -2261.1773885273155, "episode_return_mean": 2000.9531574752307, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416, "num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 555.4291179757241, "num_env_steps_trained_throughput_per_sec": 555.4291179757241, "timesteps_total": 47104, "num_env_steps_sampled_lifetime": 47104, "num_agent_steps_sampled_lifetime": 188416, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 188416, "timers": {"training_iteration_time_ms": 3753.685, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3753.558, "sample_time_ms": 2454.685, "learn_time_ms": 1265.494, "learn_throughput": 1618.341, "synch_weights_time_ms": 11.463}, "counters": {"num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416}, "done": false, "training_iteration": 23, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-13", "timestamp": 1729548613, "time_this_iter_s": 3.694516897201538, "time_total_s": 86.9579963684082, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7eb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357670>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3556c0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354c10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351480>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 86.9579963684082, "iterations_since_restore": 23, "perf": {"cpu_util_percent": 21.46, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.007536831498146, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.193574923276902, "policy_loss": -0.0008067065675277263, "vf_loss": 8.194172775745391, "vf_explained_var": -0.001225951313972473, "kl": 0.00417560457926811, "entropy": 2.6480188459157943, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7279552236199378, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.540697240829468, "policy_loss": -0.0018181267427280546, "vf_loss": 9.542515301704407, "vf_explained_var": -0.00010648667812347412, "kl": 0.006173444159685652, "entropy": 0.9939510613679886, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6748009391129017, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.317321956157684, "policy_loss": -0.0011458561639301479, "vf_loss": 9.318467903137208, "vf_explained_var": -0.00021750032901763917, "kl": 0.0007597782732773339, "entropy": 1.3528647765517234, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9843999482691288, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.929337859153748, "policy_loss": -0.00099232635111548, "vf_loss": 9.930330109596252, "vf_explained_var": -0.00032777562737464907, "kl": 0.0013395062339384561, "entropy": 1.379708443582058, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -2261.1773885273155, "episode_reward_mean": 1848.4901559973391, "episode_len_mean": 2667.4285714285716, "episode_media": {}, "episodes_timesteps_total": 37344, "policy_reward_min": {"high_level_policy": 320.70503293735214, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -2418.046071572381, "DC3_ls_policy": -3694.2811784206697}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4100.191459993249, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1368.4328631978583, "DC1_ls_policy": 2945.9402714340927, "DC2_ls_policy": -427.7106761069303, "DC3_ls_policy": -2038.1723025276867}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 63112.17140376419, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 49255.695077759316, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00017656233065783982, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 94842.94920551391, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 109267.46047543084, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.029838606463171612, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.14552696078431374, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.532169606527015, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 2.8391203703703702, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 101488.24220316934, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 126938.19591309456, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.14664269044230305, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043333333333333335, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.637016013334008, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 85324200.60861649, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 102765729.47455113, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 33.34469703740093, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 77.05883487654322, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 934.8349123842657, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 1857.4336458333332}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6199983518691755, "mean_inference_ms": 2.2837413979844885, "mean_action_processing_ms": 0.33532258067266024, "mean_env_wait_ms": 4.479522997793763, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003523486001150949, "StateBufferConnector_ms": 0.0026038714817592074, "ViewRequirementAgentConnector_ms": 0.05676618644169399}, "num_episodes": 1, "episode_return_max": 4779.476658157588, "episode_return_min": -2261.1773885273155, "episode_return_mean": 1848.4901559973391, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608, "num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 531.1504219555388, "num_env_steps_trained_throughput_per_sec": 531.1504219555388, "timesteps_total": 49152, "num_env_steps_sampled_lifetime": 49152, "num_agent_steps_sampled_lifetime": 196608, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 196608, "timers": {"training_iteration_time_ms": 3792.134, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3792.016, "sample_time_ms": 2494.611, "learn_time_ms": 1264.925, "learn_throughput": 1619.068, "synch_weights_time_ms": 11.329}, "counters": {"num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608}, "done": false, "training_iteration": 24, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-17", "timestamp": 1729548617, "time_this_iter_s": 3.862454891204834, "time_total_s": 90.82045125961304, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d599630>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353670>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353970>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353a90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353f40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 90.82045125961304, "iterations_since_restore": 24, "perf": {"cpu_util_percent": 20.24, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.859592762589455, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.902535128593446, "policy_loss": -0.002104647579835728, "vf_loss": 8.904461562633514, "vf_explained_var": 0.0013829506933689117, "kl": 0.0071322764071747365, "entropy": 2.620648202300072, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.531172838807106, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.30747561454773, "policy_loss": -0.0027624612557701766, "vf_loss": 9.31023815870285, "vf_explained_var": -0.0001055985689163208, "kl": 0.0029802953550985964, "entropy": 1.1143005251884461, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4637963965535163, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.739440357685089, "policy_loss": -0.003278706897981465, "vf_loss": 9.742718982696534, "vf_explained_var": -2.911388874053955e-05, "kl": 0.003250669987164656, "entropy": 1.5194895207881927, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0770673897117375, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.932119190692902, "policy_loss": -0.00030854600481688976, "vf_loss": 9.932427716255187, "vf_explained_var": 0.00021574199199676515, "kl": 0.0008165741998595877, "entropy": 1.3917643442749976, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1459.4292474160125, "episode_len_mean": 2700.8, "episode_media": {}, "episodes_timesteps_total": 40512, "policy_reward_min": {"high_level_policy": -37.86254990918189, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4302.170279186727, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1274.6798356573888, "DC1_ls_policy": 3036.355605284268, "DC2_ls_policy": -681.7671656331884, "DC3_ls_policy": -2169.839027892462}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 62369.05126496272, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 49255.695077759316, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016479150861398384, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 96567.39248564716, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.041149029331956806, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.662432373499288, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 102250.5334159122, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 126938.19591309456, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.13974950771247946, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043244949494949496, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.6695903666538285, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 87006425.08688737, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 36.992761005951294, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 88.06565656565657, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1057.7146313987155, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6214019101329967, "mean_inference_ms": 2.287092820844764, "mean_action_processing_ms": 0.3358465889527288, "mean_env_wait_ms": 4.497544235800382, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003511508305867513, "StateBufferConnector_ms": 0.002619028091430664, "ViewRequirementAgentConnector_ms": 0.05728562672932943}, "num_episodes": 1, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1459.4292474160125, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800, "num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 549.4404262922615, "num_env_steps_trained_throughput_per_sec": 549.4404262922615, "timesteps_total": 51200, "num_env_steps_sampled_lifetime": 51200, "num_agent_steps_sampled_lifetime": 204800, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 204800, "timers": {"training_iteration_time_ms": 3787.946, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3787.833, "sample_time_ms": 2493.258, "learn_time_ms": 1262.374, "learn_throughput": 1622.34, "synch_weights_time_ms": 11.318}, "counters": {"num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800}, "done": false, "training_iteration": 25, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-21", "timestamp": 1729548621, "time_this_iter_s": 3.735363006591797, "time_total_s": 94.55581426620483, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d529e10>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355510>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354f10>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356a70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355c90>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 94.55581426620483, "iterations_since_restore": 25, "perf": {"cpu_util_percent": 20.01666666666667, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.553496201336384, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.687226969003678, "policy_loss": -0.0033526408835314212, "vf_loss": 8.690356624126434, "vf_explained_var": -0.00015050992369651793, "kl": 0.008917103710837182, "entropy": 2.556714081764221, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8615948379039764, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.264233458042145, "policy_loss": -0.003748202370479703, "vf_loss": 9.267981708049774, "vf_explained_var": -6.22972846031189e-05, "kl": 0.008444668627214578, "entropy": 1.086912167072296, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5767547328025102, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.36444969177246, "policy_loss": -0.0013042871607467533, "vf_loss": 9.365753960609435, "vf_explained_var": -1.3530254364013672e-05, "kl": 0.0006389171628712754, "entropy": 1.5951625660061837, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.019893939048052, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.92160598039627, "policy_loss": -0.0020028033177368343, "vf_loss": 9.923608660697937, "vf_explained_var": 8.780136704444885e-05, "kl": 0.0031037304936830878, "entropy": 1.379886969923973, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1379.4492164839512, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 43776, "policy_reward_min": {"high_level_policy": -37.86254990918189, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1242.6547749067017, "DC1_ls_policy": 3133.455523663523, "DC2_ls_policy": -758.9283163485333, "DC3_ls_policy": -2237.7327657377455}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 61396.245199510464, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46804.15421772666, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00015449203932560985, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 97330.90694456654, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.04606419416537617, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.6701648477046023, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 103218.32232916521, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 126938.19591309456, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.14474448333339068, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043244949494949496, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.671322463836004, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88432478.63008165, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 46.26647382144944, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1126.1751992049847, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6194003999511737, "mean_inference_ms": 2.286602982031792, "mean_action_processing_ms": 0.33490211813057413, "mean_env_wait_ms": 4.487722004114403, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003485381603240967, "StateBufferConnector_ms": 0.0026147812604904175, "ViewRequirementAgentConnector_ms": 0.057158246636390686}, "num_episodes": 1, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1379.4492164839512, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992, "num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 550.1027747100651, "num_env_steps_trained_throughput_per_sec": 550.1027747100651, "timesteps_total": 53248, "num_env_steps_sampled_lifetime": 53248, "num_agent_steps_sampled_lifetime": 212992, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 212992, "timers": {"training_iteration_time_ms": 3789.614, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3789.502, "sample_time_ms": 2496.494, "learn_time_ms": 1261.989, "learn_throughput": 1622.835, "synch_weights_time_ms": 11.125}, "counters": {"num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992}, "done": false, "training_iteration": 26, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-25", "timestamp": 1729548625, "time_this_iter_s": 3.730553388595581, "time_total_s": 98.28636765480042, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d529510>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354280>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356590>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352680>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352e30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 98.28636765480042, "iterations_since_restore": 26, "perf": {"cpu_util_percent": 20.199999999999996, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.5107900209724905, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.648053067922593, "policy_loss": -0.004001652775332332, "vf_loss": 8.651835119724273, "vf_explained_var": -0.00014646723866462708, "kl": 0.008789307325969989, "entropy": 2.5155707746744156, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8921900659799575, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.468227744102478, "policy_loss": -0.004068967862986028, "vf_loss": 9.472296726703643, "vf_explained_var": -0.00032224655151367185, "kl": 0.0037297890530858524, "entropy": 0.893258911371231, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8231055233627558, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.435163581371308, "policy_loss": -0.0043364600511267785, "vf_loss": 9.439500033855438, "vf_explained_var": -1.8654763698577882e-05, "kl": 0.007161087112692854, "entropy": 1.560152393579483, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.057044569030404, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.937463092803956, "policy_loss": -0.003935445309616625, "vf_loss": 9.941398513317107, "vf_explained_var": -0.0004478663206100464, "kl": 0.0055208496248639, "entropy": 1.2964960739016533, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1379.4492164839512, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 43776, "policy_reward_min": {"high_level_policy": -37.86254990918189, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1242.6547749067017, "DC1_ls_policy": 3133.455523663523, "DC2_ls_policy": -758.9283163485333, "DC3_ls_policy": -2237.7327657377455}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 61396.245199510464, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46804.15421772666, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00015449203932560985, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 97330.90694456654, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.04606419416537617, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.6701648477046023, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 103218.32232916521, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 126938.19591309456, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.14474448333339068, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043244949494949496, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.671322463836004, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88432478.63008165, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 46.26647382144944, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1126.1751992049847, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6194003999511737, "mean_inference_ms": 2.286602982031792, "mean_action_processing_ms": 0.33490211813057413, "mean_env_wait_ms": 4.487722004114403, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003485381603240967, "StateBufferConnector_ms": 0.0026147812604904175, "ViewRequirementAgentConnector_ms": 0.057158246636390686}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1379.4492164839512, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184, "num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 552.372273195761, "num_env_steps_trained_throughput_per_sec": 552.372273195761, "timesteps_total": 55296, "num_env_steps_sampled_lifetime": 55296, "num_agent_steps_sampled_lifetime": 221184, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 221184, "timers": {"training_iteration_time_ms": 3776.286, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3776.179, "sample_time_ms": 2481.555, "learn_time_ms": 1262.582, "learn_throughput": 1622.073, "synch_weights_time_ms": 11.33}, "counters": {"num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184}, "done": false, "training_iteration": 27, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-29", "timestamp": 1729548629, "time_this_iter_s": 3.7141404151916504, "time_total_s": 102.00050806999207, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52ac20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356980>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356aa0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356bc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356cb0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 102.00050806999207, "iterations_since_restore": 27, "perf": {"cpu_util_percent": 20.63333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.858768102526665, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.003723418712616, "policy_loss": -0.00016160932136699557, "vf_loss": 9.00377173423767, "vf_explained_var": 0.0011661723256111145, "kl": 0.0045273826792035935, "entropy": 2.487116277217865, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8715591870248318, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.662523090839386, "policy_loss": -0.0013596433040220291, "vf_loss": 9.663882672786713, "vf_explained_var": -0.00016108006238937377, "kl": 0.0017915489480858644, "entropy": 0.9094289399683475, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.479914603382349, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.52384830713272, "policy_loss": -0.001023225043900311, "vf_loss": 9.524871575832368, "vf_explained_var": -1.548975706100464e-05, "kl": 0.0017969886126424437, "entropy": 1.6548652067780494, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0906422253698111, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.919115781784058, "policy_loss": -0.003653685108292848, "vf_loss": 9.922769439220428, "vf_explained_var": 0.0011687912046909332, "kl": 0.0037742046091644, "entropy": 1.3419558480381966, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1379.4492164839512, "episode_len_mean": 2736.0, "episode_media": {}, "episodes_timesteps_total": 43776, "policy_reward_min": {"high_level_policy": -37.86254990918189, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1242.6547749067017, "DC1_ls_policy": 3133.455523663523, "DC2_ls_policy": -758.9283163485333, "DC3_ls_policy": -2237.7327657377455}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 61396.245199510464, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46804.15421772666, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00015449203932560985, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0008012820512820513, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 97330.90694456654, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.04606419416537617, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.6701648477046023, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 103218.32232916521, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 126938.19591309456, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.14474448333339068, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.043244949494949496, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.671322463836004, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.562099358974359, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88432478.63008165, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 46.26647382144944, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 4.880729166666667, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1126.1751992049847, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6194003999511737, "mean_inference_ms": 2.286602982031792, "mean_action_processing_ms": 0.33490211813057413, "mean_env_wait_ms": 4.487722004114403, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003485381603240967, "StateBufferConnector_ms": 0.0026147812604904175, "ViewRequirementAgentConnector_ms": 0.057158246636390686}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1379.4492164839512, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376, "num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 525.4108476207638, "num_env_steps_trained_throughput_per_sec": 525.4108476207638, "timesteps_total": 57344, "num_env_steps_sampled_lifetime": 57344, "num_agent_steps_sampled_lifetime": 229376, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 229376, "timers": {"training_iteration_time_ms": 3780.695, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3780.589, "sample_time_ms": 2484.915, "learn_time_ms": 1264.07, "learn_throughput": 1620.164, "synch_weights_time_ms": 11.208}, "counters": {"num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376}, "done": false, "training_iteration": 28, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-33", "timestamp": 1729548633, "time_this_iter_s": 3.90598726272583, "time_total_s": 105.9064953327179, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7250>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354850>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3567a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355b70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d33cf2b90>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 105.9064953327179, "iterations_since_restore": 28, "perf": {"cpu_util_percent": 17.68, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.015935729444027, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.048534190654754, "policy_loss": -0.002770580421201885, "vf_loss": 9.051189148426056, "vf_explained_var": -0.0004225805401802063, "kl": 0.00925247617169589, "entropy": 2.397691410779953, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.228303776681423, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.215270817279816, "policy_loss": -0.006536645675078034, "vf_loss": 9.221807396411895, "vf_explained_var": -0.0007697433233261108, "kl": 0.015810515718107158, "entropy": 0.8265927642583847, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3256141915917397, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.821624290943145, "policy_loss": -0.00015790106845088304, "vf_loss": 9.821782171726227, "vf_explained_var": -5.612522363662719e-06, "kl": 0.0013823819051369639, "entropy": 1.7163533195853233, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.208757920190692, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.88241069316864, "policy_loss": -0.0017686684383079409, "vf_loss": 9.884179270267486, "vf_explained_var": -0.00010048598051071167, "kl": 0.002190791681687204, "entropy": 1.334344083070755, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1344.5488201816038, "episode_len_mean": 2698.6666666666665, "episode_media": {}, "episodes_timesteps_total": 48576, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1058.7076279320459, "DC1_ls_policy": 3156.0899106368324, "DC2_ls_policy": -692.6381712403667, "DC3_ls_policy": -2177.6105471469123}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 60058.0483211029, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46804.15421772666, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0002067707016227643, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 99443.04718760346, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.04094595036922326, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.515933568330017, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 105961.70945793767, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128265.26748697956, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1316710222222732, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.546985708594966, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88386299.44534038, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 42.693700109806905, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1070.2336319322085, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6221413812588749, "mean_inference_ms": 2.292054348714437, "mean_action_processing_ms": 0.33615698974872765, "mean_env_wait_ms": 4.514858473664872, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036372078789605033, "StateBufferConnector_ms": 0.002614988221062554, "ViewRequirementAgentConnector_ms": 0.05703104866875543}, "num_episodes": 2, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1344.5488201816038, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568, "num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 565.0115599351265, "num_env_steps_trained_throughput_per_sec": 565.0115599351265, "timesteps_total": 59392, "num_env_steps_sampled_lifetime": 59392, "num_agent_steps_sampled_lifetime": 237568, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 237568, "timers": {"training_iteration_time_ms": 3745.102, "restore_workers_time_ms": 0.038, "training_step_time_ms": 3745.0, "sample_time_ms": 2448.124, "learn_time_ms": 1265.088, "learn_throughput": 1618.86, "synch_weights_time_ms": 11.277}, "counters": {"num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568}, "done": false, "training_iteration": 29, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-36", "timestamp": 1729548636, "time_this_iter_s": 3.6322169303894043, "time_total_s": 109.5387122631073, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c6d40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d33cf2710>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d33cf2260>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d33cf2620>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe855570>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 109.5387122631073, "iterations_since_restore": 29, "perf": {"cpu_util_percent": 5.5600000000000005, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.276738293468952, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.765588635206223, "policy_loss": -0.00022235477808862925, "vf_loss": 8.765749955177307, "vf_explained_var": 0.0008243106305599213, "kl": 0.0048994363628489385, "entropy": 2.4437658160924913, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.786022885888815, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.49776495695114, "policy_loss": -0.000526210485259071, "vf_loss": 9.498291182518006, "vf_explained_var": -0.00023451894521713256, "kl": 0.0012829875153956948, "entropy": 0.9204963549971581, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6956822142004966, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.352894008159637, "policy_loss": -0.001890079933218658, "vf_loss": 9.354784214496613, "vf_explained_var": -4.59715723991394e-05, "kl": 0.0027111645514823384, "entropy": 1.5136491760611535, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0408335756510496, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.922333312034606, "policy_loss": -0.0040908765746280554, "vf_loss": 9.926424300670623, "vf_explained_var": 2.2629648447036745e-05, "kl": 0.005080115912722149, "entropy": 1.3552701652050019, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1400.28269629218, "episode_len_mean": 2688.0, "episode_media": {}, "episodes_timesteps_total": 51072, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1058.7755145918484, "DC1_ls_policy": 3182.4777135720715, "DC2_ls_policy": -660.0490271433023, "DC3_ls_policy": -2180.9215047284415}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 59428.020153161946, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46804.15421772666, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.000195888033116303, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 99656.08436289808, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.03879090034979046, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.4580563292411226, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 106289.39893826621, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128265.26748697956, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.12474096842110093, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.5297312313544755, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88130788.30299908, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 40.44666326192233, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1057.3644645211343, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6216830748517503, "mean_inference_ms": 2.2889557042853084, "mean_action_processing_ms": 0.33532301152075883, "mean_env_wait_ms": 4.505866991568749, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003612668890702097, "StateBufferConnector_ms": 0.002612565693102385, "ViewRequirementAgentConnector_ms": 0.056934356689453125}, "num_episodes": 1, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1400.28269629218, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760, "num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 594.553570411356, "num_env_steps_trained_throughput_per_sec": 594.553570411356, "timesteps_total": 61440, "num_env_steps_sampled_lifetime": 61440, "num_agent_steps_sampled_lifetime": 245760, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 245760, "timers": {"training_iteration_time_ms": 3683.946, "restore_workers_time_ms": 0.038, "training_step_time_ms": 3683.842, "sample_time_ms": 2385.535, "learn_time_ms": 1267.315, "learn_throughput": 1616.016, "synch_weights_time_ms": 11.6}, "counters": {"num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760}, "done": false, "training_iteration": 30, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-40", "timestamp": 1729548640, "time_this_iter_s": 3.4513747692108154, "time_total_s": 112.99008703231812, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52b1c0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3507c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3520e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350310>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3506a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 112.99008703231812, "iterations_since_restore": 30, "perf": {"cpu_util_percent": 9.18, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.452535931766033, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.033214157819748, "policy_loss": -0.00043447142816148697, "vf_loss": 8.033618581295013, "vf_explained_var": -0.00010470896959304809, "kl": 0.004813432391893888, "entropy": 2.444825127720833, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9033431991934777, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.617933654785157, "policy_loss": -0.00338798236916773, "vf_loss": 9.62132158279419, "vf_explained_var": -0.0002887651324272156, "kl": 0.005089632090357554, "entropy": 0.6289247795939445, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5088998645544052, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.490026783943176, "policy_loss": -0.0031140460749156775, "vf_loss": 9.493140780925751, "vf_explained_var": -1.4998763799667358e-05, "kl": 0.0023461369530766033, "entropy": 1.3931766048073768, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1352803334593773, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.908918154239654, "policy_loss": -0.0012199503544252366, "vf_loss": 9.910138177871705, "vf_explained_var": -8.6984783411026e-05, "kl": 0.0020936301262821874, "entropy": 1.3586791291832925, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1443.8869539766242, "episode_len_mean": 2678.8571428571427, "episode_media": {}, "episodes_timesteps_total": 56256, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1034.3537054562041, "DC1_ls_policy": 3220.193148336602, "DC2_ls_policy": -627.9639883685359, "DC3_ls_policy": -2182.695911447649}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 58393.94377718421, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0001772320299623694, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 100225.53662885027, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.035096528887905654, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.3994591068207451, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 107149.17858595368, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128265.26748697956, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.11464291616700431, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4931878983271827, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88083270.42172721, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 36.816275762844484, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1050.987399851867, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6193018036650724, "mean_inference_ms": 2.282417830372065, "mean_action_processing_ms": 0.3338715756806979, "mean_env_wait_ms": 4.486264993815941, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003545341037568592, "StateBufferConnector_ms": 0.0026237396966843378, "ViewRequirementAgentConnector_ms": 0.05673368771870931}, "num_episodes": 2, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1443.8869539766242, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952, "num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 533.9576723122191, "num_env_steps_trained_throughput_per_sec": 533.9576723122191, "timesteps_total": 63488, "num_env_steps_sampled_lifetime": 63488, "num_agent_steps_sampled_lifetime": 253952, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 253952, "timers": {"training_iteration_time_ms": 3716.389, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3716.276, "sample_time_ms": 2417.77, "learn_time_ms": 1268.124, "learn_throughput": 1614.984, "synch_weights_time_ms": 11.452}, "counters": {"num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952}, "done": false, "training_iteration": 31, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-44", "timestamp": 1729548644, "time_this_iter_s": 3.843510150909424, "time_total_s": 116.83359718322754, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c6d40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe857d30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856650>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe857e20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856380>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 116.83359718322754, "iterations_since_restore": 31, "perf": {"cpu_util_percent": 18.933333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.037637592852116, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.375016713142395, "policy_loss": -0.003127109433989972, "vf_loss": 9.378116059303284, "vf_explained_var": -8.471310138702393e-06, "kl": 0.008889665766765172, "entropy": 2.39056633412838, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.226405618339777, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.50311782360077, "policy_loss": -0.003879018552834168, "vf_loss": 9.50699691772461, "vf_explained_var": -0.00011402666568756103, "kl": 0.0047331910441700846, "entropy": 1.0374346509575845, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2449427988380193, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.754217350482941, "policy_loss": -0.0015828961273655295, "vf_loss": 9.755800235271455, "vf_explained_var": -1.2506544589996337e-05, "kl": 0.0013496073067473732, "entropy": 1.7237207546830178, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0850110828876496, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.918518698215484, "policy_loss": -0.0013235079939477145, "vf_loss": 9.919842088222504, "vf_explained_var": 2.9347091913223267e-05, "kl": 0.0033921447242548524, "entropy": 1.33968406021595, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1443.8869539766242, "episode_len_mean": 2678.8571428571427, "episode_media": {}, "episodes_timesteps_total": 56256, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1034.3537054562041, "DC1_ls_policy": 3220.193148336602, "DC2_ls_policy": -627.9639883685359, "DC3_ls_policy": -2182.695911447649}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 58393.94377718421, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0001772320299623694, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 100225.53662885027, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.035096528887905654, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.3994591068207451, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 107149.17858595368, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128265.26748697956, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.11464291616700431, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4931878983271827, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88083270.42172721, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 36.816275762844484, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1050.987399851867, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6193018036650724, "mean_inference_ms": 2.282417830372065, "mean_action_processing_ms": 0.3338715756806979, "mean_env_wait_ms": 4.486264993815941, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003545341037568592, "StateBufferConnector_ms": 0.0026237396966843378, "ViewRequirementAgentConnector_ms": 0.05673368771870931}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1443.8869539766242, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144, "num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 554.2534073616769, "num_env_steps_trained_throughput_per_sec": 554.2534073616769, "timesteps_total": 65536, "num_env_steps_sampled_lifetime": 65536, "num_agent_steps_sampled_lifetime": 262144, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 262144, "timers": {"training_iteration_time_ms": 3719.909, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3719.8, "sample_time_ms": 2422.611, "learn_time_ms": 1266.9, "learn_throughput": 1616.545, "synch_weights_time_ms": 11.392}, "counters": {"num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144}, "done": false, "training_iteration": 32, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-48", "timestamp": 1729548648, "time_this_iter_s": 3.7029411792755127, "time_total_s": 120.53653836250305, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d599bd0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354610>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356ad0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356bf0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356e00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 120.53653836250305, "iterations_since_restore": 32, "perf": {"cpu_util_percent": 20.8, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.3191169738769535, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.65796737074852, "policy_loss": -0.005662131658755243, "vf_loss": 7.663587266206742, "vf_explained_var": 1.18158757686615e-05, "kl": 0.01355404677407417, "entropy": 2.334821143746376, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7815709546208383, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.719214642047882, "policy_loss": -0.0013491369783878327, "vf_loss": 9.720563781261443, "vf_explained_var": -8.438676595687867e-05, "kl": 0.004612796968673649, "entropy": 0.706386537104845, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6118551157414913, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.41119842529297, "policy_loss": -0.002406694379169494, "vf_loss": 9.413605189323425, "vf_explained_var": -1.4565140008926392e-05, "kl": 0.004316766115937445, "entropy": 1.3983696430921555, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0774009503424167, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.94064221382141, "policy_loss": -0.0022343763266690075, "vf_loss": 9.942876589298248, "vf_explained_var": -0.00018732398748397828, "kl": 0.0046302702051633955, "entropy": 1.3122401282191276, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1443.8869539766242, "episode_len_mean": 2678.8571428571427, "episode_media": {}, "episodes_timesteps_total": 56256, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1034.3537054562041, "DC1_ls_policy": 3220.193148336602, "DC2_ls_policy": -627.9639883685359, "DC3_ls_policy": -2182.695911447649}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 58393.94377718421, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0001772320299623694, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 100225.53662885027, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.035096528887905654, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.3994591068207451, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 107149.17858595368, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128265.26748697956, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.11464291616700431, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4931878983271827, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88083270.42172721, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 36.816275762844484, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1050.987399851867, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6193018036650724, "mean_inference_ms": 2.282417830372065, "mean_action_processing_ms": 0.3338715756806979, "mean_env_wait_ms": 4.486264993815941, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003545341037568592, "StateBufferConnector_ms": 0.0026237396966843378, "ViewRequirementAgentConnector_ms": 0.05673368771870931}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1443.8869539766242, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336, "num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 518.246806091202, "num_env_steps_trained_throughput_per_sec": 518.246806091202, "timesteps_total": 67584, "num_env_steps_sampled_lifetime": 67584, "num_agent_steps_sampled_lifetime": 270336, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 270336, "timers": {"training_iteration_time_ms": 3746.363, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3746.254, "sample_time_ms": 2448.473, "learn_time_ms": 1267.53, "learn_throughput": 1615.741, "synch_weights_time_ms": 11.409}, "counters": {"num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336}, "done": false, "training_iteration": 33, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-52", "timestamp": 1729548652, "time_this_iter_s": 3.959749460220337, "time_total_s": 124.49628782272339, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52ad40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357130>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357370>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357430>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3574f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 124.49628782272339, "iterations_since_restore": 33, "perf": {"cpu_util_percent": 20.133333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.810284329950809, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.50018401145935, "policy_loss": -0.005472125485539436, "vf_loss": 8.50562624335289, "vf_explained_var": -0.00018260926008224488, "kl": 0.009519764382412995, "entropy": 2.378345564007759, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.16114204749465, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.450519406795502, "policy_loss": -0.0005008759209886194, "vf_loss": 9.451020336151123, "vf_explained_var": -0.0003627285361289978, "kl": 0.0024306159768461644, "entropy": 0.685080261528492, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.246662401407957, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.802056062221528, "policy_loss": -0.0012556218774989248, "vf_loss": 9.803311729431153, "vf_explained_var": -9.419769048690796e-06, "kl": 0.002167337038895499, "entropy": 1.621344242990017, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1890402184799314, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.89467042684555, "policy_loss": -0.00045334978494793177, "vf_loss": 9.89512379169464, "vf_explained_var": 0.00014441683888435363, "kl": 0.0009287461084057161, "entropy": 1.3463517025113105, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1443.8869539766242, "episode_len_mean": 2678.8571428571427, "episode_media": {}, "episodes_timesteps_total": 56256, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 1034.3537054562041, "DC1_ls_policy": 3220.193148336602, "DC2_ls_policy": -627.9639883685359, "DC3_ls_policy": -2182.695911447649}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 58393.94377718421, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0001772320299623694, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 100225.53662885027, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.035096528887905654, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.3994591068207451, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.15208333333333332, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 107149.17858595368, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 128265.26748697956, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.11464291616700431, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4931878983271827, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88083270.42172721, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 36.816275762844484, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1050.987399851867, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6193018036650724, "mean_inference_ms": 2.282417830372065, "mean_action_processing_ms": 0.3338715756806979, "mean_env_wait_ms": 4.486264993815941, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003545341037568592, "StateBufferConnector_ms": 0.0026237396966843378, "ViewRequirementAgentConnector_ms": 0.05673368771870931}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1443.8869539766242, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528, "num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 566.7415944785885, "num_env_steps_trained_throughput_per_sec": 566.7415944785885, "timesteps_total": 69632, "num_env_steps_sampled_lifetime": 69632, "num_agent_steps_sampled_lifetime": 278528, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 278528, "timers": {"training_iteration_time_ms": 3722.15, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3722.037, "sample_time_ms": 2424.092, "learn_time_ms": 1268.078, "learn_throughput": 1615.043, "synch_weights_time_ms": 11.414}, "counters": {"num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528}, "done": false, "training_iteration": 34, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-55", "timestamp": 1729548655, "time_this_iter_s": 3.620818614959717, "time_total_s": 128.1171064376831, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52bf40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355d20>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356c50>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3540d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3541c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 128.1171064376831, "iterations_since_restore": 34, "perf": {"cpu_util_percent": 20.740000000000002, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.306704372167587, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.165855836868285, "policy_loss": -0.0020079790148884056, "vf_loss": 9.16783401966095, "vf_explained_var": 3.708228468894959e-05, "kl": 0.009540637379905093, "entropy": 2.272104775905609, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.318552778661251, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.372790610790252, "policy_loss": -0.0012270100589375943, "vf_loss": 9.374017643928529, "vf_explained_var": -3.61219048500061e-05, "kl": 0.0013811326344127634, "entropy": 0.9754273228347301, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.792534414678812, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.614706313610077, "policy_loss": -0.0025631196214817463, "vf_loss": 9.617269444465638, "vf_explained_var": -4.422962665557861e-05, "kl": 0.0033239784328149237, "entropy": 1.8055334582924842, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1943466920405625, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.923632609844208, "policy_loss": -0.00187551022390835, "vf_loss": 9.925508081912994, "vf_explained_var": 0.0005250297486782074, "kl": 0.001923445911022293, "entropy": 1.3585638910531999, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1442.0834412044371, "episode_len_mean": 2692.3636363636365, "episode_media": {}, "episodes_timesteps_total": 59232, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 983.4546320101458, "DC1_ls_policy": 3255.735514519831, "DC2_ls_policy": -556.006318281474, "DC3_ls_policy": -2241.100387044069}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 58168.32302248741, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00019972343818011119, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 100348.4912723071, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.033501232120273575, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.335847329237984, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108191.23506800403, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.10996645419069374, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.496048248012213, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88903415.15733303, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 35.43648384156172, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1056.4525795934487, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6209487736123418, "mean_inference_ms": 2.2851623928135454, "mean_action_processing_ms": 0.33464134039596605, "mean_env_wait_ms": 4.501177426058832, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035077333450317383, "StateBufferConnector_ms": 0.002626668323170055, "ViewRequirementAgentConnector_ms": 0.05673684857108376}, "num_episodes": 1, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1442.0834412044371, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720, "num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 515.4065176560478, "num_env_steps_trained_throughput_per_sec": 515.4065176560478, "timesteps_total": 71680, "num_env_steps_sampled_lifetime": 71680, "num_agent_steps_sampled_lifetime": 286720, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 286720, "timers": {"training_iteration_time_ms": 3746.764, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3746.65, "sample_time_ms": 2448.324, "learn_time_ms": 1268.35, "learn_throughput": 1614.697, "synch_weights_time_ms": 11.202}, "counters": {"num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720}, "done": false, "training_iteration": 35, "trial_id": "04bcd_00000", "date": "2024-10-21_22-10-59", "timestamp": 1729548659, "time_this_iter_s": 3.98197865486145, "time_total_s": 132.09908509254456, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d5295a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351b40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351c30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351e10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351f00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 132.09908509254456, "iterations_since_restore": 35, "perf": {"cpu_util_percent": 20.233333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.946423271298409, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.482594317197799, "policy_loss": -0.004863839782774449, "vf_loss": 7.487426728010178, "vf_explained_var": 3.4354627132415773e-06, "kl": 0.01004716369279914, "entropy": 2.2796261966228486, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6097117230296134, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.332014179229736, "policy_loss": -0.004676209896570071, "vf_loss": 9.336690270900727, "vf_explained_var": -0.0001237332820892334, "kl": 0.0058326582934682845, "entropy": 0.714605151116848, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7730179410427809, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.487579429149628, "policy_loss": -0.0005411142716184259, "vf_loss": 9.488120591640472, "vf_explained_var": -2.9820948839187622e-05, "kl": 0.001870418358064107, "entropy": 1.2551492407917977, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.147995675355196, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.941382443904876, "policy_loss": -0.0008814014960080385, "vf_loss": 9.942263734340667, "vf_explained_var": -0.00018436610698699952, "kl": 0.0027002727761583855, "entropy": 1.3043159276247025, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1442.0834412044371, "episode_len_mean": 2692.3636363636365, "episode_media": {}, "episodes_timesteps_total": 59232, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 983.4546320101458, "DC1_ls_policy": 3255.735514519831, "DC2_ls_policy": -556.006318281474, "DC3_ls_policy": -2241.100387044069}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 58168.32302248741, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00019972343818011119, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 100348.4912723071, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.033501232120273575, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.335847329237984, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108191.23506800403, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.10996645419069374, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.496048248012213, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88903415.15733303, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 35.43648384156172, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1056.4525795934487, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6209487736123418, "mean_inference_ms": 2.2851623928135454, "mean_action_processing_ms": 0.33464134039596605, "mean_env_wait_ms": 4.501177426058832, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035077333450317383, "StateBufferConnector_ms": 0.002626668323170055, "ViewRequirementAgentConnector_ms": 0.05673684857108376}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1442.0834412044371, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912, "num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 578.2823625498528, "num_env_steps_trained_throughput_per_sec": 578.2823625498528, "timesteps_total": 73728, "num_env_steps_sampled_lifetime": 73728, "num_agent_steps_sampled_lifetime": 294912, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 294912, "timers": {"training_iteration_time_ms": 3728.618, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3728.508, "sample_time_ms": 2428.956, "learn_time_ms": 1269.287, "learn_throughput": 1613.504, "synch_weights_time_ms": 11.383}, "counters": {"num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912}, "done": false, "training_iteration": 36, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-03", "timestamp": 1729548663, "time_this_iter_s": 3.548468828201294, "time_total_s": 135.64755392074585, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52ac20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352530>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352620>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352740>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3528f0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 135.64755392074585, "iterations_since_restore": 36, "perf": {"cpu_util_percent": 15.179999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.729003775119781, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.131225264072418, "policy_loss": -0.0008979415870271623, "vf_loss": 9.13211065530777, "vf_explained_var": -0.00013072937726974488, "kl": 0.004045074539590132, "entropy": 2.317459189891815, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7342375963926315, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.661353719234466, "policy_loss": -0.0021182848315220324, "vf_loss": 9.663472092151641, "vf_explained_var": -1.7094612121582032e-05, "kl": 0.0026971137726834737, "entropy": 1.049320813268423, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4513777263462544, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.526703464984895, "policy_loss": -0.001297218876425177, "vf_loss": 9.528000581264497, "vf_explained_var": -2.58520245552063e-05, "kl": 0.002830485961544582, "entropy": 1.5229641035199166, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1234087556600572, "cur_kl_coeff": 1.164153218269348e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.920424735546112, "policy_loss": -0.0010314380400814117, "vf_loss": 9.921456170082092, "vf_explained_var": 0.0011631324887275696, "kl": 0.0013557931739683227, "entropy": 1.2886485517024995, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1442.0834412044371, "episode_len_mean": 2692.3636363636365, "episode_media": {}, "episodes_timesteps_total": 59232, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 983.4546320101458, "DC1_ls_policy": 3255.735514519831, "DC2_ls_policy": -556.006318281474, "DC3_ls_policy": -2241.100387044069}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 58168.32302248741, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00019972343818011119, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 100348.4912723071, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.033501232120273575, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.335847329237984, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108191.23506800403, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.10996645419069374, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.496048248012213, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 1.095, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 88903415.15733303, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 110557567.78267984, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 35.43648384156172, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1056.4525795934487, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6209487736123418, "mean_inference_ms": 2.2851623928135454, "mean_action_processing_ms": 0.33464134039596605, "mean_env_wait_ms": 4.501177426058832, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035077333450317383, "StateBufferConnector_ms": 0.002626668323170055, "ViewRequirementAgentConnector_ms": 0.05673684857108376}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1442.0834412044371, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104, "num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 566.4226695288264, "num_env_steps_trained_throughput_per_sec": 566.4226695288264, "timesteps_total": 75776, "num_env_steps_sampled_lifetime": 75776, "num_agent_steps_sampled_lifetime": 303104, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 303104, "timers": {"training_iteration_time_ms": 3719.424, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3719.306, "sample_time_ms": 2421.284, "learn_time_ms": 1268.775, "learn_throughput": 1614.156, "synch_weights_time_ms": 11.126}, "counters": {"num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104}, "done": false, "training_iteration": 37, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-07", "timestamp": 1729548667, "time_this_iter_s": 3.623671770095825, "time_total_s": 139.27122569084167, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7250>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3530a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353640>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353760>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3538e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 139.27122569084167, "iterations_since_restore": 37, "perf": {"cpu_util_percent": 5.5, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.141863942146301, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.765083777904511, "policy_loss": -0.0032080965989734977, "vf_loss": 8.768277025222778, "vf_explained_var": -0.000122697651386261, "kl": 0.009530105260546406, "entropy": 2.34286946952343, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.231336508691311, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.038655018806457, "policy_loss": -0.0034693836059886962, "vf_loss": 9.042124438285828, "vf_explained_var": -1.3937056064605712e-05, "kl": 0.009882698175624682, "entropy": 0.8675813749432564, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.367349833995104, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.34044816493988, "policy_loss": -0.0007206957903690636, "vf_loss": 9.341168808937073, "vf_explained_var": -4.240870475769043e-05, "kl": 0.0026570614440746183, "entropy": 1.254432950913906, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4253087133169173, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.895925283432007, "policy_loss": -0.0007922064163722098, "vf_loss": 9.896717429161072, "vf_explained_var": 0.00025203600525856016, "kl": 0.0019680557858870033, "entropy": 1.27479395121336, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1503.4108390844062, "episode_len_mean": 2688.0, "episode_media": {}, "episodes_timesteps_total": 67200, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4589.954299352335, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 878.6747959007336, "DC1_ls_policy": 3296.1698471261434, "DC2_ls_policy": -455.33869657394433, "DC3_ls_policy": -2216.095107368528}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 57172.052621493924, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00017575662559849784, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 101143.80871525183, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.029481084265840746, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.2104138315476076, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 110313.68938898061, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.10673714635447716, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.3905881148164037, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.9254166666666667, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 89363407.38453692, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 35.86950161390765, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1015.0607215573863, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6238093264530262, "mean_inference_ms": 2.2912827874858475, "mean_action_processing_ms": 0.33586792521844344, "mean_env_wait_ms": 4.5304557967831425, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036416053771972656, "StateBufferConnector_ms": 0.0026121139526367188, "ViewRequirementAgentConnector_ms": 0.05647730827331543}, "num_episodes": 3, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1503.4108390844062, "episodes_this_iter": 3}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296, "num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 579.8922871915805, "num_env_steps_trained_throughput_per_sec": 579.8922871915805, "timesteps_total": 77824, "num_env_steps_sampled_lifetime": 77824, "num_agent_steps_sampled_lifetime": 311296, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 311296, "timers": {"training_iteration_time_ms": 3682.803, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3682.685, "sample_time_ms": 2386.142, "learn_time_ms": 1267.28, "learn_throughput": 1616.06, "synch_weights_time_ms": 11.07}, "counters": {"num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296}, "done": false, "training_iteration": 38, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-10", "timestamp": 1729548670, "time_this_iter_s": 3.540027379989624, "time_total_s": 142.8112530708313, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d529090>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357400>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354190>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3542b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354370>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 142.8112530708313, "iterations_since_restore": 38, "perf": {"cpu_util_percent": 11.4, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.984722521901131, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.707056200504303, "policy_loss": -0.0036235613224562258, "vf_loss": 7.710665822029114, "vf_explained_var": 3.693178296089172e-05, "kl": 0.00890638899145521, "entropy": 2.281122609972954, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4282819725573064, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.635564804077148, "policy_loss": -0.005839541368186474, "vf_loss": 9.641404366493225, "vf_explained_var": -5.1668286323547365e-05, "kl": 0.01901924798935437, "entropy": 0.7502780579030514, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6139377668499946, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.593094372749329, "policy_loss": -0.0006949017872102559, "vf_loss": 9.59378935098648, "vf_explained_var": -5.390644073486328e-05, "kl": 0.003404472319107665, "entropy": 1.090566497296095, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2004587277770042, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.92054842710495, "policy_loss": -0.002952493552584201, "vf_loss": 9.9235009431839, "vf_explained_var": -5.3267180919647214e-05, "kl": 0.005661354741857849, "entropy": 1.2594441533088685, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1561.1383081892675, "episode_len_mean": 2702.222222222222, "episode_media": {}, "episodes_timesteps_total": 72960, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 846.8917744686499, "DC1_ls_policy": 3350.393931455381, "DC2_ls_policy": -415.88756228533, "DC3_ls_policy": -2220.2598354494353}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 56687.43150257096, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00017408474774007604, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 101421.70335609616, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.02729730024614884, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1578508118485893, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111224.34825241404, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.10096395178065241, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.3360809733021557, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.9254166666666667, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90208764.95362951, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 34.881692897772155, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1010.1518374305865, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6220207748351944, "mean_inference_ms": 2.287410686418867, "mean_action_processing_ms": 0.33459370401924327, "mean_env_wait_ms": 4.515474394541204, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003594380837899667, "StateBufferConnector_ms": 0.0026020738813612196, "ViewRequirementAgentConnector_ms": 0.05624338432594582}, "num_episodes": 2, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1561.1383081892675, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488, "num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 539.5544535188828, "num_env_steps_trained_throughput_per_sec": 539.5544535188828, "timesteps_total": 79872, "num_env_steps_sampled_lifetime": 79872, "num_agent_steps_sampled_lifetime": 319488, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 319488, "timers": {"training_iteration_time_ms": 3699.905, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3699.787, "sample_time_ms": 2402.158, "learn_time_ms": 1267.924, "learn_throughput": 1615.239, "synch_weights_time_ms": 10.981}, "counters": {"num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488}, "done": false, "training_iteration": 39, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-14", "timestamp": 1729548674, "time_this_iter_s": 3.804060697555542, "time_total_s": 146.61531376838684, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d5295a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3573a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356e00>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3570a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357340>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 146.61531376838684, "iterations_since_restore": 39, "perf": {"cpu_util_percent": 19.849999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.546585576236248, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.128481006622314, "policy_loss": -0.004447956255171448, "vf_loss": 9.132912945747375, "vf_explained_var": -1.6207247972488405e-05, "kl": 0.010266623790176488, "entropy": 2.281990724802017, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.563465964794159, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.808225631713867, "policy_loss": -0.004376702845911495, "vf_loss": 9.81260234117508, "vf_explained_var": -3.147125244140625e-06, "kl": 0.005957772748104162, "entropy": 1.0610326439142228, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.879675554484129, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.340876209735871, "policy_loss": -0.003688134835101664, "vf_loss": 9.34456433057785, "vf_explained_var": -3.27765941619873e-05, "kl": 0.013203888568080292, "entropy": 1.1495699524879455, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.195418930053711, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.924070239067078, "policy_loss": -0.0025864347349852323, "vf_loss": 9.926656711101533, "vf_explained_var": 0.0004218451678752899, "kl": 0.004168761813616584, "entropy": 1.2122968778014183, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1561.1383081892675, "episode_len_mean": 2702.222222222222, "episode_media": {}, "episodes_timesteps_total": 72960, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 846.8917744686499, "DC1_ls_policy": 3350.393931455381, "DC2_ls_policy": -415.88756228533, "DC3_ls_policy": -2220.2598354494353}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 56687.43150257096, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00017408474774007604, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 101421.70335609616, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.02729730024614884, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1578508118485893, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111224.34825241404, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.10096395178065241, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.3360809733021557, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.9254166666666667, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90208764.95362951, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 34.881692897772155, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 1010.1518374305865, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6220207748351944, "mean_inference_ms": 2.287410686418867, "mean_action_processing_ms": 0.33459370401924327, "mean_env_wait_ms": 4.515474394541204, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003594380837899667, "StateBufferConnector_ms": 0.0026020738813612196, "ViewRequirementAgentConnector_ms": 0.05624338432594582}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1561.1383081892675, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680, "num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 549.8109885203199, "num_env_steps_trained_throughput_per_sec": 549.8109885203199, "timesteps_total": 81920, "num_env_steps_sampled_lifetime": 81920, "num_agent_steps_sampled_lifetime": 327680, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 327680, "timers": {"training_iteration_time_ms": 3727.937, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3727.82, "sample_time_ms": 2429.906, "learn_time_ms": 1268.643, "learn_throughput": 1614.323, "synch_weights_time_ms": 10.646}, "counters": {"num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680}, "done": false, "training_iteration": 40, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-18", "timestamp": 1729548678, "time_this_iter_s": 3.733198642730713, "time_total_s": 150.34851241111755, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59a440>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d410a30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d411c30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d413d60>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9d2d410b50>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 150.34851241111755, "iterations_since_restore": 40, "perf": {"cpu_util_percent": 19.66, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.50435186624527, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.52488398551941, "policy_loss": -0.004931071872124449, "vf_loss": 8.529799318313598, "vf_explained_var": -9.447634220123291e-05, "kl": 0.010025109376602831, "entropy": 2.2654927015304565, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.233327943831682, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.303898012638092, "policy_loss": -0.004297642875462771, "vf_loss": 9.30819571018219, "vf_explained_var": -2.0228326320648193e-05, "kl": 0.010736189990223466, "entropy": 0.8524992063641548, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1992959842085837, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.49458681344986, "policy_loss": -0.002988194493809715, "vf_loss": 9.497575116157531, "vf_explained_var": -4.666149616241455e-05, "kl": 0.01120274721554324, "entropy": 0.6272202357649803, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2582033321261406, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.917002665996552, "policy_loss": -0.0015661594399716706, "vf_loss": 9.918568909168243, "vf_explained_var": -0.0001353919506072998, "kl": 0.0026658487343639535, "entropy": 1.176325835287571, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1662.5063063974144, "episode_len_mean": 2694.6206896551726, "episode_media": {}, "episodes_timesteps_total": 78144, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 815.2293280778129, "DC1_ls_policy": 3369.726551692521, "DC2_ls_policy": -399.5147445281475, "DC3_ls_policy": -2122.9348288447736}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 56145.08845702893, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016207890306834668, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 102152.94296166558, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.025414727815379953, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1142378567530289, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111600.00833047737, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.09400092062336604, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.21170299642904, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.2854938271604938, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90217156.04669692, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.47605890482235, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 970.5513275694732, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6204116833796792, "mean_inference_ms": 2.283005964357491, "mean_action_processing_ms": 0.3336216105334226, "mean_env_wait_ms": 4.501530218690029, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003543804431783742, "StateBufferConnector_ms": 0.002606572776005186, "ViewRequirementAgentConnector_ms": 0.0561405872476512}, "num_episodes": 2, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1662.5063063974144, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872, "num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 526.3759945227066, "num_env_steps_trained_throughput_per_sec": 526.3759945227066, "timesteps_total": 83968, "num_env_steps_sampled_lifetime": 83968, "num_agent_steps_sampled_lifetime": 335872, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 335872, "timers": {"training_iteration_time_ms": 3733.457, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3733.346, "sample_time_ms": 2435.538, "learn_time_ms": 1268.414, "learn_throughput": 1614.615, "synch_weights_time_ms": 10.665}, "counters": {"num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872}, "done": false, "training_iteration": 41, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-22", "timestamp": 1729548682, "time_this_iter_s": 3.8984785079956055, "time_total_s": 154.24699091911316, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52bf40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe855ae0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe855e40>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856020>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe8561d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 154.24699091911316, "iterations_since_restore": 41, "perf": {"cpu_util_percent": 19.866666666666664, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.45664571672678, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.381205534934997, "policy_loss": -0.0005657962523400783, "vf_loss": 8.38176234960556, "vf_explained_var": 3.634467720985413e-05, "kl": 0.005688699786378493, "entropy": 2.305775982141495, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0723737344145774, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.15837858915329, "policy_loss": -0.004852775216568262, "vf_loss": 9.163231325149535, "vf_explained_var": -2.010762691497803e-05, "kl": 0.012364146804452908, "entropy": 0.7228246532380581, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9388521119952202, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.609432339668274, "policy_loss": -0.0018691564444452524, "vf_loss": 9.61130154132843, "vf_explained_var": -2.8477609157562255e-05, "kl": 0.006324633981058006, "entropy": 1.0047326020896434, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1791434960439802, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.92884328365326, "policy_loss": -0.0019943137769587336, "vf_loss": 9.930837678909302, "vf_explained_var": -5.4570287466049196e-05, "kl": 0.0037661300182777074, "entropy": 1.098134297132492, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1662.5063063974144, "episode_len_mean": 2694.6206896551726, "episode_media": {}, "episodes_timesteps_total": 78144, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 815.2293280778129, "DC1_ls_policy": 3369.726551692521, "DC2_ls_policy": -399.5147445281475, "DC3_ls_policy": -2122.9348288447736}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 56145.08845702893, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016207890306834668, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 102152.94296166558, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.025414727815379953, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1142378567530289, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111600.00833047737, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.09400092062336604, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.21170299642904, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.2854938271604938, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90217156.04669692, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.47605890482235, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 970.5513275694732, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6204116833796792, "mean_inference_ms": 2.283005964357491, "mean_action_processing_ms": 0.3336216105334226, "mean_env_wait_ms": 4.501530218690029, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003543804431783742, "StateBufferConnector_ms": 0.002606572776005186, "ViewRequirementAgentConnector_ms": 0.0561405872476512}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1662.5063063974144, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064, "num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 517.3943767777662, "num_env_steps_trained_throughput_per_sec": 517.3943767777662, "timesteps_total": 86016, "num_env_steps_sampled_lifetime": 86016, "num_agent_steps_sampled_lifetime": 344064, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 344064, "timers": {"training_iteration_time_ms": 3759.781, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3759.67, "sample_time_ms": 2459.063, "learn_time_ms": 1270.793, "learn_throughput": 1611.592, "synch_weights_time_ms": 10.62}, "counters": {"num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064}, "done": false, "training_iteration": 42, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-26", "timestamp": 1729548686, "time_this_iter_s": 3.9661061763763428, "time_total_s": 158.2130970954895, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bfac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856620>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe8567d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856950>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856a40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 158.2130970954895, "iterations_since_restore": 42, "perf": {"cpu_util_percent": 20.849999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.7329419404268265, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.80600764155388, "policy_loss": -0.001748857693746686, "vf_loss": 8.807746469974518, "vf_explained_var": -8.762180805206299e-05, "kl": 0.006487469195600587, "entropy": 2.3226729810237883, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.016247595846653, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.807788026332855, "policy_loss": -0.002482563245575875, "vf_loss": 9.810270607471466, "vf_explained_var": -1.5696883201599122e-05, "kl": 0.0025598104136409527, "entropy": 0.81381895840168, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9095864780247211, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.687750363349915, "policy_loss": -0.0012404059991240502, "vf_loss": 9.688990759849549, "vf_explained_var": -1.3446807861328125e-05, "kl": 0.0034428885620974487, "entropy": 1.0726306430995465, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1654611587524415, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.942919886112213, "policy_loss": -0.00010977118508890272, "vf_loss": 9.94302966594696, "vf_explained_var": 1.6304105520248414e-05, "kl": 0.0010777319969947504, "entropy": 1.0882383540272713, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1662.5063063974144, "episode_len_mean": 2694.6206896551726, "episode_media": {}, "episodes_timesteps_total": 78144, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 815.2293280778129, "DC1_ls_policy": 3369.726551692521, "DC2_ls_policy": -399.5147445281475, "DC3_ls_policy": -2122.9348288447736}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 56145.08845702893, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016207890306834668, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 102152.94296166558, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.025414727815379953, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1142378567530289, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111600.00833047737, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.09400092062336604, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.21170299642904, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.2854938271604938, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90217156.04669692, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.47605890482235, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 970.5513275694732, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6204116833796792, "mean_inference_ms": 2.283005964357491, "mean_action_processing_ms": 0.3336216105334226, "mean_env_wait_ms": 4.501530218690029, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003543804431783742, "StateBufferConnector_ms": 0.002606572776005186, "ViewRequirementAgentConnector_ms": 0.0561405872476512}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1662.5063063974144, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256, "num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 545.760289708795, "num_env_steps_trained_throughput_per_sec": 545.760289708795, "timesteps_total": 88064, "num_env_steps_sampled_lifetime": 88064, "num_agent_steps_sampled_lifetime": 352256, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 352256, "timers": {"training_iteration_time_ms": 3739.857, "restore_workers_time_ms": 0.04, "training_step_time_ms": 3739.751, "sample_time_ms": 2437.794, "learn_time_ms": 1272.921, "learn_throughput": 1608.898, "synch_weights_time_ms": 10.754}, "counters": {"num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256}, "done": false, "training_iteration": 43, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-30", "timestamp": 1729548690, "time_this_iter_s": 3.7603323459625244, "time_total_s": 161.97342944145203, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d599900>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352560>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352650>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352710>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352800>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 161.97342944145203, "iterations_since_restore": 43, "perf": {"cpu_util_percent": 20.82, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.87625940144062, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.970733857154846, "policy_loss": -0.003483599977334961, "vf_loss": 7.974200338125229, "vf_explained_var": 1.8765777349472045e-05, "kl": 0.010967441656567462, "entropy": 2.3212151646614076, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2943194597959518, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.41612606048584, "policy_loss": -0.002323983598034829, "vf_loss": 9.418449902534485, "vf_explained_var": -6.03795051574707e-06, "kl": 0.004913455794394997, "entropy": 0.742237688601017, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.19748215675354, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.554513323307038, "policy_loss": -0.012382537149824202, "vf_loss": 9.56689590215683, "vf_explained_var": -1.5126168727874756e-05, "kl": 0.023414519888593267, "entropy": 1.150689034163952, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.246739763393998, "cur_kl_coeff": 1.8189894035458563e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.934523391723634, "policy_loss": -0.0007040711701847613, "vf_loss": 9.935227513313293, "vf_explained_var": 0.00017099305987358093, "kl": 0.0010400425774525052, "entropy": 1.0842972964048385, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1662.5063063974144, "episode_len_mean": 2694.6206896551726, "episode_media": {}, "episodes_timesteps_total": 78144, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 815.2293280778129, "DC1_ls_policy": 3369.726551692521, "DC2_ls_policy": -399.5147445281475, "DC3_ls_policy": -2122.9348288447736}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 56145.08845702893, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016207890306834668, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 102152.94296166558, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.025414727815379953, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1142378567530289, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111600.00833047737, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.09400092062336604, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.21170299642904, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.2854938271604938, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90217156.04669692, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.47605890482235, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 970.5513275694732, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6204116833796792, "mean_inference_ms": 2.283005964357491, "mean_action_processing_ms": 0.3336216105334226, "mean_env_wait_ms": 4.501530218690029, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003543804431783742, "StateBufferConnector_ms": 0.002606572776005186, "ViewRequirementAgentConnector_ms": 0.0561405872476512}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1662.5063063974144, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448, "num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 555.88542460554, "num_env_steps_trained_throughput_per_sec": 555.88542460554, "timesteps_total": 90112, "num_env_steps_sampled_lifetime": 90112, "num_agent_steps_sampled_lifetime": 360448, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 360448, "timers": {"training_iteration_time_ms": 3746.918, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3746.807, "sample_time_ms": 2443.358, "learn_time_ms": 1274.503, "learn_throughput": 1606.901, "synch_weights_time_ms": 10.721}, "counters": {"num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448}, "done": false, "training_iteration": 44, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-34", "timestamp": 1729548694, "time_this_iter_s": 3.6917054653167725, "time_total_s": 165.6651349067688, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d529090>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe857940>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe857e50>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe8553c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353550>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 165.6651349067688, "iterations_since_restore": 44, "perf": {"cpu_util_percent": 8.48, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.536913630366326, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.498685771226883, "policy_loss": -2.9700895538553596e-05, "vf_loss": 8.498710209131241, "vf_explained_var": -1.286640763282776e-05, "kl": 0.003364433198930783, "entropy": 2.3361529797315597, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4591748997569085, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.175173437595367, "policy_loss": -0.002554979271371849, "vf_loss": 9.177728414535522, "vf_explained_var": -1.5461444854736327e-05, "kl": 0.006607941928542036, "entropy": 0.6824808068573475, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.817312190681696, "cur_kl_coeff": 3.492459654808044e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.771271622180938, "policy_loss": -0.003238906612386927, "vf_loss": 9.774510550498963, "vf_explained_var": -8.072704076766968e-06, "kl": 0.005748429605365151, "entropy": 1.3298596307635306, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2242668762803077, "cur_kl_coeff": 9.094947017729282e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.925361120700837, "policy_loss": -0.0019316731253638864, "vf_loss": 9.927292883396149, "vf_explained_var": -1.0429322719573974e-05, "kl": 0.0034864727478209163, "entropy": 1.0771141216158866, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1662.5063063974144, "episode_len_mean": 2694.6206896551726, "episode_media": {}, "episodes_timesteps_total": 78144, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 815.2293280778129, "DC1_ls_policy": 3369.726551692521, "DC2_ls_policy": -399.5147445281475, "DC3_ls_policy": -2122.9348288447736}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 56145.08845702893, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016207890306834668, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 102152.94296166558, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.025414727815379953, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1142378567530289, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111600.00833047737, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.09400092062336604, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.21170299642904, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.2854938271604938, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90217156.04669692, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.47605890482235, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 970.5513275694732, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6204116833796792, "mean_inference_ms": 2.283005964357491, "mean_action_processing_ms": 0.3336216105334226, "mean_env_wait_ms": 4.501530218690029, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003543804431783742, "StateBufferConnector_ms": 0.002606572776005186, "ViewRequirementAgentConnector_ms": 0.0561405872476512}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1662.5063063974144, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640, "num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 588.0544752073592, "num_env_steps_trained_throughput_per_sec": 588.0544752073592, "timesteps_total": 92160, "num_env_steps_sampled_lifetime": 92160, "num_agent_steps_sampled_lifetime": 368640, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 368640, "timers": {"training_iteration_time_ms": 3697.83, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3697.713, "sample_time_ms": 2392.12, "learn_time_ms": 1276.912, "learn_throughput": 1603.869, "synch_weights_time_ms": 10.854}, "counters": {"num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640}, "done": false, "training_iteration": 45, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-37", "timestamp": 1729548697, "time_this_iter_s": 3.490529775619507, "time_total_s": 169.1556646823883, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59b400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352770>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352530>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3523b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3538b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 169.1556646823883, "iterations_since_restore": 45, "perf": {"cpu_util_percent": 5.58, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.558806571364403, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.52897452712059, "policy_loss": -0.004993590677622705, "vf_loss": 8.533958584070206, "vf_explained_var": -0.00010833740234375, "kl": 0.012210591845723684, "entropy": 2.325088459253311, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.827129166573286, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.441904258728027, "policy_loss": -0.005064532329561189, "vf_loss": 9.446968746185302, "vf_explained_var": -4.267394542694092e-05, "kl": 0.011028039939446899, "entropy": 0.5852415852248669, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.693052614852786, "cur_kl_coeff": 3.492459654808044e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.649634838104248, "policy_loss": -0.002299563225824386, "vf_loss": 9.651934361457824, "vf_explained_var": -1.817867159843445e-05, "kl": 0.012950121455038039, "entropy": 1.0976726591587067, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2308014873415232, "cur_kl_coeff": 4.547473508864641e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.928695929050445, "policy_loss": -0.00053751901286887, "vf_loss": 9.929233491420746, "vf_explained_var": 0.0003815129399299622, "kl": 0.0022535378022696543, "entropy": 1.0396558851003648, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832}, "env_runners": {"episode_reward_max": 4779.476658157588, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1662.5063063974144, "episode_len_mean": 2694.6206896551726, "episode_media": {}, "episodes_timesteps_total": 78144, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": -330.55552673696064}, "policy_reward_mean": {"high_level_policy": 815.2293280778129, "DC1_ls_policy": 3369.726551692521, "DC2_ls_policy": -399.5147445281475, "DC3_ls_policy": -2122.9348288447736}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 56145.08845702893, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00016207890306834668, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 102152.94296166558, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 120709.59840751255, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.025414727815379953, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.1142378567530289, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111600.00833047737, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.09400092062336604, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.21170299642904, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.2854938271604938, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90217156.04669692, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 32.47605890482235, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 970.5513275694732, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6204116833796792, "mean_inference_ms": 2.283005964357491, "mean_action_processing_ms": 0.3336216105334226, "mean_env_wait_ms": 4.501530218690029, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003543804431783742, "StateBufferConnector_ms": 0.002606572776005186, "ViewRequirementAgentConnector_ms": 0.0561405872476512}, "num_episodes": 0, "episode_return_max": 4779.476658157588, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1662.5063063974144, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832, "num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 556.1029325233548, "num_env_steps_trained_throughput_per_sec": 556.1029325233548, "timesteps_total": 94208, "num_env_steps_sampled_lifetime": 94208, "num_agent_steps_sampled_lifetime": 376832, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 376832, "timers": {"training_iteration_time_ms": 3711.954, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3711.839, "sample_time_ms": 2407.125, "learn_time_ms": 1276.195, "learn_throughput": 1604.771, "synch_weights_time_ms": 10.656}, "counters": {"num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832}, "done": false, "training_iteration": 46, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-41", "timestamp": 1729548701, "time_this_iter_s": 3.691575527191162, "time_total_s": 172.84724020957947, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d5e6fdf30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3531c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351ba0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353190>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353970>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 172.84724020957947, "iterations_since_restore": 46, "perf": {"cpu_util_percent": 19.133333333333336, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.709488001465798, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.028622215986251, "policy_loss": -0.003743808332365006, "vf_loss": 8.032358682155609, "vf_explained_var": 3.2135844230651854e-05, "kl": 0.009404337172511655, "entropy": 2.3361674785614013, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7794666178524494, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.263010585308075, "policy_loss": -0.0023133841576054694, "vf_loss": 9.265323972702026, "vf_explained_var": -2.4136900901794433e-05, "kl": 0.00928655040188533, "entropy": 0.480126217007637, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9743063874542712, "cur_kl_coeff": 3.492459654808044e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.532949531078339, "policy_loss": -0.001493788114748895, "vf_loss": 9.534443295001983, "vf_explained_var": -3.3812224864959715e-05, "kl": 0.005462197063889729, "entropy": 1.3112131997942924, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5214820198714734, "cur_kl_coeff": 2.2737367544323204e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.887301707267762, "policy_loss": -0.002813227998558432, "vf_loss": 9.890114974975585, "vf_explained_var": 0.00010603070259094239, "kl": 0.00555219494863195, "entropy": 1.0656116515398026, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024}, "env_runners": {"episode_reward_max": 5792.317966177487, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1796.4936888350755, "episode_len_mean": 2685.0, "episode_media": {}, "episodes_timesteps_total": 85920, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 96.08111226186901}, "policy_reward_mean": {"high_level_policy": 782.4544807528259, "DC1_ls_policy": 3395.274277882754, "DC2_ls_policy": -441.0867521305811, "DC3_ls_policy": -1940.1483176699257}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 55346.61038331961, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00014688400590568917, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 103583.48244549273, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.023032097082688083, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0971701107738303, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111661.89390933923, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.08518833431492548, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.0494751281482264, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.2854938271604938, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90105344.39841945, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 29.431428382495255, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 925.916547531878, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6229857721582444, "mean_inference_ms": 2.2880646682029058, "mean_action_processing_ms": 0.3348322991476086, "mean_env_wait_ms": 4.525696586369085, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036401674151420593, "StateBufferConnector_ms": 0.002617388963699341, "ViewRequirementAgentConnector_ms": 0.056296586990356445}, "num_episodes": 3, "episode_return_max": 5792.317966177487, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1796.4936888350755, "episodes_this_iter": 3}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024, "num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 549.8460414240135, "num_env_steps_trained_throughput_per_sec": 549.8460414240135, "timesteps_total": 96256, "num_env_steps_sampled_lifetime": 96256, "num_agent_steps_sampled_lifetime": 385024, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 385024, "timers": {"training_iteration_time_ms": 3722.852, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3722.741, "sample_time_ms": 2414.069, "learn_time_ms": 1279.248, "learn_throughput": 1600.941, "synch_weights_time_ms": 10.718}, "counters": {"num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024}, "done": false, "training_iteration": 47, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-45", "timestamp": 1729548705, "time_this_iter_s": 3.7347817420959473, "time_total_s": 176.58202195167542, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bcee0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350670>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3508e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350a00>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350b20>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 176.58202195167542, "iterations_since_restore": 47, "perf": {"cpu_util_percent": 20.88, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.343337877094745, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.018407732248306, "policy_loss": -0.0025511455751257017, "vf_loss": 8.020953762531281, "vf_explained_var": -6.47231936454773e-06, "kl": 0.006523592455540866, "entropy": 2.302464246749878, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3992106206715107, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.501802504062653, "policy_loss": -0.004273060068953782, "vf_loss": 9.506075453758239, "vf_explained_var": -1.417994499206543e-05, "kl": 0.006036638107253346, "entropy": 0.5560435317456722, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6529127702116966, "cur_kl_coeff": 3.492459654808044e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.585931408405305, "policy_loss": -0.0027343124849721788, "vf_loss": 9.58866560459137, "vf_explained_var": -1.0423362255096436e-05, "kl": 0.006918036004356885, "entropy": 1.3541834935545922, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3534263465553522, "cur_kl_coeff": 2.2737367544323204e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.918582391738891, "policy_loss": -0.0004686091095209122, "vf_loss": 9.919050967693329, "vf_explained_var": 0.0006531678140163421, "kl": 0.003667374289034477, "entropy": 1.0611993387341498, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216}, "env_runners": {"episode_reward_max": 5792.317966177487, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1796.4936888350755, "episode_len_mean": 2685.0, "episode_media": {}, "episodes_timesteps_total": 85920, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 96.08111226186901}, "policy_reward_mean": {"high_level_policy": 782.4544807528259, "DC1_ls_policy": 3395.274277882754, "DC2_ls_policy": -441.0867521305811, "DC3_ls_policy": -1940.1483176699257}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 55346.61038331961, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00014688400590568917, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 103583.48244549273, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.023032097082688083, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0971701107738303, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111661.89390933923, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.08518833431492548, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.0494751281482264, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.2854938271604938, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90105344.39841945, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 29.431428382495255, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 925.916547531878, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6229857721582444, "mean_inference_ms": 2.2880646682029058, "mean_action_processing_ms": 0.3348322991476086, "mean_env_wait_ms": 4.525696586369085, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036401674151420593, "StateBufferConnector_ms": 0.002617388963699341, "ViewRequirementAgentConnector_ms": 0.056296586990356445}, "num_episodes": 0, "episode_return_max": 5792.317966177487, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1796.4936888350755, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216, "num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 542.2393527115204, "num_env_steps_trained_throughput_per_sec": 542.2393527115204, "timesteps_total": 98304, "num_env_steps_sampled_lifetime": 98304, "num_agent_steps_sampled_lifetime": 393216, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 393216, "timers": {"training_iteration_time_ms": 3747.376, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3747.265, "sample_time_ms": 2439.277, "learn_time_ms": 1278.658, "learn_throughput": 1601.679, "synch_weights_time_ms": 10.691}, "counters": {"num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216}, "done": false, "training_iteration": 48, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-49", "timestamp": 1729548709, "time_this_iter_s": 3.7844743728637695, "time_total_s": 180.36649632453918, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d599630>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe855870>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe8555a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe855780>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe855a20>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 180.36649632453918, "iterations_since_restore": 48, "perf": {"cpu_util_percent": 19.916666666666668, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.545642353594303, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.632937806844712, "policy_loss": -0.006334038660861551, "vf_loss": 8.639262628555297, "vf_explained_var": -1.6176700592041014e-05, "kl": 0.011697578526946018, "entropy": 2.3332345277071, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.9411059729754925, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.63865748643875, "policy_loss": -0.004052163218148053, "vf_loss": 9.642709612846375, "vf_explained_var": -3.776401281356812e-05, "kl": 0.008029381560619175, "entropy": 0.4266407024115324, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.835580211505294, "cur_kl_coeff": 3.492459654808044e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.31058360338211, "policy_loss": -0.0019135079346597195, "vf_loss": 9.312497127056123, "vf_explained_var": -4.566460847854614e-06, "kl": 0.002154483715913412, "entropy": 1.62365183532238, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2841733023524284, "cur_kl_coeff": 1.1368683772161602e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.900226831436157, "policy_loss": -0.00040253978222608565, "vf_loss": 9.90062940120697, "vf_explained_var": -8.447989821434022e-05, "kl": 0.0005388173387132156, "entropy": 1.0584351658821105, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408}, "env_runners": {"episode_reward_max": 5792.317966177487, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1815.5713194261489, "episode_len_mean": 2679.2727272727275, "episode_media": {}, "episodes_timesteps_total": 88416, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 96.08111226186901}, "policy_reward_mean": {"high_level_policy": 766.7420096973294, "DC1_ls_policy": 3400.3277298337757, "DC2_ls_policy": -462.07491250129993, "DC3_ls_policy": -1889.4235076036591}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 55117.830747821485, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00014243297542369858, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104029.59493720812, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.024713719626413933, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.102323366935307, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111720.94574505939, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.08260686963871562, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.9946906254304477, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.24158653846153846, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90020781.41866808, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 29.96597947949035, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 920.775319110166, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6225565380430593, "mean_inference_ms": 2.286252054293167, "mean_action_processing_ms": 0.334326062228411, "mean_env_wait_ms": 4.519783409486632, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003621433720444188, "StateBufferConnector_ms": 0.0026168245257753315, "ViewRequirementAgentConnector_ms": 0.056218197851470024}, "num_episodes": 1, "episode_return_max": 5792.317966177487, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1815.5713194261489, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408, "num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 566.6116492020543, "num_env_steps_trained_throughput_per_sec": 566.6116492020543, "timesteps_total": 100352, "num_env_steps_sampled_lifetime": 100352, "num_agent_steps_sampled_lifetime": 401408, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 401408, "timers": {"training_iteration_time_ms": 3729.251, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3729.139, "sample_time_ms": 2421.696, "learn_time_ms": 1278.934, "learn_throughput": 1601.334, "synch_weights_time_ms": 10.674}, "counters": {"num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408}, "done": false, "training_iteration": 49, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-53", "timestamp": 1729548713, "time_this_iter_s": 3.621351957321167, "time_total_s": 183.98784828186035, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59b400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353a00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353b80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353ee0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350040>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 183.98784828186035, "iterations_since_restore": 49, "perf": {"cpu_util_percent": 20.279999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.711683861911297, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.303082275390626, "policy_loss": -0.004890572308795527, "vf_loss": 8.307964265346527, "vf_explained_var": -2.301633358001709e-05, "kl": 0.010896608629454126, "entropy": 2.2874000668525696, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7964230976998805, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.356656444072723, "policy_loss": -0.007121035165619105, "vf_loss": 9.363777482509613, "vf_explained_var": -1.6197562217712402e-05, "kl": 0.015620030863056578, "entropy": 0.565008657425642, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9170013714581728, "cur_kl_coeff": 1.746229827404022e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.354909431934356, "policy_loss": -0.0007020337623544037, "vf_loss": 9.355611503124237, "vf_explained_var": -2.983957529067993e-06, "kl": 0.004946501222730148, "entropy": 1.6467663884162902, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3688095159828664, "cur_kl_coeff": 5.684341886080801e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.906171810626983, "policy_loss": -0.004092052835039795, "vf_loss": 9.91026383638382, "vf_explained_var": -0.0002088211476802826, "kl": 0.007143468058609414, "entropy": 1.0644199892878532, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600}, "env_runners": {"episode_reward_max": 5927.413344728115, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 1936.5078495820892, "episode_len_mean": 2693.6470588235293, "episode_media": {}, "episodes_timesteps_total": 91584, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 786.2305275883497, "DC1_ls_policy": 3431.6504463342285, "DC2_ls_policy": -468.56942961233597, "DC3_ls_policy": -1812.8036947281557}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54880.29098029246, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00013824377026417804, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104285.00499178037, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.023986845519754697, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0922580034990041, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111455.20538235028, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.08017725582581221, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.9372487442903368, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.041666666666666664, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90444636.34704496, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 112707780.20569243, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 29.08462714185828, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 907.2280916801582, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 266.9734375, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6231587220699946, "mean_inference_ms": 2.2872500321179823, "mean_action_processing_ms": 0.3345032176843009, "mean_env_wait_ms": 4.525596015346336, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036011723911061008, "StateBufferConnector_ms": 0.0026113846722771138, "ViewRequirementAgentConnector_ms": 0.05613109644721536}, "num_episodes": 1, "episode_return_max": 5927.413344728115, "episode_return_min": -3987.4234727225626, "episode_return_mean": 1936.5078495820892, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600, "num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 523.4483548453558, "num_env_steps_trained_throughput_per_sec": 523.4483548453558, "timesteps_total": 102400, "num_env_steps_sampled_lifetime": 102400, "num_agent_steps_sampled_lifetime": 409600, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 409600, "timers": {"training_iteration_time_ms": 3748.011, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3747.897, "sample_time_ms": 2440.519, "learn_time_ms": 1279.017, "learn_throughput": 1601.23, "synch_weights_time_ms": 10.673}, "counters": {"num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600}, "done": false, "training_iteration": 50, "trial_id": "04bcd_00000", "date": "2024-10-21_22-11-57", "timestamp": 1729548717, "time_this_iter_s": 3.92061448097229, "time_total_s": 187.90846276283264, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52b1c0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe855bd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe857b80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856350>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856fb0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 187.90846276283264, "iterations_since_restore": 50, "perf": {"cpu_util_percent": 20.340000000000003, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.575050047039985, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.77751202583313, "policy_loss": -0.0018329506390728056, "vf_loss": 8.779337739944458, "vf_explained_var": 6.368905305862427e-05, "kl": 0.00924331279066031, "entropy": 2.1971926540136337, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1383285470306874, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.601142084598541, "policy_loss": -0.003172740456648171, "vf_loss": 9.60431479215622, "vf_explained_var": -2.387911081314087e-05, "kl": 0.006270080114360111, "entropy": 0.48149128034710886, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8502265512943268, "cur_kl_coeff": 8.73114913702011e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.581769669055939, "policy_loss": -0.0031171098817139864, "vf_loss": 9.584886610507965, "vf_explained_var": -1.8289685249328615e-05, "kl": 0.008485072326971021, "entropy": 1.361703948676586, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4561867468059062, "cur_kl_coeff": 5.684341886080801e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.892535960674286, "policy_loss": -0.003997855016496033, "vf_loss": 9.896533823013305, "vf_explained_var": 2.7564167976379394e-05, "kl": 0.00400013235328629, "entropy": 1.0349873691797256, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2174.009343039742, "episode_len_mean": 2703.5675675675675, "episode_media": {}, "episodes_timesteps_total": 100032, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 772.83905272872, "DC1_ls_policy": 3476.018633115728, "DC2_ls_policy": -429.7544752756728, "DC3_ls_policy": -1645.0938675290365}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54401.69959695247, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00012703481591843388, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 105141.40965706931, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0220419661532881, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0292450702234857, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111362.03676008928, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.07367639724534096, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7993536273564736, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90977738.97872981, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.726414130356257, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 855.399422158686, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 8.613233024691358, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6210094428853108, "mean_inference_ms": 2.283170385460814, "mean_action_processing_ms": 0.333326412917277, "mean_env_wait_ms": 4.509615627788961, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035493760495572475, "StateBufferConnector_ms": 0.0026114889093347498, "ViewRequirementAgentConnector_ms": 0.055970533474071604}, "num_episodes": 3, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2174.009343039742, "episodes_this_iter": 3}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792, "num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 535.9574395389858, "num_env_steps_trained_throughput_per_sec": 535.9574395389858, "timesteps_total": 104448, "num_env_steps_sampled_lifetime": 104448, "num_agent_steps_sampled_lifetime": 417792, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 417792, "timers": {"training_iteration_time_ms": 3741.055, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3740.941, "sample_time_ms": 2433.642, "learn_time_ms": 1278.876, "learn_throughput": 1601.406, "synch_weights_time_ms": 10.729}, "counters": {"num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792}, "done": false, "training_iteration": 51, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-01", "timestamp": 1729548721, "time_this_iter_s": 3.8290963172912598, "time_total_s": 191.7375590801239, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59b9a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354eb0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355030>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355150>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355240>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 191.7375590801239, "iterations_since_restore": 51, "perf": {"cpu_util_percent": 16.433333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.455171546339988, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.057345533370972, "policy_loss": -0.0008237227099016309, "vf_loss": 9.058165168762207, "vf_explained_var": -1.1648237705230714e-05, "kl": 0.005118946595897784, "entropy": 2.2136221051216127, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8892275393009186, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.543058848381042, "policy_loss": -0.006852241372689605, "vf_loss": 9.549911165237427, "vf_explained_var": -2.1851062774658204e-05, "kl": 0.012579124427066598, "entropy": 0.7115417554974556, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8542883954942226, "cur_kl_coeff": 8.73114913702011e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.352908313274384, "policy_loss": -0.0001527943299151957, "vf_loss": 9.353061163425446, "vf_explained_var": -1.3699382543563843e-05, "kl": 0.0008042282836868253, "entropy": 1.660826626420021, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.178560257330537, "cur_kl_coeff": 2.8421709430404005e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.913348853588104, "policy_loss": -0.002031604270450771, "vf_loss": 9.915380454063415, "vf_explained_var": 7.456988096237183e-05, "kl": 0.001837348815729456, "entropy": 1.099523949623108, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2174.009343039742, "episode_len_mean": 2703.5675675675675, "episode_media": {}, "episodes_timesteps_total": 100032, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 772.83905272872, "DC1_ls_policy": 3476.018633115728, "DC2_ls_policy": -429.7544752756728, "DC3_ls_policy": -1645.0938675290365}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54401.69959695247, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00012703481591843388, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 105141.40965706931, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0220419661532881, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0292450702234857, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111362.03676008928, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.07367639724534096, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7993536273564736, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90977738.97872981, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.726414130356257, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 855.399422158686, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 8.613233024691358, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6210094428853108, "mean_inference_ms": 2.283170385460814, "mean_action_processing_ms": 0.333326412917277, "mean_env_wait_ms": 4.509615627788961, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035493760495572475, "StateBufferConnector_ms": 0.0026114889093347498, "ViewRequirementAgentConnector_ms": 0.055970533474071604}, "num_episodes": 0, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2174.009343039742, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984, "num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 573.9992652218882, "num_env_steps_trained_throughput_per_sec": 573.9992652218882, "timesteps_total": 106496, "num_env_steps_sampled_lifetime": 106496, "num_agent_steps_sampled_lifetime": 425984, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 425984, "timers": {"training_iteration_time_ms": 3702.02, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3701.906, "sample_time_ms": 2395.502, "learn_time_ms": 1278.322, "learn_throughput": 1602.1, "synch_weights_time_ms": 10.723}, "counters": {"num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984}, "done": false, "training_iteration": 52, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-04", "timestamp": 1729548724, "time_this_iter_s": 3.5766046047210693, "time_total_s": 195.31416368484497, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d598dc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355a20>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355c30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355ea0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355ff0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 195.31416368484497, "iterations_since_restore": 52, "perf": {"cpu_util_percent": 5.58, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.150954349339008, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.787027829885483, "policy_loss": -0.0011524867033585906, "vf_loss": 8.788173305988312, "vf_explained_var": 2.9567629098892212e-05, "kl": 0.009009518787821616, "entropy": 2.1691125363111494, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7194199971854687, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.484943413734436, "policy_loss": -0.001971622509881854, "vf_loss": 9.486914992332458, "vf_explained_var": -1.1913478374481201e-05, "kl": 0.0126823967159005, "entropy": 0.46672131195664407, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9924919433891772, "cur_kl_coeff": 4.365574568510055e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.256955480575561, "policy_loss": -0.0018092118087224662, "vf_loss": 9.258764684200287, "vf_explained_var": -3.832578659057617e-06, "kl": 0.005600487994741594, "entropy": 1.4343363657593726, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2573317423462869, "cur_kl_coeff": 1.4210854715202003e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.912211954593658, "policy_loss": -0.0037652434315532447, "vf_loss": 9.915977144241333, "vf_explained_var": -2.536177635192871e-06, "kl": 0.006811963869725446, "entropy": 1.0574597150087357, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2174.009343039742, "episode_len_mean": 2703.5675675675675, "episode_media": {}, "episodes_timesteps_total": 100032, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 772.83905272872, "DC1_ls_policy": 3476.018633115728, "DC2_ls_policy": -429.7544752756728, "DC3_ls_policy": -1645.0938675290365}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54401.69959695247, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00012703481591843388, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 105141.40965706931, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0220419661532881, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0292450702234857, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111362.03676008928, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.07367639724534096, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7993536273564736, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90977738.97872981, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.726414130356257, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 855.399422158686, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 8.613233024691358, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6210094428853108, "mean_inference_ms": 2.283170385460814, "mean_action_processing_ms": 0.333326412917277, "mean_env_wait_ms": 4.509615627788961, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035493760495572475, "StateBufferConnector_ms": 0.0026114889093347498, "ViewRequirementAgentConnector_ms": 0.055970533474071604}, "num_episodes": 0, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2174.009343039742, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176, "num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 574.5689557561144, "num_env_steps_trained_throughput_per_sec": 574.5689557561144, "timesteps_total": 108544, "num_env_steps_sampled_lifetime": 108544, "num_agent_steps_sampled_lifetime": 434176, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 434176, "timers": {"training_iteration_time_ms": 3683.206, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3683.088, "sample_time_ms": 2379.668, "learn_time_ms": 1275.47, "learn_throughput": 1605.682, "synch_weights_time_ms": 10.651}, "counters": {"num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176}, "done": false, "training_iteration": 53, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-08", "timestamp": 1729548728, "time_this_iter_s": 3.573978900909424, "time_total_s": 198.8881425857544, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59bf40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3573a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356fe0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357340>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357580>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 198.8881425857544, "iterations_since_restore": 53, "perf": {"cpu_util_percent": 5.9799999999999995, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.593933561444283, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.105087625980378, "policy_loss": -0.0037033190485090016, "vf_loss": 9.108779990673066, "vf_explained_var": 3.9077550172805783e-05, "kl": 0.01408377924672095, "entropy": 2.0958481192588807, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.2289125069975855, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.579971933364869, "policy_loss": -0.001799716881942004, "vf_loss": 9.581771612167358, "vf_explained_var": -1.3874471187591553e-05, "kl": 0.006549340811762746, "entropy": 0.5828167341649533, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9368223235011102, "cur_kl_coeff": 4.365574568510055e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.532059788703918, "policy_loss": -0.0005984095158055424, "vf_loss": 9.532658100128174, "vf_explained_var": -1.862049102783203e-05, "kl": 0.0017169475255400357, "entropy": 1.3905583679676057, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.370412640273571, "cur_kl_coeff": 1.4210854715202003e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.897118532657624, "policy_loss": -0.0004629331873729825, "vf_loss": 9.89758142232895, "vf_explained_var": 3.304332494735718e-05, "kl": 0.0011904356988907238, "entropy": 1.0897021487355232, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2174.009343039742, "episode_len_mean": 2703.5675675675675, "episode_media": {}, "episodes_timesteps_total": 100032, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 772.83905272872, "DC1_ls_policy": 3476.018633115728, "DC2_ls_policy": -429.7544752756728, "DC3_ls_policy": -1645.0938675290365}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54401.69959695247, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00012703481591843388, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 105141.40965706931, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0220419661532881, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0292450702234857, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111362.03676008928, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.07367639724534096, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7993536273564736, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90977738.97872981, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.726414130356257, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 855.399422158686, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 8.613233024691358, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6210094428853108, "mean_inference_ms": 2.283170385460814, "mean_action_processing_ms": 0.333326412917277, "mean_env_wait_ms": 4.509615627788961, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035493760495572475, "StateBufferConnector_ms": 0.0026114889093347498, "ViewRequirementAgentConnector_ms": 0.055970533474071604}, "num_episodes": 0, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2174.009343039742, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368, "num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 551.3330675275829, "num_env_steps_trained_throughput_per_sec": 551.3330675275829, "timesteps_total": 110592, "num_env_steps_sampled_lifetime": 110592, "num_agent_steps_sampled_lifetime": 442368, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 442368, "timers": {"training_iteration_time_ms": 3686.245, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3686.131, "sample_time_ms": 2382.475, "learn_time_ms": 1275.712, "learn_throughput": 1605.378, "synch_weights_time_ms": 10.674}, "counters": {"num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368}, "done": false, "training_iteration": 54, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-12", "timestamp": 1729548732, "time_this_iter_s": 3.7228586673736572, "time_total_s": 202.61100125312805, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52b9a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350220>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355fc0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3560e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355f60>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 202.61100125312805, "iterations_since_restore": 54, "perf": {"cpu_util_percent": 19.966666666666665, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.920607347786427, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.279186010360718, "policy_loss": -0.0009000999853014946, "vf_loss": 8.280081164836883, "vf_explained_var": -2.8646737337112427e-05, "kl": 0.006526880268576406, "entropy": 2.085964250564575, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.2269157469272614, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.492339551448822, "policy_loss": -0.0006364137749187649, "vf_loss": 9.492975842952728, "vf_explained_var": 2.3789703845977784e-06, "kl": 0.0039927576481666276, "entropy": 0.6960763767361641, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0241383709013463, "cur_kl_coeff": 2.1827872842550277e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.402328991889954, "policy_loss": -0.00026631244691088796, "vf_loss": 9.402595269680024, "vf_explained_var": -7.0229172706604006e-06, "kl": 0.001343758776830265, "entropy": 1.4729582414031028, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2918676536530256, "cur_kl_coeff": 7.105427357601001e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.898575043678283, "policy_loss": -0.0028599775745533408, "vf_loss": 9.901435053348541, "vf_explained_var": -2.6356428861618042e-05, "kl": 0.004299660538390653, "entropy": 1.0505920425057411, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2174.009343039742, "episode_len_mean": 2703.5675675675675, "episode_media": {}, "episodes_timesteps_total": 100032, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 772.83905272872, "DC1_ls_policy": 3476.018633115728, "DC2_ls_policy": -429.7544752756728, "DC3_ls_policy": -1645.0938675290365}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54401.69959695247, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00012703481591843388, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 105141.40965706931, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0220419661532881, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0292450702234857, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111362.03676008928, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.07367639724534096, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7993536273564736, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90977738.97872981, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.726414130356257, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 855.399422158686, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 8.613233024691358, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6210094428853108, "mean_inference_ms": 2.283170385460814, "mean_action_processing_ms": 0.333326412917277, "mean_env_wait_ms": 4.509615627788961, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035493760495572475, "StateBufferConnector_ms": 0.0026114889093347498, "ViewRequirementAgentConnector_ms": 0.055970533474071604}, "num_episodes": 0, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2174.009343039742, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560, "num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 518.3806938352118, "num_env_steps_trained_throughput_per_sec": 518.3806938352118, "timesteps_total": 112640, "num_env_steps_sampled_lifetime": 112640, "num_agent_steps_sampled_lifetime": 450560, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 450560, "timers": {"training_iteration_time_ms": 3733.054, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3732.941, "sample_time_ms": 2428.483, "learn_time_ms": 1275.875, "learn_throughput": 1605.173, "synch_weights_time_ms": 10.552}, "counters": {"num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560}, "done": false, "training_iteration": 55, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-16", "timestamp": 1729548736, "time_this_iter_s": 3.959346294403076, "time_total_s": 206.57034754753113, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeab8670>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355840>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355b40>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355f90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356320>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 206.57034754753113, "iterations_since_restore": 55, "perf": {"cpu_util_percent": 19.779999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.5875939458608626, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.626922243833542, "policy_loss": -0.0032589255657512694, "vf_loss": 8.630174285173416, "vf_explained_var": 0.000137367844581604, "kl": 0.008771692849497099, "entropy": 2.07334009706974, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.844772706925869, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.404077506065368, "policy_loss": -0.0022792257776018234, "vf_loss": 9.406356847286224, "vf_explained_var": -1.728832721710205e-05, "kl": 0.009543562364433456, "entropy": 0.44352786988019943, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9343305196613074, "cur_kl_coeff": 1.0913936421275138e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.549708557128906, "policy_loss": -0.0050629367935471235, "vf_loss": 9.554771554470062, "vf_explained_var": -1.1844933032989502e-05, "kl": 0.016069221250109823, "entropy": 1.3602639004588126, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4259754370898008, "cur_kl_coeff": 3.5527136788005006e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.887846994400025, "policy_loss": -0.0011129188467748463, "vf_loss": 9.888959872722626, "vf_explained_var": -3.0488520860671996e-05, "kl": 0.0016762118146516514, "entropy": 1.009466650336981, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2174.009343039742, "episode_len_mean": 2703.5675675675675, "episode_media": {}, "episodes_timesteps_total": 100032, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1140.5699175979544, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 772.83905272872, "DC1_ls_policy": 3476.018633115728, "DC2_ls_policy": -429.7544752756728, "DC3_ls_policy": -1645.0938675290365}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54401.69959695247, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00012703481591843388, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 105141.40965706931, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0220419661532881, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0292450702234857, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111362.03676008928, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.07367639724534096, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7993536273564736, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90977738.97872981, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 26.726414130356257, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 855.399422158686, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 8.613233024691358, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6210094428853108, "mean_inference_ms": 2.283170385460814, "mean_action_processing_ms": 0.333326412917277, "mean_env_wait_ms": 4.509615627788961, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035493760495572475, "StateBufferConnector_ms": 0.0026114889093347498, "ViewRequirementAgentConnector_ms": 0.055970533474071604}, "num_episodes": 0, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2174.009343039742, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752, "num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 571.6417731304892, "num_env_steps_trained_throughput_per_sec": 571.6417731304892, "timesteps_total": 114688, "num_env_steps_sampled_lifetime": 114688, "num_agent_steps_sampled_lifetime": 458752, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 458752, "timers": {"training_iteration_time_ms": 3723.044, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3722.93, "sample_time_ms": 2418.725, "learn_time_ms": 1275.667, "learn_throughput": 1605.435, "synch_weights_time_ms": 10.589}, "counters": {"num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752}, "done": false, "training_iteration": 56, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-19", "timestamp": 1729548739, "time_this_iter_s": 3.591068983078003, "time_total_s": 210.16141653060913, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeab9360>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3533a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352410>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352650>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353dc0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 210.16141653060913, "iterations_since_restore": 56, "perf": {"cpu_util_percent": 19.21666666666667, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.916663555800914, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.093463271856308, "policy_loss": 0.0006193149136379361, "vf_loss": 8.092840892076492, "vf_explained_var": -5.969852209091187e-05, "kl": 0.0038561737764666757, "entropy": 2.083346924185753, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.097368988394737, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 8.945779418945312, "policy_loss": -0.0011885081185027957, "vf_loss": 8.94696785211563, "vf_explained_var": -4.3052434921264646e-05, "kl": 0.021221896508360823, "entropy": 0.13885877523571252, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6565338760614394, "cur_kl_coeff": 1.0913936421275138e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.460695660114288, "policy_loss": -0.0019422243582084774, "vf_loss": 9.46263791322708, "vf_explained_var": -1.5181303024291992e-05, "kl": 0.014812811160663842, "entropy": 1.1317152477800847, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.472696679458022, "cur_kl_coeff": 1.7763568394002503e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.889054214954376, "policy_loss": -0.0021484518074430525, "vf_loss": 9.891202700138091, "vf_explained_var": 9.826719760894776e-05, "kl": 0.0019083525520274696, "entropy": 1.0186175301671028, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2293.6774318454277, "episode_len_mean": 2688.0, "episode_media": {}, "episodes_timesteps_total": 104832, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 781.0328113218212, "DC1_ls_policy": 3460.3453714378943, "DC2_ls_policy": -366.2762595788561, "DC3_ls_policy": -1581.4244913354348}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54263.78903191272, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0001205202099738988, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104847.7637757833, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.02091160891465794, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9812602802974948, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111520.0201786677, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0698981204635286, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7292478857826374, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90360436.7001018, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.355828790337988, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 820.8764256163602, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 8.613233024691358, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6222014222685374, "mean_inference_ms": 2.285945745373798, "mean_action_processing_ms": 0.3339068232447357, "mean_env_wait_ms": 4.5216392825416865, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036028715280386116, "StateBufferConnector_ms": 0.0026106834411621094, "ViewRequirementAgentConnector_ms": 0.05601170735481458}, "num_episodes": 2, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2293.6774318454277, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944, "num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 541.7483741906586, "num_env_steps_trained_throughput_per_sec": 541.7483741906586, "timesteps_total": 116736, "num_env_steps_sampled_lifetime": 116736, "num_agent_steps_sampled_lifetime": 466944, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 466944, "timers": {"training_iteration_time_ms": 3728.611, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3728.498, "sample_time_ms": 2428.549, "learn_time_ms": 1272.395, "learn_throughput": 1609.563, "synch_weights_time_ms": 10.542}, "counters": {"num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944}, "done": false, "training_iteration": 57, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-23", "timestamp": 1729548743, "time_this_iter_s": 3.7889437675476074, "time_total_s": 213.95036029815674, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c71c0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351c00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353370>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352320>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3526e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 213.95036029815674, "iterations_since_restore": 57, "perf": {"cpu_util_percent": 19.14, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.811846740543842, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.898727440834046, "policy_loss": -0.004902732395567, "vf_loss": 8.903626561164856, "vf_explained_var": 6.0142576694488524e-05, "kl": 0.0095000010068361, "entropy": 2.084282210469246, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.929373343288899, "cur_kl_coeff": 2.7939677238464354e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.315395259857178, "policy_loss": 0.0008248343830928207, "vf_loss": 9.314570486545563, "vf_explained_var": -1.4871358871459961e-05, "kl": 0.006608247396799688, "entropy": 0.2757811446674168, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1073411092162133, "cur_kl_coeff": 1.0913936421275138e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.851289772987366, "policy_loss": -0.0015683781646657735, "vf_loss": 9.852858090400696, "vf_explained_var": -5.273520946502685e-06, "kl": 0.00792326146447602, "entropy": 1.3223840296268463, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5144207034260035, "cur_kl_coeff": 8.881784197001252e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.880017292499542, "policy_loss": -0.003981675230897963, "vf_loss": 9.883998930454254, "vf_explained_var": -6.546378135681152e-05, "kl": 0.008198435372219138, "entropy": 1.0147876001894474, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2293.6774318454277, "episode_len_mean": 2688.0, "episode_media": {}, "episodes_timesteps_total": 104832, "policy_reward_min": {"high_level_policy": -601.0193370609986, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 781.0328113218212, "DC1_ls_policy": 3460.3453714378943, "DC2_ls_policy": -366.2762595788561, "DC3_ls_policy": -1581.4244913354348}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54263.78903191272, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0001205202099738988, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104847.7637757833, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.02091160891465794, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9812602802974948, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111520.0201786677, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 130074.42119106125, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.0698981204635286, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7292478857826374, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90360436.7001018, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 25.355828790337988, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 820.8764256163602, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 8.613233024691358, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6222014222685374, "mean_inference_ms": 2.285945745373798, "mean_action_processing_ms": 0.3339068232447357, "mean_env_wait_ms": 4.5216392825416865, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036028715280386116, "StateBufferConnector_ms": 0.0026106834411621094, "ViewRequirementAgentConnector_ms": 0.05601170735481458}, "num_episodes": 0, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2293.6774318454277, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136, "num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 562.8370105303741, "num_env_steps_trained_throughput_per_sec": 562.8370105303741, "timesteps_total": 118784, "num_env_steps_sampled_lifetime": 118784, "num_agent_steps_sampled_lifetime": 475136, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 475136, "timers": {"training_iteration_time_ms": 3714.789, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3714.676, "sample_time_ms": 2414.482, "learn_time_ms": 1272.726, "learn_throughput": 1609.145, "synch_weights_time_ms": 10.524}, "counters": {"num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136}, "done": false, "training_iteration": 58, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-27", "timestamp": 1729548747, "time_this_iter_s": 3.6481878757476807, "time_total_s": 217.59854817390442, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bfa30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353700>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353b80>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353cd0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356320>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 217.59854817390442, "iterations_since_restore": 58, "perf": {"cpu_util_percent": 19.7, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.88168780207634, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.644520711898803, "policy_loss": -0.004364905739203095, "vf_loss": 8.648881614208221, "vf_explained_var": 7.150918245315551e-05, "kl": 0.010517658078390469, "entropy": 2.0516971170902254, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.73761306554079, "cur_kl_coeff": 2.7939677238464354e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.182331085205078, "policy_loss": 0.00044855736196041106, "vf_loss": 9.18188247680664, "vf_explained_var": -2.090036869049072e-05, "kl": 0.0078542596114874, "entropy": 0.4768380418419838, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.3146080948412417, "cur_kl_coeff": 1.0913936421275138e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.122297251224518, "policy_loss": -0.0017114566871896386, "vf_loss": 9.124008655548096, "vf_explained_var": -4.749000072479248e-06, "kl": 0.009727148200363444, "entropy": 0.9438141793012619, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3986938767135144, "cur_kl_coeff": 8.881784197001252e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.907316160202026, "policy_loss": -0.0015073780785314738, "vf_loss": 9.908823680877685, "vf_explained_var": 4.680231213569641e-05, "kl": 0.003591370607096607, "entropy": 1.0210907869040966, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2312.321957567394, "episode_len_mean": 2690.3414634146343, "episode_media": {}, "episodes_timesteps_total": 110304, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 741.8943606579033, "DC1_ls_policy": 3473.0114745272886, "DC2_ls_policy": -334.78665541453773, "DC3_ls_policy": -1567.7972222032636}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54207.08162494593, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011464117534102569, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104873.5211115671, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.019891530431016092, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9431057662310555, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 112179.47104101171, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 136037.47213748583, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.06648845605067355, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.6735299191538489, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90698697.07740627, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.118959093248332, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 797.6849037235874, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6226822047435377, "mean_inference_ms": 2.285767363173155, "mean_action_processing_ms": 0.33388832539892405, "mean_env_wait_ms": 4.5242061956137345, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035810761335419447, "StateBufferConnector_ms": 0.0026144632479039634, "ViewRequirementAgentConnector_ms": 0.056025894676766747}, "num_episodes": 2, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2312.321957567394, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328, "num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 524.7800453525822, "num_env_steps_trained_throughput_per_sec": 524.7800453525822, "timesteps_total": 120832, "num_env_steps_sampled_lifetime": 120832, "num_agent_steps_sampled_lifetime": 483328, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 483328, "timers": {"training_iteration_time_ms": 3743.601, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3743.488, "sample_time_ms": 2445.548, "learn_time_ms": 1270.331, "learn_throughput": 1612.178, "synch_weights_time_ms": 10.467}, "counters": {"num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328}, "done": false, "training_iteration": 59, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-31", "timestamp": 1729548751, "time_this_iter_s": 3.9127345085144043, "time_total_s": 221.51128268241882, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59b640>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3558d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355c60>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356110>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3566b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 221.51128268241882, "iterations_since_restore": 59, "perf": {"cpu_util_percent": 15.316666666666668, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.464600542187691, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.468741327524185, "policy_loss": -0.0014567201200407, "vf_loss": 8.470194244384766, "vf_explained_var": -2.6636570692062377e-05, "kl": 0.009840713672748616, "entropy": 2.0303524896502494, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7420510396361353, "cur_kl_coeff": 2.7939677238464354e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.535264360904694, "policy_loss": -0.010186847962904722, "vf_loss": 9.54545122385025, "vf_explained_var": -8.371472358703613e-06, "kl": 0.019513921528778157, "entropy": 0.577820573747158, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.076016682386398, "cur_kl_coeff": 1.0913936421275138e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.561698603630067, "policy_loss": -0.0002125734114088118, "vf_loss": 9.561911177635192, "vf_explained_var": -2.0117312669754028e-05, "kl": 0.007470712146370627, "entropy": 0.8693759717047215, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4191202230751514, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.892391765117646, "policy_loss": -0.00208314317278564, "vf_loss": 9.894474864006042, "vf_explained_var": 0.00016133859753608704, "kl": 0.00366763757147055, "entropy": 0.9745347797870636, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2312.321957567394, "episode_len_mean": 2690.3414634146343, "episode_media": {}, "episodes_timesteps_total": 110304, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 741.8943606579033, "DC1_ls_policy": 3473.0114745272886, "DC2_ls_policy": -334.78665541453773, "DC3_ls_policy": -1567.7972222032636}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54207.08162494593, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011464117534102569, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104873.5211115671, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.019891530431016092, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9431057662310555, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 112179.47104101171, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 136037.47213748583, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.06648845605067355, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.6735299191538489, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90698697.07740627, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.118959093248332, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 797.6849037235874, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6226822047435377, "mean_inference_ms": 2.285767363173155, "mean_action_processing_ms": 0.33388832539892405, "mean_env_wait_ms": 4.5242061956137345, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035810761335419447, "StateBufferConnector_ms": 0.0026144632479039634, "ViewRequirementAgentConnector_ms": 0.056025894676766747}, "num_episodes": 0, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2312.321957567394, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520, "num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 572.0543648912845, "num_env_steps_trained_throughput_per_sec": 572.0543648912845, "timesteps_total": 122880, "num_env_steps_sampled_lifetime": 122880, "num_agent_steps_sampled_lifetime": 491520, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 491520, "timers": {"training_iteration_time_ms": 3710.357, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3710.247, "sample_time_ms": 2413.967, "learn_time_ms": 1268.294, "learn_throughput": 1614.768, "synch_weights_time_ms": 10.423}, "counters": {"num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520}, "done": false, "training_iteration": 60, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-35", "timestamp": 1729548755, "time_this_iter_s": 3.5888617038726807, "time_total_s": 225.1001443862915, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59a170>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355d80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355f00>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356080>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3561a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 225.1001443862915, "iterations_since_restore": 60, "perf": {"cpu_util_percent": 5.4799999999999995, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.028900980949402, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.25906399488449, "policy_loss": -0.003632292977999896, "vf_loss": 9.26269336938858, "vf_explained_var": 0.00014108121395111083, "kl": 0.007752192156704041, "entropy": 1.9828206405043602, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.410302905738354, "cur_kl_coeff": 2.7939677238464354e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.557586216926575, "policy_loss": -0.0034456900204531847, "vf_loss": 9.56103196144104, "vf_explained_var": -5.662441253662109e-06, "kl": 0.009906877230241662, "entropy": 0.9884932965040207, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.951447980105877, "cur_kl_coeff": 1.0913936421275138e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.678796088695526, "policy_loss": -0.002042841142974794, "vf_loss": 9.68083896636963, "vf_explained_var": -5.75631856918335e-06, "kl": 0.00843681012447765, "entropy": 0.9295667864382267, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.725432649254799, "cur_kl_coeff": 2.220446049250313e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.823866939544677, "policy_loss": -0.001789284311234951, "vf_loss": 9.82565633058548, "vf_explained_var": 9.021162986755371e-05, "kl": 0.002018907687008209, "entropy": 0.9745639137923717, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2372.8981584678168, "episode_len_mean": 2685.767441860465, "episode_media": {}, "episodes_timesteps_total": 115488, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 719.4897833762376, "DC1_ls_policy": 3474.3897777235366, "DC2_ls_policy": -287.7243560168318, "DC3_ls_policy": -1533.2570466151299}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54162.2516562942, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00010930902765074543, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104602.53115590692, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.018966342969108367, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9015462244195621, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 112900.90558119988, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.06516348336040392, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.6168386768618812, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90792701.659635, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 113858808.81089588, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 24.10189914188277, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 770.4740735224042, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6216644062654089, "mean_inference_ms": 2.2831638983068827, "mean_action_processing_ms": 0.33329001408971237, "mean_env_wait_ms": 4.515626159447737, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035474466723065044, "StateBufferConnector_ms": 0.002613178519315498, "ViewRequirementAgentConnector_ms": 0.05594200866166935}, "num_episodes": 2, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2372.8981584678168, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712, "num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 556.0622178156959, "num_env_steps_trained_throughput_per_sec": 556.0622178156959, "timesteps_total": 124928, "num_env_steps_sampled_lifetime": 124928, "num_agent_steps_sampled_lifetime": 499712, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 499712, "timers": {"training_iteration_time_ms": 3696.541, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3696.431, "sample_time_ms": 2402.015, "learn_time_ms": 1266.437, "learn_throughput": 1617.135, "synch_weights_time_ms": 10.345}, "counters": {"num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712}, "done": false, "training_iteration": 61, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-38", "timestamp": 1729548758, "time_this_iter_s": 3.6913399696350098, "time_total_s": 228.7914843559265, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeabac20>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357670>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3567d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3553c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355de0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 228.7914843559265, "iterations_since_restore": 61, "perf": {"cpu_util_percent": 10.299999999999999, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.552315807342529, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.79090769290924, "policy_loss": -0.0001229260757099837, "vf_loss": 8.791028690338134, "vf_explained_var": -4.1008740663528445e-05, "kl": 0.005122344090980365, "entropy": 1.9901294767856599, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.344248352944851, "cur_kl_coeff": 2.7939677238464354e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.533145999908447, "policy_loss": -0.0033094909798819573, "vf_loss": 9.5364555478096, "vf_explained_var": -2.218484878540039e-05, "kl": 0.01924763960510235, "entropy": 0.7719331838190555, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.687066552788019, "cur_kl_coeff": 1.0913936421275138e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.796313869953156, "policy_loss": 0.00031575873726978897, "vf_loss": 9.795998108386993, "vf_explained_var": -3.1404197216033936e-06, "kl": 0.004858960933849674, "entropy": 0.5347630091011524, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6369234904646874, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.889858150482178, "policy_loss": -0.00014048812445253134, "vf_loss": 9.88999855518341, "vf_explained_var": -1.400485634803772e-05, "kl": 0.0016275377288880108, "entropy": 0.980367685854435, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2390.556159501131, "episode_len_mean": 2696.7272727272725, "episode_media": {}, "episodes_timesteps_total": 118656, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 691.3737482374897, "DC1_ls_policy": 3490.8864297702344, "DC2_ls_policy": -276.9374739054807, "DC3_ls_policy": -1514.766544601117}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54214.651597466065, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00010682473156777395, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104702.59798087021, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.018535289719810447, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8899666614678778, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 113237.16045838814, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.06368249510221292, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.585709595362954, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91403428.4569311, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.554128706839982, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 760.903214972997, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6219670079736792, "mean_inference_ms": 2.2835096097047916, "mean_action_processing_ms": 0.33335029860017623, "mean_env_wait_ms": 4.518802584417279, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035350972955877132, "StateBufferConnector_ms": 0.002609464255246249, "ViewRequirementAgentConnector_ms": 0.05591227249665694}, "num_episodes": 1, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2390.556159501131, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904, "num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 532.7132185078508, "num_env_steps_trained_throughput_per_sec": 532.7132185078508, "timesteps_total": 126976, "num_env_steps_sampled_lifetime": 126976, "num_agent_steps_sampled_lifetime": 507904, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 507904, "timers": {"training_iteration_time_ms": 3724.193, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3724.082, "sample_time_ms": 2430.726, "learn_time_ms": 1264.907, "learn_throughput": 1619.091, "synch_weights_time_ms": 10.535}, "counters": {"num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904}, "done": false, "training_iteration": 62, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-42", "timestamp": 1729548762, "time_this_iter_s": 3.854854106903076, "time_total_s": 232.6463384628296, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370bd090>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357730>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355660>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3556c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356260>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 232.6463384628296, "iterations_since_restore": 62, "perf": {"cpu_util_percent": 19.479999999999997, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.142533761262894, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.933850049972534, "policy_loss": -0.002617729641497135, "vf_loss": 8.936462473869323, "vf_explained_var": 5.9483200311660765e-05, "kl": 0.01349455920417442, "entropy": 1.7998823657631875, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.564588896930218, "cur_kl_coeff": 2.7939677238464354e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.441729426383972, "policy_loss": 0.0006656176876276732, "vf_loss": 9.441063749790192, "vf_explained_var": -4.190206527709961e-06, "kl": 0.00866264260839671, "entropy": 1.0648209191858768, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0949157156050204, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.652357006072998, "policy_loss": -0.002496103447629139, "vf_loss": 9.654853057861327, "vf_explained_var": -6.827712059020996e-06, "kl": 0.007864254510788107, "entropy": 0.8080458387732505, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4719330348074435, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.857186877727509, "policy_loss": -0.002764973684679717, "vf_loss": 9.85995203256607, "vf_explained_var": 6.142333149909973e-05, "kl": 0.007318508025397819, "entropy": 0.940334328263998, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096}, "env_runners": {"episode_reward_max": 6056.443625741988, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2390.556159501131, "episode_len_mean": 2696.7272727272725, "episode_media": {}, "episodes_timesteps_total": 118656, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 691.3737482374897, "DC1_ls_policy": 3490.8864297702344, "DC2_ls_policy": -276.9374739054807, "DC3_ls_policy": -1514.766544601117}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54214.651597466065, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00010682473156777395, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104702.59798087021, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.018535289719810447, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8899666614678778, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 113237.16045838814, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.06368249510221292, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.585709595362954, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91403428.4569311, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.554128706839982, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 760.903214972997, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6219670079736792, "mean_inference_ms": 2.2835096097047916, "mean_action_processing_ms": 0.33335029860017623, "mean_env_wait_ms": 4.518802584417279, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035350972955877132, "StateBufferConnector_ms": 0.002609464255246249, "ViewRequirementAgentConnector_ms": 0.05591227249665694}, "num_episodes": 0, "episode_return_max": 6056.443625741988, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2390.556159501131, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096, "num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 567.5955696813115, "num_env_steps_trained_throughput_per_sec": 567.5955696813115, "timesteps_total": 129024, "num_env_steps_sampled_lifetime": 129024, "num_agent_steps_sampled_lifetime": 516096, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 516096, "timers": {"training_iteration_time_ms": 3728.575, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3728.458, "sample_time_ms": 2435.11, "learn_time_ms": 1264.681, "learn_throughput": 1619.38, "synch_weights_time_ms": 10.398}, "counters": {"num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096}, "done": false, "training_iteration": 63, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-46", "timestamp": 1729548766, "time_this_iter_s": 3.6197009086608887, "time_total_s": 236.26603937149048, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7eb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356740>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3569b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3547c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354e80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 236.26603937149048, "iterations_since_restore": 63, "perf": {"cpu_util_percent": 19.566666666666666, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.097560532391071, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.001666915416717, "policy_loss": -0.0020340647373814137, "vf_loss": 9.003697633743286, "vf_explained_var": 5.663931369781494e-05, "kl": 0.00854798493655835, "entropy": 1.8078149646520614, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.9221003785729405, "cur_kl_coeff": 2.7939677238464354e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.317787766456604, "policy_loss": -0.00488369410741143, "vf_loss": 9.322671449184417, "vf_explained_var": -5.316734313964844e-06, "kl": 0.02293084614866736, "entropy": 1.4242541782557965, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4552096515893935, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.528200125694275, "policy_loss": 0.0016537423187401145, "vf_loss": 9.526546359062195, "vf_explained_var": -3.0368566513061523e-05, "kl": 0.005317423053567676, "entropy": 0.7038788419216871, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8225481953471898, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.849459075927735, "policy_loss": -0.0026328356703743338, "vf_loss": 9.852091872692109, "vf_explained_var": -1.4487653970718384e-05, "kl": 0.0044758100935612475, "entropy": 0.945755410939455, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2491.9416204228755, "episode_len_mean": 2709.3333333333335, "episode_media": {}, "episodes_timesteps_total": 121920, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 713.3379104821304, "DC1_ls_policy": 3509.0150438629908, "DC2_ls_policy": -259.2123231015225, "DC3_ls_policy": -1471.199010820727}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54177.13920250728, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011806740637825043, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104616.89497522317, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.01812339439270355, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.874022685548548, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 113074.01933106517, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.062267328544385964, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.5504716043548885, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91724744.45413297, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.03070362446576, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 746.3108174806778, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6212541330903955, "mean_inference_ms": 2.282745432368619, "mean_action_processing_ms": 0.3330067034956385, "mean_env_wait_ms": 4.514621551687694, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003522634506225586, "StateBufferConnector_ms": 0.002609093983968099, "ViewRequirementAgentConnector_ms": 0.05587975184122721}, "num_episodes": 1, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2491.9416204228755, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288, "num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 537.4166922395125, "num_env_steps_trained_throughput_per_sec": 537.4166922395125, "timesteps_total": 131072, "num_env_steps_sampled_lifetime": 131072, "num_agent_steps_sampled_lifetime": 524288, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 524288, "timers": {"training_iteration_time_ms": 3738.195, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3738.077, "sample_time_ms": 2446.752, "learn_time_ms": 1262.504, "learn_throughput": 1622.173, "synch_weights_time_ms": 10.387}, "counters": {"num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288}, "done": false, "training_iteration": 64, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-50", "timestamp": 1729548770, "time_this_iter_s": 3.82063627243042, "time_total_s": 240.0866756439209, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59bf40>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe857ee0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351c60>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352920>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351360>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 240.0866756439209, "iterations_since_restore": 64, "perf": {"cpu_util_percent": 20.52, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.154106402397156, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.36568391919136, "policy_loss": -0.007124856021255255, "vf_loss": 8.372803807258606, "vf_explained_var": -0.00010006725788116455, "kl": 0.012303513679671595, "entropy": 1.7931653350591659, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.149468313157558, "cur_kl_coeff": 4.190951585769654e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.467155945301055, "policy_loss": -0.002356424613390118, "vf_loss": 9.46951241493225, "vf_explained_var": -4.774332046508789e-06, "kl": 0.010245406489957531, "entropy": 0.791260214522481, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.609036372601986, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.449522137641907, "policy_loss": 0.0007774127065204084, "vf_loss": 9.44874472618103, "vf_explained_var": -1.662224531173706e-05, "kl": 0.005370551833404548, "entropy": 0.31362649500370027, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.565049210563302, "cur_kl_coeff": 2.775557561562891e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.869599092006684, "policy_loss": -0.0010596667882055045, "vf_loss": 9.870658767223357, "vf_explained_var": 4.191398620605469e-05, "kl": 0.0015272793923273298, "entropy": 0.9236923225224019, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2491.9416204228755, "episode_len_mean": 2709.3333333333335, "episode_media": {}, "episodes_timesteps_total": 121920, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 713.3379104821304, "DC1_ls_policy": 3509.0150438629908, "DC2_ls_policy": -259.2123231015225, "DC3_ls_policy": -1471.199010820727}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54177.13920250728, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011806740637825043, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104616.89497522317, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.01812339439270355, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.874022685548548, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 113074.01933106517, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.062267328544385964, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.5504716043548885, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91724744.45413297, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 23.03070362446576, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 746.3108174806778, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6212541330903955, "mean_inference_ms": 2.282745432368619, "mean_action_processing_ms": 0.3330067034956385, "mean_env_wait_ms": 4.514621551687694, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003522634506225586, "StateBufferConnector_ms": 0.002609093983968099, "ViewRequirementAgentConnector_ms": 0.05587975184122721}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2491.9416204228755, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480, "num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 553.2720748060458, "num_env_steps_trained_throughput_per_sec": 553.2720748060458, "timesteps_total": 133120, "num_env_steps_sampled_lifetime": 133120, "num_agent_steps_sampled_lifetime": 532480, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 532480, "timers": {"training_iteration_time_ms": 3713.279, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3713.164, "sample_time_ms": 2424.888, "learn_time_ms": 1260.26, "learn_throughput": 1625.062, "synch_weights_time_ms": 10.468}, "counters": {"num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480}, "done": false, "training_iteration": 65, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-54", "timestamp": 1729548774, "time_this_iter_s": 3.7099623680114746, "time_total_s": 243.79663801193237, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeabbd90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356f80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3558a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356110>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356590>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 243.79663801193237, "iterations_since_restore": 65, "perf": {"cpu_util_percent": 20.34, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.522579416632652, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.220943427085876, "policy_loss": -0.0025712774251587687, "vf_loss": 8.22351023554802, "vf_explained_var": 5.8465451002120974e-05, "kl": 0.011406719443948532, "entropy": 1.7465401858091354, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.238104082643986, "cur_kl_coeff": 4.190951585769654e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.498655700683594, "policy_loss": 0.002220713917631656, "vf_loss": 9.496435070037842, "vf_explained_var": -3.2231211662292482e-06, "kl": 0.00946653981318629, "entropy": 1.3051071420311928, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.050948758423329, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.294395852088929, "policy_loss": 0.00020891783060505986, "vf_loss": 9.294186890125275, "vf_explained_var": -2.4570524692535402e-05, "kl": 0.005680762292831787, "entropy": 0.32397176465019584, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.86479433439672, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.803359043598174, "policy_loss": -0.007009232917334884, "vf_loss": 9.810368406772614, "vf_explained_var": -1.2002140283584595e-05, "kl": 0.01495043299499369, "entropy": 0.8163186401128769, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2568.122559675161, "episode_len_mean": 2696.1702127659573, "episode_media": {}, "episodes_timesteps_total": 126720, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 725.8454218665537, "DC1_ls_policy": 3494.163166675365, "DC2_ls_policy": -255.00401264242254, "DC3_ls_policy": -1396.8820162243383}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54031.29147332011, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011304326142598447, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104796.39551515879, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.017352186120673612, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.856227393964922, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 112706.20783553101, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.06091198123044047, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.4989089828929782, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91122709.33476266, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 22.80457660853105, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 723.9725136339822, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6223123346633768, "mean_inference_ms": 2.285182485360123, "mean_action_processing_ms": 0.33351793564803583, "mean_env_wait_ms": 4.524923466556316, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036008814547924283, "StateBufferConnector_ms": 0.0026198143654681265, "ViewRequirementAgentConnector_ms": 0.05612880625623338}, "num_episodes": 2, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2568.122559675161, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672, "num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 526.3908969346352, "num_env_steps_trained_throughput_per_sec": 526.3908969346352, "timesteps_total": 135168, "num_env_steps_sampled_lifetime": 135168, "num_agent_steps_sampled_lifetime": 540672, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 540672, "timers": {"training_iteration_time_ms": 3744.077, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3743.962, "sample_time_ms": 2455.354, "learn_time_ms": 1260.585, "learn_throughput": 1624.642, "synch_weights_time_ms": 10.558}, "counters": {"num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672}, "done": false, "training_iteration": 66, "trial_id": "04bcd_00000", "date": "2024-10-21_22-12-58", "timestamp": 1729548778, "time_this_iter_s": 3.9017038345336914, "time_total_s": 247.69834184646606, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeab9e10>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356770>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3564a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354f10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3555d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 247.69834184646606, "iterations_since_restore": 66, "perf": {"cpu_util_percent": 19.716666666666665, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.4751094549894335, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.515722024440766, "policy_loss": -0.002345423633232713, "vf_loss": 9.518063497543334, "vf_explained_var": -3.511905670166016e-05, "kl": 0.010232896740036431, "entropy": 1.6903081029653548, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7006253972649574, "cur_kl_coeff": 4.190951585769654e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.63622053861618, "policy_loss": -0.002939572965260595, "vf_loss": 9.639159953594207, "vf_explained_var": -3.1784176826477052e-06, "kl": 0.0037582134893482597, "entropy": 2.3252366572618484, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5624160513281824, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.62130377292633, "policy_loss": 0.0003393518622033298, "vf_loss": 9.62096436023712, "vf_explained_var": -7.82310962677002e-06, "kl": 0.005887025412086185, "entropy": 0.49376381412148473, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6990169622004032, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.893763267993927, "policy_loss": -0.0007312453701160849, "vf_loss": 9.894494557380677, "vf_explained_var": -1.6461312770843507e-05, "kl": 0.004995727129815746, "entropy": 0.7907465875148774, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2568.122559675161, "episode_len_mean": 2696.1702127659573, "episode_media": {}, "episodes_timesteps_total": 126720, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 725.8454218665537, "DC1_ls_policy": 3494.163166675365, "DC2_ls_policy": -255.00401264242254, "DC3_ls_policy": -1396.8820162243383}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54031.29147332011, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011304326142598447, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104796.39551515879, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.017352186120673612, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.856227393964922, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 112706.20783553101, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.06091198123044047, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.4989089828929782, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91122709.33476266, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 22.80457660853105, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 723.9725136339822, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6223123346633768, "mean_inference_ms": 2.285182485360123, "mean_action_processing_ms": 0.33351793564803583, "mean_env_wait_ms": 4.524923466556316, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036008814547924283, "StateBufferConnector_ms": 0.0026198143654681265, "ViewRequirementAgentConnector_ms": 0.05612880625623338}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2568.122559675161, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864, "num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 582.2664022610275, "num_env_steps_trained_throughput_per_sec": 582.2664022610275, "timesteps_total": 137216, "num_env_steps_sampled_lifetime": 137216, "num_agent_steps_sampled_lifetime": 548864, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 548864, "timers": {"training_iteration_time_ms": 3717.771, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3717.653, "sample_time_ms": 2428.807, "learn_time_ms": 1260.847, "learn_throughput": 1624.305, "synch_weights_time_ms": 10.539}, "counters": {"num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864}, "done": false, "training_iteration": 67, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-01", "timestamp": 1729548781, "time_this_iter_s": 3.5264065265655518, "time_total_s": 251.22474837303162, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeabb520>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3533a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3534f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3535e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353850>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 251.22474837303162, "iterations_since_restore": 67, "perf": {"cpu_util_percent": 13.8, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.187487462162972, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.849549514055252, "policy_loss": -0.0068871526629664, "vf_loss": 7.856431859731674, "vf_explained_var": -2.144649624824524e-05, "kl": 0.012373241410161188, "entropy": 1.748940248787403, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.508333823084831, "cur_kl_coeff": 2.095475792884827e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.448967039585114, "policy_loss": -0.0007508304610382765, "vf_loss": 9.449717819690704, "vf_explained_var": -8.001923561096192e-07, "kl": 0.005137464842120932, "entropy": 1.1777661457657813, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.2175198420882225, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.585168159008026, "policy_loss": 0.00011237371363677084, "vf_loss": 9.585055935382844, "vf_explained_var": -1.0666996240615845e-05, "kl": 0.005102924856239073, "entropy": 0.006461778387892992, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6552203096449376, "cur_kl_coeff": 6.938893903907228e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 9.900242519378661, "policy_loss": -0.0019114790833555163, "vf_loss": 9.902154016494752, "vf_explained_var": -9.197071194648743e-05, "kl": 0.003830812748856665, "entropy": 0.765673304349184, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2568.122559675161, "episode_len_mean": 2696.1702127659573, "episode_media": {}, "episodes_timesteps_total": 126720, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 715.6501301634562}, "policy_reward_mean": {"high_level_policy": 725.8454218665537, "DC1_ls_policy": 3494.163166675365, "DC2_ls_policy": -255.00401264242254, "DC3_ls_policy": -1396.8820162243383}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54031.29147332011, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011304326142598447, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 104796.39551515879, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.017352186120673612, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.856227393964922, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 112706.20783553101, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.06091198123044047, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.4989089828929782, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91122709.33476266, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 22.80457660853105, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 723.9725136339822, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6223123346633768, "mean_inference_ms": 2.285182485360123, "mean_action_processing_ms": 0.33351793564803583, "mean_env_wait_ms": 4.524923466556316, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0036008814547924283, "StateBufferConnector_ms": 0.0026198143654681265, "ViewRequirementAgentConnector_ms": 0.05612880625623338}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2568.122559675161, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056, "num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 569.1589054069912, "num_env_steps_trained_throughput_per_sec": 569.1589054069912, "timesteps_total": 139264, "num_env_steps_sampled_lifetime": 139264, "num_agent_steps_sampled_lifetime": 557056, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 557056, "timers": {"training_iteration_time_ms": 3713.729, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3713.612, "sample_time_ms": 2424.701, "learn_time_ms": 1260.711, "learn_throughput": 1624.48, "synch_weights_time_ms": 10.532}, "counters": {"num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056}, "done": false, "training_iteration": 68, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-05", "timestamp": 1729548785, "time_this_iter_s": 3.6063649654388428, "time_total_s": 254.83111333847046, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59a170>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353df0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353010>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352080>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353a00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 254.83111333847046, "iterations_since_restore": 68, "perf": {"cpu_util_percent": 5.66, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.205251576006413, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.265789449214935, "policy_loss": 0.00017051119357347488, "vf_loss": 9.265616846084594, "vf_explained_var": 2.8717517852783204e-05, "kl": 0.005199150963291464, "entropy": 1.833197610080242, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.297358863428235, "cur_kl_coeff": 2.095475792884827e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.916290092468262, "policy_loss": -0.0006928629649337381, "vf_loss": 9.916982960700988, "vf_explained_var": -1.6629695892333984e-06, "kl": 0.013448019671707548, "entropy": 2.3026009619235994, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.430152803659439, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.180922424793243, "policy_loss": -0.002463471388909966, "vf_loss": 9.18338589668274, "vf_explained_var": -2.0825862884521483e-05, "kl": 0.00959875632152164, "entropy": 0.408462873287499, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8977269608527423, "cur_kl_coeff": 3.469446951953614e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 9.87348839044571, "policy_loss": -0.00023850759607739745, "vf_loss": 9.873726868629456, "vf_explained_var": -9.438395500183105e-06, "kl": 0.003338735497357294, "entropy": 0.7292215883731842, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2581.2675818413377, "episode_len_mean": 2692.0, "episode_media": {}, "episodes_timesteps_total": 129216, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 835.101722443578}, "policy_reward_mean": {"high_level_policy": 723.2299554234469, "DC1_ls_policy": 3490.0006962595726, "DC2_ls_policy": -281.5807148395945, "DC3_ls_policy": -1350.38235500209}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54069.8357058868, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011068819347960978, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 105134.32452518727, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.01699068224315958, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8642473627872341, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 112359.75134381559, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05964298162147295, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.4701690254502295, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90958257.38869214, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 22.329481262519987, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 715.6616984627881, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6219973008401403, "mean_inference_ms": 2.2839839350303777, "mean_action_processing_ms": 0.33318225907001625, "mean_env_wait_ms": 4.520849681222467, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035919249057769775, "StateBufferConnector_ms": 0.002618382374445597, "ViewRequirementAgentConnector_ms": 0.056087225675582886}, "num_episodes": 1, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2581.2675818413377, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248, "num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 588.2930968381642, "num_env_steps_trained_throughput_per_sec": 588.2930968381642, "timesteps_total": 141312, "num_env_steps_sampled_lifetime": 141312, "num_agent_steps_sampled_lifetime": 565248, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 565248, "timers": {"training_iteration_time_ms": 3671.596, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3671.479, "sample_time_ms": 2382.823, "learn_time_ms": 1260.672, "learn_throughput": 1624.531, "synch_weights_time_ms": 10.594}, "counters": {"num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248}, "done": false, "training_iteration": 69, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-09", "timestamp": 1729548789, "time_this_iter_s": 3.4916796684265137, "time_total_s": 258.322793006897, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d598d30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351ed0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351990>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3524d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350760>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 258.322793006897, "iterations_since_restore": 69, "perf": {"cpu_util_percent": 12.440000000000001, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.89364458322525, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.128140890598297, "policy_loss": -0.004082051548175513, "vf_loss": 9.132218074798583, "vf_explained_var": -1.040250062942505e-05, "kl": 0.012317779641674976, "entropy": 1.9021427914500237, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.995351929962635, "cur_kl_coeff": 2.095475792884827e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.720535492897033, "policy_loss": -0.0016163858701474965, "vf_loss": 9.722151839733124, "vf_explained_var": -8.627772331237793e-07, "kl": 0.007560786696834171, "entropy": 2.2785899475216866, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.84433559179306, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.77933132648468, "policy_loss": -0.0025260099209845066, "vf_loss": 9.781857419013978, "vf_explained_var": -1.6454607248306274e-05, "kl": 0.013585713692236823, "entropy": 0.04918482224456966, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.825492463633418, "cur_kl_coeff": 1.734723475976807e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 9.847836506366729, "policy_loss": -0.0013905981089919806, "vf_loss": 9.849227166175842, "vf_explained_var": 0.00025068074464797976, "kl": 0.0016784084445134796, "entropy": 0.7884214781224728, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2620.204917702802, "episode_len_mean": 2697.795918367347, "episode_media": {}, "episodes_timesteps_total": 132192, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 1201.2015386646758}, "policy_reward_mean": {"high_level_policy": 729.6095998315649, "DC1_ls_policy": 3499.8225146212344, "DC2_ls_policy": -310.91798243498613, "DC3_ls_policy": -1298.3092143150132}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54044.323562276084, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00010842925075553611, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 105344.8987264043, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 131521.60866057628, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.01664393362595224, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8698637211942535, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 112093.72985965443, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.058425777914912276, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.4421885625652455, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91119178.95909467, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 21.873777563284886, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 707.129817807853, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6226821678359469, "mean_inference_ms": 2.285166367128248, "mean_action_processing_ms": 0.3335057853761598, "mean_env_wait_ms": 4.526765561293464, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00357348091748296, "StateBufferConnector_ms": 0.002615670768582091, "ViewRequirementAgentConnector_ms": 0.05602204069799306}, "num_episodes": 1, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2620.204917702802, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440, "num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 550.3194819192727, "num_env_steps_trained_throughput_per_sec": 550.3194819192727, "timesteps_total": 143360, "num_env_steps_sampled_lifetime": 143360, "num_agent_steps_sampled_lifetime": 573440, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 573440, "timers": {"training_iteration_time_ms": 3685.736, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3685.618, "sample_time_ms": 2397.626, "learn_time_ms": 1260.205, "learn_throughput": 1625.132, "synch_weights_time_ms": 10.609}, "counters": {"num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440}, "done": false, "training_iteration": 70, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-12", "timestamp": 1729548792, "time_this_iter_s": 3.731590747833252, "time_total_s": 262.0543837547302, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7250>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350c70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350460>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350520>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350670>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 262.0543837547302, "iterations_since_restore": 70, "perf": {"cpu_util_percent": 19.73333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.717153638601303, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.344214534759521, "policy_loss": 0.0006716426578350365, "vf_loss": 8.343540889024734, "vf_explained_var": -1.3674795627593995e-05, "kl": 0.0054572895031052135, "entropy": 1.9236461371183395, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.096557612717152, "cur_kl_coeff": 2.095475792884827e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.485712659358978, "policy_loss": 0.0027425180072896183, "vf_loss": 9.482969999313354, "vf_explained_var": -2.0116567611694336e-06, "kl": 0.017116020461257386, "entropy": 0.6845377765595912, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.5939085021615025, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.439673495292663, "policy_loss": -0.0016273574263323098, "vf_loss": 9.441300761699676, "vf_explained_var": -1.4448165893554688e-05, "kl": 0.010700648830018044, "entropy": -0.031370233290363106, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1366412587463857, "cur_kl_coeff": 8.673617379884035e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.828946232795715, "policy_loss": -0.001066827110480517, "vf_loss": 9.830013155937195, "vf_explained_var": 4.5038014650344846e-05, "kl": 0.0010869286708366885, "entropy": 0.7788376286625862, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2678.7620026552045, "episode_len_mean": 2693.6470588235293, "episode_media": {}, "episodes_timesteps_total": 137376, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 1521.1393376086157}, "policy_reward_mean": {"high_level_policy": 718.6906762436116, "DC1_ls_policy": 3491.8106926502587, "DC2_ls_policy": -334.33898340000917, "DC3_ls_policy": -1197.4003828386597}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54148.75014028445, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011930663186848773, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 106154.10729438158, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 134167.09467014074, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.015991230346503134, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.859935937889129, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111368.87067007429, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05613457093785689, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.3894220902496877, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91000213.07961576, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 21.015982364724692, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 685.9907286381914, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6218308602376579, "mean_inference_ms": 2.2829651723702087, "mean_action_processing_ms": 0.3330165401879224, "mean_env_wait_ms": 4.519626657739965, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035508006226782707, "StateBufferConnector_ms": 0.002615475187114641, "ViewRequirementAgentConnector_ms": 0.05599213581459195}, "num_episodes": 2, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2678.7620026552045, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632, "num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 529.4814359867788, "num_env_steps_trained_throughput_per_sec": 529.4814359867788, "timesteps_total": 145408, "num_env_steps_sampled_lifetime": 145408, "num_agent_steps_sampled_lifetime": 581632, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 581632, "timers": {"training_iteration_time_ms": 3704.225, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3704.108, "sample_time_ms": 2416.382, "learn_time_ms": 1260.057, "learn_throughput": 1625.324, "synch_weights_time_ms": 10.618}, "counters": {"num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632}, "done": false, "training_iteration": 71, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-16", "timestamp": 1729548796, "time_this_iter_s": 3.8776254653930664, "time_total_s": 265.9320092201233, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d5e6fdf30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350f70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352290>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3508e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350eb0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 265.9320092201233, "iterations_since_restore": 71, "perf": {"cpu_util_percent": 19.38333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.762184903025627, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.960814940929414, "policy_loss": -0.001746406638994813, "vf_loss": 8.962557923793792, "vf_explained_var": 4.8922747373580934e-05, "kl": 0.009171873865854824, "entropy": 1.8993042662739754, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.396691797673702, "cur_kl_coeff": 2.095475792884827e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.543582653999328, "policy_loss": 0.005841744435019791, "vf_loss": 9.537740933895112, "vf_explained_var": -1.7687678337097168e-06, "kl": 0.02249574093875708, "entropy": 1.588269266486168, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.226018323004245, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.347000300884247, "policy_loss": 0.0010856763110496104, "vf_loss": 9.34591453075409, "vf_explained_var": 9.305775165557862e-07, "kl": 0.008594751000305222, "entropy": 0.514249924570322, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6793374724686145, "cur_kl_coeff": 4.3368086899420174e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.876824450492858, "policy_loss": -0.0021545407129451633, "vf_loss": 9.87897902727127, "vf_explained_var": 4.409998655319214e-06, "kl": 0.00460490378885684, "entropy": 0.747649009525776, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2678.7620026552045, "episode_len_mean": 2693.6470588235293, "episode_media": {}, "episodes_timesteps_total": 137376, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 1521.1393376086157}, "policy_reward_mean": {"high_level_policy": 718.6906762436116, "DC1_ls_policy": 3491.8106926502587, "DC2_ls_policy": -334.33898340000917, "DC3_ls_policy": -1197.4003828386597}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54148.75014028445, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011930663186848773, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 106154.10729438158, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 134167.09467014074, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.015991230346503134, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.859935937889129, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111368.87067007429, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05613457093785689, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.3894220902496877, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91000213.07961576, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 21.015982364724692, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 685.9907286381914, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6218308602376579, "mean_inference_ms": 2.2829651723702087, "mean_action_processing_ms": 0.3330165401879224, "mean_env_wait_ms": 4.519626657739965, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035508006226782707, "StateBufferConnector_ms": 0.002615475187114641, "ViewRequirementAgentConnector_ms": 0.05599213581459195}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2678.7620026552045, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824, "num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 564.5131449102477, "num_env_steps_trained_throughput_per_sec": 564.5131449102477, "timesteps_total": 147456, "num_env_steps_sampled_lifetime": 147456, "num_agent_steps_sampled_lifetime": 589824, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 589824, "timers": {"training_iteration_time_ms": 3682.569, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3682.453, "sample_time_ms": 2395.395, "learn_time_ms": 1259.688, "learn_throughput": 1625.8, "synch_weights_time_ms": 10.415}, "counters": {"num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824}, "done": false, "training_iteration": 72, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-20", "timestamp": 1729548800, "time_this_iter_s": 3.6370015144348145, "time_total_s": 269.5690107345581, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59a440>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355810>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354190>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354310>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3543a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 269.5690107345581, "iterations_since_restore": 72, "perf": {"cpu_util_percent": 20.3, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.82495501935482, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.613554531335831, "policy_loss": -0.0012729791516903788, "vf_loss": 7.614825171232224, "vf_explained_var": -3.728717565536499e-05, "kl": 0.005810408947402248, "entropy": 1.9212489068508147, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 10.613710042834281, "cur_kl_coeff": 3.1432136893272397e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.568589568138123, "policy_loss": 0.006042280734982341, "vf_loss": 9.56254721879959, "vf_explained_var": -2.442300319671631e-06, "kl": 0.012797771405170546, "entropy": 0.7914726734161377, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.368052390217781, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.460771465301514, "policy_loss": 0.00019687301246449352, "vf_loss": 9.46057460308075, "vf_explained_var": 4.246830940246582e-08, "kl": 0.007856603632876612, "entropy": -0.13046153597533702, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7761002283543348, "cur_kl_coeff": 2.1684043449710087e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.881003558635712, "policy_loss": -0.00032664273167029025, "vf_loss": 9.881330263614654, "vf_explained_var": 7.345303893089295e-05, "kl": 0.0005211434531934373, "entropy": 0.7679286181926728, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2678.7620026552045, "episode_len_mean": 2693.6470588235293, "episode_media": {}, "episodes_timesteps_total": 137376, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 1521.1393376086157}, "policy_reward_mean": {"high_level_policy": 718.6906762436116, "DC1_ls_policy": 3491.8106926502587, "DC2_ls_policy": -334.33898340000917, "DC3_ls_policy": -1197.4003828386597}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54148.75014028445, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011930663186848773, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 106154.10729438158, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 134167.09467014074, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.015991230346503134, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.859935937889129, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111368.87067007429, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05613457093785689, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.3894220902496877, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91000213.07961576, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 21.015982364724692, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 685.9907286381914, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6218308602376579, "mean_inference_ms": 2.2829651723702087, "mean_action_processing_ms": 0.3330165401879224, "mean_env_wait_ms": 4.519626657739965, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035508006226782707, "StateBufferConnector_ms": 0.002615475187114641, "ViewRequirementAgentConnector_ms": 0.05599213581459195}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2678.7620026552045, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016, "num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 525.2695461685483, "num_env_steps_trained_throughput_per_sec": 525.2695461685483, "timesteps_total": 149504, "num_env_steps_sampled_lifetime": 149504, "num_agent_steps_sampled_lifetime": 598016, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 598016, "timers": {"training_iteration_time_ms": 3711.64, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3711.528, "sample_time_ms": 2424.924, "learn_time_ms": 1259.461, "learn_throughput": 1626.093, "synch_weights_time_ms": 10.42}, "counters": {"num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016}, "done": false, "training_iteration": 73, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-24", "timestamp": 1729548804, "time_this_iter_s": 3.9083411693573, "time_total_s": 273.4773519039154, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c6b90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354a90>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3567d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354d30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355000>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 273.4773519039154, "iterations_since_restore": 73, "perf": {"cpu_util_percent": 20.98, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.440710112452507, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.145795261859893, "policy_loss": -0.0019480292918160557, "vf_loss": 9.147741091251373, "vf_explained_var": 1.3459473848342896e-05, "kl": 0.005875450539315352, "entropy": 1.9223844185471535, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.635938809812069, "cur_kl_coeff": 3.1432136893272397e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.798389041423798, "policy_loss": -0.0004039368242956698, "vf_loss": 9.798793005943299, "vf_explained_var": 2.60770320892334e-08, "kl": 0.008018506604824439, "entropy": 1.498691937327385, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.1285332754254345, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.341538214683533, "policy_loss": 0.0005139663117006421, "vf_loss": 9.34102429151535, "vf_explained_var": -2.263486385345459e-05, "kl": 0.008610649521782221, "entropy": 0.19221269111149014, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8383320286870002, "cur_kl_coeff": 1.0842021724855043e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.843320083618163, "policy_loss": -0.002901858906261623, "vf_loss": 9.846221911907197, "vf_explained_var": -7.319450378417969e-06, "kl": 0.0028375339545394173, "entropy": 0.809137263149023, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2678.7620026552045, "episode_len_mean": 2693.6470588235293, "episode_media": {}, "episodes_timesteps_total": 137376, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 1521.1393376086157}, "policy_reward_mean": {"high_level_policy": 718.6906762436116, "DC1_ls_policy": 3491.8106926502587, "DC2_ls_policy": -334.33898340000917, "DC3_ls_policy": -1197.4003828386597}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54148.75014028445, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011930663186848773, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 106154.10729438158, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 134167.09467014074, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.015991230346503134, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.859935937889129, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 111368.87067007429, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 87443.71735501323, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05613457093785689, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.3894220902496877, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91000213.07961576, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 21.015982364724692, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 685.9907286381914, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6218308602376579, "mean_inference_ms": 2.2829651723702087, "mean_action_processing_ms": 0.3330165401879224, "mean_env_wait_ms": 4.519626657739965, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035508006226782707, "StateBufferConnector_ms": 0.002615475187114641, "ViewRequirementAgentConnector_ms": 0.05599213581459195}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2678.7620026552045, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208, "num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 564.6182278819149, "num_env_steps_trained_throughput_per_sec": 564.6182278819149, "timesteps_total": 151552, "num_env_steps_sampled_lifetime": 151552, "num_agent_steps_sampled_lifetime": 606208, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 606208, "timers": {"training_iteration_time_ms": 3693.281, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3693.168, "sample_time_ms": 2406.395, "learn_time_ms": 1259.394, "learn_throughput": 1626.178, "synch_weights_time_ms": 10.424}, "counters": {"num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208}, "done": false, "training_iteration": 74, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-28", "timestamp": 1729548808, "time_this_iter_s": 3.6359963417053223, "time_total_s": 277.1133482456207, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeaba9e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3557e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355ab0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe357040>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355cf0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 277.1133482456207, "iterations_since_restore": 74, "perf": {"cpu_util_percent": 19.599999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.249053892493248, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.130578219890594, "policy_loss": -0.0039904808392748235, "vf_loss": 8.134565377235413, "vf_explained_var": 3.8079917430877687e-06, "kl": 0.008339671233079571, "entropy": 1.9877257645130157, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 14.461556029319762, "cur_kl_coeff": 3.1432136893272397e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.566561436653137, "policy_loss": 0.0030427125049754975, "vf_loss": 9.56351865530014, "vf_explained_var": -4.361569881439209e-06, "kl": 0.012619061711120594, "entropy": 1.3924788780510426, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.358167591691018, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.369693791866302, "policy_loss": 0.0009426907985471189, "vf_loss": 9.368751132488251, "vf_explained_var": -1.9371509552001954e-08, "kl": 0.012788339258077031, "entropy": -0.2058716990519315, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6235634118318558, "cur_kl_coeff": 5.421010862427522e-21, "cur_lr": 5.000000000000001e-05, "total_loss": 9.868637657165527, "policy_loss": -0.002041120466310531, "vf_loss": 9.87067881822586, "vf_explained_var": 5.712732672691345e-05, "kl": 0.0037228712261426966, "entropy": 0.8126183666288853, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2762.1380446161743, "episode_len_mean": 2691.5555555555557, "episode_media": {}, "episodes_timesteps_total": 145344, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 719.4461997196786, "DC1_ls_policy": 3491.0445289472914, "DC2_ls_policy": -402.3185207854479, "DC3_ls_policy": -1046.034163265351}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54124.1627080154, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011267848565357175, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 107506.23071807408, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 134167.09467014074, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.015102828660586291, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8607983165735527, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 110053.65387400033, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05301598366353151, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.312231974124705, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90937408.29764096, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 19.848427788906655, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 667.9909845247341, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6228442837386723, "mean_inference_ms": 2.2848140147513, "mean_action_processing_ms": 0.33343338663498856, "mean_env_wait_ms": 4.530005698612042, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035762786865234375, "StateBufferConnector_ms": 0.002610241925274884, "ViewRequirementAgentConnector_ms": 0.0559020925451208}, "num_episodes": 3, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2762.1380446161743, "episodes_this_iter": 3}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400, "num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 570.2560158318615, "num_env_steps_trained_throughput_per_sec": 570.2560158318615, "timesteps_total": 153600, "num_env_steps_sampled_lifetime": 153600, "num_agent_steps_sampled_lifetime": 614400, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 614400, "timers": {"training_iteration_time_ms": 3682.256, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3682.145, "sample_time_ms": 2395.457, "learn_time_ms": 1258.974, "learn_throughput": 1626.721, "synch_weights_time_ms": 10.343}, "counters": {"num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400}, "done": false, "training_iteration": 75, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-31", "timestamp": 1729548811, "time_this_iter_s": 3.601912260055542, "time_total_s": 280.71526050567627, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeabb370>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352200>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352170>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3522c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352530>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 280.71526050567627, "iterations_since_restore": 75, "perf": {"cpu_util_percent": 7.040000000000001, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.2330383360385895, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.02580583691597, "policy_loss": -0.0027881849906407296, "vf_loss": 8.028590548038483, "vf_explained_var": 1.8388032913208008e-05, "kl": 0.008959635052998797, "entropy": 1.9225689575076104, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.781282968819141, "cur_kl_coeff": 3.1432136893272397e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.803089606761933, "policy_loss": 0.004204700188711286, "vf_loss": 9.798884856700898, "vf_explained_var": -1.1332333087921142e-06, "kl": 0.04063380216685274, "entropy": 1.6378175795078278, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.9213200584054, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.572155809402465, "policy_loss": -0.0027983297244645656, "vf_loss": 9.574954152107239, "vf_explained_var": -1.1895596981048583e-05, "kl": 0.01282157292298806, "entropy": -0.3399256541393697, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8044946677982807, "cur_kl_coeff": 2.710505431213761e-21, "cur_lr": 5.000000000000001e-05, "total_loss": 9.83557062149048, "policy_loss": -0.003273650736082345, "vf_loss": 9.83884438276291, "vf_explained_var": -0.00013676807284355164, "kl": 0.005718520453990882, "entropy": 0.8288962721824646, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2762.1380446161743, "episode_len_mean": 2691.5555555555557, "episode_media": {}, "episodes_timesteps_total": 145344, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 719.4461997196786, "DC1_ls_policy": 3491.0445289472914, "DC2_ls_policy": -402.3185207854479, "DC3_ls_policy": -1046.034163265351}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54124.1627080154, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011267848565357175, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 107506.23071807408, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 134167.09467014074, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.015102828660586291, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8607983165735527, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 110053.65387400033, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05301598366353151, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.312231974124705, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 90937408.29764096, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 19.848427788906655, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 667.9909845247341, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6228442837386723, "mean_inference_ms": 2.2848140147513, "mean_action_processing_ms": 0.33343338663498856, "mean_env_wait_ms": 4.530005698612042, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035762786865234375, "StateBufferConnector_ms": 0.002610241925274884, "ViewRequirementAgentConnector_ms": 0.0559020925451208}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2762.1380446161743, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592, "num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 578.3850794635778, "num_env_steps_trained_throughput_per_sec": 578.3850794635778, "timesteps_total": 155648, "num_env_steps_sampled_lifetime": 155648, "num_agent_steps_sampled_lifetime": 622592, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 622592, "timers": {"training_iteration_time_ms": 3647.281, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3647.17, "sample_time_ms": 2360.402, "learn_time_ms": 1258.702, "learn_throughput": 1627.073, "synch_weights_time_ms": 10.269}, "counters": {"num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592}, "done": false, "training_iteration": 76, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-35", "timestamp": 1729548815, "time_this_iter_s": 3.549410104751587, "time_total_s": 284.26467061042786, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59b640>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3538e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3525f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350bb0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3529b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 284.26467061042786, "iterations_since_restore": 76, "perf": {"cpu_util_percent": 5.64, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.5521538361907, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.643995153903962, "policy_loss": -0.0011999735492281617, "vf_loss": 8.645191776752473, "vf_explained_var": 3.583207726478577e-05, "kl": 0.008573521371001324, "entropy": 1.9232430472970008, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.043601486086846, "cur_kl_coeff": 4.71482053399086e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.711630082130432, "policy_loss": 0.0026400395116070287, "vf_loss": 9.708990013599395, "vf_explained_var": -2.0384788513183595e-06, "kl": 0.014120629362564247, "entropy": 1.6091771185398103, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.821593759953975, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.499191975593567, "policy_loss": -0.0006049417308531702, "vf_loss": 9.499796867370605, "vf_explained_var": -1.632571220397949e-05, "kl": 0.005194978561848984, "entropy": 0.0865283555816859, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7631382934749127, "cur_kl_coeff": 2.710505431213761e-21, "cur_lr": 5.000000000000001e-05, "total_loss": 9.834495258331298, "policy_loss": -0.0009805701905861498, "vf_loss": 9.835475814342498, "vf_explained_var": -1.093447208404541e-05, "kl": 0.004548781264492546, "entropy": 0.7468900687992572, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2757.9990107732588, "episode_len_mean": 2701.9636363636364, "episode_media": {}, "episodes_timesteps_total": 148608, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 715.564650960788, "DC1_ls_policy": 3506.448268972713, "DC2_ls_policy": -464.7415353702617, "DC3_ls_policy": -999.2723737899828}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54063.855559861826, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0001106297859144159, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 108016.83110624657, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 135589.25206756158, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.017446324467470464, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8837726609067965, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 109704.54834963131, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05205205668783094, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.2889023999071079, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91360013.80824435, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 20.743829313511206, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 673.036713003518, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.622240523294462, "mean_inference_ms": 2.284084046509184, "mean_action_processing_ms": 0.33314253929488014, "mean_env_wait_ms": 4.526649178473534, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003563490780917081, "StateBufferConnector_ms": 0.002605481581254439, "ViewRequirementAgentConnector_ms": 0.0558427247134122}, "num_episodes": 1, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2757.9990107732588, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784, "num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 536.5558866250652, "num_env_steps_trained_throughput_per_sec": 536.5558866250652, "timesteps_total": 157696, "num_env_steps_sampled_lifetime": 157696, "num_agent_steps_sampled_lifetime": 630784, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 630784, "timers": {"training_iteration_time_ms": 3677.246, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3677.137, "sample_time_ms": 2390.369, "learn_time_ms": 1258.331, "learn_throughput": 1627.553, "synch_weights_time_ms": 10.272}, "counters": {"num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784}, "done": false, "training_iteration": 77, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-39", "timestamp": 1729548819, "time_this_iter_s": 3.8273017406463623, "time_total_s": 288.0919723510742, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeab8430>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352830>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352d70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353490>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353850>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 288.0919723510742, "iterations_since_restore": 77, "perf": {"cpu_util_percent": 18.749999999999996, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.477026978135109, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.203225314617157, "policy_loss": -0.004260770045220852, "vf_loss": 8.207481652498245, "vf_explained_var": -2.667158842086792e-05, "kl": 0.011728533225689442, "entropy": 1.9185825750231742, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.497383457422256, "cur_kl_coeff": 4.71482053399086e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.61360523700714, "policy_loss": 0.003895868139807135, "vf_loss": 9.609709441661835, "vf_explained_var": -3.118067979812622e-06, "kl": 0.011738462700304809, "entropy": 1.4970576867461205, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.471170409023761, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.546566379070281, "policy_loss": -0.006229776167310774, "vf_loss": 9.552796185016632, "vf_explained_var": -1.1233985424041748e-05, "kl": 0.016729743238283846, "entropy": -0.24270646006334573, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8078025236725808, "cur_kl_coeff": 1.3552527156068804e-21, "cur_lr": 5.000000000000001e-05, "total_loss": 9.861998903751374, "policy_loss": -0.0003507770597934723, "vf_loss": 9.862349784374237, "vf_explained_var": 4.106014966964722e-06, "kl": 0.0025422736367549355, "entropy": 0.7140453308820724, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2724.162166368201, "episode_len_mean": 2698.285714285714, "episode_media": {}, "episodes_timesteps_total": 151104, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 690.8030506267467, "DC1_ls_policy": 3502.521327769418, "DC2_ls_policy": -506.8268560746054, "DC3_ls_policy": -962.3353559533604}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54021.95295486789, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00010865425402308705, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 108725.55857763067, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.017134782959122775, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9007147928777831, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 109513.75872382603, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05112255567554824, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.2660579889197554, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91421343.2665937, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 20.373403790055647, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 673.6713113204194, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6219645088258939, "mean_inference_ms": 2.282996483021604, "mean_action_processing_ms": 0.3328572911878543, "mean_env_wait_ms": 4.523211835007832, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035519046442849295, "StateBufferConnector_ms": 0.002602062055042812, "ViewRequirementAgentConnector_ms": 0.055796333721705844}, "num_episodes": 1, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2724.162166368201, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976, "num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 551.2591195573978, "num_env_steps_trained_throughput_per_sec": 551.2591195573978, "timesteps_total": 159744, "num_env_steps_sampled_lifetime": 159744, "num_agent_steps_sampled_lifetime": 638976, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 638976, "timers": {"training_iteration_time_ms": 3688.93, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3688.82, "sample_time_ms": 2401.596, "learn_time_ms": 1258.772, "learn_throughput": 1626.982, "synch_weights_time_ms": 10.446}, "counters": {"num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976}, "done": false, "training_iteration": 78, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-43", "timestamp": 1729548823, "time_this_iter_s": 3.7242228984832764, "time_total_s": 291.8161952495575, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d370c7400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351cf0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3520b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe352860>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3520e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 291.8161952495575, "iterations_since_restore": 78, "perf": {"cpu_util_percent": 19.78, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.20139247328043, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.85980681180954, "policy_loss": -0.0018638244713656605, "vf_loss": 8.861666870117187, "vf_explained_var": 4.879236221313477e-05, "kl": 0.00953808907161274, "entropy": 1.8579551517963409, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.756405064463616, "cur_kl_coeff": 4.71482053399086e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.778879821300507, "policy_loss": 0.003964042849838733, "vf_loss": 9.774915826320647, "vf_explained_var": -5.573034286499023e-07, "kl": 0.03120572340122054, "entropy": 1.8078762039542198, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.27743610739708, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.636795580387115, "policy_loss": 0.0005838564829900861, "vf_loss": 9.636211776733399, "vf_explained_var": -7.127225399017334e-06, "kl": 0.009982094000224605, "entropy": 0.20521956188604235, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9487843550741673, "cur_kl_coeff": 6.776263578034402e-22, "cur_lr": 5.000000000000001e-05, "total_loss": 9.841757953166962, "policy_loss": -0.000990907009691, "vf_loss": 9.84274890422821, "vf_explained_var": 5.932152271270752e-06, "kl": 0.0017187577656959372, "entropy": 0.6987124256789684, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2724.162166368201, "episode_len_mean": 2698.285714285714, "episode_media": {}, "episodes_timesteps_total": 151104, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 690.8030506267467, "DC1_ls_policy": 3502.521327769418, "DC2_ls_policy": -506.8268560746054, "DC3_ls_policy": -962.3353559533604}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54021.95295486789, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00010865425402308705, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 108725.55857763067, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.017134782959122775, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9007147928777831, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 109513.75872382603, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05112255567554824, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.2660579889197554, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91421343.2665937, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 20.373403790055647, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 673.6713113204194, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6219645088258939, "mean_inference_ms": 2.282996483021604, "mean_action_processing_ms": 0.3328572911878543, "mean_env_wait_ms": 4.523211835007832, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035519046442849295, "StateBufferConnector_ms": 0.002602062055042812, "ViewRequirementAgentConnector_ms": 0.055796333721705844}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2724.162166368201, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168, "num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 545.7001702229034, "num_env_steps_trained_throughput_per_sec": 545.7001702229034, "timesteps_total": 161792, "num_env_steps_sampled_lifetime": 161792, "num_agent_steps_sampled_lifetime": 647168, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 647168, "timers": {"training_iteration_time_ms": 3716.105, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3715.99, "sample_time_ms": 2428.797, "learn_time_ms": 1258.556, "learn_throughput": 1627.261, "synch_weights_time_ms": 10.381}, "counters": {"num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168}, "done": false, "training_iteration": 79, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-47", "timestamp": 1729548827, "time_this_iter_s": 3.7620372772216797, "time_total_s": 295.5782325267792, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeabbbe0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350b50>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350040>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3521a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353130>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 295.5782325267792, "iterations_since_restore": 79, "perf": {"cpu_util_percent": 20.2, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.567744436860084, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.638768005371094, "policy_loss": -0.0031166180153377352, "vf_loss": 7.641881537437439, "vf_explained_var": -1.9003450870513915e-05, "kl": 0.008028098993511288, "entropy": 1.8206024900078774, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 13.43857981711626, "cur_kl_coeff": 7.072230800986292e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.648412787914276, "policy_loss": 0.00271699083968997, "vf_loss": 9.645695722103119, "vf_explained_var": -2.360343933105469e-06, "kl": 0.012028423343144823, "entropy": 1.096238163113594, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.893323695659637, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.60321432352066, "policy_loss": 0.0013669212930835783, "vf_loss": 9.601847290992737, "vf_explained_var": -1.2029707431793212e-05, "kl": 0.01076459814212285, "entropy": -0.27798494505696, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.954890901222825, "cur_kl_coeff": 3.388131789017201e-22, "cur_lr": 5.000000000000001e-05, "total_loss": 9.868007934093475, "policy_loss": -0.0012231835687998682, "vf_loss": 9.869231176376342, "vf_explained_var": 7.529333233833314e-05, "kl": 0.0037950785061018053, "entropy": 0.7093926064670086, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2724.162166368201, "episode_len_mean": 2698.285714285714, "episode_media": {}, "episodes_timesteps_total": 151104, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 690.8030506267467, "DC1_ls_policy": 3502.521327769418, "DC2_ls_policy": -506.8268560746054, "DC3_ls_policy": -962.3353559533604}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54021.95295486789, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00010865425402308705, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 108725.55857763067, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.017134782959122775, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9007147928777831, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 109513.75872382603, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05112255567554824, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.2660579889197554, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91421343.2665937, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 20.373403790055647, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 673.6713113204194, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6219645088258939, "mean_inference_ms": 2.282996483021604, "mean_action_processing_ms": 0.3328572911878543, "mean_env_wait_ms": 4.523211835007832, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035519046442849295, "StateBufferConnector_ms": 0.002602062055042812, "ViewRequirementAgentConnector_ms": 0.055796333721705844}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2724.162166368201, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360, "num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 562.4633826019649, "num_env_steps_trained_throughput_per_sec": 562.4633826019649, "timesteps_total": 163840, "num_env_steps_sampled_lifetime": 163840, "num_agent_steps_sampled_lifetime": 655360, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 655360, "timers": {"training_iteration_time_ms": 3708.07, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3707.956, "sample_time_ms": 2421.423, "learn_time_ms": 1258.157, "learn_throughput": 1627.778, "synch_weights_time_ms": 10.401}, "counters": {"num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360}, "done": false, "training_iteration": 80, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-50", "timestamp": 1729548830, "time_this_iter_s": 3.650641918182373, "time_total_s": 299.22887444496155, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeabb400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353940>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe353400>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351990>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350a00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 299.22887444496155, "iterations_since_restore": 80, "perf": {"cpu_util_percent": 20.283333333333335, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.536479999125004, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.5882265865802765, "policy_loss": -0.0026187983341515063, "vf_loss": 7.5908423364162445, "vf_explained_var": 2.1088123321533204e-05, "kl": 0.007835458141108653, "entropy": 1.864178977906704, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 11.910901355743409, "cur_kl_coeff": 7.072230800986292e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.66705892086029, "policy_loss": -0.01126375751919113, "vf_loss": 9.678322792053223, "vf_explained_var": -5.513429641723633e-07, "kl": 0.044895711601571284, "entropy": 1.4813323237001896, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.575770662724972, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.695968747138977, "policy_loss": -0.0001735287602059543, "vf_loss": 9.69614224433899, "vf_explained_var": -1.8300116062164305e-05, "kl": 0.010997412956021435, "entropy": -0.30419661970809103, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9271810464560986, "cur_kl_coeff": 1.6940658945086005e-22, "cur_lr": 5.000000000000001e-05, "total_loss": 9.862463414669037, "policy_loss": -0.004539654345717281, "vf_loss": 9.867002964019775, "vf_explained_var": -3.6904215812683104e-05, "kl": 0.009410425782244167, "entropy": 0.6022604882717133, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2735.761603151508, "episode_len_mean": 2694.6206896551726, "episode_media": {}, "episodes_timesteps_total": 156288, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 681.427167157385, "DC1_ls_policy": 3503.576014868056, "DC2_ls_policy": -565.0814843164869, "DC3_ls_policy": -884.1600945574475}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 53973.21005779061, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011155932231773581, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 109487.7522595665, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.01729557801246933, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9308053534469187, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108960.93035801339, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.049359708928115545, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.2224008168880398, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91381037.88490209, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 20.07663205708651, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 672.8945790148834, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061, 2773.6324787796752, 3347.4591873885624], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496, 2592, 2592], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274, 278.71205327293734, 559.092806757581], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594, 3533.629891187351, 3532.584616072475], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507, -2318.631733975204, -2073.790416203133], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808, 1279.922268294582, 1329.572180761644]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6212461793537357, "mean_inference_ms": 2.2811257927847266, "mean_action_processing_ms": 0.3324483847695608, "mean_env_wait_ms": 4.517389799053177, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035300337035080484, "StateBufferConnector_ms": 0.0026022565775904163, "ViewRequirementAgentConnector_ms": 0.055761378386925006}, "num_episodes": 2, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2735.761603151508, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552, "num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 548.3235401620369, "num_env_steps_trained_throughput_per_sec": 548.3235401620369, "timesteps_total": 165888, "num_env_steps_sampled_lifetime": 165888, "num_agent_steps_sampled_lifetime": 663552, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 663552, "timers": {"training_iteration_time_ms": 3694.779, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3694.664, "sample_time_ms": 2407.853, "learn_time_ms": 1258.327, "learn_throughput": 1627.557, "synch_weights_time_ms": 10.426}, "counters": {"num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552}, "done": false, "training_iteration": 81, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-54", "timestamp": 1729548834, "time_this_iter_s": 3.7444264888763428, "time_total_s": 302.9733009338379, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52b1c0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe350d00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe351f00>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354eb0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354f40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 302.9733009338379, "iterations_since_restore": 81, "perf": {"cpu_util_percent": 19.759999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.06228846013546, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.320500379800796, "policy_loss": -0.0026704790303483605, "vf_loss": 8.323167401552201, "vf_explained_var": 2.4490058422088622e-06, "kl": 0.009000091351300792, "entropy": 1.8807978242635728, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 32.137362730503085, "cur_kl_coeff": 1.0608346201479434e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.631637585163116, "policy_loss": 0.0071685871109366415, "vf_loss": 9.624468982219696, "vf_explained_var": -1.0110437870025634e-06, "kl": 0.03755740507235714, "entropy": 1.5402764916419982, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 19.66069977581501, "cur_kl_coeff": 5.456968210637569e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.498264455795288, "policy_loss": 0.008110808971105143, "vf_loss": 9.490153479576112, "vf_explained_var": -1.7083436250686646e-05, "kl": 0.0244702079984599, "entropy": -0.11287155644968153, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.051172786206007, "cur_kl_coeff": 1.6940658945086005e-22, "cur_lr": 5.000000000000001e-05, "total_loss": 9.830347502231598, "policy_loss": -0.004269415896851569, "vf_loss": 9.834616887569428, "vf_explained_var": -2.0419806241989134e-05, "kl": 0.004879239194781784, "entropy": 0.6339628487825394, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2729.2490103600035, "episode_len_mean": 2699.3898305084745, "episode_media": {}, "episodes_timesteps_total": 159264, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 675.5458623070284, "DC1_ls_policy": 3510.3611465343984, "DC2_ls_policy": -603.4667856982692, "DC3_ls_policy": -853.191212783156}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54005.800784854684, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011536376609839018, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 109768.23511316787, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.01700243262242748, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9449462960620886, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108765.8113651736, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.048864820477174276, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.2028155196453592, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91585931.63038345, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 19.983754534066822, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 674.4409883280994, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061, 2773.6324787796752, 3347.4591873885624, 2351.518628452731], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496, 2592, 2592, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274, 278.71205327293734, 559.092806757581, 334.4301809863449], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594, 3533.629891187351, 3532.584616072475, 3903.8987831822697], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507, -2318.631733975204, -2073.790416203133, -2829.814265841638], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808, 1279.922268294582, 1329.572180761644, 943.0039301257524]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6218377919954232, "mean_inference_ms": 2.282221989503643, "mean_action_processing_ms": 0.332737853359268, "mean_env_wait_ms": 4.522654087440351, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003523543729620465, "StateBufferConnector_ms": 0.0026092690936589647, "ViewRequirementAgentConnector_ms": 0.055870464292623226}, "num_episodes": 1, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2729.2490103600035, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744, "num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 520.8493578800167, "num_env_steps_trained_throughput_per_sec": 520.8493578800167, "timesteps_total": 167936, "num_env_steps_sampled_lifetime": 167936, "num_agent_steps_sampled_lifetime": 671744, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 671744, "timers": {"training_iteration_time_ms": 3725.193, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3725.078, "sample_time_ms": 2437.795, "learn_time_ms": 1258.699, "learn_throughput": 1627.077, "synch_weights_time_ms": 10.424}, "counters": {"num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744}, "done": false, "training_iteration": 82, "trial_id": "04bcd_00000", "date": "2024-10-21_22-13-58", "timestamp": 1729548838, "time_this_iter_s": 3.942077875137329, "time_total_s": 306.9153788089752, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d59a170>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354fd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354400>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356f20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355630>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 306.9153788089752, "iterations_since_restore": 82, "perf": {"cpu_util_percent": 17.066666666666666, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.52631011903286, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.428554183244705, "policy_loss": -0.0022035396075807514, "vf_loss": 8.430754488706588, "vf_explained_var": 1.0833144187927247e-06, "kl": 0.00860512399595193, "entropy": 1.8344159945845604, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 27.262529158592223, "cur_kl_coeff": 1.5912519302219152e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.656646382808685, "policy_loss": 0.008682084281463175, "vf_loss": 9.647964251041412, "vf_explained_var": -7.748603820800781e-07, "kl": 0.029609768040250874, "entropy": 1.7002203792333603, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.6332149937748905, "cur_kl_coeff": 8.185452315956355e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.437617206573487, "policy_loss": -0.004750395123846829, "vf_loss": 9.442367672920227, "vf_explained_var": -2.928078174591064e-07, "kl": 0.014859394544873793, "entropy": 0.4758316928520799, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9100417077541352, "cur_kl_coeff": 8.470329472543003e-23, "cur_lr": 5.000000000000001e-05, "total_loss": 9.891264808177947, "policy_loss": -0.002440315077546984, "vf_loss": 9.89370504617691, "vf_explained_var": 4.0115416049957274e-05, "kl": 0.005448411573706835, "entropy": 0.6275439456105232, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2729.2490103600035, "episode_len_mean": 2699.3898305084745, "episode_media": {}, "episodes_timesteps_total": 159264, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 675.5458623070284, "DC1_ls_policy": 3510.3611465343984, "DC2_ls_policy": -603.4667856982692, "DC3_ls_policy": -853.191212783156}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54005.800784854684, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011536376609839018, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 109768.23511316787, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.01700243262242748, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9449462960620886, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108765.8113651736, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.048864820477174276, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.2028155196453592, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91585931.63038345, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 19.983754534066822, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 674.4409883280994, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061, 2773.6324787796752, 3347.4591873885624, 2351.518628452731], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496, 2592, 2592, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274, 278.71205327293734, 559.092806757581, 334.4301809863449], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594, 3533.629891187351, 3532.584616072475, 3903.8987831822697], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507, -2318.631733975204, -2073.790416203133, -2829.814265841638], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808, 1279.922268294582, 1329.572180761644, 943.0039301257524]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6218377919954232, "mean_inference_ms": 2.282221989503643, "mean_action_processing_ms": 0.332737853359268, "mean_env_wait_ms": 4.522654087440351, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003523543729620465, "StateBufferConnector_ms": 0.0026092690936589647, "ViewRequirementAgentConnector_ms": 0.055870464292623226}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2729.2490103600035, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936, "num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 549.9790789950762, "num_env_steps_trained_throughput_per_sec": 549.9790789950762, "timesteps_total": 169984, "num_env_steps_sampled_lifetime": 169984, "num_agent_steps_sampled_lifetime": 679936, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 679936, "timers": {"training_iteration_time_ms": 3707.675, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3707.563, "sample_time_ms": 2419.329, "learn_time_ms": 1259.808, "learn_throughput": 1625.644, "synch_weights_time_ms": 10.511}, "counters": {"num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936}, "done": false, "training_iteration": 83, "trial_id": "04bcd_00000", "date": "2024-10-21_22-14-02", "timestamp": 1729548842, "time_this_iter_s": 3.7331457138061523, "time_total_s": 310.6485245227814, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeab80d0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356ef0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356470>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe356b30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe3571c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 310.6485245227814, "iterations_since_restore": 83, "perf": {"cpu_util_percent": 5.74, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.569492122530937, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.948185122013092, "policy_loss": -0.0008631804317701608, "vf_loss": 7.94904528260231, "vf_explained_var": 2.8999894857406618e-05, "kl": 0.007374440878222496, "entropy": 1.8386011078953743, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 23.42259717285633, "cur_kl_coeff": 2.3868778953328734e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.799581778049468, "policy_loss": 0.0075305616366676984, "vf_loss": 9.792051076889038, "vf_explained_var": -2.3066997528076174e-06, "kl": 0.018408461209042642, "entropy": 0.8799528008326888, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.238030017167329, "cur_kl_coeff": 8.185452315956355e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.527196168899536, "policy_loss": 0.000631117180455476, "vf_loss": 9.526565051078796, "vf_explained_var": 3.668665885925293e-06, "kl": 0.006176054188066902, "entropy": 0.19174635072704405, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1110778100788594, "cur_kl_coeff": 8.470329472543003e-23, "cur_lr": 5.000000000000001e-05, "total_loss": 9.786761212348939, "policy_loss": -0.0026832987321540715, "vf_loss": 9.789444530010224, "vf_explained_var": 4.310905933380127e-06, "kl": 0.00493646534650396, "entropy": 0.5970419280230999, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2729.2490103600035, "episode_len_mean": 2699.3898305084745, "episode_media": {}, "episodes_timesteps_total": 159264, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 675.5458623070284, "DC1_ls_policy": 3510.3611465343984, "DC2_ls_policy": -603.4667856982692, "DC3_ls_policy": -853.191212783156}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 54005.800784854684, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011536376609839018, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 109768.23511316787, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.01700243262242748, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9449462960620886, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108765.8113651736, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.048864820477174276, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.2028155196453592, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91585931.63038345, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 19.983754534066822, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 674.4409883280994, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061, 2773.6324787796752, 3347.4591873885624, 2351.518628452731], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496, 2592, 2592, 2976], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274, 278.71205327293734, 559.092806757581, 334.4301809863449], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594, 3533.629891187351, 3532.584616072475, 3903.8987831822697], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507, -2318.631733975204, -2073.790416203133, -2829.814265841638], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808, 1279.922268294582, 1329.572180761644, 943.0039301257524]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6218377919954232, "mean_inference_ms": 2.282221989503643, "mean_action_processing_ms": 0.332737853359268, "mean_env_wait_ms": 4.522654087440351, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003523543729620465, "StateBufferConnector_ms": 0.0026092690936589647, "ViewRequirementAgentConnector_ms": 0.055870464292623226}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2729.2490103600035, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128, "num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 547.458450487041, "num_env_steps_trained_throughput_per_sec": 547.458450487041, "timesteps_total": 172032, "num_env_steps_sampled_lifetime": 172032, "num_agent_steps_sampled_lifetime": 688128, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 688128, "timers": {"training_iteration_time_ms": 3719.044, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3718.932, "sample_time_ms": 2430.452, "learn_time_ms": 1260.327, "learn_throughput": 1624.975, "synch_weights_time_ms": 10.51}, "counters": {"num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128}, "done": false, "training_iteration": 84, "trial_id": "04bcd_00000", "date": "2024-10-21_22-14-06", "timestamp": 1729548846, "time_this_iter_s": 3.75239896774292, "time_total_s": 314.4009234905243, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeabb400>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe856590>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe8570a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe857370>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe857700>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 314.4009234905243, "iterations_since_restore": 84, "perf": {"cpu_util_percent": 10.466666666666667, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.722571161389351, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.52241849899292, "policy_loss": -0.0020601842552423477, "vf_loss": 8.524475371837616, "vf_explained_var": -6.060823798179626e-05, "kl": 0.008358365360618337, "entropy": 1.8421061262488365, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 36.56940205693245, "cur_kl_coeff": 2.3868778953328734e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.484184062480926, "policy_loss": 0.007551862881518901, "vf_loss": 9.47663218975067, "vf_explained_var": -4.231929779052734e-06, "kl": 0.022215165503447362, "entropy": 0.9649101939052344, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.68499867618084, "cur_kl_coeff": 8.185452315956355e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.48998965024948, "policy_loss": -0.0010087773902341724, "vf_loss": 9.490998530387879, "vf_explained_var": -1.1718273162841797e-05, "kl": 0.010195159151047004, "entropy": 0.32177842590026556, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4763867020606996, "cur_kl_coeff": 4.2351647362715013e-23, "cur_lr": 5.000000000000001e-05, "total_loss": 9.803244805335998, "policy_loss": -0.0016498147277161479, "vf_loss": 9.804894673824311, "vf_explained_var": 5.214884877204895e-05, "kl": 0.005290033577784925, "entropy": 0.5759161613881588, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2769.0260984030324, "episode_len_mean": 2689.5737704918033, "episode_media": {}, "episodes_timesteps_total": 164064, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 685.4581352127638, "DC1_ls_policy": 3501.713532386937, "DC2_ls_policy": -634.3370619167582, "DC3_ls_policy": -783.8085072799121}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 53919.60914888671, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011158134753778722, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 110246.9994646527, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.016499620623877945, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9512185486502168, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108113.824131511, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.04726269521562758, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.1657764862143638, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91115243.53352316, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 19.360190519288672, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 666.3455238883803, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061, 2773.6324787796752, 3347.4591873885624, 2351.518628452731, 3073.919619488642, 4810.9807718561315], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496, 2592, 2592, 2976, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274, 278.71205327293734, 559.092806757581, 334.4301809863449, 467.1785976138376, 1488.5617742500767], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594, 3533.629891187351, 3532.584616072475, 3903.8987831822697, 3285.679808703984, 3207.5380213696767], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507, -2318.631733975204, -2073.790416203133, -2829.814265841638, -1735.2630313893255, -1354.7573893350386], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808, 1279.922268294582, 1329.572180761644, 943.0039301257524, 1056.3242445601525, 1469.6383655714146]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6226133140163013, "mean_inference_ms": 2.283838534581605, "mean_action_processing_ms": 0.3331082649716951, "mean_env_wait_ms": 4.5302284671116295, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035617195191930554, "StateBufferConnector_ms": 0.002610781153694528, "ViewRequirementAgentConnector_ms": 0.05586372047174172}, "num_episodes": 2, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2769.0260984030324, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320, "num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 574.9964082197667, "num_env_steps_trained_throughput_per_sec": 574.9964082197667, "timesteps_total": 174080, "num_env_steps_sampled_lifetime": 174080, "num_agent_steps_sampled_lifetime": 696320, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 696320, "timers": {"training_iteration_time_ms": 3716.084, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3715.969, "sample_time_ms": 2425.238, "learn_time_ms": 1261.575, "learn_throughput": 1623.367, "synch_weights_time_ms": 10.592}, "counters": {"num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320}, "done": false, "training_iteration": 85, "trial_id": "04bcd_00000", "date": "2024-10-21_22-14-09", "timestamp": 1729548849, "time_this_iter_s": 3.572753667831421, "time_total_s": 317.9736771583557, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9bfeabb370>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354790>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354880>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354d30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354a30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 317.9736771583557, "iterations_since_restore": 85, "perf": {"cpu_util_percent": 19.5, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.785895577073097, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 8.710755825042725, "policy_loss": -0.00046396392863243816, "vf_loss": 8.711218333244323, "vf_explained_var": 0.0001340724527835846, "kl": 0.003743840017524303, "entropy": 1.8863704323768615, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 25.344429504871368, "cur_kl_coeff": 3.580316842999309e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.690176165103912, "policy_loss": 0.0057729436841327695, "vf_loss": 9.68440318107605, "vf_explained_var": -1.6674399375915528e-06, "kl": 0.02032110472246647, "entropy": 1.6271537646651268, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 12.624888281524182, "cur_kl_coeff": 8.185452315956355e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.4975701212883, "policy_loss": 0.002387122274376452, "vf_loss": 9.495182871818542, "vf_explained_var": -2.4862587451934814e-06, "kl": 0.00910010747393244, "entropy": 0.1008747833664529, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9714497953653336, "cur_kl_coeff": 4.2351647362715013e-23, "cur_lr": 5.000000000000001e-05, "total_loss": 9.886134159564971, "policy_loss": -0.0010337115498259663, "vf_loss": 9.887167859077454, "vf_explained_var": 6.660446524620056e-05, "kl": 0.002796268307156424, "entropy": 0.6165230430662632, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512}, "env_runners": {"episode_reward_max": 6952.901900979642, "episode_reward_min": -3987.4234727225626, "episode_reward_mean": 2769.0260984030324, "episode_len_mean": 2689.5737704918033, "episode_media": {}, "episodes_timesteps_total": 164064, "policy_reward_min": {"high_level_policy": -1182.8947036664883, "DC1_ls_policy": 2050.406328927159, "DC2_ls_policy": -4238.558019000802, "DC3_ls_policy": -4013.1731829993173}, "policy_reward_max": {"high_level_policy": 2926.752473059551, "DC1_ls_policy": 4611.629324760612, "DC2_ls_policy": 1160.6693496309094, "DC3_ls_policy": 2059.7989726959563}, "policy_reward_mean": {"high_level_policy": 685.4581352127638, "DC1_ls_policy": 3501.713532386937, "DC2_ls_policy": -634.3370619167582, "DC3_ls_policy": -783.8085072799121}, "custom_metrics": {"custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_mean": 53919.60914888671, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_min": 46333.68702547249, "custom_metric/DC1_ls_policy/bat_CO2_footprint_sum_max": 79572.4933552626, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.00011158134753778722, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC1_ls_policy/ls_overdue_penalty_sum_max": 0.00125, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_mean": 110246.9994646527, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_min": 84361.75528512945, "custom_metric/DC2_ls_policy/bat_CO2_footprint_sum_max": 147705.5695037559, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.016499620623877945, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_tasks_dropped_sum_max": 0.1994949494949495, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9512185486502168, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC2_ls_policy/ls_overdue_penalty_sum_max": 3.486111111111111, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_mean": 108113.824131511, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_min": 83650.90122721849, "custom_metric/DC3_ls_policy/bat_CO2_footprint_sum_max": 138120.17577979914, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.04726269521562758, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_tasks_dropped_sum_max": 0.4652777777777778, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.1657764862143638, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "custom_metric/DC3_ls_policy/ls_overdue_penalty_sum_max": 3.5848765432098766, "custom_metric/accumulated/bat_CO2_footprint_sum_mean": 91115243.53352316, "custom_metric/accumulated/bat_CO2_footprint_sum_min": 71772364.86391835, "custom_metric/accumulated/bat_CO2_footprint_sum_max": 117664680.74066275, "custom_metric/accumulated/ls_tasks_dropped_sum_mean": 19.360190519288672, "custom_metric/accumulated/ls_tasks_dropped_sum_min": 0.0, "custom_metric/accumulated/ls_tasks_dropped_sum_max": 185.37216605392157, "custom_metric/accumulated/ls_overdue_penalty_sum_mean": 666.3455238883803, "custom_metric/accumulated/ls_overdue_penalty_sum_min": 0.0, "custom_metric/accumulated/ls_overdue_penalty_sum_max": 2778.03069760101}, "hist_stats": {"episode_reward": [3394.425601531984, 3982.911748994701, 2789.1021975135986, 4779.476658157588, 1548.1343634593247, 225.6746585899132, 3745.7052293457023, 3967.192385449623, 3526.41072141222, -1160.0676121233462, 1235.0197173096917, 239.58276606431284, -2261.1773885273155, -133.52886321525148, -3987.4234727225626, 179.7487525030393, 808.8566646923119, 1321.8346348333353, 2403.492466282549, 439.1141983616806, 3277.140605596012, 1404.2096729885095, 2077.0799598198355, 980.3018242209309, 2802.053486571773, 1728.1106720947187, 2837.3526719053384, 2155.865181796892, 3906.0833826179055, 5792.317966177487, 2682.663861873799, 800.133329146111, 2426.0554983404922, 5927.413344728115, 4776.141003818498, 3764.4941771189283, 6056.443625741988, 5750.105788916393, 3264.968360584841, -178.60065566669508, 5530.381073958146, 2095.0178644934763, 5134.402689359495, 3149.8502039336313, 6952.901900979642, 3531.733429461397, 5032.653956241772, 3199.0836236516543, 4489.197039053111, 3715.645664562149, 4511.175503415988, 4897.468975364489, 3941.7057696379497, 3699.417528855531, 2534.491183255836, 863.1357240900061, 2773.6324787796752, 3347.4591873885624, 2351.518628452731, 3073.919619488642, 4810.9807718561315], "episode_lengths": [2496, 2400, 2400, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 3264, 2400, 2400, 2496, 2592, 2592, 2976, 3168, 2400, 2400, 2496, 3264, 2592, 2592, 2976, 2400, 2400, 2496, 3168, 2592, 2592, 3264, 2400, 2400, 2976, 2496, 2592, 2592, 3168, 3264, 2400, 2400, 2496, 2976, 2592, 2592, 3168, 2400, 2400, 3264, 2496, 2592, 2592, 2976, 2400, 2400], "policy_high_level_policy_reward": [1428.260801947595, 2121.5433061177937, 1394.7267230574528, 2148.686241947451, 1591.7986034058658, 1327.2694101584887, 1694.6359704218255, 2926.752473059551, 1454.0375893238588, 566.9234561433101, 1224.698932075981, 391.1277008885028, 320.70503293735214, 566.8938432849828, -37.86254990918189, 762.2788636464011, -224.71975866940272, -601.0193370609986, 1059.997474468293, 801.7142774317031, 802.978759903464, -85.42591035707666, 10.843540337450715, -53.97776700961798, 374.0022199672933, -8.466968305340684, 907.6749814405474, 61.24029818520867, 714.332305417815, 1488.584705401602, 416.871060551233, -508.5628961189728, 263.94293592144254, 1429.351617992019, 624.0161673179025, 399.4947280126381, 839.6961176282094, 1177.3154111304102, 687.9192794579775, -1182.8947036664883, 1140.2838490894935, -426.4807113030462, 946.8726095072267, -517.6157627286705, 1679.761049246321, 855.8796829019914, 1158.6491731301628, 600.3030325974311, 1035.8325314212248, 177.53703080893675, 724.8170658685868, 1276.813303700778, 592.18885796559, 327.86813477207613, 505.9610179806938, -671.0849677455274, 278.71205327293734, 559.092806757581, 334.4301809863449, 467.1785976138376, 1488.5617742500767], "policy_DC1_ls_policy_reward": [2317.723730816918, 2247.450849551567, 2050.406328927159, 2370.275804555554, 2331.4872171588654, 2718.2264758439605, 3218.0509620618514, 3367.023742231189, 3201.5261688950386, 3032.1458635964996, 3323.471435346852, 3434.738932570223, 3530.4448285283756, 4100.191459993249, 4302.170279186727, 4589.954299352335, 3391.248150233114, 3283.0818626135074, 3657.458166406371, 3625.2688509598656, 3531.7107062394202, 4002.125204367651, 4274.54589462312, 3338.2528059086944, 3165.2661581854713, 3444.7606463810985, 4611.629324760612, 3686.129233584054, 3575.3046162037595, 4098.210733110132, 3388.0452112378066, 3440.4509488170893, 3562.038192266473, 4465.300090849171, 3708.9577906264194, 3669.0487899268355, 4558.56766936492, 3077.888014867658, 3262.8920459282867, 4132.598325432724, 3307.40264410822, 3501.150520355017, 3504.1394661382496, 4200.242467778245, 4306.6740639442605, 3183.088854086701, 3136.9030058208714, 3294.3645867173104, 3971.2697959809993, 3348.3730138442875, 3242.669094878431, 4218.228656586846, 3170.3400027877465, 3045.4905786159866, 4338.250230345462, 3286.5395615881594, 3533.629891187351, 3532.584616072475, 3903.8987831822697, 3285.679808703984, 3207.5380213696767], "policy_DC2_ls_policy_reward": [-21.00340449557943, 625.6035792702161, -21.29142306337962, 1140.5699175979544, 107.05338297103651, -1134.519418490151, 894.7710864104899, -894.967545224292, 925.3807791261494, -1746.2848818095513, -1439.9201809751169, -778.5205332903208, -2418.046071572381, -1226.7747519520983, -4238.558019000802, -1916.3455770787061, -262.28884025475014, -62.34518049531574, -73.44443339614327, -544.5614339593039, -101.75080605720551, 955.1047535468247, -33.548469600226746, 263.7048329899492, 618.5152244540951, -282.6688294000118, 437.17206204471023, -409.171383268184, 52.207973655814435, 109.44141540387007, -1113.5017611686876, -1524.788131097496, -1133.6960443643034, -682.8884942765243, 148.19077868414283, -206.49816254424863, 88.75240547963536, 1160.6693496309094, 455.472111993595, -575.2339239211898, 1133.7551755005304, 432.1536207785631, 921.9519424937163, 186.8984568826154, 520.6943122726415, -680.4420340874625, 359.80797946211413, -1530.6857181066762, -1719.1068270137846, -1331.403717699718, -484.9032963864267, -2657.3719576190897, -1136.8601189217204, -879.6798924729109, -3835.5843229502093, -2821.519494813507, -2318.631733975204, -2073.790416203133, -2829.814265841638, -1735.2630313893255, -1354.7573893350386], "policy_DC3_ls_policy_reward": [-330.55552673696064, -1011.6859859448873, -634.739431407647, -880.0553059433861, -2482.2048400764543, -2685.301808922399, -2061.7527895484427, -1431.6162846168254, -2054.5338159328203, -3012.852050053611, -1873.23046913803, -2807.7633341040873, -3694.2811784206697, -3573.8394145413895, -4013.1731829993173, -3256.138833416999, -2095.3828866166377, -1297.8827102238558, -2240.518741195962, -3443.307496070578, -955.7980544896603, -3467.594374568892, -2174.7610055405053, -2567.6780476680806, -1355.7301160350905, -1425.51417658103, -3119.1236963405354, -1182.3329667041987, -435.7615126594854, 96.08111226186901, -8.750648746550857, -606.966592454505, -266.22958548312243, 715.6501301634562, 294.9762671900164, -97.55117827629834, 569.4274332692203, 334.23301328739717, -1141.3150767950065, -2553.07035351173, -51.060594740112144, -1411.8055653370623, -238.56132877972124, -719.6749579985591, 445.77247551644484, 173.20692656015933, 377.2937978286486, 835.101722443578, 1201.2015386646758, 1521.1393376086157, 1028.592639055384, 2059.7989726959563, 1316.0370278063392, 1205.7387079403898, 1525.8642578798936, 1069.2006250608808, 1279.922268294582, 1329.572180761644, 943.0039301257524, 1056.3242445601525, 1469.6383655714146]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6226133140163013, "mean_inference_ms": 2.283838534581605, "mean_action_processing_ms": 0.3331082649716951, "mean_env_wait_ms": 4.5302284671116295, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0035617195191930554, "StateBufferConnector_ms": 0.002610781153694528, "ViewRequirementAgentConnector_ms": 0.05586372047174172}, "num_episodes": 0, "episode_return_max": 6952.901900979642, "episode_return_min": -3987.4234727225626, "episode_return_mean": 2769.0260984030324, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512, "num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 539.4029368107568, "num_env_steps_trained_throughput_per_sec": 539.4029368107568, "timesteps_total": 176128, "num_env_steps_sampled_lifetime": 176128, "num_agent_steps_sampled_lifetime": 704512, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 704512, "timers": {"training_iteration_time_ms": 3741.674, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3741.558, "sample_time_ms": 2450.617, "learn_time_ms": 1262.13, "learn_throughput": 1622.653, "synch_weights_time_ms": 10.572}, "counters": {"num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512}, "done": false, "training_iteration": 86, "trial_id": "04bcd_00000", "date": "2024-10-21_22-14-14", "timestamp": 1729548854, "time_this_iter_s": 3.8069231510162354, "time_total_s": 321.78060030937195, "pid": 2171151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f9d2d52b9a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354bb0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354e20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe354fa0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f9bfe355180>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 321.78060030937195, "iterations_since_restore": 86, "perf": {"cpu_util_percent": 19.880000000000003, "ram_util_percent": 3.1}}

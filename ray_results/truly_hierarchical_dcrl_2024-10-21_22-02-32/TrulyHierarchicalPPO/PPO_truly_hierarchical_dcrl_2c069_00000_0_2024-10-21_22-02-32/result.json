{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.878932672739029, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.891209721565247, "policy_loss": -0.00043684308184310794, "vf_loss": 9.891584324836732, "vf_explained_var": -0.00022827684879302978, "kl": 0.00031115914443944346, "entropy": 1.4077980399131775, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9719072062522173, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.659422492980957, "policy_loss": -0.0016496943193487824, "vf_loss": 9.660831809043884, "vf_explained_var": -0.0003991857171058655, "kl": 0.0012019281587981822, "entropy": 1.4122545793652534, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8589852690696717, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.768271148204803, "policy_loss": -0.001442744769155979, "vf_loss": 9.769518005847932, "vf_explained_var": -0.0005183383822441101, "kl": 0.0009795949099498102, "entropy": 1.4459713622927666, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.071744529902935, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.778626239299774, "policy_loss": -0.0050845577148720626, "vf_loss": 8.782428205013275, "vf_explained_var": -0.0003583036363124847, "kl": 0.006413231584429013, "entropy": 4.202245354652405, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 40.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192, "num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 513.1695048820475, "num_env_steps_trained_throughput_per_sec": 513.1695048820475, "timesteps_total": 2048, "num_env_steps_sampled_lifetime": 2048, "num_agent_steps_sampled_lifetime": 8192, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 8192, "timers": {"training_iteration_time_ms": 3990.897, "restore_workers_time_ms": 0.026, "training_step_time_ms": 3990.808, "sample_time_ms": 2490.311, "learn_time_ms": 1422.187, "learn_throughput": 1440.035, "synch_weights_time_ms": 15.284}, "counters": {"num_env_steps_sampled": 2048, "num_env_steps_trained": 2048, "num_agent_steps_sampled": 8192, "num_agent_steps_trained": 8192}, "done": false, "training_iteration": 1, "trial_id": "2c069_00000", "date": "2024-10-21_22-02-45", "timestamp": 1729548165, "time_this_iter_s": 3.998918056488037, "time_total_s": 3.998918056488037, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6fba30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7505b0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7506a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b264a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b26560>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 3.998918056488037, "iterations_since_restore": 1, "perf": {"cpu_util_percent": 19.616666666666667, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1053673803806305, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.713872611522675, "policy_loss": -0.0013217148021794855, "vf_loss": 9.7150829911232, "vf_explained_var": -0.0035627856850624084, "kl": 0.0011134569888502893, "entropy": 1.375404092669487, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.97410690151155, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.801456308364868, "policy_loss": -0.0012231908040121198, "vf_loss": 9.802581465244293, "vf_explained_var": -0.0017554551362991334, "kl": 0.0009806459289478653, "entropy": 1.3780699357390405, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0481515660881997, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.766917848587036, "policy_loss": -0.00022726188180968165, "vf_loss": 9.767137742042541, "vf_explained_var": -0.002050095796585083, "kl": 7.219656021248966e-05, "entropy": 1.4406698986887931, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4709350407123565, "cur_kl_coeff": 0.19999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 7.726293301582336, "policy_loss": -0.00396131919696927, "vf_loss": 7.72947587966919, "vf_explained_var": 0.003042775392532349, "kl": 0.0038935786144862093, "entropy": 4.161557418107987, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384, "num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 497.48937336653273, "num_env_steps_trained_throughput_per_sec": 497.48937336653273, "timesteps_total": 4096, "num_env_steps_sampled_lifetime": 4096, "num_agent_steps_sampled_lifetime": 16384, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 16384, "timers": {"training_iteration_time_ms": 4053.791, "restore_workers_time_ms": 0.023, "training_step_time_ms": 4053.714, "sample_time_ms": 2582.293, "learn_time_ms": 1397.803, "learn_throughput": 1465.156, "synch_weights_time_ms": 19.166}, "counters": {"num_env_steps_sampled": 4096, "num_env_steps_trained": 4096, "num_agent_steps_sampled": 16384, "num_agent_steps_trained": 16384}, "done": false, "training_iteration": 2, "trial_id": "2c069_00000", "date": "2024-10-21_22-02-50", "timestamp": 1729548170, "time_this_iter_s": 4.123209714889526, "time_total_s": 8.122127771377563, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6fb880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f014f330880>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f014f330430>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f014f332560>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f014f332080>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 8.122127771377563, "iterations_since_restore": 2, "perf": {"cpu_util_percent": 19.35, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.784608756378293, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.343944108486175, "policy_loss": -0.004388922048383393, "vf_loss": 9.348063051700592, "vf_explained_var": -0.0043673887848854065, "kl": 0.005400824696032406, "entropy": 1.3397151455283165, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3111775156110526, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.734448277950287, "policy_loss": -0.0003801138198468834, "vf_loss": 9.734818363189698, "vf_explained_var": -0.005104199051856995, "kl": 0.0002005528889739594, "entropy": 1.3648442164063455, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1377508886158467, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.675436151027679, "policy_loss": -0.0004158650292083621, "vf_loss": 9.675837349891662, "vf_explained_var": -0.0038151130080223083, "kl": 0.00029211233865425316, "entropy": 1.4475882709026338, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.330480706691742, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.929587662220001, "policy_loss": -0.00572316242614761, "vf_loss": 8.934526181221008, "vf_explained_var": -0.0023863717913627626, "kl": 0.007845377612403582, "entropy": 4.1687404930591585, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576, "num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 550.7523849074232, "num_env_steps_trained_throughput_per_sec": 550.7523849074232, "timesteps_total": 6144, "num_env_steps_sampled_lifetime": 6144, "num_agent_steps_sampled_lifetime": 24576, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 24576, "timers": {"training_iteration_time_ms": 3942.049, "restore_workers_time_ms": 0.021, "training_step_time_ms": 3941.976, "sample_time_ms": 2486.867, "learn_time_ms": 1394.009, "learn_throughput": 1469.144, "synch_weights_time_ms": 17.585}, "counters": {"num_env_steps_sampled": 6144, "num_env_steps_trained": 6144, "num_agent_steps_sampled": 24576, "num_agent_steps_trained": 24576}, "done": false, "training_iteration": 3, "trial_id": "2c069_00000", "date": "2024-10-21_22-02-53", "timestamp": 1729548173, "time_this_iter_s": 3.7256178855895996, "time_total_s": 11.847745656967163, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b687250>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750e20>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750f10>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750fd0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751090>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 11.847745656967163, "iterations_since_restore": 3, "perf": {"cpu_util_percent": 22.220000000000002, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2694636676460505, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.692854559421539, "policy_loss": -0.002850222575943917, "vf_loss": 9.695418560504914, "vf_explained_var": -0.004193700104951859, "kl": 0.005725770687064392, "entropy": 1.2730149060487748, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.511383742839098, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.625924122333526, "policy_loss": -0.0015565051697194576, "vf_loss": 9.627459931373597, "vf_explained_var": -0.007184351980686188, "kl": 0.0008212016435209316, "entropy": 1.3723187461495399, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9246641468256712, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.872729790210723, "policy_loss": -0.00231373633723706, "vf_loss": 9.875018167495728, "vf_explained_var": -0.003014826774597168, "kl": 0.001018412820305592, "entropy": 1.4448820695281028, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.947865383327007, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.850679951906204, "policy_loss": -0.007423802302218974, "vf_loss": 7.857272911071777, "vf_explained_var": 0.0003201112151145935, "kl": 0.008309073299284365, "entropy": 4.18001497387886, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768, "num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 525.3669197233845, "num_env_steps_trained_throughput_per_sec": 525.3669197233845, "timesteps_total": 8192, "num_env_steps_sampled_lifetime": 8192, "num_agent_steps_sampled_lifetime": 32768, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 32768, "timers": {"training_iteration_time_ms": 3931.097, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3931.021, "sample_time_ms": 2490.815, "learn_time_ms": 1376.423, "learn_throughput": 1487.915, "synch_weights_time_ms": 19.509}, "counters": {"num_env_steps_sampled": 8192, "num_env_steps_trained": 8192, "num_agent_steps_sampled": 32768, "num_agent_steps_trained": 32768}, "done": false, "training_iteration": 4, "trial_id": "2c069_00000", "date": "2024-10-21_22-02-57", "timestamp": 1729548177, "time_this_iter_s": 3.90588116645813, "time_total_s": 15.753626823425293, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6fba30>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751270>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751360>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751420>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7514e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 15.753626823425293, "iterations_since_restore": 4, "perf": {"cpu_util_percent": 15.316666666666668, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7463233016431332, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.509109437465668, "policy_loss": -0.006903272541239858, "vf_loss": 9.515564465522766, "vf_explained_var": -0.002186211943626404, "kl": 0.008966253639624758, "entropy": 1.2854067146778108, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5819137513637542, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.672246992588043, "policy_loss": -0.0025504631688818336, "vf_loss": 9.674757742881775, "vf_explained_var": -0.006380254030227661, "kl": 0.0031860780411079757, "entropy": 1.3499783828854561, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.175630072876811, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.809984505176544, "policy_loss": -0.0007275685900822281, "vf_loss": 9.810704851150513, "vf_explained_var": -0.002427186816930771, "kl": 0.0005673325605443022, "entropy": 1.4264039665460586, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.148048497736454, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.590672326087952, "policy_loss": -0.005118616588879377, "vf_loss": 7.5951855182647705, "vf_explained_var": 0.0030061334371566774, "kl": 0.006054493489642709, "entropy": 4.097040104866028, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960, "num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 604.4651946079605, "num_env_steps_trained_throughput_per_sec": 604.4651946079605, "timesteps_total": 10240, "num_env_steps_sampled_lifetime": 10240, "num_agent_steps_sampled_lifetime": 40960, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 40960, "timers": {"training_iteration_time_ms": 3822.506, "restore_workers_time_ms": 0.022, "training_step_time_ms": 3822.43, "sample_time_ms": 2413.651, "learn_time_ms": 1351.335, "learn_throughput": 1515.538, "synch_weights_time_ms": 17.776}, "counters": {"num_env_steps_sampled": 10240, "num_env_steps_trained": 10240, "num_agent_steps_sampled": 40960, "num_agent_steps_trained": 40960}, "done": false, "training_iteration": 5, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-01", "timestamp": 1729548181, "time_this_iter_s": 3.3962135314941406, "time_total_s": 19.149840354919434, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6fb880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7516c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7517b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751870>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751930>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 19.149840354919434, "iterations_since_restore": 5, "perf": {"cpu_util_percent": 5.54, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6397101990878582, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.574523317813874, "policy_loss": -0.0037597616552375256, "vf_loss": 9.578079652786254, "vf_explained_var": -0.0014474600553512572, "kl": 0.004067270748737472, "entropy": 1.2999849334359168, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6355297274887561, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.656841361522675, "policy_loss": -0.0044728103908710185, "vf_loss": 9.661278629302979, "vf_explained_var": -0.0017796427011489869, "kl": 0.005679088049657821, "entropy": 1.3526793271303177, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8066519789397717, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.908781683444976, "policy_loss": -0.001536904345266521, "vf_loss": 9.910312354564667, "vf_explained_var": -0.0017600879073143005, "kl": 0.0010082249809727274, "entropy": 1.4321793481707572, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.5612042710185055, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.251422935724259, "policy_loss": -0.005196311580948532, "vf_loss": 8.255739295482636, "vf_explained_var": -0.0034958913922309874, "kl": 0.008797575015432867, "entropy": 3.964643669128418, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152, "num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 513.6831272166582, "num_env_steps_trained_throughput_per_sec": 513.6831272166582, "timesteps_total": 12288, "num_env_steps_sampled_lifetime": 12288, "num_agent_steps_sampled_lifetime": 49152, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 49152, "timers": {"training_iteration_time_ms": 3849.907, "restore_workers_time_ms": 0.027, "training_step_time_ms": 3849.825, "sample_time_ms": 2435.802, "learn_time_ms": 1357.383, "learn_throughput": 1508.786, "synch_weights_time_ms": 16.974}, "counters": {"num_env_steps_sampled": 12288, "num_env_steps_trained": 12288, "num_agent_steps_sampled": 49152, "num_agent_steps_trained": 49152}, "done": false, "training_iteration": 6, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-05", "timestamp": 1729548185, "time_this_iter_s": 3.997361421585083, "time_total_s": 23.147201776504517, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2ac940>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750250>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750400>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7504c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750340>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 23.147201776504517, "iterations_since_restore": 6, "perf": {"cpu_util_percent": 11.766666666666666, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7354913033545016, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.19773211479187, "policy_loss": -0.005381957220379263, "vf_loss": 9.202965474128723, "vf_explained_var": -0.0064367204904556274, "kl": 0.005940567355020271, "entropy": 1.206885078549385, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9042695358395576, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.380188262462616, "policy_loss": -0.0011598244542255997, "vf_loss": 9.381339120864869, "vf_explained_var": -0.0010647431015968322, "kl": 0.0014271485643597259, "entropy": 1.3368422880768775, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0531367521733046, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.892285180091857, "policy_loss": -0.001799723191652447, "vf_loss": 9.894081091880798, "vf_explained_var": -0.0034944429993629456, "kl": 0.0012337860249005052, "entropy": 1.4050250485539437, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0298353269696237, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.888703602552414, "policy_loss": -0.006853101041633636, "vf_loss": 7.8945984780788425, "vf_explained_var": 0.001223435252904892, "kl": 0.009581271006811675, "entropy": 3.8479031682014466, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344, "num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 557.6793941023689, "num_env_steps_trained_throughput_per_sec": 557.6793941023689, "timesteps_total": 14336, "num_env_steps_sampled_lifetime": 14336, "num_agent_steps_sampled_lifetime": 57344, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 57344, "timers": {"training_iteration_time_ms": 3824.545, "restore_workers_time_ms": 0.026, "training_step_time_ms": 3824.464, "sample_time_ms": 2410.48, "learn_time_ms": 1357.874, "learn_throughput": 1508.24, "synch_weights_time_ms": 17.304}, "counters": {"num_env_steps_sampled": 14336, "num_env_steps_trained": 14336, "num_agent_steps_sampled": 57344, "num_agent_steps_trained": 57344}, "done": false, "training_iteration": 7, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-09", "timestamp": 1729548189, "time_this_iter_s": 3.678436517715454, "time_total_s": 26.82563829421997, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b687130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f014f339f60>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f014f33a740>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f014f33ab30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751960>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 26.82563829421997, "iterations_since_restore": 7, "perf": {"cpu_util_percent": 20.18, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1521855518221855, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.39393663406372, "policy_loss": -0.0006699649267829955, "vf_loss": 9.394584465026856, "vf_explained_var": -0.0077741950750350956, "kl": 0.0008858074052910502, "entropy": 1.2225101858377456, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9901354119181633, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.43691507577896, "policy_loss": -0.0021987136395182462, "vf_loss": 9.439104545116425, "vf_explained_var": -0.0013247594237327577, "kl": 0.002955961215633399, "entropy": 1.2618323221802712, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9384256631135941, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.910271084308624, "policy_loss": -0.0031096409598831086, "vf_loss": 9.913377559185028, "vf_explained_var": -0.0017576880753040313, "kl": 0.002075900914756816, "entropy": 1.38413847386837, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8555941477417948, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.020942360162735, "policy_loss": -0.006892191205406561, "vf_loss": 8.02675358057022, "vf_explained_var": -0.0006962351500988007, "kl": 0.010809919237362919, "entropy": 3.848890742659569, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536, "num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 536.3938232188608, "num_env_steps_trained_throughput_per_sec": 536.3938232188608, "timesteps_total": 16384, "num_env_steps_sampled_lifetime": 16384, "num_agent_steps_sampled_lifetime": 65536, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 65536, "timers": {"training_iteration_time_ms": 3823.741, "restore_workers_time_ms": 0.026, "training_step_time_ms": 3823.661, "sample_time_ms": 2412.548, "learn_time_ms": 1356.749, "learn_throughput": 1509.49, "synch_weights_time_ms": 17.112}, "counters": {"num_env_steps_sampled": 16384, "num_env_steps_trained": 16384, "num_agent_steps_sampled": 65536, "num_agent_steps_trained": 65536}, "done": false, "training_iteration": 8, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-12", "timestamp": 1729548192, "time_this_iter_s": 3.824207067489624, "time_total_s": 30.649845361709595, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6869e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751660>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751630>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751420>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7514e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 30.649845361709595, "iterations_since_restore": 8, "perf": {"cpu_util_percent": 20.28, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.38210529088974, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.836519634723663, "policy_loss": -0.0024015159928239883, "vf_loss": 9.838885128498077, "vf_explained_var": -0.006676106154918671, "kl": 0.002872536745208325, "entropy": 1.2102664932608604, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8733422860503197, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.346714317798615, "policy_loss": -0.0013998005888424814, "vf_loss": 9.348111128807068, "vf_explained_var": -0.001074463129043579, "kl": 0.001923075004911823, "entropy": 1.2312334060668946, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0741105500608683, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.90202487707138, "policy_loss": -0.001696495118085295, "vf_loss": 9.903719675540923, "vf_explained_var": 0.0014702394604682923, "kl": 0.0021734741871483844, "entropy": 1.3854072943329812, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7685234621167183, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.903588724136353, "policy_loss": -0.010418755345745013, "vf_loss": 7.9126857161521915, "vf_explained_var": -0.0028986051678657533, "kl": 0.013216260112324235, "entropy": 3.7690670073032377, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728}, "env_runners": {"episode_reward_max": NaN, "episode_reward_min": NaN, "episode_reward_mean": NaN, "episode_len_mean": NaN, "episode_media": {}, "episodes_timesteps_total": 0, "policy_reward_min": {}, "policy_reward_max": {}, "policy_reward_mean": {}, "custom_metrics": {}, "hist_stats": {"episode_reward": [], "episode_lengths": []}, "sampler_perf": {}, "num_faulty_episodes": 0, "connector_metrics": {}, "num_episodes": 0, "episode_return_max": NaN, "episode_return_min": NaN, "episode_return_mean": NaN, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728, "num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 565.6800046993286, "num_env_steps_trained_throughput_per_sec": 565.6800046993286, "timesteps_total": 18432, "num_env_steps_sampled_lifetime": 18432, "num_agent_steps_sampled_lifetime": 73728, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 73728, "timers": {"training_iteration_time_ms": 3801.151, "restore_workers_time_ms": 0.024, "training_step_time_ms": 3801.073, "sample_time_ms": 2390.654, "learn_time_ms": 1355.613, "learn_throughput": 1510.756, "synch_weights_time_ms": 17.288}, "counters": {"num_env_steps_sampled": 18432, "num_env_steps_trained": 18432, "num_agent_steps_sampled": 73728, "num_agent_steps_trained": 73728}, "done": false, "training_iteration": 9, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-16", "timestamp": 1729548196, "time_this_iter_s": 3.6275386810302734, "time_total_s": 34.27738404273987, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2ad750>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750be0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750cd0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751150>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7515a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 34.27738404273987, "iterations_since_restore": 9, "perf": {"cpu_util_percent": 19.84, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.737880251556635, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 9.312332689762115, "policy_loss": -0.000863109464989975, "vf_loss": 9.313182759284974, "vf_explained_var": -0.007825623452663421, "kl": 0.0020841678276269705, "entropy": 1.1869964361190797, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4731967166066169, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.717277216911317, "policy_loss": -0.003064373345114291, "vf_loss": 9.72033669948578, "vf_explained_var": -0.00044690966606140135, "kl": 0.006183670956897913, "entropy": 1.2089820951223373, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1733518943190575, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.882800924777985, "policy_loss": -0.0009335606824606657, "vf_loss": 9.883734107017517, "vf_explained_var": -0.0002209685742855072, "kl": 0.0011051526745859519, "entropy": 1.3946610003709794, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6470464184880256, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.552679717540741, "policy_loss": -0.005116211494896561, "vf_loss": 7.556924337148667, "vf_explained_var": 0.0023657478392124175, "kl": 0.008716103829874772, "entropy": 3.7235623031854628, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 3544.3954064868935, "episode_reward_mean": 4913.278756351486, "episode_len_mean": 2464.0, "episode_media": {}, "episodes_timesteps_total": 7392, "policy_reward_min": {"high_level_policy": 1087.782922517156, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": 1039.2656202807982, "DC3_ls_policy": -899.9296171957367}, "policy_reward_max": {"high_level_policy": 1792.8289215334275, "DC1_ls_policy": 2429.970200227873, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1369.846952594935, "DC1_ls_policy": 2202.258325531077, "DC2_ls_policy": 1242.1665579356295, "DC3_ls_policy": 99.00692028983916}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 72799.61128812628, "DC1_ls_policy/bat_CO2_footprint_sum_min": 71186.82442907753, "DC1_ls_policy/bat_CO2_footprint_sum_max": 74102.32906626567, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 90798.52412645513, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 95239.4560209121, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.09147970085470086, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.2744391025641026, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 93632.78059547373, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 96182.0246733259, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.05903311965811966, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.04366987179487179, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.07333333333333333, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.0169497863247863, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 1.8220833333333333, "accumulated/bat_CO2_footprint_sum_mean": 78317310.71429697, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 80765649.97542384, "accumulated/ls_tasks_dropped_sum_mean": 3.015239049145299, "accumulated/ls_tasks_dropped_sum_min": 0.08463541666666667, "accumulated/ls_tasks_dropped_sum_max": 8.602708333333334, "accumulated/ls_overdue_penalty_sum_mean": 129.80921340811966, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 204.60822916666666}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362], "episode_lengths": [2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5868815916459356, "mean_inference_ms": 2.2178833859826104, "mean_action_processing_ms": 0.32092776131570977, "mean_env_wait_ms": 4.044888153930171, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003697474797566732, "StateBufferConnector_ms": 0.0025053819020589194, "ViewRequirementAgentConnector_ms": 0.05256334940592448}, "num_episodes": 3, "episode_return_max": 6067.316600473201, "episode_return_min": 3544.3954064868935, "episode_return_mean": 4913.278756351486, "episodes_this_iter": 3}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920, "num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 499.3147357038389, "num_env_steps_trained_throughput_per_sec": 499.3147357038389, "timesteps_total": 20480, "num_env_steps_sampled_lifetime": 20480, "num_agent_steps_sampled_lifetime": 81920, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 81920, "timers": {"training_iteration_time_ms": 3831.202, "restore_workers_time_ms": 0.027, "training_step_time_ms": 3831.118, "sample_time_ms": 2419.224, "learn_time_ms": 1357.11, "learn_throughput": 1509.089, "synch_weights_time_ms": 17.72}, "counters": {"num_env_steps_sampled": 20480, "num_env_steps_trained": 20480, "num_agent_steps_sampled": 81920, "num_agent_steps_trained": 81920}, "done": false, "training_iteration": 10, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-20", "timestamp": 1729548200, "time_this_iter_s": 4.108257532119751, "time_total_s": 38.38564157485962, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b687130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752950>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752a40>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752b00>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752bc0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 38.38564157485962, "iterations_since_restore": 10, "perf": {"cpu_util_percent": 20.86666666666667, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4088857550173999, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.61403728723526, "policy_loss": -0.0027130328584462405, "vf_loss": 9.616734635829925, "vf_explained_var": -0.0013724520802497863, "kl": 0.005013442010643132, "entropy": 1.20576341599226, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4499639883637427, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.852962851524353, "policy_loss": -0.0015041372913401573, "vf_loss": 9.854465103149414, "vf_explained_var": -1.5814602375030517e-05, "kl": 0.002637534299694338, "entropy": 1.2244108512997627, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9132383156567812, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.907077300548554, "policy_loss": -0.0001890047104097903, "vf_loss": 9.907266294956207, "vf_explained_var": -0.002513982355594635, "kl": 0.000534946457753463, "entropy": 1.3800714418292046, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.082913601398468, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.889248567819595, "policy_loss": -0.0066958395123947415, "vf_loss": 7.894991308450699, "vf_explained_var": -0.0007278420031070709, "kl": 0.009531355437775346, "entropy": 3.691469523310661, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 3544.3954064868935, "episode_reward_mean": 4653.9052205784665, "episode_len_mean": 2534.4, "episode_media": {}, "episodes_timesteps_total": 12672, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": 621.7696791576636, "DC3_ls_policy": -899.9296171957367}, "policy_reward_max": {"high_level_policy": 1792.8289215334275, "DC1_ls_policy": 2570.135638948115, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1205.8952599148492, "DC1_ls_policy": 2255.1384743242593, "DC2_ls_policy": 1101.1102323931148, "DC3_ls_policy": 91.76125394623558}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 73230.87648780998, "DC1_ls_policy/bat_CO2_footprint_sum_min": 70825.54299149157, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92599.73970724706, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0004629629629629629, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0023148148148148147, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.15504214150047485, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.5007716049382716, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95259.60244748276, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 99119.42204897037, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.03541987179487179, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.07333333333333333, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.0020817986026318, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 1.8220833333333333, "accumulated/bat_CO2_footprint_sum_mean": 82206481.08472936, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 88605742.55850695, "accumulated/ls_tasks_dropped_sum_mean": 1.952661948005698, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 8.602708333333334, "accumulated/ls_overdue_penalty_sum_mean": 164.6849706980905, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 352.74488811728395}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365], "episode_lengths": [2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6029973511169054, "mean_inference_ms": 2.242125988461132, "mean_action_processing_ms": 0.3287674508015585, "mean_env_wait_ms": 4.1742393849939745, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033032894134521484, "StateBufferConnector_ms": 0.002467632293701172, "ViewRequirementAgentConnector_ms": 0.05306363105773926}, "num_episodes": 2, "episode_return_max": 6067.316600473201, "episode_return_min": 3544.3954064868935, "episode_return_mean": 4653.9052205784665, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112, "num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 525.7866395434595, "num_env_steps_trained_throughput_per_sec": 525.7866395434595, "timesteps_total": 22528, "num_env_steps_sampled_lifetime": 22528, "num_agent_steps_sampled_lifetime": 90112, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 90112, "timers": {"training_iteration_time_ms": 3821.625, "restore_workers_time_ms": 0.026, "training_step_time_ms": 3821.541, "sample_time_ms": 2418.213, "learn_time_ms": 1350.006, "learn_throughput": 1517.03, "synch_weights_time_ms": 19.006}, "counters": {"num_env_steps_sampled": 22528, "num_env_steps_trained": 22528, "num_agent_steps_sampled": 90112, "num_agent_steps_trained": 90112}, "done": false, "training_iteration": 11, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-24", "timestamp": 1729548204, "time_this_iter_s": 3.9039461612701416, "time_total_s": 42.28958773612976, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2ad3f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751bd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751c90>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751f90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752200>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 42.28958773612976, "iterations_since_restore": 11, "perf": {"cpu_util_percent": 20.033333333333335, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3588403549045325, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.872347223758698, "policy_loss": -0.003040372580289841, "vf_loss": 9.87537968158722, "vf_explained_var": -0.00044116973876953127, "kl": 0.0025233942086004624, "entropy": 1.1575354397296906, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6541125059127808, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.440811252593994, "policy_loss": -0.003154810197884217, "vf_loss": 9.443963491916657, "vf_explained_var": -3.51540744304657e-05, "kl": 0.006737909559711852, "entropy": 1.1351963341236115, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9454530272632837, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.924166870117187, "policy_loss": -0.000983671424910426, "vf_loss": 9.925150537490845, "vf_explained_var": 0.0013223223388195038, "kl": 0.0006798699765653282, "entropy": 1.3742801636457442, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.506740191578865, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.664484143257141, "policy_loss": -0.002824678784236312, "vf_loss": 8.666639423370361, "vf_explained_var": 0.0032113932073116304, "kl": 0.006694926234013252, "entropy": 3.6846895664930344, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 3544.3954064868935, "episode_reward_mean": 4653.9052205784665, "episode_len_mean": 2534.4, "episode_media": {}, "episodes_timesteps_total": 12672, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": 621.7696791576636, "DC3_ls_policy": -899.9296171957367}, "policy_reward_max": {"high_level_policy": 1792.8289215334275, "DC1_ls_policy": 2570.135638948115, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1205.8952599148492, "DC1_ls_policy": 2255.1384743242593, "DC2_ls_policy": 1101.1102323931148, "DC3_ls_policy": 91.76125394623558}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 73230.87648780998, "DC1_ls_policy/bat_CO2_footprint_sum_min": 70825.54299149157, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92599.73970724706, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0004629629629629629, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0023148148148148147, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.15504214150047485, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.5007716049382716, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95259.60244748276, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 99119.42204897037, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.03541987179487179, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.07333333333333333, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.0020817986026318, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 1.8220833333333333, "accumulated/bat_CO2_footprint_sum_mean": 82206481.08472936, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 88605742.55850695, "accumulated/ls_tasks_dropped_sum_mean": 1.952661948005698, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 8.602708333333334, "accumulated/ls_overdue_penalty_sum_mean": 164.6849706980905, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 352.74488811728395}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365], "episode_lengths": [2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6029973511169054, "mean_inference_ms": 2.242125988461132, "mean_action_processing_ms": 0.3287674508015585, "mean_env_wait_ms": 4.1742393849939745, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033032894134521484, "StateBufferConnector_ms": 0.002467632293701172, "ViewRequirementAgentConnector_ms": 0.05306363105773926}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": 3544.3954064868935, "episode_return_mean": 4653.9052205784665, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304, "num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 576.6981938802927, "num_env_steps_trained_throughput_per_sec": 576.6981938802927, "timesteps_total": 24576, "num_env_steps_sampled_lifetime": 24576, "num_agent_steps_sampled_lifetime": 98304, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 98304, "timers": {"training_iteration_time_ms": 3765.087, "restore_workers_time_ms": 0.03, "training_step_time_ms": 3764.992, "sample_time_ms": 2372.11, "learn_time_ms": 1340.07, "learn_throughput": 1528.279, "synch_weights_time_ms": 18.169}, "counters": {"num_env_steps_sampled": 24576, "num_env_steps_trained": 24576, "num_agent_steps_sampled": 98304, "num_agent_steps_trained": 98304}, "done": false, "training_iteration": 12, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-28", "timestamp": 1729548208, "time_this_iter_s": 3.5609614849090576, "time_total_s": 45.85054922103882, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2adcf0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752470>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752560>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752620>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7526e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 45.85054922103882, "iterations_since_restore": 12, "perf": {"cpu_util_percent": 6.220000000000001, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.412557637691498, "cur_kl_coeff": 0.0015624999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.77963079214096, "policy_loss": -0.0020540683064609764, "vf_loss": 9.781678116321563, "vf_explained_var": -0.0005587950348854065, "kl": 0.004313322542117323, "entropy": 1.159188874065876, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4331068038940429, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.832791233062744, "policy_loss": -0.002321544295409694, "vf_loss": 9.835111951828003, "vf_explained_var": 2.899765968322754e-05, "kl": 0.002142735188522328, "entropy": 1.1702291920781136, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0243680816143752, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.927505671977997, "policy_loss": -0.001693136733956635, "vf_loss": 9.929198741912842, "vf_explained_var": -0.001369137316942215, "kl": 0.001431104455134502, "entropy": 1.3774015173316, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9778131186962127, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.744859343767166, "policy_loss": -0.0061033677658997474, "vf_loss": 7.749882388114929, "vf_explained_var": -0.00048277005553245547, "kl": 0.010803718293868909, "entropy": 3.629936918616295, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 3544.3954064868935, "episode_reward_mean": 4653.9052205784665, "episode_len_mean": 2534.4, "episode_media": {}, "episodes_timesteps_total": 12672, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": 621.7696791576636, "DC3_ls_policy": -899.9296171957367}, "policy_reward_max": {"high_level_policy": 1792.8289215334275, "DC1_ls_policy": 2570.135638948115, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1205.8952599148492, "DC1_ls_policy": 2255.1384743242593, "DC2_ls_policy": 1101.1102323931148, "DC3_ls_policy": 91.76125394623558}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 73230.87648780998, "DC1_ls_policy/bat_CO2_footprint_sum_min": 70825.54299149157, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92599.73970724706, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0004629629629629629, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0023148148148148147, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.15504214150047485, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.5007716049382716, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95259.60244748276, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 99119.42204897037, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.03541987179487179, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.07333333333333333, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.0020817986026318, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 1.8220833333333333, "accumulated/bat_CO2_footprint_sum_mean": 82206481.08472936, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 88605742.55850695, "accumulated/ls_tasks_dropped_sum_mean": 1.952661948005698, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 8.602708333333334, "accumulated/ls_overdue_penalty_sum_mean": 164.6849706980905, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 352.74488811728395}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365], "episode_lengths": [2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6029973511169054, "mean_inference_ms": 2.242125988461132, "mean_action_processing_ms": 0.3287674508015585, "mean_env_wait_ms": 4.1742393849939745, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033032894134521484, "StateBufferConnector_ms": 0.002467632293701172, "ViewRequirementAgentConnector_ms": 0.05306363105773926}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": 3544.3954064868935, "episode_return_mean": 4653.9052205784665, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496, "num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 518.0850821602346, "num_env_steps_trained_throughput_per_sec": 518.0850821602346, "timesteps_total": 26624, "num_env_steps_sampled_lifetime": 26624, "num_agent_steps_sampled_lifetime": 106496, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 106496, "timers": {"training_iteration_time_ms": 3788.537, "restore_workers_time_ms": 0.033, "training_step_time_ms": 3788.433, "sample_time_ms": 2396.135, "learn_time_ms": 1337.056, "learn_throughput": 1531.723, "synch_weights_time_ms": 18.798}, "counters": {"num_env_steps_sampled": 26624, "num_env_steps_trained": 26624, "num_agent_steps_sampled": 106496, "num_agent_steps_trained": 106496}, "done": false, "training_iteration": 13, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-32", "timestamp": 1729548212, "time_this_iter_s": 3.9612913131713867, "time_total_s": 49.811840534210205, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b687130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752c80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752d70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752e30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752ef0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 49.811840534210205, "iterations_since_restore": 13, "perf": {"cpu_util_percent": 7.383333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5770646326243878, "cur_kl_coeff": 0.0007812499999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 9.662342393398285, "policy_loss": -0.0022060688817873595, "vf_loss": 9.664546227455139, "vf_explained_var": -0.00025764182209968566, "kl": 0.0029473459822811085, "entropy": 1.2005573570728303, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6514252990484237, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.680308306217194, "policy_loss": -0.0020669837016612292, "vf_loss": 9.682374346256257, "vf_explained_var": -7.125735282897949e-05, "kl": 0.004468363444527767, "entropy": 1.1413369700312614, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.8828105177730322, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.945096838474274, "policy_loss": -0.0008776922593824565, "vf_loss": 9.945974552631379, "vf_explained_var": 0.001569463312625885, "kl": 0.0009109695739539535, "entropy": 1.3797895431518554, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.787688581645489, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.575554305315018, "policy_loss": -0.008220252057071775, "vf_loss": 7.582550978660583, "vf_explained_var": 0.0011909104883670806, "kl": 0.012235800500366356, "entropy": 3.5279935151338577, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 3544.3954064868935, "episode_reward_mean": 4653.9052205784665, "episode_len_mean": 2534.4, "episode_media": {}, "episodes_timesteps_total": 12672, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": 621.7696791576636, "DC3_ls_policy": -899.9296171957367}, "policy_reward_max": {"high_level_policy": 1792.8289215334275, "DC1_ls_policy": 2570.135638948115, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1205.8952599148492, "DC1_ls_policy": 2255.1384743242593, "DC2_ls_policy": 1101.1102323931148, "DC3_ls_policy": 91.76125394623558}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 73230.87648780998, "DC1_ls_policy/bat_CO2_footprint_sum_min": 70825.54299149157, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92599.73970724706, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0004629629629629629, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0023148148148148147, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.15504214150047485, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.5007716049382716, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95259.60244748276, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 99119.42204897037, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.03541987179487179, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.07333333333333333, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.0020817986026318, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 1.8220833333333333, "accumulated/bat_CO2_footprint_sum_mean": 82206481.08472936, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 88605742.55850695, "accumulated/ls_tasks_dropped_sum_mean": 1.952661948005698, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 8.602708333333334, "accumulated/ls_overdue_penalty_sum_mean": 164.6849706980905, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 352.74488811728395}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365], "episode_lengths": [2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6029973511169054, "mean_inference_ms": 2.242125988461132, "mean_action_processing_ms": 0.3287674508015585, "mean_env_wait_ms": 4.1742393849939745, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033032894134521484, "StateBufferConnector_ms": 0.002467632293701172, "ViewRequirementAgentConnector_ms": 0.05306363105773926}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": 3544.3954064868935, "episode_return_mean": 4653.9052205784665, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688, "num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 520.8429468899861, "num_env_steps_trained_throughput_per_sec": 520.8429468899861, "timesteps_total": 28672, "num_env_steps_sampled_lifetime": 28672, "num_agent_steps_sampled_lifetime": 114688, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 114688, "timers": {"training_iteration_time_ms": 3791.926, "restore_workers_time_ms": 0.037, "training_step_time_ms": 3791.814, "sample_time_ms": 2383.903, "learn_time_ms": 1351.368, "learn_throughput": 1515.501, "synch_weights_time_ms": 18.189}, "counters": {"num_env_steps_sampled": 28672, "num_env_steps_trained": 28672, "num_agent_steps_sampled": 114688, "num_agent_steps_trained": 114688}, "done": false, "training_iteration": 14, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-36", "timestamp": 1729548216, "time_this_iter_s": 3.9399051666259766, "time_total_s": 53.75174570083618, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2aeb90>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752110>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753c10>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7539d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c0d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 53.75174570083618, "iterations_since_restore": 14, "perf": {"cpu_util_percent": 20.479999999999997, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3452489264309406, "cur_kl_coeff": 0.00039062499999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 9.83257200717926, "policy_loss": -0.0005334914312697947, "vf_loss": 9.8331050157547, "vf_explained_var": -0.0003294885158538818, "kl": 0.0014974000421233314, "entropy": 1.2029434353113175, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.573137816786766, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.789905142784118, "policy_loss": -0.000758612749632448, "vf_loss": 9.790663588047028, "vf_explained_var": -7.14622437953949e-05, "kl": 0.0036881852601710332, "entropy": 1.1176127314567565, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9499199241399765, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.934163737297059, "policy_loss": -0.001141078188084066, "vf_loss": 9.935304927825928, "vf_explained_var": 0.0006137222051620483, "kl": 0.0007419879710497158, "entropy": 1.3901919960975646, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.784078611433506, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.257651597261429, "policy_loss": -0.008462040836457163, "vf_loss": 8.264621877670288, "vf_explained_var": 0.002368422597646713, "kl": 0.01491771391019964, "entropy": 3.4014690577983857, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 3544.3954064868935, "episode_reward_mean": 4653.9052205784665, "episode_len_mean": 2534.4, "episode_media": {}, "episodes_timesteps_total": 12672, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": 621.7696791576636, "DC3_ls_policy": -899.9296171957367}, "policy_reward_max": {"high_level_policy": 1792.8289215334275, "DC1_ls_policy": 2570.135638948115, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1205.8952599148492, "DC1_ls_policy": 2255.1384743242593, "DC2_ls_policy": 1101.1102323931148, "DC3_ls_policy": 91.76125394623558}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 73230.87648780998, "DC1_ls_policy/bat_CO2_footprint_sum_min": 70825.54299149157, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92599.73970724706, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0004629629629629629, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.0023148148148148147, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.15504214150047485, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 0.5007716049382716, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95259.60244748276, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 99119.42204897037, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.03541987179487179, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.07333333333333333, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.0020817986026318, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 1.8220833333333333, "accumulated/bat_CO2_footprint_sum_mean": 82206481.08472936, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 88605742.55850695, "accumulated/ls_tasks_dropped_sum_mean": 1.952661948005698, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 8.602708333333334, "accumulated/ls_overdue_penalty_sum_mean": 164.6849706980905, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 352.74488811728395}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365], "episode_lengths": [2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6029973511169054, "mean_inference_ms": 2.242125988461132, "mean_action_processing_ms": 0.3287674508015585, "mean_env_wait_ms": 4.1742393849939745, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033032894134521484, "StateBufferConnector_ms": 0.002467632293701172, "ViewRequirementAgentConnector_ms": 0.05306363105773926}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": 3544.3954064868935, "episode_return_mean": 4653.9052205784665, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880, "num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 524.5079962738278, "num_env_steps_trained_throughput_per_sec": 524.5079962738278, "timesteps_total": 30720, "num_env_steps_sampled_lifetime": 30720, "num_agent_steps_sampled_lifetime": 122880, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 122880, "timers": {"training_iteration_time_ms": 3843.576, "restore_workers_time_ms": 0.037, "training_step_time_ms": 3843.462, "sample_time_ms": 2419.097, "learn_time_ms": 1364.49, "learn_throughput": 1500.927, "synch_weights_time_ms": 19.709}, "counters": {"num_env_steps_sampled": 30720, "num_env_steps_trained": 30720, "num_agent_steps_sampled": 122880, "num_agent_steps_trained": 122880}, "done": false, "training_iteration": 15, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-40", "timestamp": 1729548220, "time_this_iter_s": 3.9127509593963623, "time_total_s": 57.664496660232544, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2adcf0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c220>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c310>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c3d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c490>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 57.664496660232544, "iterations_since_restore": 15, "perf": {"cpu_util_percent": 19.233333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7761101882904768, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.327549958229065, "policy_loss": -0.004677532042842358, "vf_loss": 9.332226240634919, "vf_explained_var": -0.0002354755997657776, "kl": 0.007079955931998035, "entropy": 1.2331988215446472, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.951169666647911, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.590164256095886, "policy_loss": -0.001273519010283053, "vf_loss": 9.591437757015228, "vf_explained_var": -0.0003917694091796875, "kl": 0.0030063952717682696, "entropy": 1.1371843293309212, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9480124052613974, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.932841551303863, "policy_loss": -0.0024983858689665794, "vf_loss": 9.935339820384979, "vf_explained_var": 0.0003577664494514465, "kl": 0.0032515868891163603, "entropy": 1.3690816044807435, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.07617157548666, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.465091735124588, "policy_loss": -0.004092803510138765, "vf_loss": 8.468491530418396, "vf_explained_var": -0.003221747279167175, "kl": 0.006931196775803982, "entropy": 3.354280471801758, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 576.6507947729784, "episode_reward_mean": 3974.3628162775517, "episode_len_mean": 2784.0, "episode_media": {}, "episodes_timesteps_total": 16704, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -560.9576433388455, "DC3_ls_policy": -4759.43527779108}, "policy_reward_max": {"high_level_policy": 1796.7813325310303, "DC1_ls_policy": 4100.262383371895, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1304.3762720175462, "DC1_ls_policy": 2562.6591258321987, "DC2_ls_policy": 824.0989197711214, "DC3_ls_policy": -716.771501343317}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 72485.08505034888, "DC1_ls_policy/bat_CO2_footprint_sum_min": 68756.12786304331, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92953.68310420272, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.00795028659611993, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.3452649459593904, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.2963789682539681, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 95922.82829084573, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 99238.95750766066, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.16770273707773709, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.8291170634920635, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.4494448189413465, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 3.6862599206349205, "accumulated/bat_CO2_footprint_sum_mean": 90371427.47729032, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 131196159.44009505, "accumulated/ls_tasks_dropped_sum_mean": 34.88439008233279, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 199.54303075396825, "accumulated/ls_overdue_penalty_sum_mean": 357.65402857446696, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 1322.4993179563492}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.5993777011919489, "mean_inference_ms": 2.2411079683453417, "mean_action_processing_ms": 0.3267759471863505, "mean_env_wait_ms": 4.182273286043552, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003226598103841146, "StateBufferConnector_ms": 0.0024725993474324546, "ViewRequirementAgentConnector_ms": 0.052956740061442055}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": 576.6507947729784, "episode_return_mean": 3974.3628162775517, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072, "num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 528.4120587379689, "num_env_steps_trained_throughput_per_sec": 528.4120587379689, "timesteps_total": 32768, "num_env_steps_sampled_lifetime": 32768, "num_agent_steps_sampled_lifetime": 131072, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 131072, "timers": {"training_iteration_time_ms": 3832.463, "restore_workers_time_ms": 0.034, "training_step_time_ms": 3832.353, "sample_time_ms": 2410.996, "learn_time_ms": 1362.832, "learn_throughput": 1502.753, "synch_weights_time_ms": 19.863}, "counters": {"num_env_steps_sampled": 32768, "num_env_steps_trained": 32768, "num_agent_steps_sampled": 131072, "num_agent_steps_trained": 131072}, "done": false, "training_iteration": 16, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-44", "timestamp": 1729548224, "time_this_iter_s": 3.884302854537964, "time_total_s": 61.54879951477051, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2aeb00>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7528c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7529e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752b00>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752c20>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 61.54879951477051, "iterations_since_restore": 16, "perf": {"cpu_util_percent": 19.840000000000003, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.729473388195038, "cur_kl_coeff": 0.00019531249999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.6336461186409, "policy_loss": -0.001712168287485838, "vf_loss": 9.635357594490051, "vf_explained_var": -0.000480574369430542, "kl": 0.003511773384715866, "entropy": 1.15758915245533, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1241115596145392, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.019695556163787, "policy_loss": -0.0018271888897288592, "vf_loss": 9.021522831916808, "vf_explained_var": -0.00017783045768737793, "kl": 0.0034795184547875453, "entropy": 1.0704706564545632, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0919768564403056, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.928646564483643, "policy_loss": -0.001092288945801556, "vf_loss": 9.929738807678223, "vf_explained_var": -7.031857967376709e-06, "kl": 0.0006537010624115055, "entropy": 1.3387106865644456, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8324923545122145, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.9214060544967655, "policy_loss": -0.0024294773873407395, "vf_loss": 7.923075950145721, "vf_explained_var": 0.0020645089447498322, "kl": 0.007595541372848252, "entropy": 3.2741261959075927, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 576.6507947729784, "episode_reward_mean": 3687.088222180604, "episode_len_mean": 3156.0, "episode_media": {}, "episodes_timesteps_total": 25248, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -560.9576433388455, "DC3_ls_policy": -4759.43527779108}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1472.6067059422237, "DC1_ls_policy": 3049.768672228758, "DC2_ls_policy": 786.7505083638247, "DC3_ls_policy": -1622.037664354215}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 70551.87867832682, "DC1_ls_policy/bat_CO2_footprint_sum_min": 64254.552710103315, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 93307.68017237663, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.008209137506012506, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.4672958527776236, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.2963789682539681, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 97617.29407722117, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 105342.07887799326, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19959991686554188, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.8291170634920635, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.8930988446353028, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 3.6862599206349205, "accumulated/bat_CO2_footprint_sum_mean": 102362595.30418968, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 47.27312427734303, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 199.54303075396825, "accumulated/ls_overdue_penalty_sum_mean": 555.6848514497896, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 1322.4993179563492}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6049141432282972, "mean_inference_ms": 2.2486784432919595, "mean_action_processing_ms": 0.32987740669581234, "mean_env_wait_ms": 4.267982719281459, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031463801860809326, "StateBufferConnector_ms": 0.002460181713104248, "ViewRequirementAgentConnector_ms": 0.053132325410842896}, "num_episodes": 2, "episode_return_max": 6067.316600473201, "episode_return_min": 576.6507947729784, "episode_return_mean": 3687.088222180604, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264, "num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 515.0346345141907, "num_env_steps_trained_throughput_per_sec": 515.0346345141907, "timesteps_total": 34816, "num_env_steps_sampled_lifetime": 34816, "num_agent_steps_sampled_lifetime": 139264, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 139264, "timers": {"training_iteration_time_ms": 3862.87, "restore_workers_time_ms": 0.034, "training_step_time_ms": 3862.759, "sample_time_ms": 2440.414, "learn_time_ms": 1363.023, "learn_throughput": 1502.542, "synch_weights_time_ms": 20.187}, "counters": {"num_env_steps_sampled": 34816, "num_env_steps_trained": 34816, "num_agent_steps_sampled": 139264, "num_agent_steps_trained": 139264}, "done": false, "training_iteration": 17, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-48", "timestamp": 1729548228, "time_this_iter_s": 3.984131097793579, "time_total_s": 65.53293061256409, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b687eb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751bd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752fe0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7530a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753190>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 65.53293061256409, "iterations_since_restore": 17, "perf": {"cpu_util_percent": 19.433333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8496042083948852, "cur_kl_coeff": 9.765624999999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.532152366638183, "policy_loss": -0.000724117923527956, "vf_loss": 9.532876646518707, "vf_explained_var": 3.7379562854766845e-06, "kl": 0.00191290529868553, "entropy": 1.1783142164349556, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7217439465224742, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.220391476154328, "policy_loss": -0.004158075741725042, "vf_loss": 9.22454959154129, "vf_explained_var": -0.00016760528087615966, "kl": 0.006130324391014597, "entropy": 1.0273459009826182, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9491697050631046, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.934264016151428, "policy_loss": -0.001077536551747471, "vf_loss": 9.935341560840607, "vf_explained_var": 0.0002021409571170807, "kl": 0.0008405928243576291, "entropy": 1.3476889729499817, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.441202713549137, "cur_kl_coeff": 0.09999999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.141549104452134, "policy_loss": -0.0007253251853398979, "vf_loss": 8.141886419057846, "vf_explained_var": 0.00022086203098297118, "kl": 0.0038806265727146182, "entropy": 3.2759451657533645, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": 576.6507947729784, "episode_reward_mean": 3687.088222180604, "episode_len_mean": 3156.0, "episode_media": {}, "episodes_timesteps_total": 25248, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -560.9576433388455, "DC3_ls_policy": -4759.43527779108}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1472.6067059422237, "DC1_ls_policy": 3049.768672228758, "DC2_ls_policy": 786.7505083638247, "DC3_ls_policy": -1622.037664354215}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 70551.87867832682, "DC1_ls_policy/bat_CO2_footprint_sum_min": 64254.552710103315, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 93307.68017237663, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.008209137506012506, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.4672958527776236, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.2963789682539681, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 97617.29407722117, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 105342.07887799326, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19959991686554188, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.8291170634920635, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.8930988446353028, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 3.6862599206349205, "accumulated/bat_CO2_footprint_sum_mean": 102362595.30418968, "accumulated/bat_CO2_footprint_sum_min": 76573479.72547917, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 47.27312427734303, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 199.54303075396825, "accumulated/ls_overdue_penalty_sum_mean": 555.6848514497896, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 1322.4993179563492}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6049141432282972, "mean_inference_ms": 2.2486784432919595, "mean_action_processing_ms": 0.32987740669581234, "mean_env_wait_ms": 4.267982719281459, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031463801860809326, "StateBufferConnector_ms": 0.002460181713104248, "ViewRequirementAgentConnector_ms": 0.053132325410842896}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": 576.6507947729784, "episode_return_mean": 3687.088222180604, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456, "num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 524.4805506904543, "num_env_steps_trained_throughput_per_sec": 524.4805506904543, "timesteps_total": 36864, "num_env_steps_sampled_lifetime": 36864, "num_agent_steps_sampled_lifetime": 147456, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 147456, "timers": {"training_iteration_time_ms": 3871.543, "restore_workers_time_ms": 0.034, "training_step_time_ms": 3871.431, "sample_time_ms": 2443.53, "learn_time_ms": 1367.08, "learn_throughput": 1498.083, "synch_weights_time_ms": 20.65}, "counters": {"num_env_steps_sampled": 36864, "num_env_steps_trained": 36864, "num_agent_steps_sampled": 147456, "num_agent_steps_trained": 147456}, "done": false, "training_iteration": 18, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-52", "timestamp": 1729548232, "time_this_iter_s": 3.9128670692443848, "time_total_s": 69.44579768180847, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6fb880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7516c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753730>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7538b0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753970>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 69.44579768180847, "iterations_since_restore": 18, "perf": {"cpu_util_percent": 20.02, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1999465472996236, "cur_kl_coeff": 4.8828124999999996e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.45311621427536, "policy_loss": -0.0028340871329419317, "vf_loss": 9.45595029592514, "vf_explained_var": -2.7789175510406495e-05, "kl": 0.003046041308613212, "entropy": 1.2150989130139351, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2093357749283316, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.479117834568024, "policy_loss": -0.00030475499806925654, "vf_loss": 9.479422664642334, "vf_explained_var": -0.0004970833659172058, "kl": 0.0009282065299034234, "entropy": 1.0735728338360786, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9133529618382454, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.937394833564758, "policy_loss": -0.00020581766730174423, "vf_loss": 9.937600648403167, "vf_explained_var": -1.0593980550765992e-05, "kl": 0.000256823284604505, "entropy": 1.341498890519142, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.87971680611372, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.820947474241256, "policy_loss": -0.007248468475881964, "vf_loss": 7.827576589584351, "vf_explained_var": -0.0027787894010543822, "kl": 0.012388307630590378, "entropy": 3.211052855849266, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 3028.8597223655283, "episode_len_mean": 3072.0, "episode_media": {}, "episodes_timesteps_total": 27648, "policy_reward_min": {"high_level_policy": 767.2298723341497, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -560.9576433388455, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1500.5567811937806, "DC1_ls_policy": 3065.0106277071623, "DC2_ls_policy": 643.1114303256599, "DC3_ls_policy": -2179.8191168610865}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 68282.83026789868, "DC1_ls_policy/bat_CO2_footprint_sum_min": 50130.44298447349, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92747.0851247136, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 96989.78705773527, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.007297011116455561, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5938000172838136, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.6058333333333332, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 99069.51548960262, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 110687.28678865422, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.278024000176778, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.4680786026387875, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99020964.44621336, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 80.33678176504566, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 344.8460416666667, "accumulated/ls_overdue_penalty_sum_mean": 767.2476804553685, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2459.7503125}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6032240427996362, "mean_inference_ms": 2.2448258995558596, "mean_action_processing_ms": 0.32876554460618035, "mean_env_wait_ms": 4.268230352991982, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0033179918924967446, "StateBufferConnector_ms": 0.0024623341030544704, "ViewRequirementAgentConnector_ms": 0.053093168470594615}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 3028.8597223655283, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648, "num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 500.5591324212754, "num_env_steps_trained_throughput_per_sec": 500.5591324212754, "timesteps_total": 38912, "num_env_steps_sampled_lifetime": 38912, "num_agent_steps_sampled_lifetime": 155648, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 155648, "timers": {"training_iteration_time_ms": 3918.644, "restore_workers_time_ms": 0.034, "training_step_time_ms": 3918.53, "sample_time_ms": 2492.571, "learn_time_ms": 1364.923, "learn_throughput": 1500.451, "synch_weights_time_ms": 20.834}, "counters": {"num_env_steps_sampled": 38912, "num_env_steps_trained": 38912, "num_agent_steps_sampled": 155648, "num_agent_steps_trained": 155648}, "done": false, "training_iteration": 19, "trial_id": "2c069_00000", "date": "2024-10-21_22-03-56", "timestamp": 1729548236, "time_this_iter_s": 4.0990142822265625, "time_total_s": 73.54481196403503, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753ac0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753be0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753dc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753ee0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 73.54481196403503, "iterations_since_restore": 19, "perf": {"cpu_util_percent": 9.383333333333335, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8419531844556332, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.38817241191864, "policy_loss": -0.005874906829558313, "vf_loss": 9.39404730796814, "vf_explained_var": -0.00010727494955062867, "kl": 0.007014456255424822, "entropy": 1.3019864022731782, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9014477856457233, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.364768838882446, "policy_loss": -0.00336180335143581, "vf_loss": 9.368130719661712, "vf_explained_var": -0.00015788525342941284, "kl": 0.006300559008377604, "entropy": 1.0545955523848534, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0282115124166011, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.926984655857087, "policy_loss": -0.0017930273723322898, "vf_loss": 9.928777539730072, "vf_explained_var": -0.0004663184285163879, "kl": 0.0018336857672608578, "entropy": 1.322484765946865, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9362603291869163, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.373263198137284, "policy_loss": -0.004349186335457489, "vf_loss": 8.377130299806595, "vf_explained_var": 0.002631741017103195, "kl": 0.009641477172909196, "entropy": 3.194449561834335, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 2301.4214635345484, "episode_len_mean": 2967.2727272727275, "episode_media": {}, "episodes_timesteps_total": 32640, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1429.9546873973475, "DC1_ls_policy": 3114.508714101736, "DC2_ls_policy": 519.6052702898023, "DC3_ls_policy": -2762.6472082543482}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 65260.75372411492, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94063.85511901893, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.00597028182255455, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.6860112029524909, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 101251.18838904618, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 113476.99523036755, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.32952837776701416, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.0799430991287053, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 95534110.07251519, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 104.8620052290933, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 344.8460416666667, "accumulated/ls_overdue_penalty_sum_mean": 1053.782684795651, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2459.7503125}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6005823730276734, "mean_inference_ms": 2.241025134683907, "mean_action_processing_ms": 0.3268760632658199, "mean_env_wait_ms": 4.260559470681179, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003247369419444691, "StateBufferConnector_ms": 0.002488222989169034, "ViewRequirementAgentConnector_ms": 0.053501671010797676}, "num_episodes": 2, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 2301.4214635345484, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840, "num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 471.02141206166164, "num_env_steps_trained_throughput_per_sec": 471.02141206166164, "timesteps_total": 40960, "num_env_steps_sampled_lifetime": 40960, "num_agent_steps_sampled_lifetime": 163840, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 163840, "timers": {"training_iteration_time_ms": 3943.283, "restore_workers_time_ms": 0.035, "training_step_time_ms": 3943.163, "sample_time_ms": 2519.382, "learn_time_ms": 1358.353, "learn_throughput": 1507.708, "synch_weights_time_ms": 20.185}, "counters": {"num_env_steps_sampled": 40960, "num_env_steps_trained": 40960, "num_agent_steps_sampled": 163840, "num_agent_steps_trained": 163840}, "done": false, "training_iteration": 20, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-00", "timestamp": 1729548240, "time_this_iter_s": 4.357459783554077, "time_total_s": 77.90227174758911, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b687eb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751c90>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752950>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ca00>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d210>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 77.90227174758911, "iterations_since_restore": 20, "perf": {"cpu_util_percent": 5.483333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.625222374498844, "cur_kl_coeff": 2.4414062499999998e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.314400064945222, "policy_loss": -0.0026543872896581887, "vf_loss": 9.317054498195649, "vf_explained_var": -2.0091980695724486e-05, "kl": 0.004801016824694728, "entropy": 1.199825221300125, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4412923458963633, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.615379929542542, "policy_loss": -0.00032837672042660413, "vf_loss": 9.615708184242248, "vf_explained_var": -3.167688846588135e-05, "kl": 0.0011632997467643236, "entropy": 1.056496599316597, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9558567374944686, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.93542433977127, "policy_loss": -0.0015436857822351158, "vf_loss": 9.936967992782593, "vf_explained_var": 0.0006865769624710083, "kl": 0.0010177994216292064, "entropy": 1.308013731241226, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.857237426936626, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.306048679351807, "policy_loss": -0.0026135890278965236, "vf_loss": 8.308153712749482, "vf_explained_var": -0.0001863040030002594, "kl": 0.010169725811102048, "entropy": 3.1334288984537126, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 1803.68054658345, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 37920, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1328.6544789563502, "DC1_ls_policy": 3183.6101280980465, "DC2_ls_policy": 467.96853661921, "DC3_ls_policy": -3176.5525970901676}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 63314.27202677757, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94791.02755127451, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005051776926776927, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7234606478516736, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103983.48500933942, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.37676723709576276, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.454836154764039, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 94576622.58665222, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.84336823210623, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1251.8660159949263, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6043227100603146, "mean_inference_ms": 2.249288411561151, "mean_action_processing_ms": 0.3282863143911117, "mean_env_wait_ms": 4.297256777300781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031925164736234224, "StateBufferConnector_ms": 0.0025056875669039213, "ViewRequirementAgentConnector_ms": 0.05421730188223032}, "num_episodes": 2, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 1803.68054658345, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032, "num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 525.7139799183075, "num_env_steps_trained_throughput_per_sec": 525.7139799183075, "timesteps_total": 43008, "num_env_steps_sampled_lifetime": 43008, "num_agent_steps_sampled_lifetime": 172032, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 172032, "timers": {"training_iteration_time_ms": 3943.345, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3943.209, "sample_time_ms": 2518.217, "learn_time_ms": 1359.616, "learn_throughput": 1506.308, "synch_weights_time_ms": 19.115}, "counters": {"num_env_steps_sampled": 43008, "num_env_steps_trained": 43008, "num_agent_steps_sampled": 172032, "num_agent_steps_trained": 172032}, "done": false, "training_iteration": 21, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-04", "timestamp": 1729548244, "time_this_iter_s": 3.9034852981567383, "time_total_s": 81.80575704574585, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af0a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e2c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d570>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b26560>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b26620>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 81.80575704574585, "iterations_since_restore": 21, "perf": {"cpu_util_percent": 18.349999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.213282364606857, "cur_kl_coeff": 1.2207031249999999e-05, "cur_lr": 5.000000000000001e-05, "total_loss": 9.497373270988465, "policy_loss": -0.000568514660699293, "vf_loss": 9.497941768169403, "vf_explained_var": -1.2946128845214843e-05, "kl": 0.0025619660561347463, "entropy": 1.192434549331665, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3778393380343914, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.856413662433624, "policy_loss": -0.0009633830864913762, "vf_loss": 9.857376992702484, "vf_explained_var": -0.0002819016575813293, "kl": 0.0017891523365928142, "entropy": 1.1497433945536613, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9697843920439482, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.940790617465973, "policy_loss": -0.0007021508645266294, "vf_loss": 9.941492772102356, "vf_explained_var": -7.047057151794433e-05, "kl": 0.0007676602317360795, "entropy": 1.305340576171875, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.878816892206669, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.277776628732681, "policy_loss": -0.006968655675882474, "vf_loss": 8.28412531018257, "vf_explained_var": -0.000179387629032135, "kl": 0.012400558353738234, "entropy": 3.1270388931035997, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 1803.68054658345, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 37920, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1328.6544789563502, "DC1_ls_policy": 3183.6101280980465, "DC2_ls_policy": 467.96853661921, "DC3_ls_policy": -3176.5525970901676}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 63314.27202677757, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94791.02755127451, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005051776926776927, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7234606478516736, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103983.48500933942, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.37676723709576276, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.454836154764039, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 94576622.58665222, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.84336823210623, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1251.8660159949263, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6043227100603146, "mean_inference_ms": 2.249288411561151, "mean_action_processing_ms": 0.3282863143911117, "mean_env_wait_ms": 4.297256777300781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031925164736234224, "StateBufferConnector_ms": 0.0025056875669039213, "ViewRequirementAgentConnector_ms": 0.05421730188223032}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 1803.68054658345, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224, "num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 486.5092942673024, "num_env_steps_trained_throughput_per_sec": 486.5092942673024, "timesteps_total": 45056, "num_env_steps_sampled_lifetime": 45056, "num_agent_steps_sampled_lifetime": 180224, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 180224, "timers": {"training_iteration_time_ms": 4009.174, "restore_workers_time_ms": 0.038, "training_step_time_ms": 4009.047, "sample_time_ms": 2574.283, "learn_time_ms": 1367.508, "learn_throughput": 1497.614, "synch_weights_time_ms": 19.622}, "counters": {"num_env_steps_sampled": 45056, "num_env_steps_trained": 45056, "num_agent_steps_sampled": 180224, "num_agent_steps_trained": 180224}, "done": false, "training_iteration": 22, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-08", "timestamp": 1729548248, "time_this_iter_s": 4.21891713142395, "time_total_s": 86.0246741771698, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af6d0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d9c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f580>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72db40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72da80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 86.0246741771698, "iterations_since_restore": 22, "perf": {"cpu_util_percent": 19.849999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4978427831083536, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.709661173820496, "policy_loss": -0.002746441261842847, "vf_loss": 9.712407636642457, "vf_explained_var": -7.068365812301636e-06, "kl": 0.0056699138113515835, "entropy": 1.2517445534467697, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.713231748715043, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.63102685213089, "policy_loss": -0.0009718061541207135, "vf_loss": 9.63199862241745, "vf_explained_var": -0.0002792283892631531, "kl": 0.0017336823121013368, "entropy": 1.167454968392849, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.991884521022439, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.942214596271516, "policy_loss": -0.0017957606818526984, "vf_loss": 9.94401032924652, "vf_explained_var": 0.00046131238341331484, "kl": 0.0013554344717630832, "entropy": 1.3433850437402726, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.4855436459183693, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.091264975070953, "policy_loss": -0.002538441610522568, "vf_loss": 9.093439435958862, "vf_explained_var": 0.0010642781853675842, "kl": 0.007279493659075603, "entropy": 3.1768737554550173, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 1803.68054658345, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 37920, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1328.6544789563502, "DC1_ls_policy": 3183.6101280980465, "DC2_ls_policy": 467.96853661921, "DC3_ls_policy": -3176.5525970901676}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 63314.27202677757, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94791.02755127451, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005051776926776927, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7234606478516736, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103983.48500933942, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.37676723709576276, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.454836154764039, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 94576622.58665222, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.84336823210623, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1251.8660159949263, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6043227100603146, "mean_inference_ms": 2.249288411561151, "mean_action_processing_ms": 0.3282863143911117, "mean_env_wait_ms": 4.297256777300781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031925164736234224, "StateBufferConnector_ms": 0.0025056875669039213, "ViewRequirementAgentConnector_ms": 0.05421730188223032}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 1803.68054658345, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416, "num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 535.4916194611728, "num_env_steps_trained_throughput_per_sec": 535.4916194611728, "timesteps_total": 47104, "num_env_steps_sampled_lifetime": 47104, "num_agent_steps_sampled_lifetime": 188416, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 188416, "timers": {"training_iteration_time_ms": 3996.325, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3996.195, "sample_time_ms": 2564.745, "learn_time_ms": 1364.673, "learn_throughput": 1500.726, "synch_weights_time_ms": 19.407}, "counters": {"num_env_steps_sampled": 47104, "num_env_steps_trained": 47104, "num_agent_steps_sampled": 188416, "num_agent_steps_trained": 188416}, "done": false, "training_iteration": 23, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-12", "timestamp": 1729548252, "time_this_iter_s": 3.832719564437866, "time_total_s": 89.85739374160767, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af910>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dfc0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c0d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ca90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e920>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 89.85739374160767, "iterations_since_restore": 23, "perf": {"cpu_util_percent": 19.349999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7319118697196245, "cur_kl_coeff": 6.1035156249999995e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.384317433834076, "policy_loss": -0.0012270542094483972, "vf_loss": 9.385544562339783, "vf_explained_var": -3.4978240728378295e-05, "kl": 0.0025103022744447, "entropy": 1.1525483056902885, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8705761343240739, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.564094793796539, "policy_loss": -0.0034340970101766287, "vf_loss": 9.567528927326203, "vf_explained_var": -0.0007141530513763428, "kl": 0.004322214492016915, "entropy": 1.120493757724762, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.069412386417389, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.921999061107636, "policy_loss": -0.001975030411267653, "vf_loss": 9.923974013328552, "vf_explained_var": 0.0016980506479740143, "kl": 0.002885060903508929, "entropy": 1.312679499387741, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8534297928214074, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.523307549953461, "policy_loss": -0.004173712595365942, "vf_loss": 8.527038186788559, "vf_explained_var": -0.0011178523302078248, "kl": 0.008861565306142653, "entropy": 3.1867489337921144, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 1803.68054658345, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 37920, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1328.6544789563502, "DC1_ls_policy": 3183.6101280980465, "DC2_ls_policy": 467.96853661921, "DC3_ls_policy": -3176.5525970901676}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 63314.27202677757, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94791.02755127451, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005051776926776927, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7234606478516736, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103983.48500933942, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.37676723709576276, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.454836154764039, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 94576622.58665222, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.84336823210623, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1251.8660159949263, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6043227100603146, "mean_inference_ms": 2.249288411561151, "mean_action_processing_ms": 0.3282863143911117, "mean_env_wait_ms": 4.297256777300781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031925164736234224, "StateBufferConnector_ms": 0.0025056875669039213, "ViewRequirementAgentConnector_ms": 0.05421730188223032}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 1803.68054658345, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608, "num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 521.0573427062093, "num_env_steps_trained_throughput_per_sec": 521.0573427062093, "timesteps_total": 49152, "num_env_steps_sampled_lifetime": 49152, "num_agent_steps_sampled_lifetime": 196608, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 196608, "timers": {"training_iteration_time_ms": 3996.164, "restore_workers_time_ms": 0.036, "training_step_time_ms": 3996.04, "sample_time_ms": 2598.029, "learn_time_ms": 1337.193, "learn_throughput": 1531.566, "synch_weights_time_ms": 18.507}, "counters": {"num_env_steps_sampled": 49152, "num_env_steps_trained": 49152, "num_agent_steps_sampled": 196608, "num_agent_steps_trained": 196608}, "done": false, "training_iteration": 24, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-16", "timestamp": 1729548256, "time_this_iter_s": 3.9359705448150635, "time_total_s": 93.79336428642273, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6870a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753910>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753a00>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753ac0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753bb0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 93.79336428642273, "iterations_since_restore": 24, "perf": {"cpu_util_percent": 19.580000000000002, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4508827213197946, "cur_kl_coeff": 3.0517578124999997e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.66144837141037, "policy_loss": -0.0004841933376155794, "vf_loss": 9.661932635307313, "vf_explained_var": -3.330409526824951e-06, "kl": 0.0021984119206536956, "entropy": 1.2030959367752074, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5563927739858627, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.74199229478836, "policy_loss": -0.0024826970882713796, "vf_loss": 9.74447500705719, "vf_explained_var": -0.0004287675023078918, "kl": 0.00400013089417448, "entropy": 1.1077749714255334, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 0.9876063264906406, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.940704584121704, "policy_loss": -0.0012739236408378929, "vf_loss": 9.941978526115417, "vf_explained_var": -0.0004229016602039337, "kl": 0.0016463573687154564, "entropy": 1.2583730056881905, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8533018067479134, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.92529762983322, "policy_loss": -0.0019301480264402927, "vf_loss": 8.926889109611512, "vf_explained_var": 0.0006464242935180664, "kl": 0.006771499762732465, "entropy": 3.2162877947092054, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 1960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 1803.68054658345, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 37920, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1328.6544789563502, "DC1_ls_policy": 3183.6101280980465, "DC2_ls_policy": 467.96853661921, "DC3_ls_policy": -3176.5525970901676}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 63314.27202677757, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94791.02755127451, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005051776926776927, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7234606478516736, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103983.48500933942, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.37676723709576276, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.454836154764039, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 94576622.58665222, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.84336823210623, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1251.8660159949263, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6043227100603146, "mean_inference_ms": 2.249288411561151, "mean_action_processing_ms": 0.3282863143911117, "mean_env_wait_ms": 4.297256777300781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031925164736234224, "StateBufferConnector_ms": 0.0025056875669039213, "ViewRequirementAgentConnector_ms": 0.05421730188223032}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 1803.68054658345, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800, "num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 548.1831509807448, "num_env_steps_trained_throughput_per_sec": 548.1831509807448, "timesteps_total": 51200, "num_env_steps_sampled_lifetime": 51200, "num_agent_steps_sampled_lifetime": 204800, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 204800, "timers": {"training_iteration_time_ms": 3979.302, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3979.173, "sample_time_ms": 2590.82, "learn_time_ms": 1329.49, "learn_throughput": 1540.44, "synch_weights_time_ms": 17.189}, "counters": {"num_env_steps_sampled": 51200, "num_env_steps_trained": 51200, "num_agent_steps_sampled": 204800, "num_agent_steps_trained": 204800}, "done": false, "training_iteration": 25, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-20", "timestamp": 1729548260, "time_this_iter_s": 3.7437946796417236, "time_total_s": 97.53715896606445, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af6d0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dba0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e920>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ca90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c0d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 97.53715896606445, "iterations_since_restore": 25, "perf": {"cpu_util_percent": 19.166666666666668, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7700933184474708, "cur_kl_coeff": 1.5258789062499999e-06, "cur_lr": 5.000000000000001e-05, "total_loss": 9.446261394023896, "policy_loss": -0.000941032130504027, "vf_loss": 9.447202336788177, "vf_explained_var": -7.55399465560913e-05, "kl": 0.003041140996856484, "entropy": 1.1736558303236961, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8314485356211663, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.646263527870179, "policy_loss": -0.0018085623392835259, "vf_loss": 9.648072147369385, "vf_explained_var": -7.623285055160522e-05, "kl": 0.001856214044079367, "entropy": 1.0998262852430343, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.091336389258504, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.941808009147644, "policy_loss": -0.0018812752154190094, "vf_loss": 9.943689382076263, "vf_explained_var": 0.0009758099913597107, "kl": 0.0029843847143979476, "entropy": 1.2656026616692544, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8172801464796065, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.429837477207183, "policy_loss": -0.004411752882879228, "vf_loss": 8.433777445554734, "vf_explained_var": -0.00011430904269218444, "kl": 0.009435031382088255, "entropy": 3.171803244948387, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 1803.68054658345, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 37920, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1328.6544789563502, "DC1_ls_policy": 3183.6101280980465, "DC2_ls_policy": 467.96853661921, "DC3_ls_policy": -3176.5525970901676}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 63314.27202677757, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94791.02755127451, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005051776926776927, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7234606478516736, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103983.48500933942, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.37676723709576276, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.454836154764039, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 94576622.58665222, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.84336823210623, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1251.8660159949263, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6043227100603146, "mean_inference_ms": 2.249288411561151, "mean_action_processing_ms": 0.3282863143911117, "mean_env_wait_ms": 4.297256777300781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031925164736234224, "StateBufferConnector_ms": 0.0025056875669039213, "ViewRequirementAgentConnector_ms": 0.05421730188223032}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 1803.68054658345, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992, "num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 518.5966674567427, "num_env_steps_trained_throughput_per_sec": 518.5966674567427, "timesteps_total": 53248, "num_env_steps_sampled_lifetime": 53248, "num_agent_steps_sampled_lifetime": 212992, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 212992, "timers": {"training_iteration_time_ms": 3986.64, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3986.503, "sample_time_ms": 2606.968, "learn_time_ms": 1321.821, "learn_throughput": 1549.378, "synch_weights_time_ms": 16.812}, "counters": {"num_env_steps_sampled": 53248, "num_env_steps_trained": 53248, "num_agent_steps_sampled": 212992, "num_agent_steps_trained": 212992}, "done": false, "training_iteration": 26, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-24", "timestamp": 1729548264, "time_this_iter_s": 3.9550621509552, "time_total_s": 101.49222111701965, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b687eb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e3634f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e3636d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363820>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363a00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 101.49222111701965, "iterations_since_restore": 26, "perf": {"cpu_util_percent": 15.879999999999999, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9219708815217018, "cur_kl_coeff": 7.629394531249999e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.258260822296142, "policy_loss": -0.0019516496569849551, "vf_loss": 9.260212314128875, "vf_explained_var": -2.5679171085357665e-05, "kl": 0.0031851439636511715, "entropy": 1.141226628422737, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.3178825326263905, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.172257423400879, "policy_loss": -0.0011351060937158763, "vf_loss": 9.173392534255981, "vf_explained_var": -0.0003580242395401001, "kl": 0.001246375434619583, "entropy": 1.1207990422844887, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.0516295678913594, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.94048171043396, "policy_loss": -0.0023481986601836978, "vf_loss": 9.942829930782318, "vf_explained_var": 0.0005998849868774414, "kl": 0.0006993329516718043, "entropy": 1.2522379770874976, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.052558508515358, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.147586745023727, "policy_loss": -0.002575657796114683, "vf_loss": 8.149811345338822, "vf_explained_var": -0.0006189063191413879, "kl": 0.007021068720354151, "entropy": 3.16051370203495, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 1803.68054658345, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 37920, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1328.6544789563502, "DC1_ls_policy": 3183.6101280980465, "DC2_ls_policy": 467.96853661921, "DC3_ls_policy": -3176.5525970901676}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 63314.27202677757, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94791.02755127451, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005051776926776927, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7234606478516736, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103983.48500933942, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.37676723709576276, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.454836154764039, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 94576622.58665222, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.84336823210623, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1251.8660159949263, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6043227100603146, "mean_inference_ms": 2.249288411561151, "mean_action_processing_ms": 0.3282863143911117, "mean_env_wait_ms": 4.297256777300781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031925164736234224, "StateBufferConnector_ms": 0.0025056875669039213, "ViewRequirementAgentConnector_ms": 0.05421730188223032}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 1803.68054658345, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184, "num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 585.6680410993462, "num_env_steps_trained_throughput_per_sec": 585.6680410993462, "timesteps_total": 55296, "num_env_steps_sampled_lifetime": 55296, "num_agent_steps_sampled_lifetime": 221184, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 221184, "timers": {"training_iteration_time_ms": 3938.684, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3938.544, "sample_time_ms": 2570.064, "learn_time_ms": 1314.064, "learn_throughput": 1558.524, "synch_weights_time_ms": 15.694}, "counters": {"num_env_steps_sampled": 55296, "num_env_steps_trained": 55296, "num_agent_steps_sampled": 221184, "num_agent_steps_trained": 221184}, "done": false, "training_iteration": 27, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-28", "timestamp": 1729548268, "time_this_iter_s": 3.504009962081909, "time_total_s": 104.99623107910156, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af520>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7522c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752140>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752350>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752410>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 104.99623107910156, "iterations_since_restore": 27, "perf": {"cpu_util_percent": 5.680000000000001, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8598232224583626, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.453522086143494, "policy_loss": -0.002718779444694519, "vf_loss": 9.456240892410278, "vf_explained_var": -8.51854681968689e-05, "kl": 0.0064098504228240925, "entropy": 1.1634845405817031, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7136392146348953, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.462813532352447, "policy_loss": -0.002210835483856499, "vf_loss": 9.465024518966676, "vf_explained_var": -0.00025971829891204836, "kl": 0.003110941640420733, "entropy": 1.1618357956409455, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.030860237404704, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.939758265018463, "policy_loss": -0.003531945205759257, "vf_loss": 9.943290305137634, "vf_explained_var": -0.0003778010606765747, "kl": 0.0063548691087397914, "entropy": 1.2465396240353583, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6073974132537843, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.139064025878906, "policy_loss": -0.004320824006572366, "vf_loss": 9.142922234535217, "vf_explained_var": 0.0010228835046291352, "kl": 0.009252759310948527, "entropy": 3.091653063893318, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -2236.9682761550775, "episode_reward_mean": 1803.68054658345, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 37920, "policy_reward_min": {"high_level_policy": 688.6625180742578, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -1049.6509226057003, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1328.6544789563502, "DC1_ls_policy": 3183.6101280980465, "DC2_ls_policy": 467.96853661921, "DC3_ls_policy": -3176.5525970901676}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 63314.27202677757, "DC1_ls_policy/bat_CO2_footprint_sum_min": 49428.7947618882, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94791.02755127451, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 103833.65809925452, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005051776926776927, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7234606478516736, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 1.951522435897436, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 103983.48500933942, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.37676723709576276, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.454836154764039, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 94576622.58665222, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.84336823210623, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1251.8660159949263, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6043227100603146, "mean_inference_ms": 2.249288411561151, "mean_action_processing_ms": 0.3282863143911117, "mean_env_wait_ms": 4.297256777300781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031925164736234224, "StateBufferConnector_ms": 0.0025056875669039213, "ViewRequirementAgentConnector_ms": 0.05421730188223032}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -2236.9682761550775, "episode_return_mean": 1803.68054658345, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376, "num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 564.857964890029, "num_env_steps_trained_throughput_per_sec": 564.857964890029, "timesteps_total": 57344, "num_env_steps_sampled_lifetime": 57344, "num_agent_steps_sampled_lifetime": 229376, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 229376, "timers": {"training_iteration_time_ms": 3910.772, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3910.627, "sample_time_ms": 2555.696, "learn_time_ms": 1303.35, "learn_throughput": 1571.335, "synch_weights_time_ms": 14.765}, "counters": {"num_env_steps_sampled": 57344, "num_env_steps_trained": 57344, "num_agent_steps_sampled": 229376, "num_agent_steps_trained": 229376}, "done": false, "training_iteration": 28, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-31", "timestamp": 1729548271, "time_this_iter_s": 3.633455991744995, "time_total_s": 108.62968707084656, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af6d0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752620>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752710>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7527d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752890>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 108.62968707084656, "iterations_since_restore": 28, "perf": {"cpu_util_percent": 4.04, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6804293490946294, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.459154546260834, "policy_loss": -0.003144495899323374, "vf_loss": 9.462299001216888, "vf_explained_var": -0.00029293149709701537, "kl": 0.007056913725426861, "entropy": 1.0396052449941635, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.569855833426118, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.538076138496399, "policy_loss": -0.004083918442483991, "vf_loss": 9.542160069942474, "vf_explained_var": -6.669014692306519e-05, "kl": 0.004165257621559703, "entropy": 1.2040666043758392, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.180380031466484, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.93265072107315, "policy_loss": -0.00279989450937137, "vf_loss": 9.935450720787049, "vf_explained_var": 0.00043357387185096743, "kl": 0.004903290850080566, "entropy": 1.213926911354065, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.168796174228191, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 8.098315250873565, "policy_loss": -0.0008605150505900383, "vf_loss": 8.098904520273209, "vf_explained_var": -0.0005280300974845886, "kl": 0.005423182466802246, "entropy": 3.0787403136491776, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1409.7104798986923, "episode_len_mean": 2880.0, "episode_media": {}, "episodes_timesteps_total": 40320, "policy_reward_min": {"high_level_policy": -96.57468149547907, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2245.3079158289174, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1226.8523960669338, "DC1_ls_policy": 3202.6225534804616, "DC2_ls_policy": 274.16307573005804, "DC3_ls_policy": -3293.9275453787714}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 62224.59627065212, "DC1_ls_policy/bat_CO2_footprint_sum_min": 48058.81144102114, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 96721.38878836749, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 121816.08487057622, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004690935717721432, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.822022982528935, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 104923.02723864079, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.373158863017494, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.5920800008523224, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 93810109.73419516, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 134.60109639409862, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1330.9935327095743, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6035989170944773, "mean_inference_ms": 2.2490358704149664, "mean_action_processing_ms": 0.32769174142098073, "mean_env_wait_ms": 4.302014152089742, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003308483532496861, "StateBufferConnector_ms": 0.0025025435856410433, "ViewRequirementAgentConnector_ms": 0.054210850170680454}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 1409.7104798986923, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568, "num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 547.7852594009339, "num_env_steps_trained_throughput_per_sec": 547.7852594009339, "timesteps_total": 59392, "num_env_steps_sampled_lifetime": 59392, "num_agent_steps_sampled_lifetime": 237568, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 237568, "timers": {"training_iteration_time_ms": 3875.498, "restore_workers_time_ms": 0.05, "training_step_time_ms": 3875.348, "sample_time_ms": 2509.3, "learn_time_ms": 1317.772, "learn_throughput": 1554.139, "synch_weights_time_ms": 13.698}, "counters": {"num_env_steps_sampled": 59392, "num_env_steps_trained": 59392, "num_agent_steps_sampled": 237568, "num_agent_steps_trained": 237568}, "done": false, "training_iteration": 29, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-35", "timestamp": 1729548275, "time_this_iter_s": 3.7452826499938965, "time_total_s": 112.37496972084045, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2ae050>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b257e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b25c90>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b25ea0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b260e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 112.37496972084045, "iterations_since_restore": 29, "perf": {"cpu_util_percent": 3.7166666666666672, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.6421205069869758, "cur_kl_coeff": 3.8146972656249997e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.767395830154419, "policy_loss": -0.0022900126059539616, "vf_loss": 9.76968582868576, "vf_explained_var": -6.581321358680725e-05, "kl": 0.002175623941025344, "entropy": 1.0198979884386064, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8715981818735599, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.007216930389404, "policy_loss": -0.0028586542466655374, "vf_loss": 9.010075616836549, "vf_explained_var": -0.0004887655377388, "kl": 0.002612308197483415, "entropy": 1.2027971565723419, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3134237814694643, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.914354348182679, "policy_loss": -0.003248084965161979, "vf_loss": 9.917602491378783, "vf_explained_var": 0.0008361190557479858, "kl": 0.0029935789697835176, "entropy": 1.2179323211312294, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7838990926742553, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 7.899028581380844, "policy_loss": -0.002765370043925941, "vf_loss": 7.901402980089188, "vf_explained_var": 0.0010444164276123048, "kl": 0.007820622902636387, "entropy": 2.964971035718918, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1244.710379084743, "episode_len_mean": 2832.0, "episode_media": {}, "episodes_timesteps_total": 45312, "policy_reward_min": {"high_level_policy": -96.57468149547907, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2245.3079158289174, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1131.573215570849, "DC1_ls_policy": 3254.4781814099465, "DC2_ls_policy": 38.679676572350616, "DC3_ls_policy": -3180.0206944684114}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 60573.58722266133, "DC1_ls_policy/bat_CO2_footprint_sum_min": 48058.81144102114, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 99656.13285588771, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 122229.96393044095, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004104568753006253, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8911951898410231, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 105117.25684752314, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.34817366058902516, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.507678374143218, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 92782051.47337343, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 126.82447446903501, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1359.073254882897, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6021488979472809, "mean_inference_ms": 2.244887083441367, "mean_action_processing_ms": 0.3264721401280176, "mean_env_wait_ms": 4.300082384132655, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032532960176467896, "StateBufferConnector_ms": 0.0025033950805664062, "ViewRequirementAgentConnector_ms": 0.05404278635978699}, "num_episodes": 2, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 1244.710379084743, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760, "num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 586.3802018514874, "num_env_steps_trained_throughput_per_sec": 586.3802018514874, "timesteps_total": 61440, "num_env_steps_sampled_lifetime": 61440, "num_agent_steps_sampled_lifetime": 245760, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 245760, "timers": {"training_iteration_time_ms": 3789.957, "restore_workers_time_ms": 0.049, "training_step_time_ms": 3789.815, "sample_time_ms": 2426.675, "learn_time_ms": 1320.242, "learn_throughput": 1551.231, "synch_weights_time_ms": 13.417}, "counters": {"num_env_steps_sampled": 61440, "num_env_steps_trained": 61440, "num_agent_steps_sampled": 245760, "num_agent_steps_trained": 245760}, "done": false, "training_iteration": 30, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-39", "timestamp": 1729548279, "time_this_iter_s": 3.5012145042419434, "time_total_s": 115.8761842250824, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2afeb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d090>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d7b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72da20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c1c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 115.8761842250824, "iterations_since_restore": 30, "perf": {"cpu_util_percent": 4.000000000000001, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4747861668467521, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.741575586795808, "policy_loss": -0.004563272651284933, "vf_loss": 9.746138727664947, "vf_explained_var": 0.00025008544325828553, "kl": 0.006113328677383937, "entropy": 1.0934236466884613, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5788535129278898, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.593186068534852, "policy_loss": -0.0032536393380723895, "vf_loss": 9.596439731121063, "vf_explained_var": -0.00016423612833023072, "kl": 0.0026267398763536675, "entropy": 1.1978002145886422, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2926250025629997, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.912744569778443, "policy_loss": -0.0003789843642152846, "vf_loss": 9.913123512268067, "vf_explained_var": 0.0007897645235061645, "kl": 0.000651064943232945, "entropy": 1.2680793926119804, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.594890849292278, "cur_kl_coeff": 0.049999999999999996, "cur_lr": 5.000000000000001e-05, "total_loss": 9.032768964767456, "policy_loss": -0.0010257610818371176, "vf_loss": 9.033627820014953, "vf_explained_var": 0.0006985969841480256, "kl": 0.0033390914755817985, "entropy": 2.959349426627159, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1077.5576636801998, "episode_len_mean": 2817.8823529411766, "episode_media": {}, "episodes_timesteps_total": 47904, "policy_reward_min": {"high_level_policy": -96.57468149547907, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2245.3079158289174, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 4535.083852268878, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 1095.9960851328572, "DC1_ls_policy": 3280.890092979361, "DC2_ls_policy": -75.57508589765487, "DC3_ls_policy": -3223.753428534371}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 59748.8569277421, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46553.17220903443, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 100638.0362392294, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 122229.96393044095, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0038631235322411795, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9420308395308394, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 105518.42017661544, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 120531.81567515845, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.3494566551368022, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.5355718394260065, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 92587159.72137284, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 128.8225786397018, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1400.754102589495, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2497.6550925925926}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6042217612752387, "mean_inference_ms": 2.249420097865487, "mean_action_processing_ms": 0.3274744441173665, "mean_env_wait_ms": 4.320419420141166, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032274162068086512, "StateBufferConnector_ms": 0.0025107580072739545, "ViewRequirementAgentConnector_ms": 0.05404598572674919}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 1077.5576636801998, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952, "num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 563.3211643668254, "num_env_steps_trained_throughput_per_sec": 563.3211643668254, "timesteps_total": 63488, "num_env_steps_sampled_lifetime": 63488, "num_agent_steps_sampled_lifetime": 253952, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 253952, "timers": {"training_iteration_time_ms": 3763.942, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3763.816, "sample_time_ms": 2410.284, "learn_time_ms": 1314.136, "learn_throughput": 1558.439, "synch_weights_time_ms": 12.696}, "counters": {"num_env_steps_sampled": 63488, "num_env_steps_trained": 63488, "num_agent_steps_sampled": 253952, "num_agent_steps_trained": 253952}, "done": false, "training_iteration": 31, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-43", "timestamp": 1729548283, "time_this_iter_s": 3.645031690597534, "time_total_s": 119.52121591567993, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2ae050>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cf70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c580>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f0d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72da80>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 119.52121591567993, "iterations_since_restore": 31, "perf": {"cpu_util_percent": 4.02, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.114907479286194, "cur_kl_coeff": 1.9073486328124998e-07, "cur_lr": 5.000000000000001e-05, "total_loss": 9.307203161716462, "policy_loss": -0.0014257337083108724, "vf_loss": 9.308628761768341, "vf_explained_var": -6.12013041973114e-05, "kl": 0.002544653481663934, "entropy": 1.0383184745907783, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8700584016740323, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.383983409404754, "policy_loss": -0.0034076927928254007, "vf_loss": 9.387391233444214, "vf_explained_var": -0.00127829909324646, "kl": 0.0030136245317408613, "entropy": 1.177110531926155, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.1515630893409252, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.916248893737793, "policy_loss": -0.002221843390725553, "vf_loss": 9.918470656871795, "vf_explained_var": 0.001297973096370697, "kl": 0.003363727036163825, "entropy": 1.256430235505104, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.9001475423574448, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.57907846570015, "policy_loss": -0.003226761083351448, "vf_loss": 8.582109916210175, "vf_explained_var": -0.0005130268633365631, "kl": 0.007812418811909083, "entropy": 2.9446460366249085, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 805.6129256088125, "episode_len_mean": 2874.9473684210525, "episode_media": {}, "episodes_timesteps_total": 54624, "policy_reward_min": {"high_level_policy": -96.57468149547907, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 5842.841520495375, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 995.7948360167029, "DC1_ls_policy": 3446.8477091700925, "DC2_ls_policy": -300.84424939642685, "DC3_ls_policy": -3336.1853701815635}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 58433.00371320671, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 102653.49488752068, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0067720595681122, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0248611354532406, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 106549.55850571675, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 122964.13318699386, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.32436112376901854, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.5140159795532604, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 95072777.69261086, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 141618860.09563276, "accumulated/ls_tasks_dropped_sum_mean": 124.01178343358032, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1483.5551748237042, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2799.625062003968}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6036963422029967, "mean_inference_ms": 2.2506517402013615, "mean_action_processing_ms": 0.3268126953695493, "mean_env_wait_ms": 4.324896620256209, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003183201739662572, "StateBufferConnector_ms": 0.0025115515056409335, "ViewRequirementAgentConnector_ms": 0.05397043730083265}, "num_episodes": 2, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 805.6129256088125, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144, "num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 585.50137546158, "num_env_steps_trained_throughput_per_sec": 585.50137546158, "timesteps_total": 65536, "num_env_steps_sampled_lifetime": 65536, "num_agent_steps_sampled_lifetime": 262144, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 262144, "timers": {"training_iteration_time_ms": 3692.77, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3692.642, "sample_time_ms": 2349.543, "learn_time_ms": 1309.203, "learn_throughput": 1564.31, "synch_weights_time_ms": 11.866}, "counters": {"num_env_steps_sampled": 65536, "num_env_steps_trained": 65536, "num_agent_steps_sampled": 262144, "num_agent_steps_trained": 262144}, "done": false, "training_iteration": 32, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-46", "timestamp": 1729548286, "time_this_iter_s": 3.505432367324829, "time_total_s": 123.02664828300476, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66a320>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ca30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d690>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d240>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dc60>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 123.02664828300476, "iterations_since_restore": 32, "perf": {"cpu_util_percent": 3.9200000000000004, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9824073627591132, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.3775510430336, "policy_loss": -0.004497161007020622, "vf_loss": 9.382048225402832, "vf_explained_var": -9.775236248970032e-05, "kl": 0.009126241791773442, "entropy": 0.982786750048399, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.063988618552685, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.219370996952057, "policy_loss": -0.0018974505714140833, "vf_loss": 9.221268510818481, "vf_explained_var": -7.327497005462646e-05, "kl": 0.0014028881834988738, "entropy": 1.1472434371709823, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2301465500146151, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.92763888835907, "policy_loss": -0.002029297291301191, "vf_loss": 9.92966823577881, "vf_explained_var": 0.0005021728575229645, "kl": 0.003687633869412821, "entropy": 1.2183005452156066, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.987745213508606, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.443730676174164, "policy_loss": -0.005474027886521071, "vf_loss": 8.44892371892929, "vf_explained_var": -8.305981755256653e-05, "kl": 0.011239772591557553, "entropy": 2.811693602800369, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 745.6594516612538, "episode_len_mean": 2942.4, "episode_media": {}, "episodes_timesteps_total": 58848, "policy_reward_min": {"high_level_policy": -458.1268159163014, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 5870.309673529274, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 923.0987534200527, "DC1_ls_policy": 3568.0208073880517, "DC2_ls_policy": -364.5984404145598, "DC3_ls_policy": -3380.8616687322974}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 57872.89964013015, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 103574.79483769755, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.006433456589706591, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0239021695896695, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 107327.70490582043, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 122964.13318699386, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.3143693933381434, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.4613502184543847, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 97804306.99561767, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 149703363.7527473, "accumulated/ls_tasks_dropped_sum_mean": 122.3735847685301, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1533.8331600455872, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 2799.625062003968}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6047412930090491, "mean_inference_ms": 2.2551722995671435, "mean_action_processing_ms": 0.3275932997520349, "mean_env_wait_ms": 4.339665943429053, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003166794776916504, "StateBufferConnector_ms": 0.0025081634521484375, "ViewRequirementAgentConnector_ms": 0.05396246910095215}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 745.6594516612538, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336, "num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 568.4783434242868, "num_env_steps_trained_throughput_per_sec": 568.4783434242868, "timesteps_total": 67584, "num_env_steps_sampled_lifetime": 67584, "num_agent_steps_sampled_lifetime": 270336, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 270336, "timers": {"training_iteration_time_ms": 3670.575, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3670.453, "sample_time_ms": 2331.621, "learn_time_ms": 1307.546, "learn_throughput": 1566.293, "synch_weights_time_ms": 11.046}, "counters": {"num_env_steps_sampled": 67584, "num_env_steps_trained": 67584, "num_agent_steps_sampled": 270336, "num_agent_steps_trained": 270336}, "done": false, "training_iteration": 33, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-50", "timestamp": 1729548290, "time_this_iter_s": 3.609893321990967, "time_total_s": 126.63654160499573, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e3611e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363c70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363dc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363c40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 126.63654160499573, "iterations_since_restore": 33, "perf": {"cpu_util_percent": 3.96, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7248372618108987, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.599058496952058, "policy_loss": -0.0042668288107961415, "vf_loss": 9.603325283527374, "vf_explained_var": -0.00010407418012619019, "kl": 0.005410882754063311, "entropy": 1.0262088045477866, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.091413116455078, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.228746175765991, "policy_loss": -0.00021885972819291055, "vf_loss": 9.228965055942535, "vf_explained_var": -6.643682718276978e-05, "kl": 0.0017614602997583551, "entropy": 1.1234827205538749, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2943323861807585, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.906771183013916, "policy_loss": -0.00032423818483948705, "vf_loss": 9.90709537267685, "vf_explained_var": 0.0007271058857440948, "kl": 0.0002258738599608158, "entropy": 1.2334109574556351, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.91856719404459, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.002560818195343, "policy_loss": -0.0030138767324388027, "vf_loss": 9.005440104007722, "vf_explained_var": 8.483827114105224e-05, "kl": 0.005379088126301212, "entropy": 2.8304296523332595, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 583.1719385525129, "episode_len_mean": 3008.0, "episode_media": {}, "episodes_timesteps_total": 63168, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 809.0134339685927, "DC1_ls_policy": 3692.0737846256607, "DC2_ls_policy": -436.24327110598875, "DC3_ls_policy": -3481.672008935759}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 57620.44352545372, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 104495.72748898473, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.00631449128472938, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0355505671577099, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108243.49779619017, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 126559.35560358495, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.3075674116447926, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.4418502962352164, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100877189.6278681, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 123.33743357584878, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1608.5975008591133, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048542086181244, "mean_inference_ms": 2.2559053870358823, "mean_action_processing_ms": 0.32751832078891874, "mean_env_wait_ms": 4.344576478047201, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031667096274239676, "StateBufferConnector_ms": 0.0025045304071335565, "ViewRequirementAgentConnector_ms": 0.05394844781784784}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 583.1719385525129, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528, "num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 583.5573609664001, "num_env_steps_trained_throughput_per_sec": 583.5573609664001, "timesteps_total": 69632, "num_env_steps_sampled_lifetime": 69632, "num_agent_steps_sampled_lifetime": 278528, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 278528, "timers": {"training_iteration_time_ms": 3628.475, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3628.355, "sample_time_ms": 2276.333, "learn_time_ms": 1320.32, "learn_throughput": 1551.139, "synch_weights_time_ms": 11.048}, "counters": {"num_env_steps_sampled": 69632, "num_env_steps_trained": 69632, "num_agent_steps_sampled": 278528, "num_agent_steps_trained": 278528}, "done": false, "training_iteration": 34, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-53", "timestamp": 1729548293, "time_this_iter_s": 3.517204761505127, "time_total_s": 130.15374636650085, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66a290>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750880>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750ac0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750e80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750fa0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 130.15374636650085, "iterations_since_restore": 34, "perf": {"cpu_util_percent": 4.0600000000000005, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.85564766228199, "cur_kl_coeff": 9.536743164062499e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.28362295627594, "policy_loss": -0.0029159871337469667, "vf_loss": 9.28653905391693, "vf_explained_var": 0.00037735477089881895, "kl": 0.004764877658260502, "entropy": 1.0251397848129273, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8849623188376428, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.397600769996643, "policy_loss": -0.001183219230733812, "vf_loss": 9.398783969879151, "vf_explained_var": -0.00028798133134841917, "kl": 0.0011634980098122582, "entropy": 1.1260978922247886, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.092940528690815, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.929736113548278, "policy_loss": -0.004572046687826514, "vf_loss": 9.934308135509491, "vf_explained_var": 7.796213030815124e-05, "kl": 0.004894777788592819, "entropy": 1.244029213488102, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.641718402504921, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.378090018033982, "policy_loss": -0.003203260211739689, "vf_loss": 8.381031429767608, "vf_explained_var": -9.815841913223267e-05, "kl": 0.010472930886408487, "entropy": 2.7747629165649412, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 583.1719385525129, "episode_len_mean": 3008.0, "episode_media": {}, "episodes_timesteps_total": 63168, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 809.0134339685927, "DC1_ls_policy": 3692.0737846256607, "DC2_ls_policy": -436.24327110598875, "DC3_ls_policy": -3481.672008935759}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 57620.44352545372, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 104495.72748898473, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.00631449128472938, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0355505671577099, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108243.49779619017, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 126559.35560358495, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.3075674116447926, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.4418502962352164, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100877189.6278681, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 123.33743357584878, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1608.5975008591133, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048542086181244, "mean_inference_ms": 2.2559053870358823, "mean_action_processing_ms": 0.32751832078891874, "mean_env_wait_ms": 4.344576478047201, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031667096274239676, "StateBufferConnector_ms": 0.0025045304071335565, "ViewRequirementAgentConnector_ms": 0.05394844781784784}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 583.1719385525129, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720, "num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 573.0047337622296, "num_env_steps_trained_throughput_per_sec": 573.0047337622296, "timesteps_total": 71680, "num_env_steps_sampled_lifetime": 71680, "num_agent_steps_sampled_lifetime": 286720, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 286720, "timers": {"training_iteration_time_ms": 3612.29, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3612.176, "sample_time_ms": 2261.138, "learn_time_ms": 1321.23, "learn_throughput": 1550.07, "synch_weights_time_ms": 10.795}, "counters": {"num_env_steps_sampled": 71680, "num_env_steps_trained": 71680, "num_agent_steps_sampled": 286720, "num_agent_steps_trained": 286720}, "done": false, "training_iteration": 35, "trial_id": "2c069_00000", "date": "2024-10-21_22-04-57", "timestamp": 1729548297, "time_this_iter_s": 3.58097505569458, "time_total_s": 133.73472142219543, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2adfc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751a20>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751b40>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752020>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7520e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 133.73472142219543, "iterations_since_restore": 35, "perf": {"cpu_util_percent": 3.8800000000000003, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8167455166578292, "cur_kl_coeff": 4.7683715820312496e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.57184511423111, "policy_loss": -0.002373238012660295, "vf_loss": 9.574218475818634, "vf_explained_var": 0.0005321554839611053, "kl": 0.004166823870127852, "entropy": 1.035926665365696, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8191360026597976, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.288023459911347, "policy_loss": -0.007357695454265923, "vf_loss": 9.295381164550781, "vf_explained_var": -7.599592208862305e-05, "kl": 0.010340435320449707, "entropy": 1.0995403200387954, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3005993753671645, "cur_kl_coeff": 1.164153218269348e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.922931921482085, "policy_loss": -0.0021700645855162294, "vf_loss": 9.925101888179778, "vf_explained_var": 6.95832073688507e-05, "kl": 0.004055716547546318, "entropy": 1.2427293598651885, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8683069080114363, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 9.016121470928192, "policy_loss": -0.004553827858762816, "vf_loss": 9.020458829402923, "vf_explained_var": 2.0741671323776246e-05, "kl": 0.008659567352333397, "entropy": 2.8236542671918867, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 583.1719385525129, "episode_len_mean": 3008.0, "episode_media": {}, "episodes_timesteps_total": 63168, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 809.0134339685927, "DC1_ls_policy": 3692.0737846256607, "DC2_ls_policy": -436.24327110598875, "DC3_ls_policy": -3481.672008935759}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 57620.44352545372, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 104495.72748898473, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.00631449128472938, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0355505671577099, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108243.49779619017, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 126559.35560358495, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.3075674116447926, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.4418502962352164, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100877189.6278681, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 123.33743357584878, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1608.5975008591133, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048542086181244, "mean_inference_ms": 2.2559053870358823, "mean_action_processing_ms": 0.32751832078891874, "mean_env_wait_ms": 4.344576478047201, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031667096274239676, "StateBufferConnector_ms": 0.0025045304071335565, "ViewRequirementAgentConnector_ms": 0.05394844781784784}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 583.1719385525129, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912, "num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 592.7910396364224, "num_env_steps_trained_throughput_per_sec": 592.7910396364224, "timesteps_total": 73728, "num_env_steps_sampled_lifetime": 73728, "num_agent_steps_sampled_lifetime": 294912, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 294912, "timers": {"training_iteration_time_ms": 3562.859, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3562.75, "sample_time_ms": 2209.565, "learn_time_ms": 1323.456, "learn_throughput": 1547.463, "synch_weights_time_ms": 10.758}, "counters": {"num_env_steps_sampled": 73728, "num_env_steps_trained": 73728, "num_agent_steps_sampled": 294912, "num_agent_steps_trained": 294912}, "done": false, "training_iteration": 36, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-01", "timestamp": 1729548301, "time_this_iter_s": 3.4631025791168213, "time_total_s": 137.19782400131226, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66a290>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7514e0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7517b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7518d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7521a0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 137.19782400131226, "iterations_since_restore": 36, "perf": {"cpu_util_percent": 3.7000000000000006, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0789144583046437, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.516366124153137, "policy_loss": -0.004577789071481675, "vf_loss": 9.520943975448608, "vf_explained_var": 0.0005845017731189728, "kl": 0.007159611661535542, "entropy": 0.9573318973183632, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4962168537080287, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.315356874465943, "policy_loss": -0.0034200527297798544, "vf_loss": 9.318777012825013, "vf_explained_var": -4.2487680912017825e-05, "kl": 0.006381461838077597, "entropy": 1.1303445726633072, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3358196530491113, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.916894626617431, "policy_loss": -0.0007319520460441709, "vf_loss": 9.917626535892486, "vf_explained_var": 0.0011111184954643249, "kl": 0.0019556191244419693, "entropy": 1.26820467710495, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.845657068490982, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.84296852350235, "policy_loss": -0.0021627008507493885, "vf_loss": 8.844942378997803, "vf_explained_var": 3.7489086389541625e-05, "kl": 0.007556263361039399, "entropy": 2.7520169645547865, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 2920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 583.1719385525129, "episode_len_mean": 3008.0, "episode_media": {}, "episodes_timesteps_total": 63168, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 809.0134339685927, "DC1_ls_policy": 3692.0737846256607, "DC2_ls_policy": -436.24327110598875, "DC3_ls_policy": -3481.672008935759}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 57620.44352545372, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 104495.72748898473, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.00631449128472938, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 1.0355505671577099, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108243.49779619017, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 126559.35560358495, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.3075674116447926, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.4418502962352164, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100877189.6278681, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 123.33743357584878, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1608.5975008591133, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048542086181244, "mean_inference_ms": 2.2559053870358823, "mean_action_processing_ms": 0.32751832078891874, "mean_env_wait_ms": 4.344576478047201, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031667096274239676, "StateBufferConnector_ms": 0.0025045304071335565, "ViewRequirementAgentConnector_ms": 0.05394844781784784}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 583.1719385525129, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104, "num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 560.3539449479043, "num_env_steps_trained_throughput_per_sec": 560.3539449479043, "timesteps_total": 75776, "num_env_steps_sampled_lifetime": 75776, "num_agent_steps_sampled_lifetime": 303104, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 303104, "timers": {"training_iteration_time_ms": 3578.656, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3578.547, "sample_time_ms": 2220.603, "learn_time_ms": 1327.105, "learn_throughput": 1543.208, "synch_weights_time_ms": 10.812}, "counters": {"num_env_steps_sampled": 75776, "num_env_steps_trained": 75776, "num_agent_steps_sampled": 303104, "num_agent_steps_trained": 303104}, "done": false, "training_iteration": 37, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-04", "timestamp": 1729548304, "time_this_iter_s": 3.6639404296875, "time_total_s": 140.86176443099976, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66a4d0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750a00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750e50>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750f40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751030>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 140.86176443099976, "iterations_since_restore": 37, "perf": {"cpu_util_percent": 4.26, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9567841447889804, "cur_kl_coeff": 2.3841857910156248e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.541012907028199, "policy_loss": -0.0004277113126590848, "vf_loss": 9.541440653800965, "vf_explained_var": 8.872896432876588e-06, "kl": 0.004146968575332722, "entropy": 0.8515140414237976, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0997782558202744, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.320188105106354, "policy_loss": -0.0027530687861144544, "vf_loss": 9.322941040992736, "vf_explained_var": -6.046593189239502e-05, "kl": 0.0021327924264826306, "entropy": 1.0493734180927277, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.293315713480115, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.916489124298096, "policy_loss": -0.0012144381180405617, "vf_loss": 9.917703497409821, "vf_explained_var": 0.0005160979926586151, "kl": 0.0027715773788372644, "entropy": 1.265006698668003, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.172880032658577, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.710711336135864, "policy_loss": -0.0057270180899649855, "vf_loss": 8.716149878501891, "vf_explained_var": -0.00011181831359863281, "kl": 0.01153578726350588, "entropy": 2.6949385911226273, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 651.2226147497694, "episode_len_mean": 2980.3636363636365, "episode_media": {}, "episodes_timesteps_total": 65568, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 771.4319572560752, "DC1_ls_policy": 3679.081095060123, "DC2_ls_policy": -414.4021488631441, "DC3_ls_policy": -3384.888288703292}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 57172.95879129822, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105049.82411285072, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.006027468953605317, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9959043292566019, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 108819.1917310977, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 126559.35560358495, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.2935870747518475, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.3318419494366456, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100225949.20849584, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 117.73118659512838, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1558.8442101003654, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6044381285885675, "mean_inference_ms": 2.255222889514558, "mean_action_processing_ms": 0.3271685913732121, "mean_env_wait_ms": 4.344887071817372, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003246285698630593, "StateBufferConnector_ms": 0.002512335777282715, "ViewRequirementAgentConnector_ms": 0.05412101745605469}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 651.2226147497694, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296, "num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 583.0361517746289, "num_env_steps_trained_throughput_per_sec": 583.0361517746289, "timesteps_total": 77824, "num_env_steps_sampled_lifetime": 77824, "num_agent_steps_sampled_lifetime": 311296, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 311296, "timers": {"training_iteration_time_ms": 3567.352, "restore_workers_time_ms": 0.04, "training_step_time_ms": 3567.243, "sample_time_ms": 2202.128, "learn_time_ms": 1332.566, "learn_throughput": 1536.884, "synch_weights_time_ms": 11.066}, "counters": {"num_env_steps_sampled": 77824, "num_env_steps_trained": 77824, "num_agent_steps_sampled": 311296, "num_agent_steps_trained": 311296}, "done": false, "training_iteration": 38, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-08", "timestamp": 1729548308, "time_this_iter_s": 3.521047592163086, "time_total_s": 144.38281202316284, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2adfc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363640>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363730>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363820>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363910>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 144.38281202316284, "iterations_since_restore": 38, "perf": {"cpu_util_percent": 4.14, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.177447985112667, "cur_kl_coeff": 1.1920928955078124e-08, "cur_lr": 5.000000000000001e-05, "total_loss": 9.303546798229217, "policy_loss": -0.0008680205792188644, "vf_loss": 9.304414772987366, "vf_explained_var": 0.00018652155995368958, "kl": 0.003665193677807424, "entropy": 0.7704845108091831, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9539588540792465, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.200059080123902, "policy_loss": -0.0021483063756022602, "vf_loss": 9.202207446098328, "vf_explained_var": -1.8061697483062743e-05, "kl": 0.0033419055883315493, "entropy": 1.149809055030346, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2480073768645525, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.923742580413819, "policy_loss": -0.0012738980352878571, "vf_loss": 9.92501654624939, "vf_explained_var": 2.204775810241699e-05, "kl": 0.0018344824271650851, "entropy": 1.237542748451233, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.163732077181339, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.148685133457183, "policy_loss": -0.00647999943466857, "vf_loss": 8.154901945590973, "vf_explained_var": 6.119534373283386e-05, "kl": 0.010529132902865968, "entropy": 2.6099304765462876, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 673.1791746819468, "episode_len_mean": 2940.0, "episode_media": {}, "episodes_timesteps_total": 70560, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 689.2030896437194, "DC1_ls_policy": 3668.1557242841604, "DC2_ls_policy": -427.07909954847975, "DC3_ls_policy": -3257.1005396974583}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 56540.84804627261, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105900.33153208584, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005525179874138207, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9686014043826544, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 110123.39635279612, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 126559.35560358495, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.2699728473686807, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.157136503863935, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99416841.623583, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 108.2962142479916, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1476.9487098529526, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6033779008544294, "mean_inference_ms": 2.2510906569694646, "mean_action_processing_ms": 0.32633411013592634, "mean_env_wait_ms": 4.339775094351221, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032126903533935547, "StateBufferConnector_ms": 0.002511094013849894, "ViewRequirementAgentConnector_ms": 0.05400702357292175}, "num_episodes": 2, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 673.1791746819468, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488, "num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 548.4334311986937, "num_env_steps_trained_throughput_per_sec": 548.4334311986937, "timesteps_total": 79872, "num_env_steps_sampled_lifetime": 79872, "num_agent_steps_sampled_lifetime": 319488, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 319488, "timers": {"training_iteration_time_ms": 3566.911, "restore_workers_time_ms": 0.038, "training_step_time_ms": 3566.805, "sample_time_ms": 2212.295, "learn_time_ms": 1319.812, "learn_throughput": 1551.736, "synch_weights_time_ms": 12.122}, "counters": {"num_env_steps_sampled": 79872, "num_env_steps_trained": 79872, "num_agent_steps_sampled": 319488, "num_agent_steps_trained": 319488}, "done": false, "training_iteration": 39, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-12", "timestamp": 1729548312, "time_this_iter_s": 3.7463088035583496, "time_total_s": 148.1291208267212, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2ae050>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750fa0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750940>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750ac0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751780>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 148.1291208267212, "iterations_since_restore": 39, "perf": {"cpu_util_percent": 4.38, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0182360716164114, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.659274315834045, "policy_loss": -0.00497189856832847, "vf_loss": 9.66424618959427, "vf_explained_var": 0.0003517992794513702, "kl": 0.011135856205465134, "entropy": 0.7620756573975086, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.2002151161432266, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.442037808895112, "policy_loss": -0.0022148686926811933, "vf_loss": 9.444252729415894, "vf_explained_var": -1.6926229000091554e-05, "kl": 0.006185878983046678, "entropy": 1.116252489387989, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2193935979157686, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.933846700191499, "policy_loss": -0.003784728003665805, "vf_loss": 9.937631404399871, "vf_explained_var": 0.0004473470151424408, "kl": 0.004965263244867017, "entropy": 1.2437277883291245, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.952194683253765, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.918044590950013, "policy_loss": -0.004216817615088075, "vf_loss": 8.921986997127533, "vf_explained_var": 3.22394073009491e-05, "kl": 0.010975805580869746, "entropy": 2.523576107621193, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 673.1791746819468, "episode_len_mean": 2940.0, "episode_media": {}, "episodes_timesteps_total": 70560, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 689.2030896437194, "DC1_ls_policy": 3668.1557242841604, "DC2_ls_policy": -427.07909954847975, "DC3_ls_policy": -3257.1005396974583}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 56540.84804627261, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105900.33153208584, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005525179874138207, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9686014043826544, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 110123.39635279612, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 126559.35560358495, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.2699728473686807, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.157136503863935, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99416841.623583, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 108.2962142479916, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1476.9487098529526, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6033779008544294, "mean_inference_ms": 2.2510906569694646, "mean_action_processing_ms": 0.32633411013592634, "mean_env_wait_ms": 4.339775094351221, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032126903533935547, "StateBufferConnector_ms": 0.002511094013849894, "ViewRequirementAgentConnector_ms": 0.05400702357292175}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 673.1791746819468, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680, "num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 540.7662541157409, "num_env_steps_trained_throughput_per_sec": 540.7662541157409, "timesteps_total": 81920, "num_env_steps_sampled_lifetime": 81920, "num_agent_steps_sampled_lifetime": 327680, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 327680, "timers": {"training_iteration_time_ms": 3596.372, "restore_workers_time_ms": 0.037, "training_step_time_ms": 3596.267, "sample_time_ms": 2242.686, "learn_time_ms": 1318.384, "learn_throughput": 1553.417, "synch_weights_time_ms": 12.682}, "counters": {"num_env_steps_sampled": 81920, "num_env_steps_trained": 81920, "num_agent_steps_sampled": 327680, "num_agent_steps_trained": 327680}, "done": false, "training_iteration": 40, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-16", "timestamp": 1729548316, "time_this_iter_s": 3.7976503372192383, "time_total_s": 151.92677116394043, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66a0e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d0c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dd20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72db70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d600>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 151.92677116394043, "iterations_since_restore": 40, "perf": {"cpu_util_percent": 9.783333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.853419878333807, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.671734368801117, "policy_loss": -0.0021311609132681044, "vf_loss": 9.673865497112274, "vf_explained_var": 0.00011980757117271423, "kl": 0.005083811325675924, "entropy": 0.7261194162070751, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.819135283306241, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.329926252365112, "policy_loss": -0.004510785604361444, "vf_loss": 9.334436964988708, "vf_explained_var": -2.909153699874878e-05, "kl": 0.01142906901131937, "entropy": 1.0145576775074006, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.387281360849738, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.915057647228242, "policy_loss": -0.0012204801198095084, "vf_loss": 9.916278040409088, "vf_explained_var": 9.294971823692322e-05, "kl": 0.001328447602225042, "entropy": 1.2052193239331246, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.183530579507351, "cur_kl_coeff": 0.024999999999999998, "cur_lr": 5.000000000000001e-05, "total_loss": 8.324429988861084, "policy_loss": -0.0007674410764593631, "vf_loss": 8.325082767009736, "vf_explained_var": 3.641098737716675e-05, "kl": 0.004585244227110966, "entropy": 2.5805337876081467, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 734.6716614245172, "episode_len_mean": 2926.08, "episode_media": {}, "episodes_timesteps_total": 73152, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 670.2252502058525, "DC1_ls_policy": 3668.6574124349227, "DC2_ls_policy": -405.46234281265095, "DC3_ls_policy": -3198.7486584036124}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 56188.89699856723, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105767.32967950506, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005304172679172678, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9473264840098173, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 110940.05857409452, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 130539.95188525667, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.25917393347393347, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 3.061236846178513, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99122531.37190984, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 103.96436567807194, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1433.1078332180937, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6045401639664564, "mean_inference_ms": 2.253513193726316, "mean_action_processing_ms": 0.32686278964308924, "mean_env_wait_ms": 4.350002704570587, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003205537796020508, "StateBufferConnector_ms": 0.002526998519897461, "ViewRequirementAgentConnector_ms": 0.054277896881103516}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 734.6716614245172, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872, "num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 501.0889633936266, "num_env_steps_trained_throughput_per_sec": 501.0889633936266, "timesteps_total": 83968, "num_env_steps_sampled_lifetime": 83968, "num_agent_steps_sampled_lifetime": 335872, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 335872, "timers": {"training_iteration_time_ms": 3641.528, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3641.416, "sample_time_ms": 2284.002, "learn_time_ms": 1322.484, "learn_throughput": 1548.601, "synch_weights_time_ms": 12.691}, "counters": {"num_env_steps_sampled": 83968, "num_env_steps_trained": 83968, "num_agent_steps_sampled": 335872, "num_agent_steps_trained": 335872}, "done": false, "training_iteration": 41, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-20", "timestamp": 1729548320, "time_this_iter_s": 4.09557843208313, "time_total_s": 156.02234959602356, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2ae050>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72eec0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dab0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cbb0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72df30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 156.02234959602356, "iterations_since_restore": 41, "perf": {"cpu_util_percent": 19.349999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0809307411313056, "cur_kl_coeff": 5.960464477539062e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.587080872058868, "policy_loss": -0.0004452019464224577, "vf_loss": 9.587526106834412, "vf_explained_var": 0.0007494494318962097, "kl": 0.0021616616377289613, "entropy": 0.7022739723324776, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5705080427229405, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.78859565258026, "policy_loss": -0.00467037137132138, "vf_loss": 9.79326605796814, "vf_explained_var": -2.5136768817901613e-05, "kl": 0.011662730897114833, "entropy": 0.979223196208477, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3734153516590595, "cur_kl_coeff": 1.8189894035458563e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.928654193878174, "policy_loss": -0.0019105930346995591, "vf_loss": 9.930564785003662, "vf_explained_var": 6.049424409866333e-05, "kl": 0.002189309134021755, "entropy": 1.2509276181459428, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.391207773983479, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.713501501083375, "policy_loss": -0.004805398039752618, "vf_loss": 8.718135762214661, "vf_explained_var": 5.165711045265198e-05, "kl": 0.01368166896527551, "entropy": 2.4868229418992995, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 777.6708684425835, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 75840, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 623.942278300541, "DC1_ls_policy": 3675.635301244065, "DC2_ls_policy": -371.74989237868056, "DC3_ls_policy": -3150.156818723347}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55950.878323362216, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105896.91749363077, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005100166037666037, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9236827456138352, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 111895.43578088107, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 135779.8659505447, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.24920570526339755, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.9750474482485703, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99182593.37222855, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 99.96573622891532, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1394.4149838635517, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6047306801125563, "mean_inference_ms": 2.252756242721589, "mean_action_processing_ms": 0.3267296686299014, "mean_env_wait_ms": 4.351150409876182, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003187243755047138, "StateBufferConnector_ms": 0.002525632198040302, "ViewRequirementAgentConnector_ms": 0.05423312003795917}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 777.6708684425835, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064, "num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 544.9488592369884, "num_env_steps_trained_throughput_per_sec": 544.9488592369884, "timesteps_total": 86016, "num_env_steps_sampled_lifetime": 86016, "num_agent_steps_sampled_lifetime": 344064, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 344064, "timers": {"training_iteration_time_ms": 3667.557, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3667.445, "sample_time_ms": 2311.276, "learn_time_ms": 1321.287, "learn_throughput": 1550.004, "synch_weights_time_ms": 12.641}, "counters": {"num_env_steps_sampled": 86016, "num_env_steps_trained": 86016, "num_agent_steps_sampled": 344064, "num_agent_steps_trained": 344064}, "done": false, "training_iteration": 42, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-24", "timestamp": 1729548324, "time_this_iter_s": 3.7675299644470215, "time_total_s": 159.78987956047058, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e668f70>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dde0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e560>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e920>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ee00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 159.78987956047058, "iterations_since_restore": 42, "perf": {"cpu_util_percent": 21.159999999999997, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4285633586347104, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.1045490026474, "policy_loss": -0.0031791791203431784, "vf_loss": 9.107728278636932, "vf_explained_var": 0.0014316730201244354, "kl": 0.007870942139061707, "entropy": 0.6660536892712117, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.032106216996908, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.652918303012848, "policy_loss": -0.002734791982220486, "vf_loss": 9.655653047561646, "vf_explained_var": -9.465664625167847e-05, "kl": 0.00571511694531093, "entropy": 0.9707523003220558, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2319042410701513, "cur_kl_coeff": 9.094947017729282e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.927474236488342, "policy_loss": -0.0025270181358791888, "vf_loss": 9.93000133037567, "vf_explained_var": 9.470283985137939e-05, "kl": 0.00534174787342181, "entropy": 1.2197124019265175, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.997882308065891, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.843980836868287, "policy_loss": -0.0005526341847144067, "vf_loss": 8.84443576335907, "vf_explained_var": -0.00015257149934768676, "kl": 0.007822834187323538, "entropy": 2.3833903193473818, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 777.6708684425835, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 75840, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 623.942278300541, "DC1_ls_policy": 3675.635301244065, "DC2_ls_policy": -371.74989237868056, "DC3_ls_policy": -3150.156818723347}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55950.878323362216, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105896.91749363077, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005100166037666037, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9236827456138352, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 111895.43578088107, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 135779.8659505447, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.24920570526339755, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.9750474482485703, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99182593.37222855, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 99.96573622891532, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1394.4149838635517, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6047306801125563, "mean_inference_ms": 2.252756242721589, "mean_action_processing_ms": 0.3267296686299014, "mean_env_wait_ms": 4.351150409876182, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003187243755047138, "StateBufferConnector_ms": 0.002525632198040302, "ViewRequirementAgentConnector_ms": 0.05423312003795917}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 777.6708684425835, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256, "num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 547.8815505510365, "num_env_steps_trained_throughput_per_sec": 547.8815505510365, "timesteps_total": 88064, "num_env_steps_sampled_lifetime": 88064, "num_agent_steps_sampled_lifetime": 352256, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 352256, "timers": {"training_iteration_time_ms": 3681.101, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3680.989, "sample_time_ms": 2326.266, "learn_time_ms": 1320.186, "learn_throughput": 1551.296, "synch_weights_time_ms": 12.656}, "counters": {"num_env_steps_sampled": 88064, "num_env_steps_trained": 88064, "num_agent_steps_sampled": 352256, "num_agent_steps_trained": 352256}, "done": false, "training_iteration": 43, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-27", "timestamp": 1729548327, "time_this_iter_s": 3.7478137016296387, "time_total_s": 163.53769326210022, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2afeb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362bf0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362d70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362e30>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362ef0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 163.53769326210022, "iterations_since_restore": 43, "perf": {"cpu_util_percent": 19.75, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.05919296965003, "cur_kl_coeff": 2.980232238769531e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.616520380973816, "policy_loss": -0.0010521067772060633, "vf_loss": 9.617572391033173, "vf_explained_var": 0.0013050898909568787, "kl": 0.00486230118053797, "entropy": 0.6642993912100792, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9154599025845527, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.506977021694183, "policy_loss": -0.0010543334647081792, "vf_loss": 9.508031523227691, "vf_explained_var": -2.691596746444702e-05, "kl": 0.003125727579754615, "entropy": 0.9377842791378498, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2718209762126207, "cur_kl_coeff": 9.094947017729282e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.917444169521332, "policy_loss": -0.0007995534804649651, "vf_loss": 9.918243670463562, "vf_explained_var": 3.389492630958557e-05, "kl": 0.0008896008703914049, "entropy": 1.204761591553688, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.178973266482354, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.438251125812531, "policy_loss": -0.006221428920980543, "vf_loss": 8.444321674108505, "vf_explained_var": 9.293779730796814e-05, "kl": 0.012082450734989307, "entropy": 2.347362557053566, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 777.6708684425835, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 75840, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 623.942278300541, "DC1_ls_policy": 3675.635301244065, "DC2_ls_policy": -371.74989237868056, "DC3_ls_policy": -3150.156818723347}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55950.878323362216, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105896.91749363077, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005100166037666037, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9236827456138352, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 111895.43578088107, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 135779.8659505447, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.24920570526339755, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.9750474482485703, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99182593.37222855, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 99.96573622891532, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1394.4149838635517, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6047306801125563, "mean_inference_ms": 2.252756242721589, "mean_action_processing_ms": 0.3267296686299014, "mean_env_wait_ms": 4.351150409876182, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003187243755047138, "StateBufferConnector_ms": 0.002525632198040302, "ViewRequirementAgentConnector_ms": 0.05423312003795917}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 777.6708684425835, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448, "num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 528.673759278172, "num_env_steps_trained_throughput_per_sec": 528.673759278172, "timesteps_total": 90112, "num_env_steps_sampled_lifetime": 90112, "num_agent_steps_sampled_lifetime": 360448, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 360448, "timers": {"training_iteration_time_ms": 3717.534, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3717.422, "sample_time_ms": 2366.091, "learn_time_ms": 1316.97, "learn_throughput": 1555.085, "synch_weights_time_ms": 12.663}, "counters": {"num_env_steps_sampled": 90112, "num_env_steps_trained": 90112, "num_agent_steps_sampled": 360448, "num_agent_steps_trained": 360448}, "done": false, "training_iteration": 44, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-31", "timestamp": 1729548331, "time_this_iter_s": 3.880495071411133, "time_total_s": 167.41818833351135, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6869e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e3639d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363ac0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363bb0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e363ca0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 167.41818833351135, "iterations_since_restore": 44, "perf": {"cpu_util_percent": 19.22, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.193942330777645, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.420565104484558, "policy_loss": -0.002717838133685291, "vf_loss": 9.423282933235168, "vf_explained_var": 0.000664113461971283, "kl": 0.010186084538327122, "entropy": 0.620061269402504, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1521205857396124, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.482375001907348, "policy_loss": -0.0027140971273183823, "vf_loss": 9.485089206695557, "vf_explained_var": -5.792081356048584e-05, "kl": 0.0023605043849332158, "entropy": 0.9277283795177936, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3566796947270632, "cur_kl_coeff": 4.547473508864641e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.90939748287201, "policy_loss": -0.002036818180931732, "vf_loss": 9.911434292793274, "vf_explained_var": 0.0009899958968162537, "kl": 0.004449518634771721, "entropy": 1.2122914135456084, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.731410828232765, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.696945488452911, "policy_loss": -0.005820303113432601, "vf_loss": 8.70260637998581, "vf_explained_var": -9.600222110748292e-05, "kl": 0.012754360958161728, "entropy": 2.231863647699356, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 777.6708684425835, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 75840, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 623.942278300541, "DC1_ls_policy": 3675.635301244065, "DC2_ls_policy": -371.74989237868056, "DC3_ls_policy": -3150.156818723347}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55950.878323362216, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105896.91749363077, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005100166037666037, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9236827456138352, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 111895.43578088107, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 135779.8659505447, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.24920570526339755, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.9750474482485703, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99182593.37222855, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 99.96573622891532, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1394.4149838635517, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6047306801125563, "mean_inference_ms": 2.252756242721589, "mean_action_processing_ms": 0.3267296686299014, "mean_env_wait_ms": 4.351150409876182, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003187243755047138, "StateBufferConnector_ms": 0.002525632198040302, "ViewRequirementAgentConnector_ms": 0.05423312003795917}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 777.6708684425835, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640, "num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 555.6760667201905, "num_env_steps_trained_throughput_per_sec": 555.6760667201905, "timesteps_total": 92160, "num_env_steps_sampled_lifetime": 92160, "num_agent_steps_sampled_lifetime": 368640, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 368640, "timers": {"training_iteration_time_ms": 3728.68, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3728.569, "sample_time_ms": 2377.476, "learn_time_ms": 1316.47, "learn_throughput": 1555.676, "synch_weights_time_ms": 12.955}, "counters": {"num_env_steps_sampled": 92160, "num_env_steps_trained": 92160, "num_agent_steps_sampled": 368640, "num_agent_steps_trained": 368640}, "done": false, "training_iteration": 45, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-35", "timestamp": 1729548335, "time_this_iter_s": 3.6930978298187256, "time_total_s": 171.11128616333008, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e669750>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e650>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e9e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ef80>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cbe0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 171.11128616333008, "iterations_since_restore": 45, "perf": {"cpu_util_percent": 19.21666666666667, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6142104491591454, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.34689803123474, "policy_loss": -0.005183538515120744, "vf_loss": 9.352081561088562, "vf_explained_var": 0.0003048844635486603, "kl": 0.013615275840777485, "entropy": 0.49448631666600706, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.590948075801134, "cur_kl_coeff": 1.164153218269348e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.807101500034332, "policy_loss": -0.002991544475662522, "vf_loss": 9.810093080997467, "vf_explained_var": -3.321766853332519e-05, "kl": 0.007843134962104401, "entropy": 0.9158400617539882, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2534449577331543, "cur_kl_coeff": 2.2737367544323204e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.934221160411834, "policy_loss": -0.0017616736527998, "vf_loss": 9.9359827876091, "vf_explained_var": -7.656067609786987e-05, "kl": 0.002742367963355826, "entropy": 1.1652639180421829, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.242449180781842, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.865397256612777, "policy_loss": -0.0047899353550747035, "vf_loss": 8.870056200027467, "vf_explained_var": -9.495764970779419e-06, "kl": 0.010482753234464326, "entropy": 2.18759967982769, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 777.6708684425835, "episode_len_mean": 2916.923076923077, "episode_media": {}, "episodes_timesteps_total": 75840, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 623.942278300541, "DC1_ls_policy": 3675.635301244065, "DC2_ls_policy": -371.74989237868056, "DC3_ls_policy": -3150.156818723347}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55950.878323362216, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105896.91749363077, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.005100166037666037, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.9236827456138352, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 111895.43578088107, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 135779.8659505447, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.24920570526339755, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.9750474482485703, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99182593.37222855, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 99.96573622891532, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1394.4149838635517, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6047306801125563, "mean_inference_ms": 2.252756242721589, "mean_action_processing_ms": 0.3267296686299014, "mean_env_wait_ms": 4.351150409876182, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003187243755047138, "StateBufferConnector_ms": 0.002525632198040302, "ViewRequirementAgentConnector_ms": 0.05423312003795917}, "num_episodes": 0, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 777.6708684425835, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832, "num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 564.1864206979046, "num_env_steps_trained_throughput_per_sec": 564.1864206979046, "timesteps_total": 94208, "num_env_steps_sampled_lifetime": 94208, "num_agent_steps_sampled_lifetime": 376832, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 376832, "timers": {"training_iteration_time_ms": 3746.197, "restore_workers_time_ms": 0.038, "training_step_time_ms": 3746.085, "sample_time_ms": 2395.105, "learn_time_ms": 1315.182, "learn_throughput": 1557.199, "synch_weights_time_ms": 13.913}, "counters": {"num_env_steps_sampled": 94208, "num_env_steps_trained": 94208, "num_agent_steps_sampled": 376832, "num_agent_steps_trained": 376832}, "done": false, "training_iteration": 46, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-39", "timestamp": 1729548339, "time_this_iter_s": 3.638625383377075, "time_total_s": 174.74991154670715, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6869e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72de10>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e260>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dd50>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ca90>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 174.74991154670715, "iterations_since_restore": 46, "perf": {"cpu_util_percent": 8.4, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6933903634548186, "cur_kl_coeff": 1.4901161193847655e-09, "cur_lr": 5.000000000000001e-05, "total_loss": 9.445718395709992, "policy_loss": 0.00018598503665998579, "vf_loss": 9.445532381534576, "vf_explained_var": 0.0010165996849536897, "kl": 0.0032778422073334924, "entropy": 0.535011687874794, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4121875673532487, "cur_kl_coeff": 1.164153218269348e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 8.993912363052369, "policy_loss": -0.0015651092398911715, "vf_loss": 8.995477318763733, "vf_explained_var": -7.612258195877075e-05, "kl": 0.004516318378591677, "entropy": 0.8352447800338269, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.3220432411879302, "cur_kl_coeff": 1.1368683772161602e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.920257520675658, "policy_loss": -0.0012438912061043083, "vf_loss": 9.921501445770264, "vf_explained_var": -4.010647535324096e-06, "kl": 0.0021135011866448396, "entropy": 1.1103304967284202, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.711072705686092, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.147436112165451, "policy_loss": -0.0040550781763158735, "vf_loss": 8.151366889476776, "vf_explained_var": 0.00030162930488586426, "kl": 0.009945955919285644, "entropy": 2.2101539969444275, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024}, "env_runners": {"episode_reward_max": 6067.316600473201, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 836.3261546307099, "episode_len_mean": 2897.777777777778, "episode_media": {}, "episodes_timesteps_total": 78240, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1369.2502858714554, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 604.570574650157, "DC1_ls_policy": 3664.9656473544655, "DC2_ls_policy": -317.7399304710113, "DC3_ls_policy": -3115.470136902906}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55596.586531744295, "DC1_ls_policy/bat_CO2_footprint_sum_min": 46306.634668686325, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 105348.14149306994, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004911270999233962, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.896632767381224, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 113137.5611375366, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 145432.82041058005, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.23997586432771617, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.8856012464615866, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.49759615384615385, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 98565769.28965424, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 96.2633015537703, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1350.578661158729, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6044869714675568, "mean_inference_ms": 2.2522450479677976, "mean_action_processing_ms": 0.32649135206215096, "mean_env_wait_ms": 4.35106610437892, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032535305729618777, "StateBufferConnector_ms": 0.002525029359040437, "ViewRequirementAgentConnector_ms": 0.05419739970454463}, "num_episodes": 1, "episode_return_max": 6067.316600473201, "episode_return_min": -3711.90038700316, "episode_return_mean": 836.3261546307099, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024, "num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 587.9208511516116, "num_env_steps_trained_throughput_per_sec": 587.9208511516116, "timesteps_total": 96256, "num_env_steps_sampled_lifetime": 96256, "num_agent_steps_sampled_lifetime": 385024, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 385024, "timers": {"training_iteration_time_ms": 3729.062, "restore_workers_time_ms": 0.04, "training_step_time_ms": 3728.945, "sample_time_ms": 2377.907, "learn_time_ms": 1314.848, "learn_throughput": 1557.594, "synch_weights_time_ms": 14.437}, "counters": {"num_env_steps_sampled": 96256, "num_env_steps_trained": 96256, "num_agent_steps_sampled": 385024, "num_agent_steps_trained": 385024}, "done": false, "training_iteration": 47, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-42", "timestamp": 1729548342, "time_this_iter_s": 3.492302417755127, "time_total_s": 178.24221396446228, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6fb880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c850>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dc30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f250>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ca30>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 178.24221396446228, "iterations_since_restore": 47, "perf": {"cpu_util_percent": 5.62, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4846199460327627, "cur_kl_coeff": 7.450580596923828e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.49011833667755, "policy_loss": -0.0010667831753380596, "vf_loss": 9.49118505716324, "vf_explained_var": 0.00035509169101715087, "kl": 0.002543524420548924, "entropy": 0.5578082613646984, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1497550673782824, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.544364202022553, "policy_loss": -0.0015451698563992977, "vf_loss": 9.545909428596497, "vf_explained_var": -6.348788738250733e-05, "kl": 0.0035135858775902306, "entropy": 0.7655795060098172, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4291662819683553, "cur_kl_coeff": 5.684341886080801e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.906439542770386, "policy_loss": -0.004503967857453972, "vf_loss": 9.910943591594696, "vf_explained_var": 0.0006174162030220032, "kl": 0.008200820593174393, "entropy": 1.0863356709480285, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.781516946852207, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.597432911396027, "policy_loss": -0.005477454757783562, "vf_loss": 8.602756160497666, "vf_explained_var": -0.0006905585527420044, "kl": 0.012339298585812977, "entropy": 2.1829584151506425, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1047.1703647639308, "episode_len_mean": 2938.285714285714, "episode_media": {}, "episodes_timesteps_total": 82272, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1690.9515042267647, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 607.0281339215173, "DC1_ls_policy": 3739.085094530183, "DC2_ls_policy": -246.00095066037642, "DC3_ls_policy": -3052.9419130273977}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55189.217698765184, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 104994.5893403994, "DC2_ls_policy/bat_CO2_footprint_sum_min": 88043.15788417417, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004735868463547034, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8654073624237313, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 113990.16914828004, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 145432.82041058005, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.23140529774458346, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.7913840534190237, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.24751984126984128, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100027215.30789709, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 92.82532649827851, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1306.616440072136, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6039886112269469, "mean_inference_ms": 2.252637248038423, "mean_action_processing_ms": 0.32614999221684243, "mean_env_wait_ms": 4.349681347923175, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032390866960797992, "StateBufferConnector_ms": 0.002519573484148298, "ViewRequirementAgentConnector_ms": 0.05419020141874041}, "num_episodes": 1, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1047.1703647639308, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216, "num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 532.3262102503755, "num_env_steps_trained_throughput_per_sec": 532.3262102503755, "timesteps_total": 98304, "num_env_steps_sampled_lifetime": 98304, "num_agent_steps_sampled_lifetime": 393216, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 393216, "timers": {"training_iteration_time_ms": 3762.527, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3762.404, "sample_time_ms": 2413.317, "learn_time_ms": 1312.954, "learn_throughput": 1559.841, "synch_weights_time_ms": 14.569}, "counters": {"num_env_steps_sampled": 98304, "num_env_steps_trained": 98304, "num_agent_steps_sampled": 393216, "num_agent_steps_trained": 393216}, "done": false, "training_iteration": 48, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-46", "timestamp": 1729548346, "time_this_iter_s": 3.8563761711120605, "time_total_s": 182.09859013557434, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66bb50>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d900>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c9a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cb20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cdc0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 182.09859013557434, "iterations_since_restore": 48, "perf": {"cpu_util_percent": 18.1, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0900846034288407, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.378513097763062, "policy_loss": -0.004322649410460145, "vf_loss": 9.382835721969604, "vf_explained_var": 4.907697439193726e-06, "kl": 0.010494180621527259, "entropy": 0.6225334472954274, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.388460595905781, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.492112755775452, "policy_loss": -0.003512065170798451, "vf_loss": 9.495624756813049, "vf_explained_var": -2.9252469539642333e-05, "kl": 0.009924019117192984, "entropy": 0.7074196830391883, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4673774801194668, "cur_kl_coeff": 5.684341886080801e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.886962139606476, "policy_loss": -0.00462053157389164, "vf_loss": 9.891582679748534, "vf_explained_var": 0.00014465153217315673, "kl": 0.007415349009966249, "entropy": 1.0890435367822646, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.543054580688477, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.790445721149444, "policy_loss": -0.0076590953161939975, "vf_loss": 8.797948527336121, "vf_explained_var": 0.00047529563307762145, "kl": 0.012505219411106402, "entropy": 2.1763496845960617, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1209.7984287227898, "episode_len_mean": 2908.8, "episode_media": {}, "episodes_timesteps_total": 87264, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1690.9515042267647, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 573.5879051460083, "DC1_ls_policy": 3725.2241641995365, "DC2_ls_policy": -131.1638211689401, "DC3_ls_policy": -2957.8498194538197}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54708.204919439326, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 103969.85658766715, "DC2_ls_policy/bat_CO2_footprint_sum_min": 87898.57780962082, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004420143899310566, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.8077135382621492, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 116076.85806499881, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.21597827789494456, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.6430855866098923, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.24751984126984128, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99355761.48267743, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 86.63697139839329, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1237.2536927585663, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6032838657567046, "mean_inference_ms": 2.249636882091711, "mean_action_processing_ms": 0.32556208378776624, "mean_env_wait_ms": 4.345725064397388, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032126903533935547, "StateBufferConnector_ms": 0.002518296241760254, "ViewRequirementAgentConnector_ms": 0.05414247512817383}, "num_episodes": 2, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1209.7984287227898, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408, "num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 563.0512834815686, "num_env_steps_trained_throughput_per_sec": 563.0512834815686, "timesteps_total": 100352, "num_env_steps_sampled_lifetime": 100352, "num_agent_steps_sampled_lifetime": 401408, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 401408, "timers": {"training_iteration_time_ms": 3752.831, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3752.708, "sample_time_ms": 2407.24, "learn_time_ms": 1309.777, "learn_throughput": 1563.625, "synch_weights_time_ms": 14.144}, "counters": {"num_env_steps_sampled": 100352, "num_env_steps_trained": 100352, "num_agent_steps_sampled": 401408, "num_agent_steps_trained": 401408}, "done": false, "training_iteration": 49, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-50", "timestamp": 1729548350, "time_this_iter_s": 3.646641731262207, "time_total_s": 185.74523186683655, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6869e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7534f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753610>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753700>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7537c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 185.74523186683655, "iterations_since_restore": 49, "perf": {"cpu_util_percent": 20.04, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.712221459299326, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.510778558254241, "policy_loss": -0.0010623682755976915, "vf_loss": 9.511840832233428, "vf_explained_var": 1.343265175819397e-05, "kl": 0.008930793818649363, "entropy": 0.47000661343336103, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.444752204418182, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.528198599815369, "policy_loss": -0.0027835956308990715, "vf_loss": 9.530982220172882, "vf_explained_var": -3.159642219543457e-05, "kl": 0.008303871595308387, "entropy": 0.6672616064548492, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.2710270531475545, "cur_kl_coeff": 5.684341886080801e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.917947721481323, "policy_loss": -0.0017748001904692502, "vf_loss": 9.919722425937653, "vf_explained_var": 0.0001132875680923462, "kl": 0.0034983272639692586, "entropy": 1.058665607869625, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.261232304573059, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.836560809612275, "policy_loss": -0.0038547729258425535, "vf_loss": 8.840309607982636, "vf_explained_var": -6.249621510505677e-05, "kl": 0.008474677601407165, "entropy": 2.206320533156395, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 3960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1278.406128187935, "episode_len_mean": 2951.2258064516127, "episode_media": {}, "episodes_timesteps_total": 91488, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6173.13332937785, "DC2_ls_policy": 1690.9515042267647, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 552.408716742894, "DC1_ls_policy": 3803.4733936618863, "DC2_ls_policy": -72.88956251942237, "DC3_ls_policy": -3004.5864196974267}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54595.144930625705, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 1.5273704789833822e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 103650.75157437225, "DC2_ls_policy/bat_CO2_footprint_sum_min": 87898.57780962082, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004277558612236031, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7857287051608286, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 116871.18984446983, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.209011236672527, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.605967478732936, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.24751984126984128, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 101016544.22390026, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 83.84223038554188, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1233.426349785905, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.603969034749121, "mean_inference_ms": 2.2522624333467833, "mean_action_processing_ms": 0.3260767995084394, "mean_env_wait_ms": 4.354472082386817, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032128826264412173, "StateBufferConnector_ms": 0.002532428310763451, "ViewRequirementAgentConnector_ms": 0.054494219441567696}, "num_episodes": 1, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1278.406128187935, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600, "num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 524.7638234473349, "num_env_steps_trained_throughput_per_sec": 524.7638234473349, "timesteps_total": 102400, "num_env_steps_sampled_lifetime": 102400, "num_agent_steps_sampled_lifetime": 409600, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 409600, "timers": {"training_iteration_time_ms": 3764.379, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3764.258, "sample_time_ms": 2420.021, "learn_time_ms": 1309.988, "learn_throughput": 1563.373, "synch_weights_time_ms": 13.589}, "counters": {"num_env_steps_sampled": 102400, "num_env_steps_trained": 102400, "num_agent_steps_sampled": 409600, "num_agent_steps_trained": 409600}, "done": false, "training_iteration": 50, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-54", "timestamp": 1729548354, "time_this_iter_s": 3.9113705158233643, "time_total_s": 189.6566023826599, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66bac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751300>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751540>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7516c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751840>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 189.6566023826599, "iterations_since_restore": 50, "perf": {"cpu_util_percent": 19.4, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.2098790973424913, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.413595187664033, "policy_loss": -0.002500081912148744, "vf_loss": 9.416095268726348, "vf_explained_var": 0.00011252462863922119, "kl": 0.010971443093694688, "entropy": 0.3124880135059357, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.728943167626858, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.230272734165192, "policy_loss": -0.0020055804401636125, "vf_loss": 9.232278323173523, "vf_explained_var": -0.00012590587139129638, "kl": 0.007765427995582735, "entropy": 0.541016298532486, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5144632779061795, "cur_kl_coeff": 2.8421709430404005e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.88550888299942, "policy_loss": -0.0040060836472548544, "vf_loss": 9.889514911174775, "vf_explained_var": -4.479587078094482e-05, "kl": 0.006394448148705725, "entropy": 0.9724369488656521, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.780091050267219, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.45816748738289, "policy_loss": -0.00353576730703935, "vf_loss": 8.461582922935486, "vf_explained_var": 0.00034237727522850036, "kl": 0.009630501833898153, "entropy": 2.261333701014519, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1432.7656022806627, "episode_len_mean": 2981.818181818182, "episode_media": {}, "episodes_timesteps_total": 98400, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1690.9515042267647, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 564.0007398006971, "DC1_ls_policy": 3873.135754537003, "DC2_ls_policy": -0.6714782132593097, "DC3_ls_policy": -3003.6994138437813}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54277.35616236543, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.603900962486821e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 102901.7546553872, "DC2_ls_policy/bat_CO2_footprint_sum_min": 84116.95121753217, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004018312635736878, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7514224761162892, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 117913.46988551367, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19672969146453995, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.522045674933932, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.24751984126984128, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 102141358.49335209, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 79.00067101500025, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1205.1854050691754, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6049620001289765, "mean_inference_ms": 2.254481188731329, "mean_action_processing_ms": 0.32646739291195714, "mean_env_wait_ms": 4.364239899705052, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031919190377900095, "StateBufferConnector_ms": 0.0025348229841752486, "ViewRequirementAgentConnector_ms": 0.05449797167922511}, "num_episodes": 2, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1432.7656022806627, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792, "num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 543.5670121032856, "num_env_steps_trained_throughput_per_sec": 543.5670121032856, "timesteps_total": 104448, "num_env_steps_sampled_lifetime": 104448, "num_agent_steps_sampled_lifetime": 417792, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 417792, "timers": {"training_iteration_time_ms": 3732.44, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3732.319, "sample_time_ms": 2392.105, "learn_time_ms": 1305.79, "learn_throughput": 1568.399, "synch_weights_time_ms": 13.569}, "counters": {"num_env_steps_sampled": 104448, "num_env_steps_trained": 104448, "num_agent_steps_sampled": 417792, "num_agent_steps_trained": 417792}, "done": false, "training_iteration": 51, "trial_id": "2c069_00000", "date": "2024-10-21_22-05-58", "timestamp": 1729548358, "time_this_iter_s": 3.7752084732055664, "time_total_s": 193.43181085586548, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6869e0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752860>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752950>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752a10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752ad0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 193.43181085586548, "iterations_since_restore": 51, "perf": {"cpu_util_percent": 18.866666666666664, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8436961941421033, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.508691942691803, "policy_loss": -0.0008958408609032631, "vf_loss": 9.509587681293487, "vf_explained_var": 0.00011732131242752075, "kl": 0.005079069521435392, "entropy": 0.37695860415697097, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1445441626012327, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.282993578910828, "policy_loss": -0.00586499169585295, "vf_loss": 9.288858664035796, "vf_explained_var": -2.3539364337921143e-05, "kl": 0.011146667567755269, "entropy": 0.650239822268486, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.4695076901465653, "cur_kl_coeff": 2.8421709430404005e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.910019052028655, "policy_loss": -0.00301230862387456, "vf_loss": 9.913031470775604, "vf_explained_var": 7.224082946777344e-05, "kl": 0.006657875642213427, "entropy": 0.8872763611376285, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.140553393959999, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.568317902088165, "policy_loss": -0.002525580069050193, "vf_loss": 8.57074922323227, "vf_explained_var": 8.294433355331421e-05, "kl": 0.007537266710370315, "entropy": 2.203778398036957, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1432.7656022806627, "episode_len_mean": 2981.818181818182, "episode_media": {}, "episodes_timesteps_total": 98400, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1690.9515042267647, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 564.0007398006971, "DC1_ls_policy": 3873.135754537003, "DC2_ls_policy": -0.6714782132593097, "DC3_ls_policy": -3003.6994138437813}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54277.35616236543, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.603900962486821e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 102901.7546553872, "DC2_ls_policy/bat_CO2_footprint_sum_min": 84116.95121753217, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.004018312635736878, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7514224761162892, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 117913.46988551367, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19672969146453995, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.522045674933932, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.24751984126984128, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 102141358.49335209, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 79.00067101500025, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1205.1854050691754, "accumulated/ls_overdue_penalty_sum_min": 72.52203525641026, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6049620001289765, "mean_inference_ms": 2.254481188731329, "mean_action_processing_ms": 0.32646739291195714, "mean_env_wait_ms": 4.364239899705052, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031919190377900095, "StateBufferConnector_ms": 0.0025348229841752486, "ViewRequirementAgentConnector_ms": 0.05449797167922511}, "num_episodes": 0, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1432.7656022806627, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984, "num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 548.2611399820917, "num_env_steps_trained_throughput_per_sec": 548.2611399820917, "timesteps_total": 106496, "num_env_steps_sampled_lifetime": 106496, "num_agent_steps_sampled_lifetime": 425984, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 425984, "timers": {"training_iteration_time_ms": 3730.169, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3730.048, "sample_time_ms": 2388.652, "learn_time_ms": 1306.868, "learn_throughput": 1567.105, "synch_weights_time_ms": 13.636}, "counters": {"num_env_steps_sampled": 106496, "num_env_steps_trained": 106496, "num_agent_steps_sampled": 425984, "num_agent_steps_trained": 425984}, "done": false, "training_iteration": 52, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-02", "timestamp": 1729548362, "time_this_iter_s": 3.744629383087158, "time_total_s": 197.17644023895264, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af910>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752da0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7503a0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7504c0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750820>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 197.17644023895264, "iterations_since_restore": 52, "perf": {"cpu_util_percent": 19.4, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.3559850066900254, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.639454126358032, "policy_loss": -0.0018601003102958202, "vf_loss": 9.641314232349396, "vf_explained_var": 0.00015392079949378968, "kl": 0.006282939013819192, "entropy": 0.16572201456874608, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7685875318944455, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.191842138767242, "policy_loss": 1.9557843916118146e-05, "vf_loss": 9.191822504997253, "vf_explained_var": -3.1775236129760744e-05, "kl": 0.0029434209738615933, "entropy": 0.5636571891605854, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.502205315977335, "cur_kl_coeff": 2.8421709430404005e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.917422151565551, "policy_loss": -0.0008070076466538012, "vf_loss": 9.918229115009307, "vf_explained_var": 7.441639900207519e-06, "kl": 0.0012192989104903517, "entropy": 0.8806370131671428, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.852172176539898, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.467633634805679, "policy_loss": -0.003974725009175018, "vf_loss": 7.471461170911789, "vf_explained_var": 1.6746670007705687e-05, "kl": 0.01177716056195095, "entropy": 2.1274188458919525, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1559.6727658538389, "episode_len_mean": 2973.176470588235, "episode_media": {}, "episodes_timesteps_total": 101088, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1757.3551779315412, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 574.8443509942672, "DC1_ls_policy": 3869.8174803460024, "DC2_ls_policy": 51.03518814394071, "DC3_ls_policy": -2936.0242536303745}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54156.37045916655, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.527315640060738e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 102295.33907267278, "DC2_ls_policy/bat_CO2_footprint_sum_min": 82283.62484309752, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0039001269699799105, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7293327569307961, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118422.0004502535, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19094352406852408, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.448480606063326, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 101771208.38886416, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 76.67712186750023, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1170.1179881308663, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6050579862230974, "mean_inference_ms": 2.2535620982514297, "mean_action_processing_ms": 0.32634718876082236, "mean_env_wait_ms": 4.363929916072706, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031793818754308366, "StateBufferConnector_ms": 0.002535125788520364, "ViewRequirementAgentConnector_ms": 0.05448004778693704}, "num_episodes": 1, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1559.6727658538389, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176, "num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 544.5996317109023, "num_env_steps_trained_throughput_per_sec": 544.5996317109023, "timesteps_total": 108544, "num_env_steps_sampled_lifetime": 108544, "num_agent_steps_sampled_lifetime": 434176, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 434176, "timers": {"training_iteration_time_ms": 3732.422, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3732.301, "sample_time_ms": 2392.12, "learn_time_ms": 1305.237, "learn_throughput": 1569.064, "synch_weights_time_ms": 13.62}, "counters": {"num_env_steps_sampled": 108544, "num_env_steps_trained": 108544, "num_agent_steps_sampled": 434176, "num_agent_steps_trained": 434176}, "done": false, "training_iteration": 53, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-06", "timestamp": 1729548366, "time_this_iter_s": 3.7692508697509766, "time_total_s": 200.9456911087036, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66b910>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d510>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d030>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72df00>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c280>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 200.9456911087036, "iterations_since_restore": 53, "perf": {"cpu_util_percent": 17.05, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.968061016499996, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.394742214679718, "policy_loss": -0.0037892569962423295, "vf_loss": 9.398531472682953, "vf_explained_var": 0.0001520790159702301, "kl": 0.008712931740095086, "entropy": 0.2138716347515583, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1255510635674, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.33200067281723, "policy_loss": -0.003578515542903915, "vf_loss": 9.335579133033752, "vf_explained_var": -2.9711425304412843e-05, "kl": 0.0072268101966334345, "entropy": 0.7493773616850377, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5559342324733734, "cur_kl_coeff": 1.4210854715202003e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.902300930023193, "policy_loss": -0.003939715115120634, "vf_loss": 9.906240665912629, "vf_explained_var": -7.309019565582275e-07, "kl": 0.006909472222673942, "entropy": 0.8662343434989452, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.567581725120545, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.5387302339077, "policy_loss": -0.0018271504522999749, "vf_loss": 8.54044840335846, "vf_explained_var": 2.9403716325759888e-05, "kl": 0.008720290982684384, "entropy": 2.111197406053543, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1559.6727658538389, "episode_len_mean": 2973.176470588235, "episode_media": {}, "episodes_timesteps_total": 101088, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1757.3551779315412, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 574.8443509942672, "DC1_ls_policy": 3869.8174803460024, "DC2_ls_policy": 51.03518814394071, "DC3_ls_policy": -2936.0242536303745}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54156.37045916655, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.527315640060738e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 102295.33907267278, "DC2_ls_policy/bat_CO2_footprint_sum_min": 82283.62484309752, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0039001269699799105, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7293327569307961, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118422.0004502535, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19094352406852408, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.448480606063326, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 101771208.38886416, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 76.67712186750023, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1170.1179881308663, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6050579862230974, "mean_inference_ms": 2.2535620982514297, "mean_action_processing_ms": 0.32634718876082236, "mean_env_wait_ms": 4.363929916072706, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031793818754308366, "StateBufferConnector_ms": 0.002535125788520364, "ViewRequirementAgentConnector_ms": 0.05448004778693704}, "num_episodes": 0, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1559.6727658538389, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368, "num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 592.1413484560538, "num_env_steps_trained_throughput_per_sec": 592.1413484560538, "timesteps_total": 110592, "num_env_steps_sampled_lifetime": 110592, "num_agent_steps_sampled_lifetime": 442368, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 442368, "timers": {"training_iteration_time_ms": 3690.901, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3690.78, "sample_time_ms": 2351.564, "learn_time_ms": 1304.457, "learn_throughput": 1570.002, "synch_weights_time_ms": 13.722}, "counters": {"num_env_steps_sampled": 110592, "num_env_steps_trained": 110592, "num_agent_steps_sampled": 442368, "num_agent_steps_trained": 442368}, "done": false, "training_iteration": 54, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-09", "timestamp": 1729548369, "time_this_iter_s": 3.4659972190856934, "time_total_s": 204.4116883277893, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e669990>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753c40>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753d30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753df0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753ee0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 204.4116883277893, "iterations_since_restore": 54, "perf": {"cpu_util_percent": 5.539999999999999, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.408059249818325, "cur_kl_coeff": 3.725290298461914e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.742703235149383, "policy_loss": 6.68987282551825e-05, "vf_loss": 9.742636263370514, "vf_explained_var": 9.878352284431458e-05, "kl": 0.0022795570126635752, "entropy": 0.20023888191208244, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.405264434218407, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.165551555156707, "policy_loss": -0.005104744900017976, "vf_loss": 9.170656299591064, "vf_explained_var": -1.1338293552398681e-05, "kl": 0.01520143147733961, "entropy": 0.6417331017553807, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5462516859173774, "cur_kl_coeff": 1.4210854715202003e-15, "cur_lr": 5.000000000000001e-05, "total_loss": 9.908713948726653, "policy_loss": -0.0013814050005748868, "vf_loss": 9.910095286369323, "vf_explained_var": 3.1200051307678225e-05, "kl": 0.001592741763943447, "entropy": 0.9073827765882015, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.418307460844517, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.635854589939117, "policy_loss": -0.0027373109420295804, "vf_loss": 7.638486754894257, "vf_explained_var": -0.00012069791555404663, "kl": 0.008408419251294227, "entropy": 2.153518149256706, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1559.6727658538389, "episode_len_mean": 2973.176470588235, "episode_media": {}, "episodes_timesteps_total": 101088, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1757.3551779315412, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 574.8443509942672, "DC1_ls_policy": 3869.8174803460024, "DC2_ls_policy": 51.03518814394071, "DC3_ls_policy": -2936.0242536303745}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54156.37045916655, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.527315640060738e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 102295.33907267278, "DC2_ls_policy/bat_CO2_footprint_sum_min": 82283.62484309752, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0039001269699799105, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7293327569307961, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118422.0004502535, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19094352406852408, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.448480606063326, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 101771208.38886416, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 76.67712186750023, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1170.1179881308663, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6050579862230974, "mean_inference_ms": 2.2535620982514297, "mean_action_processing_ms": 0.32634718876082236, "mean_env_wait_ms": 4.363929916072706, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031793818754308366, "StateBufferConnector_ms": 0.002535125788520364, "ViewRequirementAgentConnector_ms": 0.05448004778693704}, "num_episodes": 0, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1559.6727658538389, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560, "num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 577.881034176777, "num_env_steps_trained_throughput_per_sec": 577.881034176777, "timesteps_total": 112640, "num_env_steps_sampled_lifetime": 112640, "num_agent_steps_sampled_lifetime": 450560, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 450560, "timers": {"training_iteration_time_ms": 3676.74, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3676.614, "sample_time_ms": 2340.329, "learn_time_ms": 1301.597, "learn_throughput": 1573.452, "synch_weights_time_ms": 13.393}, "counters": {"num_env_steps_sampled": 112640, "num_env_steps_trained": 112640, "num_agent_steps_sampled": 450560, "num_agent_steps_trained": 450560}, "done": false, "training_iteration": 55, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-13", "timestamp": 1729548373, "time_this_iter_s": 3.5520546436309814, "time_total_s": 207.9637429714203, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f015b6fb880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e4d0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c4f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c610>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d6c0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 207.9637429714203, "iterations_since_restore": 55, "perf": {"cpu_util_percent": 8.86, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5621166273951532, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.628680455684663, "policy_loss": -0.0005691370693966747, "vf_loss": 9.629249465465545, "vf_explained_var": 0.00013260096311569215, "kl": 0.005027148503438638, "entropy": 0.08175223906291648, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1411995328962803, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.301591312885284, "policy_loss": -0.0010332230827771126, "vf_loss": 9.302624607086182, "vf_explained_var": -6.741285324096679e-06, "kl": 0.004873036397976232, "entropy": 0.7623831048607826, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7193079344928264, "cur_kl_coeff": 7.105427357601001e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.925031471252442, "policy_loss": -0.001455508905928582, "vf_loss": 9.926486849784851, "vf_explained_var": -8.970573544502259e-05, "kl": 0.003208206836292752, "entropy": 0.8883100926876069, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.957966047525406, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.331053060293197, "policy_loss": -0.008436051825992764, "vf_loss": 8.339317774772644, "vf_explained_var": 3.336817026138306e-05, "kl": 0.013710710556461803, "entropy": 2.2753925681114198, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1559.6727658538389, "episode_len_mean": 2973.176470588235, "episode_media": {}, "episodes_timesteps_total": 101088, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1757.3551779315412, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 574.8443509942672, "DC1_ls_policy": 3869.8174803460024, "DC2_ls_policy": 51.03518814394071, "DC3_ls_policy": -2936.0242536303745}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54156.37045916655, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.527315640060738e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 102295.33907267278, "DC2_ls_policy/bat_CO2_footprint_sum_min": 82283.62484309752, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0039001269699799105, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7293327569307961, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118422.0004502535, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.19094352406852408, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.448480606063326, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 101771208.38886416, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 76.67712186750023, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1170.1179881308663, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6050579862230974, "mean_inference_ms": 2.2535620982514297, "mean_action_processing_ms": 0.32634718876082236, "mean_env_wait_ms": 4.363929916072706, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031793818754308366, "StateBufferConnector_ms": 0.002535125788520364, "ViewRequirementAgentConnector_ms": 0.05448004778693704}, "num_episodes": 0, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1559.6727658538389, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752, "num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 547.4147705355548, "num_env_steps_trained_throughput_per_sec": 547.4147705355548, "timesteps_total": 114688, "num_env_steps_sampled_lifetime": 114688, "num_agent_steps_sampled_lifetime": 458752, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 458752, "timers": {"training_iteration_time_ms": 3687.861, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3687.736, "sample_time_ms": 2351.333, "learn_time_ms": 1301.324, "learn_throughput": 1573.781, "synch_weights_time_ms": 12.582}, "counters": {"num_env_steps_sampled": 114688, "num_env_steps_trained": 114688, "num_agent_steps_sampled": 458752, "num_agent_steps_trained": 458752}, "done": false, "training_iteration": 56, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-17", "timestamp": 1729548377, "time_this_iter_s": 3.750840663909912, "time_total_s": 211.7145836353302, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af760>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c0a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c040>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ce20>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e560>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 211.7145836353302, "iterations_since_restore": 56, "perf": {"cpu_util_percent": 18.866666666666664, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.629547896981239, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.533546733856202, "policy_loss": -0.00206557021883782, "vf_loss": 9.535612225532532, "vf_explained_var": 0.00012515634298324586, "kl": 0.007486196987611038, "entropy": 0.04679042582283728, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4752345331013204, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.238697791099549, "policy_loss": -0.006302930228412151, "vf_loss": 9.24500069618225, "vf_explained_var": -1.4123320579528808e-05, "kl": 0.011209200092230276, "entropy": 0.7913755267858505, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8428386434912682, "cur_kl_coeff": 3.5527136788005006e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.892065167427063, "policy_loss": -0.0031487779226154087, "vf_loss": 9.895213997364044, "vf_explained_var": -3.462508320808411e-05, "kl": 0.0068117886866960325, "entropy": 0.9286810696125031, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.209803421795368, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.593162858486176, "policy_loss": -0.0009352241817396134, "vf_loss": 8.594033318758012, "vf_explained_var": -7.270500063896179e-05, "kl": 0.005181217232166091, "entropy": 2.3010113060474398, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1688.234567048421, "episode_len_mean": 2956.8, "episode_media": {}, "episodes_timesteps_total": 103488, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1757.3551779315412, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 596.7560486279272, "DC1_ls_policy": 3853.178446689964, "DC2_ls_policy": 94.1500991418054, "DC3_ls_policy": -2855.8500274112794}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54090.96254138821, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4551066217732885e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 101724.84335924382, "DC2_ls_policy/bat_CO2_footprint_sum_min": 82283.62484309752, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0037886947708376272, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7090780114946782, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118548.56369615556, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.18548799480942338, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.380059731604374, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 101076229.63484037, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 74.48634695700024, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1137.1701081128415, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048333467515649, "mean_inference_ms": 2.2529219625770494, "mean_action_processing_ms": 0.32615712119919116, "mean_env_wait_ms": 4.363179086008911, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032220567975725445, "StateBufferConnector_ms": 0.0025340488978794645, "ViewRequirementAgentConnector_ms": 0.05444220134190151}, "num_episodes": 1, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1688.234567048421, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944, "num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 531.6208899017751, "num_env_steps_trained_throughput_per_sec": 531.6208899017751, "timesteps_total": 116736, "num_env_steps_sampled_lifetime": 116736, "num_agent_steps_sampled_lifetime": 466944, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 466944, "timers": {"training_iteration_time_ms": 3724.749, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3724.629, "sample_time_ms": 2390.749, "learn_time_ms": 1299.66, "learn_throughput": 1575.797, "synch_weights_time_ms": 12.112}, "counters": {"num_env_steps_sampled": 116736, "num_env_steps_trained": 116736, "num_agent_steps_sampled": 466944, "num_agent_steps_trained": 466944}, "done": false, "training_iteration": 57, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-21", "timestamp": 1729548381, "time_this_iter_s": 3.8607003688812256, "time_total_s": 215.57528400421143, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66bac0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e350>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c0d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d2d0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ebc0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 215.57528400421143, "iterations_since_restore": 57, "perf": {"cpu_util_percent": 19.380000000000003, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5669292978942395, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.681932282447814, "policy_loss": -0.0026718748733401297, "vf_loss": 9.68460408449173, "vf_explained_var": 0.00011891573667526245, "kl": 0.0056058290996604055, "entropy": -0.03950205477303825, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8007876694202425, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.451556301116943, "policy_loss": -0.00109925321303308, "vf_loss": 9.452655506134032, "vf_explained_var": -2.126544713973999e-05, "kl": 0.005475814742232613, "entropy": 0.5138641517609358, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.5822837680578232, "cur_kl_coeff": 3.5527136788005006e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.895045804977418, "policy_loss": -0.0010638292762450874, "vf_loss": 9.896109580993652, "vf_explained_var": 3.8147717714309695e-05, "kl": 0.0022196373092356224, "entropy": 0.912758718430996, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.13696621954441, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 7.48313707113266, "policy_loss": -0.003603637986816466, "vf_loss": 7.486644691228866, "vf_explained_var": 0.00010284706950187683, "kl": 0.007678884682172793, "entropy": 2.3780472189188004, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1688.234567048421, "episode_len_mean": 2956.8, "episode_media": {}, "episodes_timesteps_total": 103488, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1757.3551779315412, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 596.7560486279272, "DC1_ls_policy": 3853.178446689964, "DC2_ls_policy": 94.1500991418054, "DC3_ls_policy": -2855.8500274112794}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54090.96254138821, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.4551066217732885e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 101724.84335924382, "DC2_ls_policy/bat_CO2_footprint_sum_min": 82283.62484309752, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0037886947708376272, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.7090780114946782, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118548.56369615556, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.18548799480942338, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.380059731604374, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 101076229.63484037, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 74.48634695700024, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1137.1701081128415, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6048333467515649, "mean_inference_ms": 2.2529219625770494, "mean_action_processing_ms": 0.32615712119919116, "mean_env_wait_ms": 4.363179086008911, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032220567975725445, "StateBufferConnector_ms": 0.0025340488978794645, "ViewRequirementAgentConnector_ms": 0.05444220134190151}, "num_episodes": 0, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1688.234567048421, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136, "num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 575.7025143512873, "num_env_steps_trained_throughput_per_sec": 575.7025143512873, "timesteps_total": 118784, "num_env_steps_sampled_lifetime": 118784, "num_agent_steps_sampled_lifetime": 475136, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 475136, "timers": {"training_iteration_time_ms": 3695.762, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3695.643, "sample_time_ms": 2365.886, "learn_time_ms": 1297.269, "learn_throughput": 1578.701, "synch_weights_time_ms": 11.688}, "counters": {"num_env_steps_sampled": 118784, "num_env_steps_trained": 118784, "num_agent_steps_sampled": 475136, "num_agent_steps_trained": 475136}, "done": false, "training_iteration": 58, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-24", "timestamp": 1729548384, "time_this_iter_s": 3.564570665359497, "time_total_s": 219.13985466957092, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2afeb0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e7a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e9b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72eda0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cbe0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 219.13985466957092, "iterations_since_restore": 58, "perf": {"cpu_util_percent": 20.6, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8415439039468766, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.536497008800506, "policy_loss": -0.002443275327095762, "vf_loss": 9.538940227031707, "vf_explained_var": 2.5840848684310914e-05, "kl": 0.009960409930863534, "entropy": -0.05743052419275045, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.612651849538088, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.601010704040528, "policy_loss": -0.003983585583046079, "vf_loss": 9.604994118213654, "vf_explained_var": -2.7725100517272948e-05, "kl": 0.009914409756130001, "entropy": 0.5275438733398914, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7072498247027397, "cur_kl_coeff": 1.7763568394002503e-16, "cur_lr": 5.000000000000001e-05, "total_loss": 9.83615027666092, "policy_loss": -0.00035143954446539285, "vf_loss": 9.836501693725586, "vf_explained_var": -5.3588300943374634e-05, "kl": 0.002175160646209171, "entropy": 0.9476287245750428, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.927619341015816, "cur_kl_coeff": 0.012499999999999999, "cur_lr": 5.000000000000001e-05, "total_loss": 8.350010871887207, "policy_loss": -0.0008840770111419261, "vf_loss": 8.350838834047318, "vf_explained_var": 1.3563036918640137e-05, "kl": 0.004493289600713979, "entropy": 2.3624738067388535, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1907.509892396036, "episode_len_mean": 2931.891891891892, "episode_media": {}, "episodes_timesteps_total": 108480, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1812.3546202194793, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 640.3225589986598, "DC1_ls_policy": 3825.437704855438, "DC2_ls_policy": 179.69799858387393, "DC3_ls_policy": -2737.9483700419382}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 53889.44420688787, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.322398155731489e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 100813.94694061636, "DC2_ls_policy/bat_CO2_footprint_sum_min": 80548.21238274612, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0035839004589004585, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.6707494703328036, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118716.97526499053, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17546161671161672, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.2644665860290853, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99971641.00799793, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 70.46005793229752, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1080.1083830857788, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6042410292709868, "mean_inference_ms": 2.2502899554597144, "mean_action_processing_ms": 0.3256667314912765, "mean_env_wait_ms": 4.359537157613233, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032192951924092062, "StateBufferConnector_ms": 0.0025409298974114493, "ViewRequirementAgentConnector_ms": 0.0545266512277964}, "num_episodes": 2, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1907.509892396036, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328, "num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 531.5620687290855, "num_env_steps_trained_throughput_per_sec": 531.5620687290855, "timesteps_total": 120832, "num_env_steps_sampled_lifetime": 120832, "num_agent_steps_sampled_lifetime": 483328, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 483328, "timers": {"training_iteration_time_ms": 3717.309, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3717.19, "sample_time_ms": 2388.571, "learn_time_ms": 1296.856, "learn_throughput": 1579.204, "synch_weights_time_ms": 11.212}, "counters": {"num_env_steps_sampled": 120832, "num_env_steps_trained": 120832, "num_agent_steps_sampled": 483328, "num_agent_steps_trained": 483328}, "done": false, "training_iteration": 59, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-28", "timestamp": 1729548388, "time_this_iter_s": 3.862382173538208, "time_total_s": 223.00223684310913, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af760>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752e00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752b60>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ebc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d2d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 223.00223684310913, "iterations_since_restore": 59, "perf": {"cpu_util_percent": 19.05, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.803237706422806, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.785478222370148, "policy_loss": -0.0013681846670806409, "vf_loss": 9.786846387386323, "vf_explained_var": 5.577206611633301e-05, "kl": 0.007315540643437183, "entropy": -0.1429016382433474, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.515075495839119, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.40794450044632, "policy_loss": -0.004030845843954012, "vf_loss": 9.41197544336319, "vf_explained_var": -1.0525435209274292e-05, "kl": 0.007163510026089892, "entropy": 0.4804155383259058, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.635627668350935, "cur_kl_coeff": 8.881784197001252e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.915370965003968, "policy_loss": -0.002247724833432585, "vf_loss": 9.917618668079376, "vf_explained_var": 0.0005237549543380737, "kl": 0.0044810517381847605, "entropy": 0.9182004816830158, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.70058141797781, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.286965084075928, "policy_loss": -0.003761992696672678, "vf_loss": 7.29067565202713, "vf_explained_var": -9.944289922714234e-06, "kl": 0.00823425289454555, "entropy": 2.3973539143800737, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520}, "env_runners": {"episode_reward_max": 6739.964038360894, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 1907.509892396036, "episode_len_mean": 2931.891891891892, "episode_media": {}, "episodes_timesteps_total": 108480, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1812.3546202194793, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 640.3225589986598, "DC1_ls_policy": 3825.437704855438, "DC2_ls_policy": 179.69799858387393, "DC3_ls_policy": -2737.9483700419382}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 53889.44420688787, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.322398155731489e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 100813.94694061636, "DC2_ls_policy/bat_CO2_footprint_sum_min": 80548.21238274612, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0035839004589004585, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.6707494703328036, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118716.97526499053, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17546161671161672, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.2644665860290853, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99971641.00799793, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 70.46005793229752, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1080.1083830857788, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6042410292709868, "mean_inference_ms": 2.2502899554597144, "mean_action_processing_ms": 0.3256667314912765, "mean_env_wait_ms": 4.359537157613233, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032192951924092062, "StateBufferConnector_ms": 0.0025409298974114493, "ViewRequirementAgentConnector_ms": 0.0545266512277964}, "num_episodes": 0, "episode_return_max": 6739.964038360894, "episode_return_min": -3711.90038700316, "episode_return_mean": 1907.509892396036, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520, "num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 548.0456309201661, "num_env_steps_trained_throughput_per_sec": 548.0456309201661, "timesteps_total": 122880, "num_env_steps_sampled_lifetime": 122880, "num_agent_steps_sampled_lifetime": 491520, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 491520, "timers": {"training_iteration_time_ms": 3700.733, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3700.607, "sample_time_ms": 2374.221, "learn_time_ms": 1295.35, "learn_throughput": 1581.04, "synch_weights_time_ms": 11.162}, "counters": {"num_env_steps_sampled": 122880, "num_env_steps_trained": 122880, "num_agent_steps_sampled": 491520, "num_agent_steps_trained": 491520}, "done": false, "training_iteration": 60, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-32", "timestamp": 1729548392, "time_this_iter_s": 3.746271848678589, "time_total_s": 226.74850869178772, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af640>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e4a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72df30>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ef50>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c310>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 226.74850869178772, "iterations_since_restore": 60, "perf": {"cpu_util_percent": 20.759999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.2694094479084015, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.737052249908448, "policy_loss": -0.002544759516604245, "vf_loss": 9.73959698677063, "vf_explained_var": 4.7977268695831296e-05, "kl": 0.006795737476842821, "entropy": -0.09908442574087531, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4307411633431912, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.47803373336792, "policy_loss": -0.005708434199914336, "vf_loss": 9.48374217748642, "vf_explained_var": -9.423494338989257e-06, "kl": 0.008799787318798736, "entropy": 0.45196981392800806, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8303716838359834, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.829270565509796, "policy_loss": -0.0038068984169512985, "vf_loss": 9.83307740688324, "vf_explained_var": 0.00020417943596839905, "kl": 0.005132690323398732, "entropy": 0.8470350407063961, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.587906602025032, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.829932588338852, "policy_loss": -0.004273517156252638, "vf_loss": 7.834138602018356, "vf_explained_var": 7.808730006217957e-05, "kl": 0.010805809379053797, "entropy": 2.3413487702608107, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712}, "env_runners": {"episode_reward_max": 6851.333359821607, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2037.6105099598672, "episode_len_mean": 2922.9473684210525, "episode_media": {}, "episodes_timesteps_total": 111072, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1926.7559552211542, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 664.3182653665812, "DC1_ls_policy": 3815.2664721349897, "DC2_ls_policy": 225.67320796906552, "DC3_ls_policy": -2667.647435510773}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 53905.1076611929, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.261282414791187e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 100251.21784422596, "DC2_ls_policy/bat_CO2_footprint_sum_min": 79430.24127778136, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0034895872889293936, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.6530981684819404, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118780.83793649668, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17084420574552153, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.2089161333103213, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99595802.00765048, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 68.60584588144758, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1054.0129002341062, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605214076857717, "mean_inference_ms": 2.252719773809821, "mean_action_processing_ms": 0.32615108530221154, "mean_env_wait_ms": 4.3671969940097926, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003209710121154785, "StateBufferConnector_ms": 0.0025446477689241107, "ViewRequirementAgentConnector_ms": 0.054595344945004114}, "num_episodes": 1, "episode_return_max": 6851.333359821607, "episode_return_min": -3711.90038700316, "episode_return_mean": 2037.6105099598672, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712, "num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 537.5960282428443, "num_env_steps_trained_throughput_per_sec": 537.5960282428443, "timesteps_total": 124928, "num_env_steps_sampled_lifetime": 124928, "num_agent_steps_sampled_lifetime": 499712, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 499712, "timers": {"training_iteration_time_ms": 3704.915, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3704.793, "sample_time_ms": 2379.333, "learn_time_ms": 1294.419, "learn_throughput": 1582.177, "synch_weights_time_ms": 11.295}, "counters": {"num_env_steps_sampled": 124928, "num_env_steps_trained": 124928, "num_agent_steps_sampled": 499712, "num_agent_steps_trained": 499712}, "done": false, "training_iteration": 61, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-36", "timestamp": 1729548396, "time_this_iter_s": 3.8174962997436523, "time_total_s": 230.56600499153137, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f4dc0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c760>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cf70>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cc70>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d210>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 230.56600499153137, "iterations_since_restore": 61, "perf": {"cpu_util_percent": 13.35, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.832544334232807, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.544592928886413, "policy_loss": -0.0027913096186239273, "vf_loss": 9.547384309768677, "vf_explained_var": 0.0001042790710926056, "kl": 0.010534504395401548, "entropy": 0.05105802894686349, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0108744867146013, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.126963376998901, "policy_loss": -0.005410967115312815, "vf_loss": 9.1323744058609, "vf_explained_var": -9.63360071182251e-06, "kl": 0.0068420881190377255, "entropy": 0.37081737704575063, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.7862909719347955, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.885169398784637, "policy_loss": -0.005648772389395163, "vf_loss": 9.890818190574645, "vf_explained_var": 1.6323477029800416e-05, "kl": 0.010282128237224696, "entropy": 0.8601993471384048, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.7695289760828015, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.568137830495834, "policy_loss": -0.006678614288102835, "vf_loss": 8.574746453762055, "vf_explained_var": -4.303455352783203e-06, "kl": 0.011202581138969603, "entropy": 2.308115628361702, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 4920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904}, "env_runners": {"episode_reward_max": 6851.333359821607, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2037.6105099598672, "episode_len_mean": 2922.9473684210525, "episode_media": {}, "episodes_timesteps_total": 111072, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2220.0128755178634, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 1926.7559552211542, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 664.3182653665812, "DC1_ls_policy": 3815.2664721349897, "DC2_ls_policy": 225.67320796906552, "DC3_ls_policy": -2667.647435510773}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 53905.1076611929, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 2.261282414791187e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 100251.21784422596, "DC2_ls_policy/bat_CO2_footprint_sum_min": 79430.24127778136, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0034895872889293936, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.6530981684819404, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118780.83793649668, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.17084420574552153, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.2089161333103213, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.020833333333333332, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99595802.00765048, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 68.60584588144758, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1054.0129002341062, "accumulated/ls_overdue_penalty_sum_min": 12.893229166666666, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605214076857717, "mean_inference_ms": 2.252719773809821, "mean_action_processing_ms": 0.32615108530221154, "mean_env_wait_ms": 4.3671969940097926, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003209710121154785, "StateBufferConnector_ms": 0.0025446477689241107, "ViewRequirementAgentConnector_ms": 0.054595344945004114}, "num_episodes": 0, "episode_return_max": 6851.333359821607, "episode_return_min": -3711.90038700316, "episode_return_mean": 2037.6105099598672, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904, "num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 546.1142367788806, "num_env_steps_trained_throughput_per_sec": 546.1142367788806, "timesteps_total": 126976, "num_env_steps_sampled_lifetime": 126976, "num_agent_steps_sampled_lifetime": 507904, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 507904, "timers": {"training_iteration_time_ms": 3706.382, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3706.266, "sample_time_ms": 2382.804, "learn_time_ms": 1292.411, "learn_throughput": 1584.635, "synch_weights_time_ms": 11.148}, "counters": {"num_env_steps_sampled": 126976, "num_env_steps_trained": 126976, "num_agent_steps_sampled": 507904, "num_agent_steps_trained": 507904}, "done": false, "training_iteration": 62, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-40", "timestamp": 1729548400, "time_this_iter_s": 3.7589035034179688, "time_total_s": 234.32490849494934, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ea70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c520>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e740>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c940>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 234.32490849494934, "iterations_since_restore": 62, "perf": {"cpu_util_percent": 5.819999999999999, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.125074760615826, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.767090213298797, "policy_loss": -0.00011702172923833132, "vf_loss": 9.767207205295563, "vf_explained_var": 9.94652509689331e-07, "kl": 0.007231099609329644, "entropy": -0.18173964424058794, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.9097997821867465, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.612600111961365, "policy_loss": -0.0024194030731450765, "vf_loss": 9.615019500255585, "vf_explained_var": -3.711134195327759e-05, "kl": 0.006507735887090893, "entropy": 0.23710057130083442, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.053106250613928, "cur_kl_coeff": 4.440892098500626e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.892998707294463, "policy_loss": -0.001569622999522835, "vf_loss": 9.894568336009979, "vf_explained_var": -0.00011231452226638794, "kl": 0.003826516462277141, "entropy": 0.8004413835704327, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.6287048444151875, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.141413486003875, "policy_loss": -0.007335090421838686, "vf_loss": 7.148676365613937, "vf_explained_var": 0.00015576779842376708, "kl": 0.011559185840087593, "entropy": 2.324192488193512, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096}, "env_runners": {"episode_reward_max": 9563.980333560929, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2369.9245435643484, "episode_len_mean": 2944.8, "episode_media": {}, "episodes_timesteps_total": 117792, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2747.0872641253422, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 2721.794098550147, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 754.301079340639, "DC1_ls_policy": 3845.2060007658815, "DC2_ls_policy": 339.1020739534744, "DC3_ls_policy": -2568.6846104956517}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 53825.27626654983, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.078277817861151e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 99172.8729442247, "DC2_ls_policy/bat_CO2_footprint_sum_min": 75770.09614653506, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.003315107924482924, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.6230412263276847, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118676.33884597462, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.16230199545824547, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.1087319833908373, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99859730.38282219, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 65.1755535873752, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1007.3174844820736, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.604922355961239, "mean_inference_ms": 2.252026603652374, "mean_action_processing_ms": 0.32608936695646906, "mean_env_wait_ms": 4.3654592530806156, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031882524490356445, "StateBufferConnector_ms": 0.0025472044944763184, "ViewRequirementAgentConnector_ms": 0.054528266191482544}, "num_episodes": 2, "episode_return_max": 9563.980333560929, "episode_return_min": -3711.90038700316, "episode_return_mean": 2369.9245435643484, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096, "num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 566.1397347638214, "num_env_steps_trained_throughput_per_sec": 566.1397347638214, "timesteps_total": 129024, "num_env_steps_sampled_lifetime": 129024, "num_agent_steps_sampled_lifetime": 516096, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 516096, "timers": {"training_iteration_time_ms": 3692.074, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3691.958, "sample_time_ms": 2367.616, "learn_time_ms": 1293.733, "learn_throughput": 1583.016, "synch_weights_time_ms": 11.125}, "counters": {"num_env_steps_sampled": 129024, "num_env_steps_trained": 129024, "num_agent_steps_sampled": 516096, "num_agent_steps_trained": 516096}, "done": false, "training_iteration": 63, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-44", "timestamp": 1729548404, "time_this_iter_s": 3.6287522315979004, "time_total_s": 237.95366072654724, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f014f2af760>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e560>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d990>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dc90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e770>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 237.95366072654724, "iterations_since_restore": 63, "perf": {"cpu_util_percent": 12.76, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.120997375249862, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.500364363193512, "policy_loss": -0.0018352973740547896, "vf_loss": 9.502199697494508, "vf_explained_var": 2.9756873846054078e-05, "kl": 0.01147545952153647, "entropy": -0.2420822374522686, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7986765533685682, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.479005241394043, "policy_loss": -0.0031153269577771426, "vf_loss": 9.482120680809022, "vf_explained_var": -4.739612340927124e-05, "kl": 0.005195914992874633, "entropy": 0.20494693219661714, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.0713172920048235, "cur_kl_coeff": 2.220446049250313e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.840082359313964, "policy_loss": -0.0012793098343536259, "vf_loss": 9.841361582279205, "vf_explained_var": -3.139525651931763e-05, "kl": 0.003492936681641368, "entropy": 0.8014054074883461, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.520660500228405, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.146794277429581, "policy_loss": -0.0023933393182232975, "vf_loss": 8.149136239290238, "vf_explained_var": 9.960383176803589e-05, "kl": 0.008203547982226252, "entropy": 2.3010234475135802, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5080.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288}, "env_runners": {"episode_reward_max": 9563.980333560929, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2369.9245435643484, "episode_len_mean": 2944.8, "episode_media": {}, "episodes_timesteps_total": 117792, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2747.0872641253422, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 2721.794098550147, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 754.301079340639, "DC1_ls_policy": 3845.2060007658815, "DC2_ls_policy": 339.1020739534744, "DC3_ls_policy": -2568.6846104956517}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 53825.27626654983, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.078277817861151e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 99172.8729442247, "DC2_ls_policy/bat_CO2_footprint_sum_min": 75770.09614653506, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.003315107924482924, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.6230412263276847, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118676.33884597462, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.16230199545824547, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.1087319833908373, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99859730.38282219, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 65.1755535873752, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1007.3174844820736, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.604922355961239, "mean_inference_ms": 2.252026603652374, "mean_action_processing_ms": 0.32608936695646906, "mean_env_wait_ms": 4.3654592530806156, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031882524490356445, "StateBufferConnector_ms": 0.0025472044944763184, "ViewRequirementAgentConnector_ms": 0.054528266191482544}, "num_episodes": 0, "episode_return_max": 9563.980333560929, "episode_return_min": -3711.90038700316, "episode_return_mean": 2369.9245435643484, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288, "num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 528.8504650071635, "num_env_steps_trained_throughput_per_sec": 528.8504650071635, "timesteps_total": 131072, "num_env_steps_sampled_lifetime": 131072, "num_agent_steps_sampled_lifetime": 524288, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 524288, "timers": {"training_iteration_time_ms": 3733.466, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3733.349, "sample_time_ms": 2408.318, "learn_time_ms": 1294.198, "learn_throughput": 1582.447, "synch_weights_time_ms": 11.027}, "counters": {"num_env_steps_sampled": 131072, "num_env_steps_trained": 131072, "num_agent_steps_sampled": 524288, "num_agent_steps_trained": 524288}, "done": false, "training_iteration": 64, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-48", "timestamp": 1729548408, "time_this_iter_s": 3.8822996616363525, "time_total_s": 241.8359603881836, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f5990>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f400>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cee0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d2a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e9e0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 241.8359603881836, "iterations_since_restore": 64, "perf": {"cpu_util_percent": 19.400000000000002, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.33484810590744, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.225357043743134, "policy_loss": -0.0030340364202857016, "vf_loss": 9.228390955924988, "vf_explained_var": 0.0002090074121952057, "kl": 0.007284580714987698, "entropy": -0.09564336183248087, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.024313683062792, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.60477659702301, "policy_loss": -0.0024775352561846376, "vf_loss": 9.607254195213319, "vf_explained_var": -1.7642229795455933e-05, "kl": 0.009571183677417138, "entropy": 0.24521887842565776, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8604731149971485, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.832657325267792, "policy_loss": -0.0028082140488550067, "vf_loss": 9.835465395450592, "vf_explained_var": -4.613399505615235e-06, "kl": 0.008713905445790714, "entropy": 0.7572245717048645, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.547668915987015, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.916589838266373, "policy_loss": -0.007876800186932088, "vf_loss": 7.924382799863816, "vf_explained_var": -3.279000520706177e-06, "kl": 0.013412473568588091, "entropy": 2.306086781620979, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5160.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480}, "env_runners": {"episode_reward_max": 9563.980333560929, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2369.9245435643484, "episode_len_mean": 2944.8, "episode_media": {}, "episodes_timesteps_total": 117792, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2747.0872641253422, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 2721.794098550147, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 754.301079340639, "DC1_ls_policy": 3845.2060007658815, "DC2_ls_policy": 339.1020739534744, "DC3_ls_policy": -2568.6846104956517}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 53825.27626654983, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 3.078277817861151e-05, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.0004734848484848485, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 99172.8729442247, "DC2_ls_policy/bat_CO2_footprint_sum_min": 75770.09614653506, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.003315107924482924, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.6230412263276847, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118676.33884597462, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.16230199545824547, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.1087319833908373, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99859730.38282219, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 65.1755535873752, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 1007.3174844820736, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.604922355961239, "mean_inference_ms": 2.252026603652374, "mean_action_processing_ms": 0.32608936695646906, "mean_env_wait_ms": 4.3654592530806156, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0031882524490356445, "StateBufferConnector_ms": 0.0025472044944763184, "ViewRequirementAgentConnector_ms": 0.054528266191482544}, "num_episodes": 0, "episode_return_max": 9563.980333560929, "episode_return_min": -3711.90038700316, "episode_return_mean": 2369.9245435643484, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480, "num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 544.8659687381563, "num_env_steps_trained_throughput_per_sec": 544.8659687381563, "timesteps_total": 133120, "num_env_steps_sampled_lifetime": 133120, "num_agent_steps_sampled_lifetime": 532480, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 532480, "timers": {"training_iteration_time_ms": 3754.94, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3754.823, "sample_time_ms": 2428.415, "learn_time_ms": 1295.646, "learn_throughput": 1580.679, "synch_weights_time_ms": 11.054}, "counters": {"num_env_steps_sampled": 133120, "num_env_steps_trained": 133120, "num_agent_steps_sampled": 532480, "num_agent_steps_trained": 532480}, "done": false, "training_iteration": 65, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-51", "timestamp": 1729548411, "time_this_iter_s": 3.7673285007476807, "time_total_s": 245.60328888893127, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e669120>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f010>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e1d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d840>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c730>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 245.60328888893127, "iterations_since_restore": 65, "perf": {"cpu_util_percent": 19.759999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.741777037084103, "cur_kl_coeff": 1.862645149230957e-10, "cur_lr": 5.000000000000001e-05, "total_loss": 9.770560169219971, "policy_loss": 4.228181787766516e-05, "vf_loss": 9.770517909526825, "vf_explained_var": -1.8209218978881836e-06, "kl": 0.00481226714964759, "entropy": -0.2446645999327302, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.502265354990959, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.40145046710968, "policy_loss": -0.0026991342019755393, "vf_loss": 9.404149556159973, "vf_explained_var": -2.5022029876708985e-05, "kl": 0.009768423348397701, "entropy": 0.041696094849612564, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9144078515470029, "cur_kl_coeff": 1.1102230246251564e-17, "cur_lr": 5.000000000000001e-05, "total_loss": 9.71511242389679, "policy_loss": 0.00026089566526934507, "vf_loss": 9.714851486682893, "vf_explained_var": -6.3017010688781735e-06, "kl": 0.0011597148212391564, "entropy": 0.7609799414873123, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.412542554736137, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.275349199771881, "policy_loss": -0.00358998014125973, "vf_loss": 7.27888445854187, "vf_explained_var": 0.00011302009224891662, "kl": 0.008757377819166443, "entropy": 2.289779135584831, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5240.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672}, "env_runners": {"episode_reward_max": 9563.980333560929, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2572.409261259283, "episode_len_mean": 2962.285714285714, "episode_media": {}, "episodes_timesteps_total": 124416, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2747.0872641253422, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 795.0408593810071, "DC1_ls_policy": 3794.8474821342547, "DC2_ls_policy": 442.3975118922751, "DC3_ls_policy": -2459.8765921482577}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54006.348678486276, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.03854821123174298, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8236268939393939, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 98295.87823124265, "DC2_ls_policy/bat_CO2_footprint_sum_min": 75770.09614653506, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0031572456423646896, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5951880726930331, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118731.19566453804, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1545733290078528, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.0203099968080123, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100331979.6365309, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 62.071955797500195, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 969.2398511233495, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6053060674732852, "mean_inference_ms": 2.2538707135882445, "mean_action_processing_ms": 0.32635432332025754, "mean_env_wait_ms": 4.37202544488103, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032247531981695267, "StateBufferConnector_ms": 0.002553491365341913, "ViewRequirementAgentConnector_ms": 0.05452874160948254}, "num_episodes": 2, "episode_return_max": 9563.980333560929, "episode_return_min": -3711.90038700316, "episode_return_mean": 2572.409261259283, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672, "num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 529.2878382222793, "num_env_steps_trained_throughput_per_sec": 529.2878382222793, "timesteps_total": 135168, "num_env_steps_sampled_lifetime": 135168, "num_agent_steps_sampled_lifetime": 540672, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 540672, "timers": {"training_iteration_time_ms": 3767.752, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3767.638, "sample_time_ms": 2441.18, "learn_time_ms": 1295.883, "learn_throughput": 1580.39, "synch_weights_time_ms": 10.921}, "counters": {"num_env_steps_sampled": 135168, "num_env_steps_trained": 135168, "num_agent_steps_sampled": 540672, "num_agent_steps_trained": 540672}, "done": false, "training_iteration": 66, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-55", "timestamp": 1729548415, "time_this_iter_s": 3.8787336349487305, "time_total_s": 249.48202252388, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f5900>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d150>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cb20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d1e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ca90>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 249.48202252388, "iterations_since_restore": 66, "perf": {"cpu_util_percent": 19.633333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.1660446241498, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.64989639520645, "policy_loss": -1.1253054253757e-06, "vf_loss": 9.649897527694701, "vf_explained_var": 4.003196954727173e-05, "kl": 0.007409961421946748, "entropy": -0.14219307443127036, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.3278739549219605, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.163576030731202, "policy_loss": -0.004907530581112951, "vf_loss": 9.168483638763428, "vf_explained_var": -4.1478872299194335e-05, "kl": 0.012596863331236819, "entropy": -0.01695947542320937, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9806216176599265, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.730558180809021, "policy_loss": -0.004549447918543592, "vf_loss": 9.735107469558717, "vf_explained_var": -5.104392766952515e-06, "kl": 0.008345661159296783, "entropy": 0.7875863231718541, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.268119320273399, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.6090866208076475, "policy_loss": -0.001562406914308667, "vf_loss": 7.610613000392914, "vf_explained_var": 2.873539924621582e-05, "kl": 0.005758333076209965, "entropy": 2.2947100043296813, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5320.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864}, "env_runners": {"episode_reward_max": 9563.980333560929, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2572.409261259283, "episode_len_mean": 2962.285714285714, "episode_media": {}, "episodes_timesteps_total": 124416, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 2747.0872641253422, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 795.0408593810071, "DC1_ls_policy": 3794.8474821342547, "DC2_ls_policy": 442.3975118922751, "DC3_ls_policy": -2459.8765921482577}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54006.348678486276, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.03854821123174298, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8236268939393939, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 98295.87823124265, "DC2_ls_policy/bat_CO2_footprint_sum_min": 75770.09614653506, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0031572456423646896, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5951880726930331, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118731.19566453804, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1545733290078528, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 2.0203099968080123, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100331979.6365309, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 62.071955797500195, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 969.2398511233495, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6053060674732852, "mean_inference_ms": 2.2538707135882445, "mean_action_processing_ms": 0.32635432332025754, "mean_env_wait_ms": 4.37202544488103, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032247531981695267, "StateBufferConnector_ms": 0.002553491365341913, "ViewRequirementAgentConnector_ms": 0.05452874160948254}, "num_episodes": 0, "episode_return_max": 9563.980333560929, "episode_return_min": -3711.90038700316, "episode_return_mean": 2572.409261259283, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864, "num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 555.719744840533, "num_env_steps_trained_throughput_per_sec": 555.719744840533, "timesteps_total": 137216, "num_env_steps_sampled_lifetime": 137216, "num_agent_steps_sampled_lifetime": 548864, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 548864, "timers": {"training_iteration_time_ms": 3751.047, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3750.934, "sample_time_ms": 2426.831, "learn_time_ms": 1293.679, "learn_throughput": 1583.082, "synch_weights_time_ms": 10.72}, "counters": {"num_env_steps_sampled": 137216, "num_env_steps_trained": 137216, "num_agent_steps_sampled": 548864, "num_agent_steps_trained": 548864}, "done": false, "training_iteration": 67, "trial_id": "2c069_00000", "date": "2024-10-21_22-06-59", "timestamp": 1729548419, "time_this_iter_s": 3.6944098472595215, "time_total_s": 253.17643237113953, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66b130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c460>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ceb0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e260>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d8d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 253.17643237113953, "iterations_since_restore": 67, "perf": {"cpu_util_percent": 19.78333333333333, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.951206420361996, "cur_kl_coeff": 9.313225746154784e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.600283801555634, "policy_loss": 0.00013497672625817358, "vf_loss": 9.60014886856079, "vf_explained_var": 3.4071505069732666e-05, "kl": 0.0037694163427673547, "entropy": 0.043794606998562816, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.349281346797943, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.644073164463043, "policy_loss": 0.0009359945426695049, "vf_loss": 9.643137097358704, "vf_explained_var": -2.224147319793701e-05, "kl": 0.004493378329425468, "entropy": -0.12315313736908137, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8103754639625549, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.699874889850616, "policy_loss": -0.01067877714522183, "vf_loss": 9.710553669929505, "vf_explained_var": 5.125999450683594e-07, "kl": 0.017079347281105585, "entropy": 0.7966549128293992, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.3064045250415806, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.259653013944626, "policy_loss": -0.003855287324404344, "vf_loss": 7.263451480865479, "vf_explained_var": 0.00012646913528442384, "kl": 0.009082695621511217, "entropy": 2.2815029591321947, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5400.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2749.981917298961, "episode_len_mean": 2993.860465116279, "episode_media": {}, "episodes_timesteps_total": 128736, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 852.057122649553, "DC1_ls_policy": 3791.236603649574, "DC2_ls_policy": 507.20501449710906, "DC3_ls_policy": -2400.516823497278}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 53965.00922450745, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.05796827867079805, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8736111111111111, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 97963.36299360731, "DC2_ls_policy/bat_CO2_footprint_sum_min": 75770.09614653506, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0030838213251003946, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5813572561876826, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118555.9472418259, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.15097860042627484, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.978816999466224, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 101120184.266325, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 60.62842194174437, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 953.3837281321088, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6052407850575707, "mean_inference_ms": 2.2538125906481166, "mean_action_processing_ms": 0.32626951817946004, "mean_env_wait_ms": 4.37315631073441, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032230865123660064, "StateBufferConnector_ms": 0.0025506629500278207, "ViewRequirementAgentConnector_ms": 0.05456458690554597}, "num_episodes": 1, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 2749.981917298961, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056, "num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 531.9746835098111, "num_env_steps_trained_throughput_per_sec": 531.9746835098111, "timesteps_total": 139264, "num_env_steps_sampled_lifetime": 139264, "num_agent_steps_sampled_lifetime": 557056, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 557056, "timers": {"training_iteration_time_ms": 3780.285, "restore_workers_time_ms": 0.04, "training_step_time_ms": 3780.177, "sample_time_ms": 2455.604, "learn_time_ms": 1294.121, "learn_throughput": 1582.541, "synch_weights_time_ms": 10.679}, "counters": {"num_env_steps_sampled": 139264, "num_env_steps_trained": 139264, "num_agent_steps_sampled": 557056, "num_agent_steps_trained": 557056}, "done": false, "training_iteration": 68, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-03", "timestamp": 1729548423, "time_this_iter_s": 3.8602168560028076, "time_total_s": 257.03664922714233, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e669120>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72edd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72eef0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b25cc0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f0157b26590>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 257.03664922714233, "iterations_since_restore": 68, "perf": {"cpu_util_percent": 20.560000000000002, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.812505722045898, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.807733082771302, "policy_loss": -0.002801979903597385, "vf_loss": 9.810534977912903, "vf_explained_var": 2.1819770336151122e-05, "kl": 0.005980526170335224, "entropy": -0.20554270660504698, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.164475513994693, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.046323573589325, "policy_loss": 0.0005702487542293966, "vf_loss": 9.045753467082978, "vf_explained_var": -2.6814639568328857e-05, "kl": 0.007630130259737686, "entropy": -0.14177251420915127, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1683761589229107, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.771554505825042, "policy_loss": -0.0026961592375300825, "vf_loss": 9.77425068616867, "vf_explained_var": -7.753819227218628e-06, "kl": 0.006572348807114992, "entropy": 0.6881358921527863, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.147777327895165, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.288200998306275, "policy_loss": -0.0029259628616273405, "vf_loss": 7.2910790860652925, "vf_explained_var": -1.8194317817687988e-05, "kl": 0.00766727463319512, "entropy": 2.302165371179581, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5480.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2948.7571527445753, "episode_len_mean": 2971.733333333333, "episode_media": {}, "episodes_timesteps_total": 133728, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 920.2095061175002, "DC1_ls_policy": 3727.8122817341414, "DC2_ls_policy": 574.6336568005462, "DC3_ls_policy": -2273.898291907615}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54082.038225741904, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.07907424691220988, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8736111111111111, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 96828.63355614526, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002946762599540377, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5555280590465776, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118094.95912915874, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1442684404073293, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.89809892199707, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100021247.0301972, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 57.93382541100018, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 918.9147037300834, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.60476962799474, "mean_inference_ms": 2.2518555264362057, "mean_action_processing_ms": 0.3258697255757262, "mean_env_wait_ms": 4.370251507680241, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032099088033040366, "StateBufferConnector_ms": 0.002550151613023546, "ViewRequirementAgentConnector_ms": 0.05457917849222819}, "num_episodes": 2, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 2948.7571527445753, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248, "num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 587.9189599216905, "num_env_steps_trained_throughput_per_sec": 587.9189599216905, "timesteps_total": 141312, "num_env_steps_sampled_lifetime": 141312, "num_agent_steps_sampled_lifetime": 565248, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 565248, "timers": {"training_iteration_time_ms": 3743.353, "restore_workers_time_ms": 0.04, "training_step_time_ms": 3743.246, "sample_time_ms": 2418.882, "learn_time_ms": 1293.598, "learn_throughput": 1583.181, "synch_weights_time_ms": 10.701}, "counters": {"num_env_steps_sampled": 141312, "num_env_steps_trained": 141312, "num_agent_steps_sampled": 565248, "num_agent_steps_trained": 565248}, "done": false, "training_iteration": 69, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-07", "timestamp": 1729548427, "time_this_iter_s": 3.492483615875244, "time_total_s": 260.5291328430176, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f5630>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7534c0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7535b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753670>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753760>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 260.5291328430176, "iterations_since_restore": 69, "perf": {"cpu_util_percent": 6.22, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.460155894607306, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.513283884525299, "policy_loss": -0.0010902289941441268, "vf_loss": 9.514374077320099, "vf_explained_var": 6.786361336708069e-05, "kl": 0.007651503641410877, "entropy": -0.04268299245159142, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.485436505079269, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 8.82184534072876, "policy_loss": -0.0012117839651182294, "vf_loss": 8.823057103157044, "vf_explained_var": -3.805011510848999e-05, "kl": 0.006267258664138353, "entropy": -0.05245133599382825, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.9254920445382595, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.624828064441681, "policy_loss": -0.0042170544969849285, "vf_loss": 9.629045248031616, "vf_explained_var": -3.0785799026489257e-06, "kl": 0.009755782196777307, "entropy": 0.716913678497076, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.338829629123211, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.45509825348854, "policy_loss": -0.005704821343533695, "vf_loss": 8.460733062028885, "vf_explained_var": 0.0001634642481803894, "kl": 0.011195065260609139, "entropy": 2.2404312551021577, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5560.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 2948.7571527445753, "episode_len_mean": 2971.733333333333, "episode_media": {}, "episodes_timesteps_total": 133728, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 721.6831852248217}, "policy_reward_mean": {"high_level_policy": 920.2095061175002, "DC1_ls_policy": 3727.8122817341414, "DC2_ls_policy": 574.6336568005462, "DC3_ls_policy": -2273.898291907615}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54082.038225741904, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.07907424691220988, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8736111111111111, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 96828.63355614526, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002946762599540377, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5555280590465776, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 118094.95912915874, "DC3_ls_policy/bat_CO2_footprint_sum_min": 89855.97679064586, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1442684404073293, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.89809892199707, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 100021247.0301972, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 57.93382541100018, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 918.9147037300834, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.60476962799474, "mean_inference_ms": 2.2518555264362057, "mean_action_processing_ms": 0.3258697255757262, "mean_env_wait_ms": 4.370251507680241, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032099088033040366, "StateBufferConnector_ms": 0.002550151613023546, "ViewRequirementAgentConnector_ms": 0.05457917849222819}, "num_episodes": 0, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 2948.7571527445753, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440, "num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 564.1210990055829, "num_env_steps_trained_throughput_per_sec": 564.1210990055829, "timesteps_total": 143360, "num_env_steps_sampled_lifetime": 143360, "num_agent_steps_sampled_lifetime": 573440, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 573440, "timers": {"training_iteration_time_ms": 3732.702, "restore_workers_time_ms": 0.038, "training_step_time_ms": 3732.599, "sample_time_ms": 2408.891, "learn_time_ms": 1292.543, "learn_throughput": 1584.474, "synch_weights_time_ms": 10.559}, "counters": {"num_env_steps_sampled": 143360, "num_env_steps_trained": 143360, "num_agent_steps_sampled": 573440, "num_agent_steps_trained": 573440}, "done": false, "training_iteration": 70, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-10", "timestamp": 1729548430, "time_this_iter_s": 3.6406044960021973, "time_total_s": 264.1697373390198, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66bbe0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751180>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7518d0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751240>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7514b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 264.1697373390198, "iterations_since_restore": 70, "perf": {"cpu_util_percent": 5.7, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.21677748709917, "cur_kl_coeff": 4.656612873077392e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.806612956523896, "policy_loss": 0.0011268930742517115, "vf_loss": 9.805486059188842, "vf_explained_var": 4.312321543693542e-05, "kl": 0.0043878780961696135, "entropy": -0.19137685569003224, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.760759152472019, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.507318019866943, "policy_loss": -0.0016529007581993938, "vf_loss": 9.508970844745637, "vf_explained_var": -2.0682066679000855e-05, "kl": 0.010038741447899072, "entropy": -0.18926676716655494, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 1.8261616073548794, "cur_kl_coeff": 5.551115123125782e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.83901743888855, "policy_loss": -0.0005064993049018085, "vf_loss": 9.839524006843567, "vf_explained_var": -1.7702579498291015e-06, "kl": 0.003613581889340263, "entropy": 0.7225779317319393, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.151017366349697, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.336747604608536, "policy_loss": -0.0037317766225896777, "vf_loss": 7.34043585062027, "vf_explained_var": -0.00014951229095458985, "kl": 0.006965704184586835, "entropy": 2.2583894520998, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5640.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3068.5052436292895, "episode_len_mean": 2963.478260869565, "episode_media": {}, "episodes_timesteps_total": 136320, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 1396.6149510383357}, "policy_reward_mean": {"high_level_policy": 964.377965389901, "DC1_ls_policy": 3688.201001438595, "DC2_ls_policy": 610.0308025574071, "DC3_ls_policy": -2194.104525756616}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54203.39022787299, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.09482538378824609, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8736111111111111, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 96467.41929079515, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0028827025430286294, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5434513621107825, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 117444.61971033076, "DC3_ls_policy/bat_CO2_footprint_sum_min": 88179.34586307211, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1411321699636917, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.8568359019536556, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99475669.89051773, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 56.67439442380452, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 904.7650760121186, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6055672322203327, "mean_inference_ms": 2.2537469195193958, "mean_action_processing_ms": 0.32624785552915614, "mean_env_wait_ms": 4.376356587603781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032007694244384766, "StateBufferConnector_ms": 0.002550430919813073, "ViewRequirementAgentConnector_ms": 0.054588395616282585}, "num_episodes": 1, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 3068.5052436292895, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632, "num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 541.2046078977412, "num_env_steps_trained_throughput_per_sec": 541.2046078977412, "timesteps_total": 145408, "num_env_steps_sampled_lifetime": 145408, "num_agent_steps_sampled_lifetime": 581632, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 581632, "timers": {"training_iteration_time_ms": 3730.16, "restore_workers_time_ms": 0.039, "training_step_time_ms": 3730.059, "sample_time_ms": 2406.484, "learn_time_ms": 1292.385, "learn_throughput": 1584.668, "synch_weights_time_ms": 10.479}, "counters": {"num_env_steps_sampled": 145408, "num_env_steps_trained": 145408, "num_agent_steps_sampled": 581632, "num_agent_steps_trained": 581632}, "done": false, "training_iteration": 71, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-14", "timestamp": 1729548434, "time_this_iter_s": 3.7938036918640137, "time_total_s": 267.9635410308838, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f6170>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750f70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7511b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751300>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7515d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 267.9635410308838, "iterations_since_restore": 71, "perf": {"cpu_util_percent": 19.333333333333336, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.797004956007004, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.829906976222992, "policy_loss": -0.002164943655952811, "vf_loss": 9.832072019577026, "vf_explained_var": 3.677085041999817e-05, "kl": 0.006046825167643242, "entropy": -0.19701187070459128, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.8155668288469315, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.741173696517944, "policy_loss": -0.0031173659255728124, "vf_loss": 9.744291138648986, "vf_explained_var": -3.512054681777954e-05, "kl": 0.0053669989855977766, "entropy": -0.20989105757325888, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.088416384905577, "cur_kl_coeff": 2.775557561562891e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.72509993314743, "policy_loss": -0.000810150895267725, "vf_loss": 9.725910079479217, "vf_explained_var": -6.889551877975464e-06, "kl": 0.001877856027567759, "entropy": 0.7160700328648091, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.113544680178165, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.43490532040596, "policy_loss": -0.0050199685443658385, "vf_loss": 7.43987158536911, "vf_explained_var": 0.00021225214004516602, "kl": 0.008594637438272911, "entropy": 2.3900076746940613, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5720.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3068.5052436292895, "episode_len_mean": 2963.478260869565, "episode_media": {}, "episodes_timesteps_total": 136320, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 1396.6149510383357}, "policy_reward_mean": {"high_level_policy": 964.377965389901, "DC1_ls_policy": 3688.201001438595, "DC2_ls_policy": 610.0308025574071, "DC3_ls_policy": -2194.104525756616}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54203.39022787299, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.09482538378824609, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8736111111111111, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 96467.41929079515, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0028827025430286294, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5434513621107825, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 117444.61971033076, "DC3_ls_policy/bat_CO2_footprint_sum_min": 88179.34586307211, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1411321699636917, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.8568359019536556, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99475669.89051773, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 56.67439442380452, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 904.7650760121186, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6055672322203327, "mean_inference_ms": 2.2537469195193958, "mean_action_processing_ms": 0.32624785552915614, "mean_env_wait_ms": 4.376356587603781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032007694244384766, "StateBufferConnector_ms": 0.002550430919813073, "ViewRequirementAgentConnector_ms": 0.054588395616282585}, "num_episodes": 0, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 3068.5052436292895, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824, "num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 549.3673013324976, "num_env_steps_trained_throughput_per_sec": 549.3673013324976, "timesteps_total": 147456, "num_env_steps_sampled_lifetime": 147456, "num_agent_steps_sampled_lifetime": 589824, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 589824, "timers": {"training_iteration_time_ms": 3727.941, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3727.834, "sample_time_ms": 2403.905, "learn_time_ms": 1292.633, "learn_throughput": 1584.363, "synch_weights_time_ms": 10.488}, "counters": {"num_env_steps_sampled": 147456, "num_env_steps_trained": 147456, "num_agent_steps_sampled": 589824, "num_agent_steps_trained": 589824}, "done": false, "training_iteration": 72, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-18", "timestamp": 1729548438, "time_this_iter_s": 3.736924886703491, "time_total_s": 271.7004659175873, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e668b80>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7522f0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7523b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752470>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752560>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 271.7004659175873, "iterations_since_restore": 72, "perf": {"cpu_util_percent": 19.98, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.7961510747671126, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.775410437583924, "policy_loss": -0.0026571248890832067, "vf_loss": 9.778067684173584, "vf_explained_var": 1.983568072319031e-05, "kl": 0.012571147595144794, "entropy": -0.09720803494565189, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.276189562305808, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.436340498924256, "policy_loss": -0.005010150244925171, "vf_loss": 9.441350603103638, "vf_explained_var": -9.8496675491333e-06, "kl": 0.011194199897911452, "entropy": -0.2347145302221179, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4103627379983665, "cur_kl_coeff": 1.3877787807814456e-18, "cur_lr": 5.000000000000001e-05, "total_loss": 9.503966987133026, "policy_loss": -0.0005539558711461723, "vf_loss": 9.504521036148072, "vf_explained_var": 4.4479966163635256e-07, "kl": 0.003775673561364433, "entropy": 0.7806518480181694, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.250766459107399, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.943901520967484, "policy_loss": -0.001498526195064187, "vf_loss": 7.945360565185547, "vf_explained_var": 7.104873657226562e-05, "kl": 0.006308916631383677, "entropy": 2.368693271279335, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5800.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3068.5052436292895, "episode_len_mean": 2963.478260869565, "episode_media": {}, "episodes_timesteps_total": 136320, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 1396.6149510383357}, "policy_reward_mean": {"high_level_policy": 964.377965389901, "DC1_ls_policy": 3688.201001438595, "DC2_ls_policy": 610.0308025574071, "DC3_ls_policy": -2194.104525756616}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54203.39022787299, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.09482538378824609, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8736111111111111, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 96467.41929079515, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0028827025430286294, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5434513621107825, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 117444.61971033076, "DC3_ls_policy/bat_CO2_footprint_sum_min": 88179.34586307211, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1411321699636917, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.8568359019536556, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 99475669.89051773, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 56.67439442380452, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 904.7650760121186, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6055672322203327, "mean_inference_ms": 2.2537469195193958, "mean_action_processing_ms": 0.32624785552915614, "mean_env_wait_ms": 4.376356587603781, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032007694244384766, "StateBufferConnector_ms": 0.002550430919813073, "ViewRequirementAgentConnector_ms": 0.054588395616282585}, "num_episodes": 0, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 3068.5052436292895, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016, "num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 544.9842630313296, "num_env_steps_trained_throughput_per_sec": 544.9842630313296, "timesteps_total": 149504, "num_env_steps_sampled_lifetime": 149504, "num_agent_steps_sampled_lifetime": 598016, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 598016, "timers": {"training_iteration_time_ms": 3741.983, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3741.878, "sample_time_ms": 2420.157, "learn_time_ms": 1290.434, "learn_throughput": 1587.063, "synch_weights_time_ms": 10.496}, "counters": {"num_env_steps_sampled": 149504, "num_env_steps_trained": 149504, "num_agent_steps_sampled": 598016, "num_agent_steps_trained": 598016}, "done": false, "training_iteration": 73, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-22", "timestamp": 1729548442, "time_this_iter_s": 3.7659549713134766, "time_total_s": 275.46642088890076, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66bbe0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7527a0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752890>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752950>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752a10>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 275.46642088890076, "iterations_since_restore": 73, "perf": {"cpu_util_percent": 19.683333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.240602365136146, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.807532238960267, "policy_loss": -0.001839255797676742, "vf_loss": 9.809371614456177, "vf_explained_var": 2.778172492980957e-05, "kl": 0.006483398889668024, "entropy": -0.2589450743049383, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.601976205408573, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.031015765666961, "policy_loss": -0.00350710311322473, "vf_loss": 9.034523022174834, "vf_explained_var": -3.7766993045806885e-05, "kl": 0.008935545341593354, "entropy": -0.27697141095995903, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8915935426950456, "cur_kl_coeff": 6.938893903907228e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 9.475531423091889, "policy_loss": -0.0012459594872780144, "vf_loss": 9.476777338981629, "vf_explained_var": -4.154443740844727e-06, "kl": 0.004554210636672854, "entropy": 0.682274179905653, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.476854929327965, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 6.6844844102859495, "policy_loss": -0.009317539847688749, "vf_loss": 6.6937076330184935, "vf_explained_var": -0.00014469027519226074, "kl": 0.01509373768894998, "entropy": 2.3527852296829224, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5880.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3191.7382212972893, "episode_len_mean": 2957.6170212765956, "episode_media": {}, "episodes_timesteps_total": 139008, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 1897.4122422937862, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 1396.6149510383357}, "policy_reward_mean": {"high_level_policy": 1005.7971837554002, "DC1_ls_policy": 3660.0879583107107, "DC2_ls_policy": 646.087322000263, "DC3_ls_policy": -2120.2342427690864}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54381.08004452885, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.10217174087076569, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 0.8736111111111111, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 96043.41670073448, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002821368446368446, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.533732855419469, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 116898.0600230279, "DC3_ls_policy/bat_CO2_footprint_sum_min": 88179.34586307211, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.13812935783680466, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.8173287551035777, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 98981930.74447267, "accumulated/bat_CO2_footprint_sum_min": 72287917.58240284, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 55.46855624457464, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 890.9312161121646, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.60559782931697, "mean_inference_ms": 2.252918443055487, "mean_action_processing_ms": 0.3261509527613883, "mean_env_wait_ms": 4.376100696126725, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.00319151168173932, "StateBufferConnector_ms": 0.0025482887917376578, "ViewRequirementAgentConnector_ms": 0.05456297955614455}, "num_episodes": 1, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 3191.7382212972893, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208, "num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 572.4975413409354, "num_env_steps_trained_throughput_per_sec": 572.4975413409354, "timesteps_total": 151552, "num_env_steps_sampled_lifetime": 151552, "num_agent_steps_sampled_lifetime": 606208, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 606208, "timers": {"training_iteration_time_ms": 3712.459, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3712.353, "sample_time_ms": 2391.848, "learn_time_ms": 1289.365, "learn_throughput": 1588.379, "synch_weights_time_ms": 10.504}, "counters": {"num_env_steps_sampled": 151552, "num_env_steps_trained": 151552, "num_agent_steps_sampled": 606208, "num_agent_steps_trained": 606208}, "done": false, "training_iteration": 74, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-26", "timestamp": 1729548446, "time_this_iter_s": 3.5856025218963623, "time_total_s": 279.0520234107971, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f6200>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362440>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362710>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362a40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362b90>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 279.0520234107971, "iterations_since_restore": 74, "perf": {"cpu_util_percent": 20.439999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.171646374464035, "cur_kl_coeff": 2.328306436538696e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.81494208574295, "policy_loss": 0.00017604759195819498, "vf_loss": 9.81476604938507, "vf_explained_var": 1.975521445274353e-05, "kl": 0.004686844275465773, "entropy": -0.08339161644107662, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.045861254632473, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.302052783966065, "policy_loss": 0.0002644610707648098, "vf_loss": 9.301788365840912, "vf_explained_var": -2.5160610675811768e-05, "kl": 0.00909934265582706, "entropy": -0.38724411875009535, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.18878873065114, "cur_kl_coeff": 3.469446951953614e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 9.449402356147766, "policy_loss": -0.0016543401055969299, "vf_loss": 9.451056706905366, "vf_explained_var": 2.3692846298217774e-07, "kl": 0.002046996980880067, "entropy": 0.7591916725039483, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.069968673586845, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.147449684143066, "policy_loss": -0.0020778965146746485, "vf_loss": 8.149474078416825, "vf_explained_var": 0.00012615099549293519, "kl": 0.008558371948676136, "entropy": 2.2549711167812347, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 5960.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3253.4306374525227, "episode_len_mean": 2946.0, "episode_media": {}, "episodes_timesteps_total": 141408, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 1560.9111366922798}, "policy_reward_mean": {"high_level_policy": 1031.2909995422044, "DC1_ls_policy": 3588.547147107995, "DC2_ls_policy": 677.1362048326297, "DC3_ls_policy": -2043.5437140303081}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54745.149192083365, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.13874107960262475, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 95628.90807984502, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0027625899370691035, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5228304348204521, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 116349.11448490452, "DC3_ls_policy/bat_CO2_footprint_sum_min": 88179.34586307211, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1352516628818712, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7794677393722533, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 98392895.08310933, "accumulated/bat_CO2_footprint_sum_min": 70708218.9990327, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 54.31296132281267, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 887.512141297328, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605421926415789, "mean_inference_ms": 2.2523762777190135, "mean_action_processing_ms": 0.3260160647239445, "mean_env_wait_ms": 4.375675354167507, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032195200522740683, "StateBufferConnector_ms": 0.0025463600953420005, "ViewRequirementAgentConnector_ms": 0.05452310045560201}, "num_episodes": 1, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 3253.4306374525227, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400, "num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 528.067271487599, "num_env_steps_trained_throughput_per_sec": 528.067271487599, "timesteps_total": 153600, "num_env_steps_sampled_lifetime": 153600, "num_agent_steps_sampled_lifetime": 614400, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 614400, "timers": {"training_iteration_time_ms": 3724.416, "restore_workers_time_ms": 0.04, "training_step_time_ms": 3724.311, "sample_time_ms": 2405.719, "learn_time_ms": 1287.6, "learn_throughput": 1590.556, "synch_weights_time_ms": 10.484}, "counters": {"num_env_steps_sampled": 153600, "num_env_steps_trained": 153600, "num_agent_steps_sampled": 614400, "num_agent_steps_trained": 614400}, "done": false, "training_iteration": 75, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-30", "timestamp": 1729548450, "time_this_iter_s": 3.887968063354492, "time_total_s": 282.9399914741516, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e668b80>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e361bd0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e3611e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e3620e0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e361f00>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 282.9399914741516, "iterations_since_restore": 75, "perf": {"cpu_util_percent": 20.78, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.039419068396091, "cur_kl_coeff": 1.164153218269348e-11, "cur_lr": 5.000000000000001e-05, "total_loss": 9.84667239189148, "policy_loss": -0.0020595588721334934, "vf_loss": 9.8487318277359, "vf_explained_var": 1.2167543172836303e-05, "kl": 0.0042950820282060004, "entropy": -0.22520888410508633, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.065133054554463, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.573238897323609, "policy_loss": -0.00031920320470817386, "vf_loss": 9.573558104038238, "vf_explained_var": -0.0003621131181716919, "kl": 0.006573621665304346, "entropy": -0.3702282000333071, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.454339613765478, "cur_kl_coeff": 1.734723475976807e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 9.466852355003358, "policy_loss": -0.008527303370647133, "vf_loss": 9.475379717350005, "vf_explained_var": -9.566545486450196e-07, "kl": 0.01979661489949701, "entropy": 0.5549451075494289, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.916969613730908, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.537533360719681, "policy_loss": -0.004664268158376217, "vf_loss": 7.542132484912872, "vf_explained_var": -5.872547626495361e-05, "kl": 0.010421128298776238, "entropy": 2.257810986042023, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6040.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3253.4306374525227, "episode_len_mean": 2946.0, "episode_media": {}, "episodes_timesteps_total": 141408, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 1560.9111366922798}, "policy_reward_mean": {"high_level_policy": 1031.2909995422044, "DC1_ls_policy": 3588.547147107995, "DC2_ls_policy": 677.1362048326297, "DC3_ls_policy": -2043.5437140303081}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54745.149192083365, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.13874107960262475, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 95628.90807984502, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0027625899370691035, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5228304348204521, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 116349.11448490452, "DC3_ls_policy/bat_CO2_footprint_sum_min": 88179.34586307211, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1352516628818712, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7794677393722533, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 98392895.08310933, "accumulated/bat_CO2_footprint_sum_min": 70708218.9990327, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 54.31296132281267, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 887.512141297328, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605421926415789, "mean_inference_ms": 2.2523762777190135, "mean_action_processing_ms": 0.3260160647239445, "mean_env_wait_ms": 4.375675354167507, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032195200522740683, "StateBufferConnector_ms": 0.0025463600953420005, "ViewRequirementAgentConnector_ms": 0.05452310045560201}, "num_episodes": 0, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 3253.4306374525227, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592, "num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 535.8793342768375, "num_env_steps_trained_throughput_per_sec": 535.8793342768375, "timesteps_total": 155648, "num_env_steps_sampled_lifetime": 155648, "num_agent_steps_sampled_lifetime": 622592, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 622592, "timers": {"training_iteration_time_ms": 3719.657, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3719.548, "sample_time_ms": 2403.223, "learn_time_ms": 1286.205, "learn_throughput": 1592.282, "synch_weights_time_ms": 10.75}, "counters": {"num_env_steps_sampled": 155648, "num_env_steps_trained": 155648, "num_agent_steps_sampled": 622592, "num_agent_steps_trained": 622592}, "done": false, "training_iteration": 76, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-34", "timestamp": 1729548454, "time_this_iter_s": 3.831134557723999, "time_total_s": 286.7711260318756, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e6683a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362770>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e362500>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e361930>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e361e70>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 286.7711260318756, "iterations_since_restore": 76, "perf": {"cpu_util_percent": 14.449999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.7992791444063188, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.550094401836395, "policy_loss": -0.0022373885149136186, "vf_loss": 9.552331829071045, "vf_explained_var": 8.708983659744263e-06, "kl": 0.00952587416613955, "entropy": 0.04427096429280937, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.443365435302257, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.276570296287536, "policy_loss": -0.0014740565442480148, "vf_loss": 9.27804434299469, "vf_explained_var": -0.00022305920720100403, "kl": 0.009558625408683278, "entropy": -0.4167672246694565, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.1613300714641808, "cur_kl_coeff": 1.734723475976807e-19, "cur_lr": 5.000000000000001e-05, "total_loss": 9.596953904628753, "policy_loss": -0.0010804924531839788, "vf_loss": 9.598034358024597, "vf_explained_var": -1.2314319610595703e-05, "kl": 0.003055263885539716, "entropy": 0.6093283087015152, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.133141508698463, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.456358957290649, "policy_loss": -0.005421340081375093, "vf_loss": 7.46171258687973, "vf_explained_var": 3.1512975692749026e-05, "kl": 0.010855708474264248, "entropy": 2.2383507788181305, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6120.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3253.4306374525227, "episode_len_mean": 2946.0, "episode_media": {}, "episodes_timesteps_total": 141408, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3246.7401799284867, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 1560.9111366922798}, "policy_reward_mean": {"high_level_policy": 1031.2909995422044, "DC1_ls_policy": 3588.547147107995, "DC2_ls_policy": 677.1362048326297, "DC3_ls_policy": -2043.5437140303081}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 54745.149192083365, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.13874107960262475, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 95628.90807984502, "DC2_ls_policy/bat_CO2_footprint_sum_min": 71746.79869061439, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0027625899370691035, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5228304348204521, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 116349.11448490452, "DC3_ls_policy/bat_CO2_footprint_sum_min": 88179.34586307211, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1352516628818712, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7794677393722533, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 98392895.08310933, "accumulated/bat_CO2_footprint_sum_min": 70708218.9990327, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 54.31296132281267, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 887.512141297328, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605421926415789, "mean_inference_ms": 2.2523762777190135, "mean_action_processing_ms": 0.3260160647239445, "mean_env_wait_ms": 4.375675354167507, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032195200522740683, "StateBufferConnector_ms": 0.0025463600953420005, "ViewRequirementAgentConnector_ms": 0.05452310045560201}, "num_episodes": 0, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 3253.4306374525227, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784, "num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 554.046956320837, "num_env_steps_trained_throughput_per_sec": 554.046956320837, "timesteps_total": 157696, "num_env_steps_sampled_lifetime": 157696, "num_agent_steps_sampled_lifetime": 630784, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 630784, "timers": {"training_iteration_time_ms": 3720.772, "restore_workers_time_ms": 0.044, "training_step_time_ms": 3720.657, "sample_time_ms": 2402.107, "learn_time_ms": 1287.903, "learn_throughput": 1590.182, "synch_weights_time_ms": 10.998}, "counters": {"num_env_steps_sampled": 157696, "num_env_steps_trained": 157696, "num_agent_steps_sampled": 630784, "num_agent_steps_trained": 630784}, "done": false, "training_iteration": 77, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-37", "timestamp": 1729548457, "time_this_iter_s": 3.705524206161499, "time_total_s": 290.4766502380371, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f65f0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e380>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c2e0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72ca90>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cdf0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 290.4766502380371, "iterations_since_restore": 77, "perf": {"cpu_util_percent": 5.266666666666667, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.930027425289154, "cur_kl_coeff": 5.82076609134674e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.745805501937866, "policy_loss": 0.0007706621021497994, "vf_loss": 9.74503481388092, "vf_explained_var": -3.680586814880371e-06, "kl": 0.0021569624097537597, "entropy": 0.13553744181990623, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.168534265458584, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.814173650741576, "policy_loss": -0.000381486484548077, "vf_loss": 9.814555180072784, "vf_explained_var": -0.00019150599837303162, "kl": 0.006816469084151322, "entropy": -0.3771216057240963, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4118542104959486, "cur_kl_coeff": 8.673617379884035e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.333129727840424, "policy_loss": -0.001356933801434934, "vf_loss": 9.334486615657806, "vf_explained_var": -2.484023571014404e-06, "kl": 0.0031961426145670655, "entropy": 0.6849863030016422, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.983214904367924, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.074851769208908, "policy_loss": -0.0021761655109003184, "vf_loss": 7.076988810300827, "vf_explained_var": 4.748627543449402e-05, "kl": 0.006256615644998564, "entropy": 2.22331063747406, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6200.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976}, "env_runners": {"episode_reward_max": 10208.033470965429, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3493.786513621346, "episode_len_mean": 2928.0, "episode_media": {}, "episodes_timesteps_total": 146400, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 3515.215201152888, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3232.1837940846235, "DC3_ls_policy": 1687.2631621007613}, "policy_reward_mean": {"high_level_policy": 1127.8633749223593, "DC1_ls_policy": 3517.5299527891075, "DC2_ls_policy": 743.6690467382826, "DC3_ls_policy": -1895.2758608284034}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55159.97513586841, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.15969784667493, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94650.86388134053, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002652086339586339, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5019172174276341, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 114882.508125724, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79567.61574618056, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.12984159636659637, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.7082890297973632, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 97113212.70002374, "accumulated/bat_CO2_footprint_sum_min": 66153917.497499906, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 52.14044286990016, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 855.839986975563, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6050260087209393, "mean_inference_ms": 2.2507712513677434, "mean_action_processing_ms": 0.32567711373187647, "mean_env_wait_ms": 4.373561310501736, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032099485397338867, "StateBufferConnector_ms": 0.002548813819885254, "ViewRequirementAgentConnector_ms": 0.0545194149017334}, "num_episodes": 2, "episode_return_max": 10208.033470965429, "episode_return_min": -3711.90038700316, "episode_return_mean": 3493.786513621346, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976, "num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 575.6172950793527, "num_env_steps_trained_throughput_per_sec": 575.6172950793527, "timesteps_total": 159744, "num_env_steps_sampled_lifetime": 159744, "num_agent_steps_sampled_lifetime": 638976, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 638976, "timers": {"training_iteration_time_ms": 3691.586, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3691.466, "sample_time_ms": 2373.925, "learn_time_ms": 1285.141, "learn_throughput": 1593.599, "synch_weights_time_ms": 11.103}, "counters": {"num_env_steps_sampled": 159744, "num_env_steps_trained": 159744, "num_agent_steps_sampled": 638976, "num_agent_steps_trained": 638976}, "done": false, "training_iteration": 78, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-41", "timestamp": 1729548461, "time_this_iter_s": 3.5682926177978516, "time_total_s": 294.04494285583496, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66b0a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e230>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f070>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cf40>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752170>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 294.04494285583496, "iterations_since_restore": 78, "perf": {"cpu_util_percent": 13.760000000000002, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.442736357450485, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.616423773765565, "policy_loss": -0.0024988507037051024, "vf_loss": 9.61892260313034, "vf_explained_var": -3.1258165836334226e-05, "kl": 0.005411840386000222, "entropy": -0.2237154535483569, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.011347444355488, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.688908624649049, "policy_loss": -0.0035394589067436755, "vf_loss": 9.69244805574417, "vf_explained_var": -0.0012405171990394592, "kl": 0.011120338283399178, "entropy": -0.19976691352203488, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4576182410120966, "cur_kl_coeff": 4.3368086899420174e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.761650741100311, "policy_loss": -0.0023562526213936506, "vf_loss": 9.764006900787354, "vf_explained_var": -3.5837292671203614e-07, "kl": 0.0032895879135146112, "entropy": 0.5523331556469202, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.07329731285572, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 6.446176415681839, "policy_loss": -0.0071456001256592575, "vf_loss": 6.453245890140534, "vf_explained_var": -8.211582899093628e-05, "kl": 0.012172953276695975, "entropy": 2.2416875034570696, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6280.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168}, "env_runners": {"episode_reward_max": 13808.427194880165, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3696.034370116617, "episode_len_mean": 2949.6470588235293, "episode_media": {}, "episodes_timesteps_total": 150432, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 4699.089326327027, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 2694.4967756484803}, "policy_reward_mean": {"high_level_policy": 1197.8874131851958, "DC1_ls_policy": 3505.12909819042, "DC2_ls_policy": 798.2981776777, "DC3_ls_policy": -1805.2803189366998}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55376.059263928066, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.17085417585621834, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94244.56868949911, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002600084646653274, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.49314071269749366, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 114328.292047832, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79567.61574618056, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1272956827123494, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.6747931664680031, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 97430445.58410108, "accumulated/bat_CO2_footprint_sum_min": 66153917.497499906, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 51.118081245000155, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 845.1598444029795, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6047784980383608, "mean_inference_ms": 2.2509040743071846, "mean_action_processing_ms": 0.32567521028924973, "mean_env_wait_ms": 4.372760954197698, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032048599392760033, "StateBufferConnector_ms": 0.002548507615631702, "ViewRequirementAgentConnector_ms": 0.05452282288495232}, "num_episodes": 1, "episode_return_max": 13808.427194880165, "episode_return_min": -3711.90038700316, "episode_return_mean": 3696.034370116617, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168, "num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 518.4545947105761, "num_env_steps_trained_throughput_per_sec": 518.4545947105761, "timesteps_total": 161792, "num_env_steps_sampled_lifetime": 161792, "num_agent_steps_sampled_lifetime": 647168, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 647168, "timers": {"training_iteration_time_ms": 3738.261, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3738.137, "sample_time_ms": 2419.463, "learn_time_ms": 1285.702, "learn_throughput": 1592.904, "synch_weights_time_ms": 11.276}, "counters": {"num_env_steps_sampled": 161792, "num_env_steps_trained": 161792, "num_agent_steps_sampled": 647168, "num_agent_steps_trained": 647168}, "done": false, "training_iteration": 79, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-45", "timestamp": 1729548465, "time_this_iter_s": 3.962991237640381, "time_total_s": 298.00793409347534, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f4310>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752e60>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752f20>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753040>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753130>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 298.00793409347534, "iterations_since_restore": 79, "perf": {"cpu_util_percent": 22.959999999999997, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.437560151517391, "cur_kl_coeff": 2.91038304567337e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.68657112121582, "policy_loss": -0.0008526205871021375, "vf_loss": 9.687423729896546, "vf_explained_var": -7.309019565582275e-07, "kl": 0.002883873575137841, "entropy": 0.275588626973331, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.182983949780464, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.900049436092377, "policy_loss": -0.0007941873802337796, "vf_loss": 9.900843679904938, "vf_explained_var": 0.0001845322549343109, "kl": 0.0059524015201504995, "entropy": -0.45846985913813115, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6142560616135597, "cur_kl_coeff": 2.1684043449710087e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.45108596086502, "policy_loss": -0.004105263540986925, "vf_loss": 9.45519117116928, "vf_explained_var": -5.3033232688903805e-06, "kl": 0.011798632060163383, "entropy": 0.7341976396739482, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.039831122756004, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.324040561914444, "policy_loss": -0.0005591542692855, "vf_loss": 8.32456476688385, "vf_explained_var": 5.4142624139785764e-05, "kl": 0.005616657851716255, "entropy": 2.2395452946424483, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6360.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360}, "env_runners": {"episode_reward_max": 13808.427194880165, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3696.034370116617, "episode_len_mean": 2949.6470588235293, "episode_media": {}, "episodes_timesteps_total": 150432, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 4699.089326327027, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 2694.4967756484803}, "policy_reward_mean": {"high_level_policy": 1197.8874131851958, "DC1_ls_policy": 3505.12909819042, "DC2_ls_policy": 798.2981776777, "DC3_ls_policy": -1805.2803189366998}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55376.059263928066, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.17085417585621834, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 94244.56868949911, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002600084646653274, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.49314071269749366, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 114328.292047832, "DC3_ls_policy/bat_CO2_footprint_sum_min": 79567.61574618056, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.1272956827123494, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.6747931664680031, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 97430445.58410108, "accumulated/bat_CO2_footprint_sum_min": 66153917.497499906, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 51.118081245000155, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 845.1598444029795, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6047784980383608, "mean_inference_ms": 2.2509040743071846, "mean_action_processing_ms": 0.32567521028924973, "mean_env_wait_ms": 4.372760954197698, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032048599392760033, "StateBufferConnector_ms": 0.002548507615631702, "ViewRequirementAgentConnector_ms": 0.05452282288495232}, "num_episodes": 0, "episode_return_max": 13808.427194880165, "episode_return_min": -3711.90038700316, "episode_return_mean": 3696.034370116617, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360, "num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 508.47364414233607, "num_env_steps_trained_throughput_per_sec": 508.47364414233607, "timesteps_total": 163840, "num_env_steps_sampled_lifetime": 163840, "num_agent_steps_sampled_lifetime": 655360, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 655360, "timers": {"training_iteration_time_ms": 3777.996, "restore_workers_time_ms": 0.048, "training_step_time_ms": 3777.865, "sample_time_ms": 2456.538, "learn_time_ms": 1286.74, "learn_throughput": 1591.619, "synch_weights_time_ms": 11.505}, "counters": {"num_env_steps_sampled": 163840, "num_env_steps_trained": 163840, "num_agent_steps_sampled": 655360, "num_agent_steps_trained": 655360}, "done": false, "training_iteration": 80, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-49", "timestamp": 1729548469, "time_this_iter_s": 4.037652492523193, "time_total_s": 302.04558658599854, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66b880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750d00>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e753520>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751ab0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750f40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 302.04558658599854, "iterations_since_restore": 80, "perf": {"cpu_util_percent": 19.816666666666666, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.999577407538891, "cur_kl_coeff": 1.455191522836685e-12, "cur_lr": 5.000000000000001e-05, "total_loss": 9.762431943416596, "policy_loss": -0.0026501268963329493, "vf_loss": 9.765082049369813, "vf_explained_var": -5.263090133666992e-06, "kl": 0.0034824272969228983, "entropy": 0.22084656860679389, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.642191842198372, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.876327288150787, "policy_loss": -0.002493492350913584, "vf_loss": 9.878820836544037, "vf_explained_var": 0.00010430514812469483, "kl": 0.006803274408230209, "entropy": -0.3488978881388903, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.4906385131180286, "cur_kl_coeff": 2.1684043449710087e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.694299471378326, "policy_loss": -0.0025549371261149646, "vf_loss": 9.696854424476623, "vf_explained_var": -2.3417174816131593e-06, "kl": 0.005917267286376184, "entropy": 0.5141082756221295, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.523469197750091, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.194350188970565, "policy_loss": -0.008822728658560663, "vf_loss": 7.203049689531326, "vf_explained_var": -3.477931022644043e-05, "kl": 0.01971873376287662, "entropy": 2.0438338309526443, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6440.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552}, "env_runners": {"episode_reward_max": 13808.427194880165, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3785.685232358791, "episode_len_mean": 2942.769230769231, "episode_media": {}, "episodes_timesteps_total": 153024, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 4699.089326327027, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 2694.4967756484803}, "policy_reward_mean": {"high_level_policy": 1231.7169422645304, "DC1_ls_policy": 3468.3255789801315, "DC2_ls_policy": 815.6286677241253, "DC3_ls_policy": -1729.985956609997}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55737.55791827841, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.18063386763106315, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 93935.2375569591, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0025500830188330183, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.4933616534077271, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 113584.00419342438, "DC3_ls_policy/bat_CO2_footprint_sum_min": 75625.32361863516, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.12484768881403498, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.6425856055743877, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 96959375.27624543, "accumulated/bat_CO2_footprint_sum_min": 66153917.497499906, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 50.13504122105785, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 834.0646990838577, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165, 8357.87920670966], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027, 2957.0229253105936], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553, 1591.346099255443], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857, 1699.4836600918122], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803, 2110.0265220518445]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6055304225019136, "mean_inference_ms": 2.2527298982180928, "mean_action_processing_ms": 0.3260360906382059, "mean_env_wait_ms": 4.3788066301742345, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032034057837266186, "StateBufferConnector_ms": 0.002552225039555476, "ViewRequirementAgentConnector_ms": 0.05461458976452167}, "num_episodes": 1, "episode_return_max": 13808.427194880165, "episode_return_min": -3711.90038700316, "episode_return_mean": 3785.685232358791, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552, "num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 551.0746192151239, "num_env_steps_trained_throughput_per_sec": 551.0746192151239, "timesteps_total": 165888, "num_env_steps_sampled_lifetime": 165888, "num_agent_steps_sampled_lifetime": 663552, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 663552, "timers": {"training_iteration_time_ms": 3771.219, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3771.091, "sample_time_ms": 2448.479, "learn_time_ms": 1286.758, "learn_throughput": 1591.597, "synch_weights_time_ms": 11.551}, "counters": {"num_env_steps_sampled": 165888, "num_env_steps_trained": 165888, "num_agent_steps_sampled": 663552, "num_agent_steps_trained": 663552}, "done": false, "training_iteration": 81, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-53", "timestamp": 1729548473, "time_this_iter_s": 3.72939395904541, "time_total_s": 305.77498054504395, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e669990>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750940>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750a90>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e750fa0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752950>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 305.77498054504395, "iterations_since_restore": 81, "perf": {"cpu_util_percent": 19.583333333333332, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.5386947914958, "cur_kl_coeff": 7.275957614183425e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.547858786582946, "policy_loss": -0.0009550490183755755, "vf_loss": 9.548813712596893, "vf_explained_var": 3.6418437957763673e-06, "kl": 0.0014732203249877784, "entropy": 0.20528231281787157, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.8055500239133835, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.715109157562257, "policy_loss": -0.00010032799327746034, "vf_loss": 9.715209436416625, "vf_explained_var": -0.00042106062173843386, "kl": 0.006973585406649363, "entropy": -0.4055089887231588, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.6150625720620155, "cur_kl_coeff": 2.1684043449710087e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.551680958271026, "policy_loss": -0.0034586627152748406, "vf_loss": 9.555139660835266, "vf_explained_var": -5.6356191635131834e-06, "kl": 0.004776302307892227, "entropy": 0.45490915663540366, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.643632158637047, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 8.02858391404152, "policy_loss": -0.004118284210562706, "vf_loss": 8.032628190517425, "vf_explained_var": -3.0259042978286745e-05, "kl": 0.011831539231809528, "entropy": 1.999417208135128, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6520.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744}, "env_runners": {"episode_reward_max": 13808.427194880165, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3785.685232358791, "episode_len_mean": 2942.769230769231, "episode_media": {}, "episodes_timesteps_total": 153024, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 4699.089326327027, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 2694.4967756484803}, "policy_reward_mean": {"high_level_policy": 1231.7169422645304, "DC1_ls_policy": 3468.3255789801315, "DC2_ls_policy": 815.6286677241253, "DC3_ls_policy": -1729.985956609997}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55737.55791827841, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.18063386763106315, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 93935.2375569591, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0025500830188330183, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.4933616534077271, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 113584.00419342438, "DC3_ls_policy/bat_CO2_footprint_sum_min": 75625.32361863516, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.12484768881403498, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.6425856055743877, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 96959375.27624543, "accumulated/bat_CO2_footprint_sum_min": 66153917.497499906, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 50.13504122105785, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 834.0646990838577, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165, 8357.87920670966], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032, 2592], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027, 2957.0229253105936], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553, 1591.346099255443], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857, 1699.4836600918122], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803, 2110.0265220518445]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6055304225019136, "mean_inference_ms": 2.2527298982180928, "mean_action_processing_ms": 0.3260360906382059, "mean_env_wait_ms": 4.3788066301742345, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032034057837266186, "StateBufferConnector_ms": 0.002552225039555476, "ViewRequirementAgentConnector_ms": 0.05461458976452167}, "num_episodes": 0, "episode_return_max": 13808.427194880165, "episode_return_min": -3711.90038700316, "episode_return_mean": 3785.685232358791, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744, "num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 520.8920281446352, "num_env_steps_trained_throughput_per_sec": 520.8920281446352, "timesteps_total": 167936, "num_env_steps_sampled_lifetime": 167936, "num_agent_steps_sampled_lifetime": 671744, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 671744, "timers": {"training_iteration_time_ms": 3791.598, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3791.47, "sample_time_ms": 2468.709, "learn_time_ms": 1286.336, "learn_throughput": 1592.119, "synch_weights_time_ms": 11.867}, "counters": {"num_env_steps_sampled": 167936, "num_env_steps_trained": 167936, "num_agent_steps_sampled": 671744, "num_agent_steps_trained": 671744}, "done": false, "training_iteration": 82, "trial_id": "2c069_00000", "date": "2024-10-21_22-07-57", "timestamp": 1729548477, "time_this_iter_s": 3.941135883331299, "time_total_s": 309.71611642837524, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f7130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751570>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751780>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7518a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e751990>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 309.71611642837524, "iterations_since_restore": 82, "perf": {"cpu_util_percent": 20.0, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8891083553433416, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.728572118282319, "policy_loss": -0.002999714208999649, "vf_loss": 9.731571793556213, "vf_explained_var": -2.270936965942383e-06, "kl": 0.003958094593781425, "entropy": 0.35895676594227555, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.629694958031178, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.789815497398376, "policy_loss": -0.0016026366036385297, "vf_loss": 9.791418194770813, "vf_explained_var": -6.83218240737915e-06, "kl": 0.005051710264527622, "entropy": -0.555677841603756, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.8047685503959654, "cur_kl_coeff": 1.0842021724855043e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.341654694080352, "policy_loss": -0.004132920852862298, "vf_loss": 9.345787596702575, "vf_explained_var": -1.5021860599517823e-05, "kl": 0.011008496662180595, "entropy": 0.4690399806946516, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 6.412212005257606, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.899566721916199, "policy_loss": -0.0024178887135349212, "vf_loss": 7.901929974555969, "vf_explained_var": 0.00016161873936653136, "kl": 0.00874566766829048, "entropy": 1.929455043375492, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6600.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936}, "env_runners": {"episode_reward_max": 13808.427194880165, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 3967.5434265331983, "episode_len_mean": 2966.943396226415, "episode_media": {}, "episodes_timesteps_total": 157248, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 4699.089326327027, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 3216.4338671670357}, "policy_reward_mean": {"high_level_policy": 1292.6555622141198, "DC1_ls_policy": 3474.9372909318267, "DC2_ls_policy": 836.6078540769265, "DC3_ls_policy": -1636.6572806896754}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 55939.50551614147, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.1815361803058344, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 93659.52975811668, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002501968244892773, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.501303872068416, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 113071.58161236727, "DC3_ls_policy/bat_CO2_footprint_sum_min": 75625.32361863516, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.12249207204395884, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.611593424337135, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 97453962.15403175, "accumulated/bat_CO2_footprint_sum_min": 66153917.497499906, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 49.18909704707563, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 823.6456826864063, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165, 8357.87920670966, 13424.169523602372], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032, 2592, 4224], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027, 2957.0229253105936, 4461.4637995927715], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553, 1591.346099255443, 3818.7463124199785], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857, 1699.4836600918122, 1927.5255444225925], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803, 2110.0265220518445, 3216.4338671670357]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6060109542841814, "mean_inference_ms": 2.2545836763366696, "mean_action_processing_ms": 0.3263878705068177, "mean_env_wait_ms": 4.38511882164649, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003203356041098541, "StateBufferConnector_ms": 0.0025597383391182376, "ViewRequirementAgentConnector_ms": 0.054759911771090526}, "num_episodes": 1, "episode_return_max": 13808.427194880165, "episode_return_min": -3711.90038700316, "episode_return_mean": 3967.5434265331983, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936, "num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 542.247122770039, "num_env_steps_trained_throughput_per_sec": 542.247122770039, "timesteps_total": 169984, "num_env_steps_sampled_lifetime": 169984, "num_agent_steps_sampled_lifetime": 679936, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 679936, "timers": {"training_iteration_time_ms": 3793.498, "restore_workers_time_ms": 0.047, "training_step_time_ms": 3793.364, "sample_time_ms": 2467.421, "learn_time_ms": 1287.903, "learn_throughput": 1590.182, "synch_weights_time_ms": 12.011}, "counters": {"num_env_steps_sampled": 169984, "num_env_steps_trained": 169984, "num_agent_steps_sampled": 679936, "num_agent_steps_trained": 679936}, "done": false, "training_iteration": 83, "trial_id": "2c069_00000", "date": "2024-10-21_22-08-01", "timestamp": 1729548481, "time_this_iter_s": 3.7867236137390137, "time_total_s": 313.50284004211426, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66b880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752530>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752620>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e752770>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e7529b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 313.50284004211426, "iterations_since_restore": 83, "perf": {"cpu_util_percent": 19.683333333333334, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.1740372613072396, "cur_kl_coeff": 1.8189894035458563e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.795467209815978, "policy_loss": -0.0007749743992462755, "vf_loss": 9.796242165565491, "vf_explained_var": -3.008544445037842e-06, "kl": 0.002619235478596238, "entropy": 0.32668673917651175, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 8.470874251425267, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.739160907268523, "policy_loss": -0.001856244052760303, "vf_loss": 9.74101710319519, "vf_explained_var": -3.520995378494263e-05, "kl": 0.01093443847839808, "entropy": -0.6151521094143391, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.868383752554655, "cur_kl_coeff": 1.0842021724855043e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.575773692131042, "policy_loss": -0.002039669593796134, "vf_loss": 9.577813291549683, "vf_explained_var": 1.2576580047607423e-06, "kl": 0.005061291588850736, "entropy": 0.4084409408271313, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.325885356962681, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.954848372936249, "policy_loss": -0.002966785425087437, "vf_loss": 7.957760393619537, "vf_explained_var": -0.00021283477544784546, "kl": 0.008762540465512957, "entropy": 1.959398877620697, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6680.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128}, "env_runners": {"episode_reward_max": 13808.427194880165, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 4066.7817125571896, "episode_len_mean": 2961.777777777778, "episode_media": {}, "episodes_timesteps_total": 159936, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 4699.089326327027, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 3216.4338671670357}, "policy_reward_mean": {"high_level_policy": 1328.5327871437707, "DC1_ls_policy": 3455.698938977696, "DC2_ls_policy": 845.2505437294024, "DC3_ls_policy": -1562.70055729368}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 56231.23392618251, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.18223221444479162, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 93425.27502628083, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002455635499616981, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.505620004067149, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 112314.97940949822, "DC3_ls_policy/bat_CO2_footprint_sum_min": 72215.06265743799, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.12022370033944109, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.581749101664225, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 97078808.020389, "accumulated/bat_CO2_footprint_sum_min": 66153917.497499906, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 48.27818784250015, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 812.8189452314552, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165, 8357.87920670966, 13424.169523602372, 9326.410871828743], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032, 2592, 4224, 2688], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027, 2957.0229253105936, 4461.4637995927715, 3230.025708415262], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553, 1591.346099255443, 3818.7463124199785, 2436.066285408778], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857, 1699.4836600918122, 1927.5255444225925, 1303.313095310621], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803, 2110.0265220518445, 3216.4338671670357, 2357.0057826940797]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.6060243546419836, "mean_inference_ms": 2.2539557412351927, "mean_action_processing_ms": 0.3262962684753419, "mean_env_wait_ms": 4.3848711701375835, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.003195360854819969, "StateBufferConnector_ms": 0.002559798735159415, "ViewRequirementAgentConnector_ms": 0.054749736079463256}, "num_episodes": 1, "episode_return_max": 13808.427194880165, "episode_return_min": -3711.90038700316, "episode_return_mean": 4066.7817125571896, "episodes_this_iter": 1}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128, "num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 531.894704604237, "num_env_steps_trained_throughput_per_sec": 531.894704604237, "timesteps_total": 172032, "num_env_steps_sampled_lifetime": 172032, "num_agent_steps_sampled_lifetime": 688128, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 688128, "timers": {"training_iteration_time_ms": 3820.805, "restore_workers_time_ms": 0.045, "training_step_time_ms": 3820.675, "sample_time_ms": 2493.097, "learn_time_ms": 1288.98, "learn_throughput": 1588.854, "synch_weights_time_ms": 12.27}, "counters": {"num_env_steps_sampled": 172032, "num_env_steps_trained": 172032, "num_agent_steps_sampled": 688128, "num_agent_steps_trained": 688128}, "done": false, "training_iteration": 84, "trial_id": "2c069_00000", "date": "2024-10-21_22-08-05", "timestamp": 1729548485, "time_this_iter_s": 3.861271381378174, "time_total_s": 317.36411142349243, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f7880>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cc70>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c160>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c550>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72c9d0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 317.36411142349243, "iterations_since_restore": 84, "perf": {"cpu_util_percent": 7.74, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.956083409488201, "cur_kl_coeff": 9.094947017729282e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.51726928949356, "policy_loss": -0.007940280227921903, "vf_loss": 9.525209498405456, "vf_explained_var": -8.285045623779297e-07, "kl": 0.014520684580567567, "entropy": 0.3281328411772847, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.025016947090625, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.797495257854461, "policy_loss": 0.0010476147115696221, "vf_loss": 9.796447598934174, "vf_explained_var": -2.8754770755767823e-05, "kl": 0.005020801649152418, "entropy": -0.6137781351804733, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.624966075271368, "cur_kl_coeff": 1.0842021724855043e-20, "cur_lr": 5.000000000000001e-05, "total_loss": 9.434943222999573, "policy_loss": -0.001912272465415299, "vf_loss": 9.436855447292327, "vf_explained_var": 2.1010637283325195e-07, "kl": 0.0035743550738970955, "entropy": 0.49707207903265954, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.958328156173229, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.891321498155594, "policy_loss": -0.006164085201453418, "vf_loss": 7.897413545846939, "vf_explained_var": 6.756633520126343e-05, "kl": 0.011523898122642115, "entropy": 2.055170637369156, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6760.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320}, "env_runners": {"episode_reward_max": 15641.124459311133, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 4333.008375232187, "episode_len_mean": 2976.0, "episode_media": {}, "episodes_timesteps_total": 166656, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 5879.40514066063, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 3530.9292888126265}, "policy_reward_mean": {"high_level_policy": 1443.394164913425, "DC1_ls_policy": 3438.907211403783, "DC2_ls_policy": 852.0334362580488, "DC3_ls_policy": -1401.3264373430695}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 56710.540767238694, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.1889580480558903, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92861.00147561196, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002367934231773517, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5353415779959679, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 110813.07980187435, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68433.6611603244, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.11592999675588962, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.5252580623190741, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 96832274.17023122, "accumulated/bat_CO2_footprint_sum_min": 64206261.09271852, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 46.55396684812514, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 799.8013043303318, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165, 8357.87920670966, 13424.169523602372, 9326.410871828743, 15641.124459311133, 7401.132075603127], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032, 2592, 4224, 2688, 4320, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027, 2957.0229253105936, 4461.4637995927715, 3230.025708415262, 5879.40514066063, 3209.897588727548], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553, 1591.346099255443, 3818.7463124199785, 2436.066285408778, 4196.774950263778, 1774.286183552459], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857, 1699.4836600918122, 1927.5255444225925, 1303.313095310621, 2034.0150795740788, 36.327989488933504], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803, 2110.0265220518445, 3216.4338671670357, 2357.0057826940797, 3530.9292888126265, 2380.620313834208]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605783979981936, "mean_inference_ms": 2.2533781408086164, "mean_action_processing_ms": 0.3261072682277427, "mean_env_wait_ms": 4.385342930145437, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032546264784676687, "StateBufferConnector_ms": 0.0025604452405657086, "ViewRequirementAgentConnector_ms": 0.0547019498688834}, "num_episodes": 2, "episode_return_max": 15641.124459311133, "episode_return_min": -3711.90038700316, "episode_return_mean": 4333.008375232187, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320, "num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 553.1908012749632, "num_env_steps_trained_throughput_per_sec": 553.1908012749632, "timesteps_total": 174080, "num_env_steps_sampled_lifetime": 174080, "num_agent_steps_sampled_lifetime": 696320, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 696320, "timers": {"training_iteration_time_ms": 3803.194, "restore_workers_time_ms": 0.046, "training_step_time_ms": 3803.059, "sample_time_ms": 2472.45, "learn_time_ms": 1290.674, "learn_throughput": 1586.767, "synch_weights_time_ms": 12.337}, "counters": {"num_env_steps_sampled": 174080, "num_env_steps_trained": 174080, "num_agent_steps_sampled": 696320, "num_agent_steps_trained": 696320}, "done": false, "training_iteration": 85, "trial_id": "2c069_00000", "date": "2024-10-21_22-08-09", "timestamp": 1729548489, "time_this_iter_s": 3.711552381515503, "time_total_s": 321.07566380500793, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e6684c0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dcc0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f4f0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f100>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d7b0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 321.07566380500793, "iterations_since_restore": 85, "perf": {"cpu_util_percent": 6.266666666666666, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.457225403189659, "cur_kl_coeff": 9.094947017729282e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.421777403354644, "policy_loss": -0.0007393902516923845, "vf_loss": 9.422516775131225, "vf_explained_var": 2.0097196102142335e-05, "kl": 0.006547709297592519, "entropy": 0.21617910023778678, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 5.699643802642822, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.716287469863891, "policy_loss": -0.0008712217444553971, "vf_loss": 9.717158699035645, "vf_explained_var": -2.3482739925384523e-05, "kl": 0.005211454733219527, "entropy": -0.5757232423871755, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.6193875707685947, "cur_kl_coeff": 5.421010862427522e-21, "cur_lr": 5.000000000000001e-05, "total_loss": 8.986856842041016, "policy_loss": -0.003534891456365585, "vf_loss": 8.99039180278778, "vf_explained_var": -4.1127204895019533e-07, "kl": 0.00696894597686025, "entropy": 0.7659225225448608, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.254560129344464, "cur_kl_coeff": 0.0062499999999999995, "cur_lr": 5.000000000000001e-05, "total_loss": 7.62326887845993, "policy_loss": -0.0005602456687483937, "vf_loss": 7.623806267976761, "vf_explained_var": 9.512081742286682e-05, "kl": 0.00367772323081851, "entropy": 2.1096151143312456, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6840.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512}, "env_runners": {"episode_reward_max": 15641.124459311133, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 4333.008375232187, "episode_len_mean": 2976.0, "episode_media": {}, "episodes_timesteps_total": 166656, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 5879.40514066063, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 3530.9292888126265}, "policy_reward_mean": {"high_level_policy": 1443.394164913425, "DC1_ls_policy": 3438.907211403783, "DC2_ls_policy": 852.0334362580488, "DC3_ls_policy": -1401.3264373430695}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 56710.540767238694, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.1889580480558903, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92861.00147561196, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002367934231773517, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5353415779959679, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 110813.07980187435, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68433.6611603244, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.11592999675588962, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.5252580623190741, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 96832274.17023122, "accumulated/bat_CO2_footprint_sum_min": 64206261.09271852, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 46.55396684812514, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 799.8013043303318, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165, 8357.87920670966, 13424.169523602372, 9326.410871828743, 15641.124459311133, 7401.132075603127], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032, 2592, 4224, 2688, 4320, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027, 2957.0229253105936, 4461.4637995927715, 3230.025708415262, 5879.40514066063, 3209.897588727548], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553, 1591.346099255443, 3818.7463124199785, 2436.066285408778, 4196.774950263778, 1774.286183552459], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857, 1699.4836600918122, 1927.5255444225925, 1303.313095310621, 2034.0150795740788, 36.327989488933504], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803, 2110.0265220518445, 3216.4338671670357, 2357.0057826940797, 3530.9292888126265, 2380.620313834208]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605783979981936, "mean_inference_ms": 2.2533781408086164, "mean_action_processing_ms": 0.3261072682277427, "mean_env_wait_ms": 4.385342930145437, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032546264784676687, "StateBufferConnector_ms": 0.0025604452405657086, "ViewRequirementAgentConnector_ms": 0.0547019498688834}, "num_episodes": 0, "episode_return_max": 15641.124459311133, "episode_return_min": -3711.90038700316, "episode_return_mean": 4333.008375232187, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512, "num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 532.9276140438104, "num_env_steps_trained_throughput_per_sec": 532.9276140438104, "timesteps_total": 176128, "num_env_steps_sampled_lifetime": 176128, "num_agent_steps_sampled_lifetime": 704512, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 704512, "timers": {"training_iteration_time_ms": 3805.31, "restore_workers_time_ms": 0.043, "training_step_time_ms": 3805.181, "sample_time_ms": 2477.25, "learn_time_ms": 1288.434, "learn_throughput": 1589.526, "synch_weights_time_ms": 12.188}, "counters": {"num_env_steps_sampled": 176128, "num_env_steps_trained": 176128, "num_agent_steps_sampled": 704512, "num_agent_steps_trained": 704512}, "done": false, "training_iteration": 86, "trial_id": "2c069_00000", "date": "2024-10-21_22-08-13", "timestamp": 1729548493, "time_this_iter_s": 3.8509271144866943, "time_total_s": 324.92659091949463, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66b130>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dd80>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72e380>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72db10>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72db40>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 324.92659091949463, "iterations_since_restore": 86, "perf": {"cpu_util_percent": 19.759999999999998, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.130328819155693, "cur_kl_coeff": 9.094947017729282e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.720488739013671, "policy_loss": -0.00013340546283870935, "vf_loss": 9.720622229576112, "vf_explained_var": -3.382563591003418e-07, "kl": 0.002750158233903855, "entropy": 0.2575314801186323, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 7.591341222822666, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.866273999214172, "policy_loss": 0.00031767684267833827, "vf_loss": 9.865956377983093, "vf_explained_var": 1.7199665307998657e-05, "kl": 0.008894230502664868, "entropy": -0.6058947689831257, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 3.0131144031882284, "cur_kl_coeff": 5.421010862427522e-21, "cur_lr": 5.000000000000001e-05, "total_loss": 9.234354615211487, "policy_loss": -0.006237687228713184, "vf_loss": 9.240592420101166, "vf_explained_var": 1.4349818229675293e-06, "kl": 0.009233284038817464, "entropy": 0.6505628310143947, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.543993890285492, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.304968440532685, "policy_loss": -0.005031349800992757, "vf_loss": 7.309973645210266, "vf_explained_var": -0.00019651800394058228, "kl": 0.008369770595072623, "entropy": 2.0961921602487563, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 6920.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 178176, "num_env_steps_trained": 178176, "num_agent_steps_sampled": 712704, "num_agent_steps_trained": 712704}, "env_runners": {"episode_reward_max": 15641.124459311133, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 4333.008375232187, "episode_len_mean": 2976.0, "episode_media": {}, "episodes_timesteps_total": 166656, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 5879.40514066063, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 3530.9292888126265}, "policy_reward_mean": {"high_level_policy": 1443.394164913425, "DC1_ls_policy": 3438.907211403783, "DC2_ls_policy": 852.0334362580488, "DC3_ls_policy": -1401.3264373430695}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 56710.540767238694, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.1889580480558903, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92861.00147561196, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.002367934231773517, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5353415779959679, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 110813.07980187435, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68433.6611603244, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.11592999675588962, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.5252580623190741, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 96832274.17023122, "accumulated/bat_CO2_footprint_sum_min": 64206261.09271852, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 46.55396684812514, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 799.8013043303318, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165, 8357.87920670966, 13424.169523602372, 9326.410871828743, 15641.124459311133, 7401.132075603127], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032, 2592, 4224, 2688, 4320, 2400], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027, 2957.0229253105936, 4461.4637995927715, 3230.025708415262, 5879.40514066063, 3209.897588727548], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553, 1591.346099255443, 3818.7463124199785, 2436.066285408778, 4196.774950263778, 1774.286183552459], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857, 1699.4836600918122, 1927.5255444225925, 1303.313095310621, 2034.0150795740788, 36.327989488933504], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803, 2110.0265220518445, 3216.4338671670357, 2357.0057826940797, 3530.9292888126265, 2380.620313834208]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605783979981936, "mean_inference_ms": 2.2533781408086164, "mean_action_processing_ms": 0.3261072682277427, "mean_env_wait_ms": 4.385342930145437, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032546264784676687, "StateBufferConnector_ms": 0.0025604452405657086, "ViewRequirementAgentConnector_ms": 0.0547019498688834}, "num_episodes": 0, "episode_return_max": 15641.124459311133, "episode_return_min": -3711.90038700316, "episode_return_mean": 4333.008375232187, "episodes_this_iter": 0}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 712704, "num_agent_steps_trained": 712704, "num_env_steps_sampled": 178176, "num_env_steps_trained": 178176, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 556.1133011467092, "num_env_steps_trained_throughput_per_sec": 556.1133011467092, "timesteps_total": 178176, "num_env_steps_sampled_lifetime": 178176, "num_agent_steps_sampled_lifetime": 712704, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 712704, "timers": {"training_iteration_time_ms": 3803.934, "restore_workers_time_ms": 0.042, "training_step_time_ms": 3803.811, "sample_time_ms": 2479.612, "learn_time_ms": 1285.737, "learn_throughput": 1592.861, "synch_weights_time_ms": 12.077}, "counters": {"num_env_steps_sampled": 178176, "num_env_steps_trained": 178176, "num_agent_steps_sampled": 712704, "num_agent_steps_trained": 712704}, "done": false, "training_iteration": 87, "trial_id": "2c069_00000", "date": "2024-10-21_22-08-16", "timestamp": 1729548496, "time_this_iter_s": 3.6903839111328125, "time_total_s": 328.61697483062744, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e0f7910>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72eb30>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72f2b0>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72eec0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dde0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 328.61697483062744, "iterations_since_restore": 87, "perf": {"cpu_util_percent": 18.366666666666667, "ram_util_percent": 3.1}}
{"custom_metrics": {}, "episode_media": {}, "info": {"learner": {"DC2_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.586384013295174, "cur_kl_coeff": 4.547473508864641e-14, "cur_lr": 5.000000000000001e-05, "total_loss": 9.333607017993927, "policy_loss": -0.0046099847764708105, "vf_loss": 9.338217079639435, "vf_explained_var": -2.3148953914642333e-06, "kl": 0.010942787125327414, "entropy": 0.04171394455479458, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC3_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 9.384945856034756, "cur_kl_coeff": 3.6379788070917126e-13, "cur_lr": 5.000000000000001e-05, "total_loss": 9.6913858294487, "policy_loss": 0.0032774083665572107, "vf_loss": 9.688108348846436, "vf_explained_var": -8.518248796463012e-06, "kl": 0.007332454171754765, "entropy": -0.6220397636294365, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "DC1_ls_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 2.7679870545864107, "cur_kl_coeff": 5.421010862427522e-21, "cur_lr": 5.000000000000001e-05, "total_loss": 9.151118159294128, "policy_loss": -0.0015959454118274151, "vf_loss": 9.152714121341706, "vf_explained_var": -3.25813889503479e-06, "kl": 0.0049659510295896325, "entropy": 0.5026668891310692, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}, "high_level_policy": {"learner_stats": {"allreduce_latency": 0.0, "grad_gnorm": 4.601252919435501, "cur_kl_coeff": 0.0031249999999999997, "cur_lr": 5.000000000000001e-05, "total_loss": 7.711274409294129, "policy_loss": -0.004189823532942683, "vf_loss": 7.715423583984375, "vf_explained_var": 0.00012666806578636168, "kl": 0.013017341624710401, "entropy": 2.027502979338169, "entropy_coeff": 0.0}, "model": {}, "custom_metrics": {}, "num_agent_steps_trained": 128.0, "num_grad_updates_lifetime": 7000.5, "diff_num_grad_updates_vs_sampler_policy": 39.5}}, "num_env_steps_sampled": 180224, "num_env_steps_trained": 180224, "num_agent_steps_sampled": 720896, "num_agent_steps_trained": 720896}, "env_runners": {"episode_reward_max": 15641.124459311133, "episode_reward_min": -3711.90038700316, "episode_reward_mean": 4454.590700453097, "episode_len_mean": 2959.448275862069, "episode_media": {}, "episodes_timesteps_total": 171648, "policy_reward_min": {"high_level_policy": -1472.6929550606071, "DC1_ls_policy": 226.12902058034817, "DC2_ls_policy": -2798.6894275846344, "DC3_ls_policy": -6642.070736916057}, "policy_reward_max": {"high_level_policy": 5879.40514066063, "DC1_ls_policy": 6304.8497333462765, "DC2_ls_policy": 3529.75472464857, "DC3_ls_policy": 3530.9292888126265}, "policy_reward_mean": {"high_level_policy": 1494.6713420850444, "DC1_ls_policy": 3380.795384056801, "DC2_ls_policy": 852.0295711055028, "DC3_ls_policy": -1272.9055967942504}, "custom_metrics": {"DC1_ls_policy/bat_CO2_footprint_sum_mean": 57139.92173064047, "DC1_ls_policy/bat_CO2_footprint_sum_min": 44190.25920832934, "DC1_ls_policy/bat_CO2_footprint_sum_max": 76930.00558317947, "DC1_ls_policy/ls_tasks_dropped_sum_mean": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC1_ls_policy/ls_tasks_dropped_sum_max": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_mean": 0.1990343178399931, "DC1_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC1_ls_policy/ls_overdue_penalty_sum_max": 1.8575, "DC2_ls_policy/bat_CO2_footprint_sum_mean": 92610.89659747556, "DC2_ls_policy/bat_CO2_footprint_sum_min": 69506.24297911246, "DC2_ls_policy/bat_CO2_footprint_sum_max": 125833.85643044474, "DC2_ls_policy/ls_tasks_dropped_sum_mean": 0.0022862813272296026, "DC2_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC2_ls_policy/ls_tasks_dropped_sum_max": 0.04538690476190476, "DC2_ls_policy/ls_overdue_penalty_sum_mean": 0.5508876575345684, "DC2_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC2_ls_policy/ls_overdue_penalty_sum_max": 2.1033333333333335, "DC3_ls_policy/bat_CO2_footprint_sum_mean": 109458.38329540883, "DC3_ls_policy/bat_CO2_footprint_sum_min": 68433.6611603244, "DC3_ls_policy/bat_CO2_footprint_sum_max": 149084.54374214294, "DC3_ls_policy/ls_tasks_dropped_sum_mean": 0.11193241066085893, "DC3_ls_policy/ls_tasks_dropped_sum_min": 0.0, "DC3_ls_policy/ls_tasks_dropped_sum_max": 0.9054166666666666, "DC3_ls_policy/ls_overdue_penalty_sum_mean": 1.4726629567218648, "DC3_ls_policy/ls_overdue_penalty_sum_min": 0.0, "DC3_ls_policy/ls_overdue_penalty_sum_max": 7.067916666666667, "accumulated/bat_CO2_footprint_sum_mean": 95939099.00149491, "accumulated/bat_CO2_footprint_sum_min": 64206261.09271852, "accumulated/bat_CO2_footprint_sum_max": 162334842.27287677, "accumulated/ls_tasks_dropped_sum_mean": 44.948657646465655, "accumulated/ls_tasks_dropped_sum_min": 0.0, "accumulated/ls_tasks_dropped_sum_max": 347.0300925925926, "accumulated/ls_overdue_penalty_sum_mean": 791.5246954719031, "accumulated/ls_overdue_penalty_sum_min": 0.24990699404761904, "accumulated/ls_overdue_penalty_sum_max": 3103.88431712963}, "hist_stats": {"episode_reward": [3544.3954064868935, 6067.316600473201, 5128.124262094362, 4759.670095267144, 3770.0197385707365, 576.6507947729784, 2050.269090952465, 3600.2597888270543, -2236.9682761550775, -1207.5251368710362, -736.576265538682, 55.83641566768755, -1923.6254089628717, -3711.90038700316, 1158.1694713680463, -978.7501245938537, -1596.885782792493, -1008.9351835145544, -2002.899512481404, -393.4565533423636, -2666.578323622306, 2080.286814892155, 1469.45084963207, 359.95181823973604, 2210.4913432462045, 1852.6510438942375, 2361.3635955219984, 6739.964038360894, 2929.987840561996, 4043.1948077316397, 3336.6371121422962, 3949.032996003783, 3701.641905432096, 5747.609163768657, 6059.335807664213, 5294.778584635544, 6194.877587323067, 6851.333359821607, 7803.802030538039, 9563.980333560929, 5539.996837194324, 7704.210393121647, 10208.033470965429, 7150.272645686671, 7294.576783963907, 8457.169333441429, 8860.455194025291, 6152.974196748489, 8864.765359369741, 9659.889723976454, 13808.427194880165, 8357.87920670966, 13424.169523602372, 9326.410871828743, 15641.124459311133, 7401.132075603127, 6487.491846481458, 9230.299766795712], "episode_lengths": [2400, 2496, 2496, 2688, 2592, 4032, 4320, 4224, 2400, 2496, 2496, 2688, 2592, 2400, 2496, 2496, 2592, 2688, 4032, 4224, 4320, 2400, 2496, 2496, 2592, 2688, 2400, 4032, 2496, 2496, 4224, 4320, 2592, 2688, 2400, 2496, 2496, 2592, 2688, 4032, 2400, 4224, 4320, 2496, 2496, 2592, 2688, 2400, 2496, 2496, 4032, 2592, 4224, 2688, 4320, 2400, 2496, 2496], "policy_high_level_policy_reward": [1228.9290137342207, 1792.8289215334275, 1087.782922517156, 1152.7055694552905, 767.2298723341497, 1796.7813325310303, 1734.5831399146516, 2220.0128755178634, 1724.157383206235, 688.6625180742578, 1535.8280125525396, 849.4572945115141, 693.5493705502182, -96.57468149547907, 632.6632753158556, 296.57462888065487, 526.7619981249888, 279.2925263765858, 8.87591068219717, -458.1268159163014, -1472.6929550606071, -17.77905370679372, -48.62172282279262, -382.0071853615983, 214.75710369704868, -533.1320193322446, 100.90627974017026, 673.3822342482472, 49.54715379591338, 161.30225078184864, -82.96693535053802, 1051.9285200907295, 435.4256743025661, 932.683520382081, 1341.7537681723613, 1114.9297408346006, 1690.5432401383678, 1552.159400979672, 2180.861825570132, 2747.0872641253422, 1718.9585261563684, 1500.7143942203654, 3246.7401799284867, 2489.643715152958, 2281.3277862037644, 2951.958632647942, 2911.081228568367, 2229.5003415220017, 3375.9855669392537, 3515.215201152888, 4699.089326327027, 2957.0229253105936, 4461.4637995927715, 3230.025708415262, 5879.40514066063, 3209.897588727548, 2587.737920450933, 3273.126685329838], "policy_DC1_ls_policy_reward": [1897.4122422937862, 2429.970200227873, 2279.3925340715714, 2570.135638948115, 2098.7817560799526, 4100.262383371895, 4487.110770567993, 4535.083852268878, 3186.9462715343952, 3336.2682563067583, 3338.2319494478797, 3661.3403604805562, 3465.995449674949, 3449.784083451858, 3598.644849899645, 3636.290303933038, 3703.4806780899876, 3872.1333730872416, 5842.841520495375, 5870.309673529274, 6173.13332937785, 3406.234614183837, 3614.317293818417, 3481.635997678714, 3680.6979280532255, 3850.082521472623, 3387.5546462248726, 5740.310168274556, 3540.094337411928, 3522.247941729046, 6150.950277532376, 6304.8497333462765, 3600.9549628563514, 3760.31443204299, 3287.4513023846707, 3318.076255011745, 3361.873190490702, 3438.930861478396, 3543.2025493779292, 5284.9115401277295, 1936.5107300054342, 3638.8434889980235, 3639.579707292991, 2124.3425531568046, 2604.0361679478706, 1905.6933881390207, 2366.887974428028, 226.12902058034817, 1434.7165522495254, 2191.518026022052, 2885.0863682560553, 1591.346099255443, 3818.7463124199785, 2436.066285408778, 4196.774950263778, 1774.286183552459, 1252.2790699196294, 2255.0493667629707], "policy_DC2_ls_policy_reward": [1317.9837676546347, 1369.2502858714554, 1039.2656202807982, 1157.281809001021, 621.7696791576636, -560.9576433388455, 215.4817581248817, 1133.9287901589887, -506.00119397965824, -1049.6509226057003, 977.3060228625873, 549.9389492906275, -182.0059464287235, -2245.3079158289174, -1433.1414444430332, -1786.2667906201705, -1903.6512854177427, -1632.5748506873422, -2798.6894275846344, -1575.928069759086, -1869.139884934569, 44.26141823659469, -542.5597889507561, -590.4913252235897, 113.33981884724065, 471.06136847058025, 1086.5190791283903, 1690.9515042267647, 1535.2961329850116, 1417.8158504373253, 1675.3381969661095, 606.554889702624, 1630.8627673619121, 1757.3551779315412, 1560.0570730692048, 1541.2178574206673, 1812.3546202194793, 1926.7559552211542, 2266.7069567643407, 2721.794098550147, 1784.4287472519534, 3232.1837940846235, 3229.1201239001334, 2025.850283504543, 2022.8486491443482, 2202.9023616161453, 2304.6872163716353, 2136.433697953862, 2366.8000780802568, 2314.1144268676476, 3529.75472464857, 1699.4836600918122, 1927.5255444225925, 1303.313095310621, 2034.0150795740788, 36.327989488933504, 437.3709855871346, 1266.4717080812882], "policy_DC3_ls_policy_reward": [-899.9296171957367, 475.2671928404324, 721.6831852248217, -120.45292213729572, 282.2384309989562, -4759.43527779108, -4386.906577655081, -4288.765729118738, -6642.070736916057, -4182.8049886463605, -6587.942250401696, -5004.9001886150245, -5901.164282759328, -4819.801873130626, -1639.997209404417, -3125.348266787358, -3923.477173589722, -3527.7862322910373, -5055.927516074363, -4229.711341196237, -5497.878813004992, -1352.430163821477, -1553.6849324127916, -2149.1856688537923, -1798.303507351308, -1935.3608267167178, -2213.616409571432, -1364.679868388686, -2194.949783630854, -1058.1712352165873, -4406.68442700563, -4014.3001471358457, -1965.6014990887352, -702.7439665879456, -129.92633596203714, -679.4452686314826, -669.8934635254744, -66.5128578576606, -186.9693011743651, -1189.812569242306, 100.09883378057339, -667.5312841813453, 92.59345984387227, 510.43609387237484, 386.3641806679072, 1396.6149510383357, 1277.798774657276, 1560.9111366922798, 1687.2631621007613, 1639.042069933857, 2694.4967756484803, 2110.0265220518445, 3216.4338671670357, 2357.0057826940797, 3530.9292888126265, 2380.620313834208, 2210.1038705237684, 2435.6520066215853]}, "sampler_perf": {"mean_raw_obs_processing_ms": 0.605454248855685, "mean_inference_ms": 2.2521472298342973, "mean_action_processing_ms": 0.32583130119292153, "mean_env_wait_ms": 4.38407265515774, "mean_env_render_ms": 0.0}, "num_faulty_episodes": 0, "connector_metrics": {"ObsPreprocessorConnector_ms": 0.0032473227073406353, "StateBufferConnector_ms": 0.0025660827242094896, "ViewRequirementAgentConnector_ms": 0.05472127733559444}, "num_episodes": 2, "episode_return_max": 15641.124459311133, "episode_return_min": -3711.90038700316, "episode_return_mean": 4454.590700453097, "episodes_this_iter": 2}, "num_healthy_workers": 8, "num_in_flight_async_sample_reqs": 0, "num_remote_worker_restarts": 0, "num_agent_steps_sampled": 720896, "num_agent_steps_trained": 720896, "num_env_steps_sampled": 180224, "num_env_steps_trained": 180224, "num_env_steps_sampled_this_iter": 2048, "num_env_steps_trained_this_iter": 2048, "num_env_steps_sampled_throughput_per_sec": 539.1477667155752, "num_env_steps_trained_throughput_per_sec": 539.1477667155752, "timesteps_total": 180224, "num_env_steps_sampled_lifetime": 180224, "num_agent_steps_sampled_lifetime": 720896, "num_steps_trained_this_iter": 2048, "agent_timesteps_total": 720896, "timers": {"training_iteration_time_ms": 3827.999, "restore_workers_time_ms": 0.041, "training_step_time_ms": 3827.88, "sample_time_ms": 2505.114, "learn_time_ms": 1286.288, "learn_throughput": 1592.178, "synch_weights_time_ms": 11.952}, "counters": {"num_env_steps_sampled": 180224, "num_env_steps_trained": 180224, "num_agent_steps_sampled": 720896, "num_agent_steps_trained": 720896}, "done": false, "training_iteration": 88, "trial_id": "2c069_00000", "date": "2024-10-21_22-08-20", "timestamp": 1729548500, "time_this_iter_s": 3.80730938911438, "time_total_s": 332.4242842197418, "pid": 730151, "hostname": "ai25", "node_ip": "10.93.232.115", "config": {"extra_python_environs_for_driver": {}, "extra_python_environs_for_worker": {}, "placement_strategy": "PACK", "num_gpus": 0, "_fake_gpus": false, "num_cpus_for_main_process": 1, "eager_tracing": true, "eager_max_retraces": 20, "tf_session_args": {"intra_op_parallelism_threads": 2, "inter_op_parallelism_threads": 2, "gpu_options": {"allow_growth": true}, "log_device_placement": false, "device_count": {"CPU": 1}, "allow_soft_placement": true}, "local_tf_session_args": {"intra_op_parallelism_threads": 8, "inter_op_parallelism_threads": 8}, "torch_compile_learner": false, "torch_compile_learner_what_to_compile": "forward_train", "torch_compile_learner_dynamo_backend": "inductor", "torch_compile_learner_dynamo_mode": null, "torch_compile_worker": false, "torch_compile_worker_dynamo_backend": "onnxrt", "torch_compile_worker_dynamo_mode": null, "torch_ddp_kwargs": {}, "torch_skip_nan_gradients": false, "enable_rl_module_and_learner": false, "enable_env_runner_and_connector_v2": false, "env": "truly_hierarchical_dcrl", "env_config": {"config1": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_NY_New.York-LaGuardia.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 8, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config2": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_AZ_Phoenix-Sky.Harbor.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 0, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "config3": {"location": "ca", "cintensity_file": "CA_NG_&_avgCI.csv", "weather_file": "USA_CA_San.Jose-Mineta.epw", "workload_file": "Alibaba_CPU_Data_Hourly_1.csv", "dc_config_file": "dc_config_dc1.json", "datacenter_capacity_mw": 1.0, "flexible_load": 0.4, "timezone_shift": 16, "month": 7, "days_per_episode": 30, "partial_obs": true, "nonoverlapping_shared_obs_space": true, "debug": false, "initialize_queue_at_reset": true, "agents": ["agent_ls"], "workload_baseline": 0.0}, "num_transfers": 2, "active_agents": [""], "low_level_actor_config": {"harl": {"algo": "haa2c", "env": "dcrl", "exp_name": "ll_actor", "model_dir": "/lustre/guillant/green-dcc/envs/seed-00001-2024-05-01-21-50-12"}, "rllib": {"checkpoint_path": "/lustre/guillant/green-dcc/envs/maddpg/checkpoint_000000/", "is_maddpg": true}}}, "observation_space": null, "action_space": null, "clip_rewards": null, "normalize_actions": true, "clip_actions": false, "_is_atari": null, "disable_env_checking": false, "env_task_fn": null, "render_env": false, "action_mask_key": "action_mask", "env_runner_cls": null, "num_env_runners": 8, "num_envs_per_env_runner": 1, "num_cpus_per_env_runner": 1, "num_gpus_per_env_runner": 0, "custom_resources_per_env_runner": {}, "validate_env_runners_after_construction": true, "max_requests_in_flight_per_env_runner": 2, "sample_timeout_s": 60.0, "_env_to_module_connector": null, "add_default_connectors_to_env_to_module_pipeline": true, "_module_to_env_connector": null, "add_default_connectors_to_module_to_env_pipeline": true, "episode_lookback_horizon": 1, "rollout_fragment_length": "auto", "batch_mode": "truncate_episodes", "compress_observations": false, "remote_worker_envs": false, "remote_env_batch_wait_ms": 0, "enable_tf1_exec_eagerly": false, "sample_collector": "<class 'ray.rllib.evaluation.collectors.simple_list_collector.SimpleListCollector'>", "preprocessor_pref": "deepmind", "observation_filter": "NoFilter", "update_worker_filter_stats": true, "use_worker_filter_stats": true, "enable_connectors": true, "sampler_perf_stats_ema_coef": null, "num_learners": 0, "num_gpus_per_learner": 0, "num_cpus_per_learner": 1, "local_gpu_idx": 0, "gamma": 0.99, "lr": 1e-05, "grad_clip": 2.0, "grad_clip_by": "global_norm", "train_batch_size_per_learner": null, "train_batch_size": 2048, "num_epochs": 5, "minibatch_size": 128, "shuffle_batch_per_epoch": true, "model": {"fcnet_hiddens": [64, 64], "fcnet_activation": "tanh", "fcnet_weights_initializer": null, "fcnet_weights_initializer_config": null, "fcnet_bias_initializer": null, "fcnet_bias_initializer_config": null, "conv_filters": null, "conv_activation": "relu", "conv_kernel_initializer": null, "conv_kernel_initializer_config": null, "conv_bias_initializer": null, "conv_bias_initializer_config": null, "conv_transpose_kernel_initializer": null, "conv_transpose_kernel_initializer_config": null, "conv_transpose_bias_initializer": null, "conv_transpose_bias_initializer_config": null, "post_fcnet_hiddens": [], "post_fcnet_activation": "relu", "post_fcnet_weights_initializer": null, "post_fcnet_weights_initializer_config": null, "post_fcnet_bias_initializer": null, "post_fcnet_bias_initializer_config": null, "free_log_std": false, "log_std_clip_param": 20.0, "no_final_linear": false, "vf_share_layers": false, "use_lstm": false, "max_seq_len": 20, "lstm_cell_size": 256, "lstm_use_prev_action": false, "lstm_use_prev_reward": false, "lstm_weights_initializer": null, "lstm_weights_initializer_config": null, "lstm_bias_initializer": null, "lstm_bias_initializer_config": null, "_time_major": false, "use_attention": false, "attention_num_transformer_units": 1, "attention_dim": 64, "attention_num_heads": 1, "attention_head_dim": 32, "attention_memory_inference": 50, "attention_memory_training": 50, "attention_position_wise_mlp_dim": 32, "attention_init_gru_gate_bias": 2.0, "attention_use_n_prev_actions": 0, "attention_use_n_prev_rewards": 0, "framestack": true, "dim": 84, "grayscale": false, "zero_mean": true, "custom_model": null, "custom_model_config": {}, "custom_action_dist": null, "custom_preprocessor": null, "encoder_latent_dim": null, "always_check_shapes": false, "lstm_use_prev_action_reward": -1, "_use_default_native_models": -1, "_disable_preprocessor_api": false, "_disable_action_flattening": false}, "_learner_connector": null, "add_default_connectors_to_learner_pipeline": true, "learner_config_dict": {}, "optimizer": {}, "_learner_class": null, "explore": true, "exploration_config": {"type": "StochasticSampling"}, "count_steps_by": "env_steps", "policy_map_capacity": 100, "policy_mapping_fn": "<function policy_mapping_fn at 0x7f001e66b9a0>", "policies_to_train": null, "policy_states_are_swappable": false, "observation_fn": null, "input_read_method": "read_parquet", "input_read_method_kwargs": {}, "input_read_schema": {}, "input_read_episodes": false, "input_read_sample_batches": false, "input_read_batch_size": null, "input_filesystem": null, "input_filesystem_kwargs": {}, "input_compress_columns": ["obs", "new_obs"], "input_spaces_jsonable": true, "materialize_data": false, "materialize_mapped_data": true, "map_batches_kwargs": {}, "iter_batches_kwargs": {}, "prelearner_class": null, "prelearner_buffer_class": null, "prelearner_buffer_kwargs": {}, "prelearner_module_synch_period": 10, "dataset_num_iters_per_learner": null, "input_config": {}, "actions_in_input_normalized": false, "postprocess_inputs": false, "shuffle_buffer_size": 0, "output": null, "output_config": {}, "output_compress_columns": ["obs", "new_obs"], "output_max_file_size": 67108864, "output_max_rows_per_file": null, "output_write_method": "write_parquet", "output_write_method_kwargs": {}, "output_filesystem": null, "output_filesystem_kwargs": {}, "output_write_episodes": true, "offline_sampling": false, "evaluation_interval": null, "evaluation_duration": 10, "evaluation_duration_unit": "episodes", "evaluation_sample_timeout_s": 120.0, "evaluation_parallel_to_training": false, "evaluation_force_reset_envs_before_iteration": true, "evaluation_config": null, "off_policy_estimation_methods": {}, "ope_split_batch_by_episode": true, "evaluation_num_env_runners": 0, "in_evaluation": false, "sync_filters_on_rollout_workers_timeout_s": 10.0, "keep_per_episode_custom_metrics": false, "metrics_episode_collection_timeout_s": 60.0, "metrics_num_episodes_for_smoothing": 100, "min_time_s_per_iteration": null, "min_train_timesteps_per_iteration": 0, "min_sample_timesteps_per_iteration": 0, "log_gradients": true, "export_native_model_files": false, "checkpoint_trainable_policies_only": false, "logger_creator": null, "logger_config": null, "log_level": "WARN", "log_sys_usage": true, "fake_sampler": false, "seed": null, "_run_training_always_in_thread": false, "_evaluation_parallel_to_training_wo_thread": false, "recreate_failed_env_runners": false, "ignore_env_runner_failures": false, "max_num_env_runner_restarts": 1000, "delay_between_env_runner_restarts_s": 60.0, "restart_failed_sub_environments": false, "num_consecutive_env_runner_failures_tolerance": 100, "env_runner_health_probe_timeout_s": 30, "env_runner_restore_timeout_s": 1800, "_model_config": {}, "_rl_module_spec": null, "_AlgorithmConfig__prior_exploration_config": null, "algorithm_config_overrides_per_module": {}, "_per_module_overrides": {}, "_torch_grad_scaler_class": null, "_torch_lr_scheduler_classes": null, "_tf_policy_handles_more_than_one_loss": false, "_disable_preprocessor_api": false, "_disable_action_flattening": false, "_disable_initialize_loss_from_dummy_batch": false, "_dont_auto_sync_env_runner_states": false, "simple_optimizer": true, "policy_map_cache": -1, "worker_cls": -1, "synchronize_filters": -1, "enable_async_evaluation": -1, "custom_async_evaluation_function": -1, "_enable_rl_module_api": -1, "auto_wrap_old_gym_envs": -1, "always_attach_evaluation_results": -1, "replay_sequence_length": null, "_disable_execution_plan_api": -1, "lr_schedule": null, "use_critic": true, "use_gae": true, "use_kl_loss": true, "kl_coeff": 0.2, "kl_target": 0.01, "vf_loss_coeff": 1.0, "entropy_coeff": 1e-05, "entropy_coeff_schedule": null, "clip_param": 0.2, "vf_clip_param": 10.0, "sgd_minibatch_size": -1, "vf_share_layers": -1, "__stdout_file__": null, "__stderr_file__": null, "lambda": 1.0, "input": "sampler", "policies": {"high_level_policy": [null, "Box(-10.0, 10.0, (6,), float32)", "Box(-1.0, 1.0, (3,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72cbb0>"], "DC1_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d870>"], "DC2_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72d5a0>"], "DC3_ls_policy": [null, "Box(-10.0, 10.0, (15,), float32)", "Box(-1.0, 1.0, (1,), float32)", "<ray.rllib.algorithms.ppo.ppo.PPOConfig object at 0x7f001e72dab0>"]}, "callbacks": "<class 'custom_callbacks.CustomMetricsCallback'>", "create_env_on_driver": false, "custom_eval_function": null, "framework": "torch"}, "time_since_restore": 332.4242842197418, "iterations_since_restore": 88, "perf": {"cpu_util_percent": 19.18, "ram_util_percent": 3.1}}
